/*! For license information please see 582.9d359155.chunk.js.LICENSE.txt */
(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[582],{3322:function(e,t,n){var r=n(4993).default,i=n(1588).default,o=n(3808).default,a=n(7424).default,s=n(4704).default,c=n(7061).default,u=n(7156).default,l=n(6115).default,f=n(3496).default,d=n(1655).default,p=n(6389).default,h=n(6690).default,v=n(9728).default,m=n(861).default,g=n(8416).default;e.exports=function(){"use strict";var e,t,E,_,b;function y(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{},S=function(e){try{return!!e()}catch(e){return!0}},w=!S((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),R=w,O=Function.prototype,I=O.bind,A=O.call,k=R&&I.bind(A,A),C=R?function(e){return e&&k(e)}:function(e){return e&&function(){return A.apply(e,arguments)}},N=C({}.isPrototypeOf),x=function(e){return e&&e.Math==Math&&e},D=x("object"==typeof globalThis&&globalThis)||x("object"==typeof window&&window)||x("object"==typeof self&&self)||x("object"==typeof T&&T)||function(){return this}()||Function("return this")(),P=w,L=Function.prototype,M=L.apply,U=L.call,j="object"==typeof Reflect&&Reflect.apply||(P?U.bind(M):function(){return U.apply(M,arguments)}),F=function(e){return"function"==typeof e},B={},V=!S((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),G=w,W=Function.prototype.call,q=G?W.bind(W):function(){return W.apply(W,arguments)},H={},K={}.propertyIsEnumerable,z=Object.getOwnPropertyDescriptor,Y=z&&!K.call({1:2},1);H.f=Y?function(e){var t=z(this,e);return!!t&&t.enumerable}:K;var J,X,Q=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},$=C,Z=$({}.toString),ee=$("".slice),te=function(e){return ee(Z(e),8,-1)},ne=C,re=S,ie=te,oe=D.Object,ae=ne("".split),se=re((function(){return!oe("z").propertyIsEnumerable(0)}))?function(e){return"String"==ie(e)?ae(e,""):oe(e)}:oe,ce=D.TypeError,ue=function(e){if(null==e)throw ce("Can't call method on "+e);return e},le=se,fe=ue,de=function(e){return le(fe(e))},pe=F,he=function(e){return"object"==typeof e?null!==e:pe(e)},ve={},me=ve,ge=D,Ee=F,_e=function(e){return Ee(e)?e:void 0},be=function(e,t){return arguments.length<2?_e(me[e])||_e(ge[e]):me[e]&&me[e][t]||ge[e]&&ge[e][t]},ye=be("navigator","userAgent")||"",Te=D,Se=ye,we=Te.process,Re=Te.Deno,Oe=we&&we.versions||Re&&Re.version,Ie=Oe&&Oe.v8;Ie&&(X=(J=Ie.split("."))[0]>0&&J[0]<4?1:+(J[0]+J[1])),!X&&Se&&(!(J=Se.match(/Edge\/(\d+)/))||J[1]>=74)&&(J=Se.match(/Chrome\/(\d+)/))&&(X=+J[1]);var Ae=X,ke=Ae,Ce=S,Ne=!!Object.getOwnPropertySymbols&&!Ce((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ke&&ke<41})),xe=Ne&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,De=be,Pe=F,Le=N,Me=xe,Ue=D.Object,je=Me?function(e){return"symbol"==typeof e}:function(e){var t=De("Symbol");return Pe(t)&&Le(t.prototype,Ue(e))},Fe=D.String,Be=function(e){try{return Fe(e)}catch(e){return"Object"}},Ve=F,Ge=Be,We=D.TypeError,qe=function(e){if(Ve(e))return e;throw We(Ge(e)+" is not a function")},He=qe,Ke=function(e,t){var n=e[t];return null==n?void 0:He(n)},ze=q,Ye=F,Je=he,Xe=D.TypeError,Qe={exports:{}},$e=D,Ze=Object.defineProperty,et=function(e,t){try{Ze($e,e,{value:t,configurable:!0,writable:!0})}catch(S){$e[e]=t}return t},tt="__core-js_shared__",nt=D[tt]||et(tt,{}),rt=nt;(Qe.exports=function(e,t){return rt[e]||(rt[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"\xa9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var it=ue,ot=D.Object,at=function(e){return ot(it(e))},st=at,ct=C({}.hasOwnProperty),ut=Object.hasOwn||function(e,t){return ct(st(e),t)},lt=C,ft=0,dt=Math.random(),pt=lt(1..toString),ht=function(e){return"Symbol("+(void 0===e?"":e)+")_"+pt(++ft+dt,36)},vt=D,mt=Qe.exports,gt=ut,Et=ht,_t=Ne,bt=xe,yt=mt("wks"),Tt=vt.Symbol,St=Tt&&Tt.for,wt=bt?Tt:Tt&&Tt.withoutSetter||Et,Rt=function(e){if(!gt(yt,e)||!_t&&"string"!=typeof yt[e]){var t="Symbol."+e;_t&&gt(Tt,e)?yt[e]=Tt[e]:yt[e]=bt&&St?St(t):wt(t)}return yt[e]},Ot=q,It=he,At=je,kt=Ke,Ct=function(e,t){var n,r;if("string"===t&&Ye(n=e.toString)&&!Je(r=ze(n,e)))return r;if(Ye(n=e.valueOf)&&!Je(r=ze(n,e)))return r;if("string"!==t&&Ye(n=e.toString)&&!Je(r=ze(n,e)))return r;throw Xe("Can't convert object to primitive value")},Nt=Rt,xt=D.TypeError,Dt=Nt("toPrimitive"),Pt=function(e,t){if(!It(e)||At(e))return e;var n,r=kt(e,Dt);if(r){if(void 0===t&&(t="default"),n=Ot(r,e,t),!It(n)||At(n))return n;throw xt("Can't convert object to primitive value")}return void 0===t&&(t="number"),Ct(e,t)},Lt=je,Mt=function(e){var t=Pt(e,"string");return Lt(t)?t:t+""},Ut=he,jt=D.document,Ft=Ut(jt)&&Ut(jt.createElement),Bt=function(e){return Ft?jt.createElement(e):{}},Vt=Bt,Gt=!V&&!S((function(){return 7!=Object.defineProperty(Vt("div"),"a",{get:function(){return 7}}).a})),Wt=V,qt=q,Ht=H,Kt=Q,zt=de,Yt=Mt,Jt=ut,Xt=Gt,Qt=Object.getOwnPropertyDescriptor;B.f=Wt?Qt:function(e,t){if(e=zt(e),t=Yt(t),Xt)try{return Qt(e,t)}catch(e){}if(Jt(e,t))return Kt(!qt(Ht.f,e,t),e[t])};var $t=S,Zt=F,en=/#|\.prototype\./,tn=function(e,t){var n=rn[nn(e)];return n==an||n!=on&&(Zt(t)?$t(t):!!t)},nn=tn.normalize=function(e){return String(e).replace(en,".").toLowerCase()},rn=tn.data={},on=tn.NATIVE="N",an=tn.POLYFILL="P",sn=tn,cn=qe,un=w,ln=C(C.bind),fn=function(e,t){return cn(e),void 0===t?e:un?ln(e,t):function(){return e.apply(t,arguments)}},dn={},pn=V&&S((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),hn=D,vn=he,mn=hn.String,gn=hn.TypeError,En=function(e){if(vn(e))return e;throw gn(mn(e)+" is not an object")},_n=V,bn=Gt,yn=pn,Tn=En,Sn=Mt,wn=D.TypeError,Rn=Object.defineProperty,On=Object.getOwnPropertyDescriptor,In="enumerable",An="configurable",kn="writable";dn.f=_n?yn?function(e,t,n){if(Tn(e),t=Sn(t),Tn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&kn in n&&!n.writable){var r=On(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:An in n?n.configurable:r.configurable,enumerable:In in n?n.enumerable:r.enumerable,writable:!1})}return Rn(e,t,n)}:Rn:function(e,t,n){if(Tn(e),t=Sn(t),Tn(n),bn)try{return Rn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw wn("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Cn=dn,Nn=Q,xn=V?function(e,t,n){return Cn.f(e,t,Nn(1,n))}:function(e,t,n){return e[t]=n,e},Dn=D,Pn=j,Ln=C,Mn=F,Un=B.f,jn=sn,Fn=ve,Bn=fn,Vn=xn,Gn=ut,Wn=function(e){var t=function t(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return Pn(e,this,arguments)};return t.prototype=e.prototype,t},qn=function(e,t){var n,r,i,o,a,s,c,u,l=e.target,f=e.global,d=e.stat,p=e.proto,h=f?Dn:d?Dn[l]:(Dn[l]||{}).prototype,v=f?Fn:Fn[l]||Vn(Fn,l,{})[l],m=v.prototype;for(i in t)n=!jn(f?i:l+(d?".":"#")+i,e.forced)&&h&&Gn(h,i),a=v[i],n&&(s=e.noTargetGet?(u=Un(h,i))&&u.value:h[i]),o=n&&s?s:t[i],n&&typeof a==typeof o||(c=e.bind&&n?Bn(o,Dn):e.wrap&&n?Wn(o):p&&Mn(o)?Ln(o):o,(e.sham||o&&o.sham||a&&a.sham)&&Vn(c,"sham",!0),Vn(v,i,c),p&&(Gn(Fn,r=l+"Prototype")||Vn(Fn,r,{}),Vn(Fn[r],i,o),e.real&&m&&!m[i]&&Vn(m,i,o)))},Hn=Math.ceil,Kn=Math.floor,zn=function(e){var t=+e;return t!=t||0===t?0:(t>0?Kn:Hn)(t)},Yn=zn,Jn=Math.min,Xn=function(e){return e>0?Jn(Yn(e),9007199254740991):0},Qn=function(e){return Xn(e.length)},$n=qe,Zn=at,er=se,tr=Qn,nr=D.TypeError,rr=function(e){return function(t,n,r,i){$n(n);var o=Zn(t),a=er(o),s=tr(o),c=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(c in a){i=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw nr("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(i=n(i,a[c],c,o));return i}},ir={left:rr(!1),right:rr(!0)},or=S,ar=function(e,t){var n=[][e];return!!n&&or((function(){n.call(null,t||function(){throw 1},1)}))},sr="process"==te(D.process),cr=ir.left,ur=Ae,lr=sr;qn({target:"Array",proto:!0,forced:!ar("reduce")||!lr&&ur>79&&ur<83},{reduce:function(e){var t=arguments.length;return cr(this,e,t,t>1?arguments[1]:void 0)}});var fr=ve,dr=function(e){return fr[e+"Prototype"]},pr=dr("Array").reduce,hr=N,vr=pr,mr=Array.prototype,gr=function(e){var t=e.reduce;return e===mr||hr(mr,e)&&t===mr.reduce?vr:t},Er=gr,_r=!0,br=!0;function yr(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Tr(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function Sr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(_r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function wr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(br=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Rr(){if("object"==typeof window){if(_r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Or(e,t){br&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Ir(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=yr(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=yr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=yr(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function Ar(e){return"[object Object]"===Object.prototype.toString.call(e)}function kr(e){var t;return Ar(e)?Er(t=Object.keys(e)).call(t,(function(t,n){var r=Ar(e[n]),i=r?kr(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,g({},n,i))}),{}):e}function Cr(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach((function(i){i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach((function(n){e(t,t.get(n),r)}))})))}(e,n,i)}))})),i}var Nr=Qe.exports,xr=ht,Dr=Nr("keys"),Pr=function(e){return Dr[e]||(Dr[e]=xr(e))},Lr=!S((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Mr=D,Ur=ut,jr=F,Fr=at,Br=Lr,Vr=Pr("IE_PROTO"),Gr=Mr.Object,Wr=Gr.prototype,qr=Br?Gr.getPrototypeOf:function(e){var t=Fr(e);if(Ur(t,Vr))return t[Vr];var n=t.constructor;return jr(n)&&t instanceof n?n.prototype:t instanceof Gr?Wr:null},Hr=D,Kr=F,zr=Hr.String,Yr=Hr.TypeError,Jr=C,Xr=En,Qr=function(e){if("object"==typeof e||Kr(e))return e;throw Yr("Can't set "+zr(e)+" as a prototype")},$r=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Jr(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Xr(n),Qr(r),t?e(n,r):n.__proto__=r,n}}():void 0),Zr={},ei=zn,ti=Math.max,ni=Math.min,ri=function(e,t){var n=ei(e);return n<0?ti(n+t,0):ni(n,t)},ii=de,oi=ri,ai=Qn,si=function(e){return function(t,n,r){var i,o=ii(t),a=ai(o),s=oi(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},ci={includes:si(!0),indexOf:si(!1)},ui={},li=ut,fi=de,di=ci.indexOf,pi=ui,hi=C([].push),vi=function(e,t){var n,r=fi(e),i=0,o=[];for(n in r)!li(pi,n)&&li(r,n)&&hi(o,n);for(;t.length>i;)li(r,n=t[i++])&&(~di(o,n)||hi(o,n));return o},mi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],gi=vi,Ei=mi.concat("length","prototype");Zr.f=Object.getOwnPropertyNames||function(e){return gi(e,Ei)};var _i={};_i.f=Object.getOwnPropertySymbols;var bi=be,yi=Zr,Ti=_i,Si=En,wi=C([].concat),Ri=bi("Reflect","ownKeys")||function(e){var t=yi.f(Si(e)),n=Ti.f;return n?wi(t,n(e)):t},Oi=ut,Ii=Ri,Ai=B,ki=dn,Ci={},Ni=vi,xi=mi,Di=Object.keys||function(e){return Ni(e,xi)},Pi=V,Li=pn,Mi=dn,Ui=En,ji=de,Fi=Di;Ci.f=Pi&&!Li?Object.defineProperties:function(e,t){Ui(e);for(var n,r=ji(t),i=Fi(t),o=i.length,a=0;o>a;)Mi.f(e,n=i[a++],r[n]);return e};var Bi,Vi=be("document","documentElement"),Gi=En,Wi=Ci,qi=mi,Hi=ui,Ki=Vi,zi=Bt,Yi=Pr("IE_PROTO"),Ji=function(){},Xi=function(e){return"<script>"+e+"<\/script>"},Qi=function(e){e.write(Xi("")),e.close();var t=e.parentWindow.Object;return e=null,t},$i=function(){try{Bi=new ActiveXObject("htmlfile")}catch(e){}var e,t;$i="undefined"!=typeof document?document.domain&&Bi?Qi(Bi):((t=zi("iframe")).style.display="none",Ki.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Xi("document.F=Object")),e.close(),e.F):Qi(Bi);for(var n=qi.length;n--;)delete $i.prototype[qi[n]];return $i()};Hi[Yi]=!0;var Zi=Object.create||function(e,t){var n;return null!==e?(Ji.prototype=Gi(e),n=new Ji,Ji.prototype=null,n[Yi]=e):n=$i(),void 0===t?n:Wi.f(n,t)},eo=C("".replace),to=String(Error("zxcasd").stack),no=/\n\s*at [^:]*:[^\n]*/,ro=no.test(to),io=he,oo=xn,ao={},so=ao,co=Rt("iterator"),uo=Array.prototype,lo={};lo[Rt("toStringTag")]="z";var fo="[object z]"===String(lo),po=D,ho=fo,vo=F,mo=te,go=Rt("toStringTag"),Eo=po.Object,_o="Arguments"==mo(function(){return arguments}()),bo=ho?mo:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Eo(e),go))?n:_o?mo(t):"Object"==(r=mo(t))&&vo(t.callee)?"Arguments":r},yo=bo,To=Ke,So=ao,wo=Rt("iterator"),Ro=function(e){if(null!=e)return To(e,wo)||To(e,"@@iterator")||So[yo(e)]},Oo=q,Io=qe,Ao=En,ko=Be,Co=Ro,No=D.TypeError,xo=q,Do=En,Po=Ke,Lo=fn,Mo=q,Uo=En,jo=Be,Fo=function(e){return void 0!==e&&(so.Array===e||uo[co]===e)},Bo=Qn,Vo=N,Go=function(e,t){var n=arguments.length<2?Co(e):t;if(Io(n))return Ao(Oo(n,e));throw No(ko(e)+" is not iterable")},Wo=Ro,qo=function(e,t,n){var r,i;Do(e);try{if(!(r=Po(e,"return"))){if("throw"===t)throw n;return n}r=xo(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return Do(r),n},Ho=D.TypeError,Ko=function(e,t){this.stopped=e,this.result=t},zo=Ko.prototype,Yo=function(e,t,n){var r,i,o,a,s,c,u,l=n&&n.that,f=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),h=Lo(t,l),v=function(e){return r&&qo(r,"normal",e),new Ko(!0,e)},m=function(e){return f?(Uo(e),p?h(e[0],e[1],v):h(e[0],e[1])):p?h(e,v):h(e)};if(d)r=e;else{if(!(i=Wo(e)))throw Ho(jo(e)+" is not iterable");if(Fo(i)){for(o=0,a=Bo(e);a>o;o++)if((s=m(e[o]))&&Vo(zo,s))return s;return new Ko(!1)}r=Go(e,i)}for(c=r.next;!(u=Mo(c,r)).done;){try{s=m(u.value)}catch(e){qo(r,"throw",e)}if("object"==typeof s&&s&&Vo(zo,s))return s}return new Ko(!1)},Jo=bo,Xo=D.String,Qo=function(e){if("Symbol"===Jo(e))throw TypeError("Cannot convert a Symbol value to a string");return Xo(e)},$o=Qo,Zo=Q,ea=!S((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Zo(1,7)),7!==e.stack)})),ta=qn,na=D,ra=N,ia=qr,oa=$r,aa=function(e,t,n){for(var r=Ii(t),i=ki.f,o=Ai.f,a=0;a<r.length;a++){var s=r[a];Oi(e,s)||n&&Oi(n,s)||i(e,s,o(t,s))}},sa=Zi,ca=xn,ua=Q,la=function(e,t){if(ro&&"string"==typeof e)for(;t--;)e=eo(e,no,"");return e},fa=function(e,t){io(t)&&"cause"in t&&oo(e,"cause",t.cause)},da=Yo,pa=function(e,t){return void 0===e?arguments.length<2?"":t:$o(e)},ha=ea,va=Rt("toStringTag"),ma=na.Error,ga=[].push,Ea=function(e,t){var n,r=arguments.length>2?arguments[2]:void 0,i=ra(_a,this);oa?n=oa(new ma,i?ia(this):_a):(n=i?this:sa(_a),ca(n,va,"Error")),void 0!==t&&ca(n,"message",pa(t)),ha&&ca(n,"stack",la(n.stack,1)),fa(n,r);var o=[];return da(e,ga,{that:o}),ca(n,"errors",o),n};oa?oa(Ea,ma):aa(Ea,ma,{name:!0});var _a=Ea.prototype=sa(ma.prototype,{constructor:ua(1,Ea),message:ua(1,""),name:ua(1,"AggregateError")});ta({global:!0},{AggregateError:Ea});var ba=F,ya=nt,Ta=C(Function.toString);ba(ya.inspectSource)||(ya.inspectSource=function(e){return Ta(e)});var Sa,wa,Ra,Oa=ya.inspectSource,Ia=F,Aa=Oa,ka=D.WeakMap,Ca=Ia(ka)&&/native code/.test(Aa(ka)),Na=D,xa=C,Da=he,Pa=xn,La=ut,Ma=nt,Ua=Pr,ja=ui,Fa="Object already initialized",Ba=Na.TypeError,Va=Na.WeakMap;if(Ca||Ma.state){var Ga=Ma.state||(Ma.state=new Va),Wa=xa(Ga.get),qa=xa(Ga.has),Ha=xa(Ga.set);Sa=function(e,t){if(qa(Ga,e))throw new Ba(Fa);return t.facade=e,Ha(Ga,e,t),t},wa=function(e){return Wa(Ga,e)||{}},Ra=function(e){return qa(Ga,e)}}else{var Ka=Ua("state");ja[Ka]=!0,Sa=function(e,t){if(La(e,Ka))throw new Ba(Fa);return t.facade=e,Pa(e,Ka,t),t},wa=function(e){return La(e,Ka)?e[Ka]:{}},Ra=function(e){return La(e,Ka)}}var za,Ya,Ja,Xa={set:Sa,get:wa,has:Ra,enforce:function(e){return Ra(e)?wa(e):Sa(e,{})},getterFor:function(e){return function(t){var n;if(!Da(t)||(n=wa(t)).type!==e)throw Ba("Incompatible receiver, "+e+" required");return n}}},Qa=V,$a=ut,Za=Function.prototype,es=Qa&&Object.getOwnPropertyDescriptor,ts=$a(Za,"name"),ns={EXISTS:ts,PROPER:ts&&"something"===function(){}.name,CONFIGURABLE:ts&&(!Qa||Qa&&es(Za,"name").configurable)},rs=xn,is=function(e,t,n,r){r&&r.enumerable?e[t]=n:rs(e,t,n)},os=S,as=F,ss=Zi,cs=qr,us=is,ls=Rt("iterator"),fs=!1;[].keys&&("next"in(Ja=[].keys())?(Ya=cs(cs(Ja)))!==Object.prototype&&(za=Ya):fs=!0);var ds=null==za||os((function(){var e={};return za[ls].call(e)!==e}));as((za=ds?{}:ss(za))[ls])||us(za,ls,(function(){return this}));var ps={IteratorPrototype:za,BUGGY_SAFARI_ITERATORS:fs},hs=bo,vs=fo?{}.toString:function(){return"[object "+hs(this)+"]"},ms=fo,gs=dn.f,Es=xn,_s=ut,bs=vs,ys=Rt("toStringTag"),Ts=function(e,t,n,r){if(e){var i=n?e:e.prototype;_s(i,ys)||gs(i,ys,{configurable:!0,value:t}),r&&!ms&&Es(i,"toString",bs)}},Ss=ps.IteratorPrototype,ws=Zi,Rs=Q,Os=Ts,Is=ao,As=function(){return this},ks=qn,Cs=q,Ns=function(e,t,n,r){var i=t+" Iterator";return e.prototype=ws(Ss,{next:Rs(+!r,n)}),Os(e,i,!1,!0),Is[i]=As,e},xs=qr,Ds=Ts,Ps=is,Ls=ao,Ms=ns.PROPER,Us=ps.BUGGY_SAFARI_ITERATORS,js=Rt("iterator"),Fs="keys",Bs="values",Vs="entries",Gs=function(){return this},Ws=function(e,t,n,r,i,o,a){Ns(n,t,r);var s,c,u,l=function(e){if(e===i&&v)return v;if(!Us&&e in p)return p[e];switch(e){case Fs:case Bs:case Vs:return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",d=!1,p=e.prototype,h=p[js]||p["@@iterator"]||i&&p[i],v=!Us&&h||l(i),m="Array"==t&&p.entries||h;if(m&&(s=xs(m.call(new e)))!==Object.prototype&&s.next&&(Ds(s,f,!0,!0),Ls[f]=Gs),Ms&&i==Bs&&h&&h.name!==Bs&&(d=!0,v=function(){return Cs(h,this)}),i)if(c={values:l(Bs),keys:o?v:l(Fs),entries:l(Vs)},a)for(u in c)(Us||d||!(u in p))&&Ps(p,u,c[u]);else ks({target:t,proto:!0,forced:Us||d},c);return a&&p[js]!==v&&Ps(p,js,v,{name:i}),Ls[t]=v,c},qs=de,Hs=ao,Ks=Xa;dn.f;var zs=Ws,Ys="Array Iterator",Js=Ks.set,Xs=Ks.getterFor(Ys);zs(Array,"Array",(function(e,t){Js(this,{type:Ys,target:qs(e),index:0,kind:t})}),(function(){var e=Xs(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),Hs.Arguments=Hs.Array;var Qs=D.Promise,$s=is,Zs=be,ec=dn,tc=V,nc=Rt("species"),rc=N,ic=D.TypeError,oc=Rt("iterator"),ac=!1;try{var sc=0,cc={next:function(){return{done:!!sc++}},return:function(){ac=!0}};cc[oc]=function(){return this},Array.from(cc,(function(){throw 2}))}catch(y){}var uc=C,lc=S,fc=F,dc=bo,pc=Oa,hc=function(){},vc=[],mc=be("Reflect","construct"),gc=/^\s*(?:class|function)\b/,Ec=uc(gc.exec),_c=!gc.exec(hc),bc=function(e){if(!fc(e))return!1;try{return mc(hc,vc,e),!0}catch(e){return!1}},yc=function(e){if(!fc(e))return!1;switch(dc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return _c||!!Ec(gc,pc(e))}catch(e){return!0}};yc.sham=!0;var Tc,Sc,wc,Rc,Oc=!mc||lc((function(){var e;return bc(bc.call)||!bc(Object)||!bc((function(){e=!0}))||e}))?yc:bc,Ic=Oc,Ac=Be,kc=D.TypeError,Cc=En,Nc=function(e){if(Ic(e))return e;throw kc(Ac(e)+" is not a constructor")},xc=Rt("species"),Dc=function(e,t){var n,r=Cc(e).constructor;return void 0===r||null==(n=Cc(r)[xc])?t:Nc(n)},Pc=C([].slice),Lc=/(?:ipad|iphone|ipod).*applewebkit/i.test(ye),Mc=D,Uc=j,jc=fn,Fc=F,Bc=ut,Vc=S,Gc=Vi,Wc=Pc,qc=Bt,Hc=Lc,Kc=sr,zc=Mc.setImmediate,Yc=Mc.clearImmediate,Jc=Mc.process,Xc=Mc.Dispatch,Qc=Mc.Function,$c=Mc.MessageChannel,Zc=Mc.String,eu=0,tu={},nu="onreadystatechange";try{Tc=Mc.location}catch(y){}var ru=function(e){if(Bc(tu,e)){var t=tu[e];delete tu[e],t()}},iu=function(e){return function(){ru(e)}},ou=function(e){ru(e.data)},au=function(e){Mc.postMessage(Zc(e),Tc.protocol+"//"+Tc.host)};zc&&Yc||(zc=function(e){var t=Wc(arguments,1);return tu[++eu]=function(){Uc(Fc(e)?e:Qc(e),void 0,t)},Sc(eu),eu},Yc=function(e){delete tu[e]},Kc?Sc=function(e){Jc.nextTick(iu(e))}:Xc&&Xc.now?Sc=function(e){Xc.now(iu(e))}:$c&&!Hc?(Rc=(wc=new $c).port2,wc.port1.onmessage=ou,Sc=jc(Rc.postMessage,Rc)):Mc.addEventListener&&Fc(Mc.postMessage)&&!Mc.importScripts&&Tc&&"file:"!==Tc.protocol&&!Vc(au)?(Sc=au,Mc.addEventListener("message",ou,!1)):Sc=nu in qc("script")?function(e){Gc.appendChild(qc("script")).onreadystatechange=function(){Gc.removeChild(this),ru(e)}}:function(e){setTimeout(iu(e),0)});var su,cu,uu,lu,fu,du,pu,hu,vu={set:zc,clear:Yc},mu=D,gu=/ipad|iphone|ipod/i.test(ye)&&void 0!==mu.Pebble,Eu=/web0s(?!.*chrome)/i.test(ye),_u=D,bu=fn,yu=B.f,Tu=vu.set,Su=Lc,wu=gu,Ru=Eu,Ou=sr,Iu=_u.MutationObserver||_u.WebKitMutationObserver,Au=_u.document,ku=_u.process,Cu=_u.Promise,Nu=yu(_u,"queueMicrotask"),xu=Nu&&Nu.value;xu||(su=function(){var e,t;for(Ou&&(e=ku.domain)&&e.exit();cu;){t=cu.fn,cu=cu.next;try{t()}catch(e){throw cu?lu():uu=void 0,e}}uu=void 0,e&&e.enter()},Su||Ou||Ru||!Iu||!Au?!wu&&Cu&&Cu.resolve?((pu=Cu.resolve(void 0)).constructor=Cu,hu=bu(pu.then,pu),lu=function(){hu(su)}):Ou?lu=function(){ku.nextTick(su)}:(Tu=bu(Tu,_u),lu=function(){Tu(su)}):(fu=!0,du=Au.createTextNode(""),new Iu(su).observe(du,{characterData:!0}),lu=function(){du.data=fu=!fu}));var Du=xu||function(e){var t={fn:e,next:void 0};uu&&(uu.next=t),cu||(cu=t,lu()),uu=t},Pu={},Lu=qe,Mu=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Lu(t),this.reject=Lu(n)};Pu.f=function(e){return new Mu(e)};var Uu=En,ju=he,Fu=Pu,Bu=function(e,t){if(Uu(e),ju(t)&&t.constructor===e)return t;var n=Fu.f(e);return(0,n.resolve)(t),n.promise},Vu=D,Gu=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Wu=function(){this.head=null,this.tail=null};Wu.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var qu,Hu,Ku,zu="object"==typeof window,Yu=qn,Ju=D,Xu=be,Qu=q,$u=Qs,Zu=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:$s(e,r,t[r],n);return e},el=Ts,tl=function(e){var t=Zs(e),n=ec.f;tc&&t&&!t[nc]&&n(t,nc,{configurable:!0,get:function(){return this}})},nl=qe,rl=F,il=he,ol=function(e,t){if(rc(t,e))return e;throw ic("Incorrect invocation")},al=Oa,sl=Yo,cl=function(e,t){if(!t&&!ac)return!1;var n=!1;try{var r={};r[oc]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},ul=Dc,ll=vu.set,fl=Du,dl=Bu,pl=function(e,t){var n=Vu.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},hl=Pu,vl=Gu,ml=Wu,gl=Xa,El=sn,_l=zu,bl=sr,yl=Ae,Tl=Rt("species"),Sl="Promise",wl=gl.getterFor(Sl),Rl=gl.set,Ol=gl.getterFor(Sl),Il=$u&&$u.prototype,Al=$u,kl=Il,Cl=Ju.TypeError,Nl=Ju.document,xl=Ju.process,Dl=hl.f,Pl=Dl,Ll=!!(Nl&&Nl.createEvent&&Ju.dispatchEvent),Ml=rl(Ju.PromiseRejectionEvent),Ul="unhandledrejection",jl=El(Sl,(function(){var e=al(Al),t=e!==String(Al);if(!t&&66===yl)return!0;if(!kl.finally)return!0;if(yl>=51&&/native code/.test(e))return!1;var n=new Al((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[Tl]=r,!(n.then((function(){}))instanceof r)||!t&&_l&&!Ml})),Fl=jl||!cl((function(e){Al.all(e).catch((function(){}))})),Bl=function(e){var t;return!(!il(e)||!rl(t=e.then))&&t},Vl=function(e,t){var n,r,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&Kl(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),i=!0)),n===e.promise?u(Cl("Promise-chain cycle")):(r=Bl(n))?Qu(r,n,c,u):c(n)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},Gl=function(e,t){e.notified||(e.notified=!0,fl((function(){for(var n,r=e.reactions;n=r.get();)Vl(n,e);e.notified=!1,t&&!e.rejection&&ql(e)})))},Wl=function(e,t,n){var r,i;Ll?((r=Nl.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Ju.dispatchEvent(r)):r={promise:t,reason:n},!Ml&&(i=Ju["on"+e])?i(r):e===Ul&&pl("Unhandled promise rejection",n)},ql=function(e){Qu(ll,Ju,(function(){var t,n=e.facade,r=e.value;if(Hl(e)&&(t=vl((function(){bl?xl.emit("unhandledRejection",r,n):Wl(Ul,n,r)})),e.rejection=bl||Hl(e)?2:1,t.error))throw t.value}))},Hl=function(e){return 1!==e.rejection&&!e.parent},Kl=function(e){Qu(ll,Ju,(function(){var t=e.facade;bl?xl.emit("rejectionHandled",t):Wl("rejectionhandled",t,e.value)}))},zl=function(e,t,n){return function(r){e(t,r,n)}},Yl=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Gl(e,!0))},Jl=function e(t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===n)throw Cl("Promise can't be resolved itself");var i=Bl(n);i?fl((function(){var r={done:!1};try{Qu(i,n,zl(e,r,t),zl(Yl,r,t))}catch(n){Yl(r,n,t)}})):(t.value=n,t.state=1,Gl(t,!1))}catch(n){Yl({done:!1},n,t)}}};jl&&(kl=(Al=function(e){ol(this,kl),nl(e),Qu(qu,this);var t=wl(this);try{e(zl(Jl,t),zl(Yl,t))}catch(e){Yl(t,e)}}).prototype,(qu=function(e){Rl(this,{type:Sl,done:!1,notified:!1,parent:!1,reactions:new ml,rejection:!1,state:0,value:void 0})}).prototype=Zu(kl,{then:function(e,t){var n=Ol(this),r=Dl(ul(this,Al));return n.parent=!0,r.ok=!rl(e)||e,r.fail=rl(t)&&t,r.domain=bl?xl.domain:void 0,0==n.state?n.reactions.add(r):fl((function(){Vl(r,n)})),r.promise},catch:function(e){return this.then(void 0,e)}}),Hu=function(){var e=new qu,t=wl(e);this.promise=e,this.resolve=zl(Jl,t),this.reject=zl(Yl,t)},hl.f=Dl=function(e){return e===Al||e===Ku?new Hu(e):Pl(e)}),Yu({global:!0,wrap:!0,forced:jl},{Promise:Al}),el(Al,Sl,!1,!0),tl(Sl),Ku=Xu(Sl),Yu({target:Sl,stat:!0,forced:jl},{reject:function(e){var t=Dl(this);return Qu(t.reject,void 0,e),t.promise}}),Yu({target:Sl,stat:!0,forced:!0},{resolve:function(e){return dl(this===Ku?Al:this,e)}}),Yu({target:Sl,stat:!0,forced:Fl},{all:function(e){var t=this,n=Dl(t),r=n.resolve,i=n.reject,o=vl((function(){var n=nl(t.resolve),o=[],a=0,s=1;sl(e,(function(e){var c=a++,u=!1;s++,Qu(n,t,e).then((function(e){u||(u=!0,o[c]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=Dl(t),r=n.reject,i=vl((function(){var i=nl(t.resolve);sl(e,(function(e){Qu(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Xl=q,Ql=qe,$l=Pu,Zl=Gu,ef=Yo;qn({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=$l.f(t),r=n.resolve,i=n.reject,o=Zl((function(){var n=Ql(t.resolve),i=[],o=0,a=1;ef(e,(function(e){var s=o++,c=!1;a++,Xl(n,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||r(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||r(i))}))})),--a||r(i)}));return o.error&&i(o.value),n.promise}});var tf=qe,nf=be,rf=q,of=Pu,af=Gu,sf=Yo,cf="No one promise resolved";qn({target:"Promise",stat:!0},{any:function(e){var t=this,n=nf("AggregateError"),r=of.f(t),i=r.resolve,o=r.reject,a=af((function(){var r=tf(t.resolve),a=[],s=0,c=1,u=!1;sf(e,(function(e){var l=s++,f=!1;c++,rf(r,t,e).then((function(e){f||u||(u=!0,i(e))}),(function(e){f||u||(f=!0,a[l]=e,--c||o(new n(a,cf)))}))})),--c||o(new n(a,cf))}));return a.error&&o(a.value),r.promise}});var uf=Qs,lf=be,ff=F,df=Dc,pf=Bu;qn({target:"Promise",proto:!0,real:!0,forced:!!uf&&S((function(){uf.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=df(this,lf("Promise")),n=ff(e);return this.then(n?function(n){return pf(t,e()).then((function(){return n}))}:e,n?function(n){return pf(t,e()).then((function(){throw n}))}:e)}});var hf=C,vf=zn,mf=Qo,gf=ue,Ef=hf("".charAt),_f=hf("".charCodeAt),bf=hf("".slice),yf=function(e){return function(t,n){var r,i,o=mf(gf(t)),a=vf(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=_f(o,a))<55296||r>56319||a+1===s||(i=_f(o,a+1))<56320||i>57343?e?Ef(o,a):r:e?bf(o,a,a+2):i-56320+(r-55296<<10)+65536}},Tf=(yf(!1),yf(!0)),Sf=Qo,wf=Xa,Rf=Ws,Of="String Iterator",If=wf.set,Af=wf.getterFor(Of);Rf(String,"String",(function(e){If(this,{type:Of,string:Sf(e),index:0})}),(function(){var e,t=Af(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Tf(n,r),t.index+=e.length,{value:e,done:!1})}));var kf=ve.Promise,Cf={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Nf=D,xf=bo,Df=xn,Pf=ao,Lf=Rt("toStringTag");for(var Mf in Cf){var Uf=Nf[Mf],jf=Uf&&Uf.prototype;jf&&xf(jf)!==Lf&&Df(jf,Lf,Mf),Pf[Mf]=Pf.Array}var Ff=kf,Bf=Ff,Vf=Rr;function Gf(e,t){var n=e&&e.navigator;if(n.mediaDevices){var r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),(o={})[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var o=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){var a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});var s,c=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)&&(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?s=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(s=["front"]),s))return n.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return s.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&s.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=a.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=r(e.video),Vf("chrome: "+JSON.stringify(e)),i(e)}));e.video=r(e.video)}return Vf("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){var a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return a(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Bf.reject(o(e))}))}))}}}}function Wf(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function qf(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})),t.stream.getTracks().forEach((function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Tr(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function Hf(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Kf(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],i=n[1],o=n[2];if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(a(e)))};return t.apply(this,[c,r])}return new Bf((function(n,r){t.apply(e,[function(e){n(s(a(e)))},r])})).then(i,o)}}}function zf(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return Cr(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),Tr(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return Cr(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,o=arguments[0];return this.getSenders().forEach((function(e){e.track===o&&(t?r=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===o&&(n?r=!0:n=e),e.track===o})),r||t&&n?Bf.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Bf.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function Yf(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),i.apply(this,arguments)}}function Jf(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Yf(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find((function(e){return e.track===t}));if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[n.id];if(a)a.addTrack(t),Bf.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[n.id]=s,this._reverseStreams[s.id]=n,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=g({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(n){var r=s(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=c(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(r){n._streams[r].getTracks().find((function(t){return e.track===t}))&&(t=n._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function c(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}}function Xf(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=g({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}))}function Qf(e,t){Tr(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var $f=Object.freeze({__proto__:null,shimMediaStream:Wf,shimOnTrack:qf,shimGetSendersWithDtmf:Hf,shimGetStats:Kf,shimSenderReceiverGetStats:zf,shimAddTrackRemoveTrackWithNative:Yf,shimAddTrackRemoveTrack:Jf,shimPeerConnection:Xf,fixNegotiationNeeded:Qf,shimGetUserMedia:Gf,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function Zf(e,t){var n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Or("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},r&&r.prototype.getSettings){var a=r.prototype.getSettings;r.prototype.getSettings=function(){var e=a.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function ed(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function td(e,t){if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=g({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),i=e[0],o=e[1],a=e[2];return r.apply(this,[i||null]).then((function(e){if(t.version<53&&!o)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(o,a)}}}function nd(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Bf.resolve(new Map)}}}function rd(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),Tr(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function id(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;Or("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})}function od(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ad(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var n=(e=m(e)).length>0;n&&e.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var i=r.sender,o=i.getParameters();(!("encodings"in o)||1===o.encodings.length&&0===Object.keys(o.encodings[0]).length)&&(o.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(o).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return r})}}function sd(e){if("object"==typeof e&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function cd(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Bf.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function ud(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Bf.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}var ld=Object.freeze({__proto__:null,shimOnTrack:ed,shimPeerConnection:td,shimSenderGetStats:nd,shimReceiverGetStats:rd,shimRemoveStream:id,shimRTCDataChannel:od,shimAddTransceiver:ad,shimGetParameters:sd,shimCreateOffer:cd,shimCreateAnswer:ud,shimGetUserMedia:Zf,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Bf.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function fd(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i&&i.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}}function dd(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function pd(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Bf.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Bf.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Bf.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Bf.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Bf.resolve()):r},t.addIceCandidate=s}}function hd(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(vd(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function vd(e){return e&&void 0!==e.video?Object.assign({},e,{video:kr(e.video)}):e}function md(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(Or("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,r.push(o)):r.push(e.iceServers[i])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function gd(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Ed(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function _d(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var bd=Object.freeze({__proto__:null,shimLocalStreamsAPI:fd,shimRemoteStreamsAPI:dd,shimCallbacksAPI:pd,shimGetUserMedia:hd,shimConstraints:vd,shimRTCIceServerUrls:md,shimTrackEventTransceiver:gd,shimCreateOfferLegacy:Ed,shimAudioContext:_d}),yd="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",Td=ue,Sd=Qo,wd=C("".replace),Rd="[\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]",Od=RegExp("^"+Rd+Rd+"*"),Id=RegExp(Rd+Rd+"*$"),Ad=function(e){return function(t){var n=Sd(Td(t));return 1&e&&(n=wd(n,Od,"")),2&e&&(n=wd(n,Id,"")),n}},kd={start:Ad(1),end:Ad(2),trim:Ad(3)},Cd=ns.PROPER,Nd=S,xd=yd,Dd=kd.trim;qn({target:"String",proto:!0,forced:function(e){return Nd((function(){return!!xd[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||Cd&&xd[e].name!==e}))}("trim")},{trim:function(){return Dd(this)}});var Pd=dr("String").trim,Ld=N,Md=Pd,Ud=String.prototype,jd=function(e){var t=e.trim;return"string"==typeof e||e===Ud||Ld(Ud,e)&&t===Ud.trim?Md:t},Fd={exports:{}};!function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return jd(e).call(e).split("\n").map((function(e){return jd(e).call(e)}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){var n;return jd(n=t>0?"m="+e:e).call(n)+"\r\n"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation);var n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++){var o,a;t=jd(o=r[i]).call(o).split("="),n[jd(a=t[0]).call(a)]=t[1]}return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=t.parseRtpMap(a),c=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){var r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));var i=0;return n.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((function(e){r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){var n,r=[],i=t.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(n=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),r.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&c&&r.push({ssrc:c});var l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=l}))),r},t.parseRtcpParameters=function(e){var n={},r=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;var o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){var n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(n=r[0].substr(7).split(" "))[0],track:n[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(n=i[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(n=parseInt(i[0].substr(19),10)),isNaN(n)&&(n=65536);var o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:n};var a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){var s=a[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){var i=void 0!==n?n:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){for(var r=t.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),r=0;r<n.length;r++)if(n[r].length<2||"="!==n[r].charAt(1))return!1;return!0},e.exports=t}(Fd);var Bd=Fd.exports,Vd=Object.freeze(y({__proto__:null,default:Bd},[Fd.exports]));function Gd(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),r=Bd.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Tr(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function Wd(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Tr(e,"icecandidate",(function(e){if(e.candidate){var t=Bd.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function qd(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=Bd.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=Bd.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=Bd.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),n(arguments[0])){var e,s=r(arguments[0]),c=i(s),u=o(arguments[0],s);e=0===c&&0===u?Number.POSITIVE_INFINITY:0===c||0===u?Math.max(c,u):Math.min(c,u);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return e}}),this._sctp=l}return a.apply(this,arguments)}}}function Hd(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},Tr(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function Kd(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}}function zd(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71)&&!("safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var r=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==jd(e).call(e)})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return n.apply(this,arguments)}}}function Yd(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Bf.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Bf.resolve())})}}function Jd(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!=typeof t||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then((function(t){return n.apply(e,[t])}))})}}var Xd,Qd,$d=Object.freeze({__proto__:null,shimRTCIceCandidate:Gd,shimRTCIceCandidateRelayProtocol:Wd,shimMaxMessageSize:qd,shimSendThrowTypeError:Hd,shimConnectionState:Kd,removeExtmapAllowMixed:zd,shimAddIceCandidateNullOrEmpty:Yd,shimParameterlessSetLocalDescription:Jd});!function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=Rr,r=Ir(e),i={browserDetails:r,commonShim:$d,extractVersion:yr,disableLog:Sr,disableWarnings:wr,sdp:Vd};switch(r.browser){case"chrome":if(!$f||!Xf||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=$f,Yd(e,r),Jd(e),Gf(e,r),Wf(e),Xf(e,r),qf(e),Jf(e,r),Hf(e),Kf(e),zf(e),Qf(e,r),Gd(e),Wd(e),Kd(e),qd(e,r),Hd(e),zd(e,r);break;case"firefox":if(!ld||!td||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=ld,Yd(e,r),Jd(e),Zf(e,r),td(e,r),ed(e),id(e),nd(e),rd(e),od(e),ad(e),sd(e),cd(e),ud(e),Gd(e),Kd(e),qd(e,r),Hd(e);break;case"safari":if(!bd||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=bd,Yd(e,r),Jd(e),md(e),Ed(e),pd(e),fd(e),dd(e),gd(e),hd(e),_d(e),Gd(e),Wd(e),qd(e,r),Hd(e),zd(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(Xd||(Xd={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(Qd||(Qd={}));var Zd={exports:{}};!function(e,t){!function(n,r){var i="function",o="undefined",a="object",s="string",c="major",u="model",l="name",f="type",d="vendor",p="version",h="architecture",v="console",m="mobile",g="tablet",E="smarttv",_="wearable",b="embedded",y="Amazon",T="Apple",S="ASUS",w="BlackBerry",R="Google",O="Huawei",I="LG",A="Microsoft",k="Motorola",C="Samsung",N="Sharp",x="Sony",D="Xiaomi",P="Zebra",L="Facebook",M="Chromium OS",U="Mac OS",j=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},F=function(e,t){return typeof e===s&&-1!==B(t).indexOf(B(e))},B=function(e){return e.toLowerCase()},V=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},G=function(e,t){for(var n,o,s,c,u,l,f=0;f<t.length&&!u;){var d=t[f],p=t[f+1];for(n=o=0;n<d.length&&!u&&d[n];)if(u=d[n++].exec(e))for(s=0;s<p.length;s++)l=u[++o],typeof(c=p[s])===a&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,l):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=l?l.replace(c[1],c[2]):r:this[c[0]]=l?c[1].call(this,l,c[2]):r:4===c.length&&(this[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):r):this[c]=l||r;f+=2}},W=function(e,t){for(var n in t)if(typeof t[n]===a&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(F(t[n][i],e))return"?"===n?r:n}else if(F(t[n],e))return"?"===n?r:n;return e},q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},H={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,p],[/opios[\/ ]+([\w\.]+)/i],[p,[l,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[p,[l,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[l,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[l,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[l,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[l,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[l,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure Browser"],p],[/\bfocus\/([\w\.]+)/i],[p,[l,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[p,[l,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[l,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[l,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[p,[l,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[l,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 Browser"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[l,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,L],p],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[l,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[l,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[l,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,"Chrome WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[l,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[p,W,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[l,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[l,p],[/(cobalt)\/([\w\.]+)/i],[l,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,B]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",B]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,B]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[d,C],[f,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[d,C],[f,m]],[/\((ip(?:hone|od)[\w ]*);/i],[u,[d,T],[f,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[d,T],[f,g]],[/(macintosh);/i],[u,[d,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[d,N],[f,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[d,O],[f,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[d,O],[f,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[d,D],[f,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[d,D],[f,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[d,"OPPO"],[f,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[d,"Vivo"],[f,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[d,"Realme"],[f,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[d,k],[f,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[d,k],[f,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[d,I],[f,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[d,I],[f,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[d,"Lenovo"],[f,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[d,"Nokia"],[f,m]],[/(pixel c)\b/i],[u,[d,R],[f,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[d,R],[f,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[d,x],[f,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[d,x],[f,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[d,"OnePlus"],[f,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[d,y],[f,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[d,y],[f,m]],[/(playbook);[-\w\),; ]+(rim)/i],[u,d,[f,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[d,w],[f,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[d,S],[f,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[d,S],[f,m]],[/(nexus 9)/i],[u,[d,"HTC"],[f,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[u,/_/g," "],[f,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[d,"Acer"],[f,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[d,"Meizu"],[f,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,u,[f,m]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,u,[f,g]],[/(surface duo)/i],[u,[d,A],[f,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[d,"Fairphone"],[f,m]],[/(u304aa)/i],[u,[d,"AT&T"],[f,m]],[/\bsie-(\w*)/i],[u,[d,"Siemens"],[f,m]],[/\b(rct\w+) b/i],[u,[d,"RCA"],[f,g]],[/\b(venue[\d ]{2,7}) b/i],[u,[d,"Dell"],[f,g]],[/\b(q(?:mv|ta)\w+) b/i],[u,[d,"Verizon"],[f,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[d,"Barnes & Noble"],[f,g]],[/\b(tm\d{3}\w+) b/i],[u,[d,"NuVision"],[f,g]],[/\b(k88) b/i],[u,[d,"ZTE"],[f,g]],[/\b(nx\d{3}j) b/i],[u,[d,"ZTE"],[f,m]],[/\b(gen\d{3}) b.+49h/i],[u,[d,"Swiss"],[f,m]],[/\b(zur\d{3}) b/i],[u,[d,"Swiss"],[f,g]],[/\b((zeki)?tb.*\b) b/i],[u,[d,"Zeki"],[f,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],u,[f,g]],[/\b(ns-?\w{0,9}) b/i],[u,[d,"Insignia"],[f,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[d,"NextBook"],[f,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],u,[f,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],u,[f,m]],[/\b(ph-1) /i],[u,[d,"Essential"],[f,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[d,"Envizen"],[f,g]],[/\b(trio[-\w\. ]+) b/i],[u,[d,"MachSpeed"],[f,g]],[/\btu_(1491) b/i],[u,[d,"Rotor"],[f,g]],[/(shield[\w ]+) b/i],[u,[d,"Nvidia"],[f,g]],[/(sprint) (\w+)/i],[d,u,[f,m]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[d,A],[f,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[d,P],[f,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[d,P],[f,m]],[/smart-tv.+(samsung)/i],[d,[f,E]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[d,C],[f,E]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,I],[f,E]],[/(apple) ?tv/i],[d,[u,"Apple TV"],[f,E]],[/crkey/i],[[u,"Chromecast"],[d,R],[f,E]],[/droid.+aft(\w)( bui|\))/i],[u,[d,y],[f,E]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[d,N],[f,E]],[/(bravia[\w ]+)( bui|\))/i],[u,[d,x],[f,E]],[/(mitv-\w{5}) bui/i],[u,[d,D],[f,E]],[/Hbbtv.*(technisat) (.*);/i],[d,u,[f,E]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,V],[u,V],[f,E]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,E]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,u,[f,v]],[/droid.+; (shield) bui/i],[u,[d,"Nvidia"],[f,v]],[/(playstation [345portablevi]+)/i],[u,[d,x],[f,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[d,A],[f,v]],[/((pebble))app/i],[d,u,[f,_]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[d,T],[f,_]],[/droid.+; (glass) \d/i],[u,[d,R],[f,_]],[/droid.+; (wt63?0{2,3})\)/i],[u,[d,P],[f,_]],[/(quest( 2| pro)?)/i],[u,[d,L],[f,_]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[f,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[f,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[f,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,m]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[l,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[l,[p,W,q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[l,"Windows"],[p,W,q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,U],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,p],[/\(bb(10);/i],[p,[l,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[l,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[l,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,M],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,p],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[l,p]]},K=function e(t,c){if(typeof t===a&&(c=t,t=r),!(this instanceof e))return new e(t,c).getResult();var u=typeof n!==o&&n.navigator?n.navigator:r,l=t||(u&&u.userAgent?u.userAgent:""),f=u&&u.userAgentData?u.userAgentData:r,d=c?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(H,c):H;return this.getBrowser=function(){var e={};return e.name=r,e.version=r,G.call(e,l,d.browser),e.major=function(e){return typeof e===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e.version),u&&u.brave&&typeof u.brave.isBrave==i&&(e.name="Brave"),e},this.getCPU=function(){var e={};return e.architecture=r,G.call(e,l,d.cpu),e},this.getDevice=function(){var e={};return e.vendor=r,e.model=r,e.type=r,G.call(e,l,d.device),!e.type&&f&&f.mobile&&(e.type=m),"Macintosh"==e.model&&u&&typeof u.standalone!==o&&u.maxTouchPoints&&u.maxTouchPoints>2&&(e.model="iPad",e.type=g),e},this.getEngine=function(){var e={};return e.name=r,e.version=r,G.call(e,l,d.engine),e},this.getOS=function(){var e={};return e.name=r,e.version=r,G.call(e,l,d.os),!e.name&&f&&"Unknown"!=f.platform&&(e.name=f.platform.replace(/chrome os/i,M).replace(/macos/i,U)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return l},this.setUA=function(e){return l=typeof e===s&&e.length>350?V(e,350):e,this},this.setUA(l),this};K.VERSION="0.7.34",K.BROWSER=j([l,p,c]),K.CPU=j([h]),K.DEVICE=j([u,d,f,v,m,E,g,_,b]),K.ENGINE=K.OS=j([l,p]),e.exports&&(t=e.exports=K),t.UAParser=K;var z=typeof n!==o&&(n.jQuery||n.Zepto);if(z&&!z.ua){var Y=new K;z.ua=Y.getResult(),z.ua.get=function(){return Y.getUA()},z.ua.set=function(e){Y.setUA(e);var t=Y.getResult();for(var n in t)z.ua[n]=t[n]}}}("object"==typeof window?window:T)}(Zd,Zd.exports);var ep,tp=new(0,Zd.exports),np=tp.getResult();function rp(e){return e&&tp.setUA(e),{name:ip(np=tp.getResult()),version:op(np),os:ap(np),osVersion:np.os.version}}function ip(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return Qd.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Qd.CHROME;case"Safari":case"Mobile Safari":return Qd.SAFARI;case"Edge":return Qd.EDGE;case"Firefox":return Qd.FIREFOX;case"QQBrowser":return Qd.QQ;case"Opera":return Qd.OPERA;case"WeChat":return Qd.WECHAT;default:return e.browser.name||""}}function op(e){return("Blink"===e.engine.name?e.engine.version||"":e.browser.version||"").split(".")[0]}function ap(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}function sp(){var e=rp();return!!("WebKit"===np.engine.name&&e.os===Xd.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Qd.SAFARI||pp()&&e.name!==Qd.SAFARI)}function cp(){var e=rp();if(sp()){if(e.os===Xd.MAC_OS)return!0;if(e.os===Xd.IOS){var t=np.os.version&&np.os.version.split(".");if(t&&14===Number(t[0])&&t[1]&&Number(t[1])>=3)return!0;if(t&&Number(t[0])>14)return!0}}return!1}function up(){return"WebKit"===np.engine.name}function lp(){return rp().name===Qd.CHROME}function fp(){return rp().name===Qd.SAFARI}function dp(){return rp().name===Qd.FIREFOX}function pp(){return rp().os===Xd.IOS}function hp(e){var t=rp();return!(t.name!==Qd.CHROME||!t.osVersion)&&Number(t.version)>=e}function vp(e){var t=rp();return!(t.name!==Qd.EDGE||!t.osVersion)&&Number(t.version)>=e}function mp(e){var t=rp();return!(t.name!==Qd.OPERA||!t.osVersion)&&Number(t.version)>=e}function gp(){var e=rp();return!(e.name!==Qd.CHROME||!e.osVersion)&&Number(e.version)<=90}function Ep(){var e=rp();if(e.os!==Xd.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function _p(){var e=rp();if(e.os!==Xd.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])}function bp(){var e=rp();if(e.os!==Xd.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])&&0===Number(t[1])}function yp(){var e=rp();if(e.os!==Xd.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function Tp(){var e=rp();if(e.os!==Xd.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}function Sp(){return fp()&&navigator.maxTouchPoints>0}function wp(){return rp().name===Qd.WECHAT}function Rp(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Op(){var e=rp();return e.name!==Qd.EDGE&&e.name!==Qd.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ip(){return rp().os===Xd.ANDROID}function Ap(){var e=rp();return"Android"===e.os&&("Chrome"===e.name||e.name===Qd.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}!function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(ep||(ep={}));var kp={exports:{}},Cp=qn,Np=V,xp=dn.f;Cp({target:"Object",stat:!0,forced:Object.defineProperty!==xp,sham:!Np},{defineProperty:xp});var Dp=ve.Object,Pp=kp.exports=function(e,t,n){return Dp.defineProperty(e,t,n)};Dp.defineProperty.sham&&(Pp.sham=!0);var Lp=kp.exports;function Mp(e,t,n){return t in e?Lp(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Up,jp={exports:{}},Fp=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},Bp=Fp,Vp=Object.prototype.toString,Gp=(Up=Object.create(null),function(e){var t=Vp.call(e);return Up[t]||(Up[t]=t.slice(8,-1).toLowerCase())});function Wp(e){return e=e.toLowerCase(),function(t){return Gp(t)===e}}function qp(e){return Array.isArray(e)}function Hp(e){return void 0===e}var Kp=Wp("ArrayBuffer");function zp(e){return null!==e&&"object"==typeof e}function Yp(e){if("object"!==Gp(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var Jp=Wp("Date"),Xp=Wp("File"),Qp=Wp("Blob"),$p=Wp("FileList");function Zp(e){return"[object Function]"===Vp.call(e)}var eh=Wp("URLSearchParams");function th(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),qp(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var nh,rh=(nh="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return nh&&e instanceof nh}),ih={isArray:qp,isArrayBuffer:Kp,isBuffer:function(e){return null!==e&&!Hp(e)&&null!==e.constructor&&!Hp(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||Vp.call(e)===t||Zp(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Kp(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:zp,isPlainObject:Yp,isUndefined:Hp,isDate:Jp,isFile:Xp,isBlob:Qp,isFunction:Zp,isStream:function(e){return zp(e)&&Zp(e.pipe)},isURLSearchParams:eh,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:th,merge:function e(){var t={};function n(n,r){Yp(t[r])&&Yp(n)?t[r]=e(t[r],n):Yp(n)?t[r]=e({},n):qp(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)th(arguments[r],n);return t},extend:function(e,t,n){return th(t,(function(t,r){e[r]=n&&"function"==typeof t?Bp(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,i,o,a={};t=t||{};do{for(i=(r=Object.getOwnPropertyNames(e)).length;i-- >0;)a[o=r[i]]||(t[o]=e[o],a[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Gp,kindOfTest:Wp,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(Hp(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:rh,isFileList:$p},oh=ih;function ah(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var sh=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(oh.isURLSearchParams(t))r=t.toString();else{var i=[];oh.forEach(t,(function(e,t){null!=e&&(oh.isArray(e)?t+="[]":e=[e],oh.forEach(e,(function(e){oh.isDate(e)?e=e.toISOString():oh.isObject(e)&&(e=JSON.stringify(e)),i.push(ah(t)+"="+ah(e))})))})),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e},ch=ih;function uh(){this.handlers=[]}uh.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},uh.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},uh.prototype.forEach=function(e){ch.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var lh=uh,fh=ih,dh=ih;function ph(e,t,n,r,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}dh.inherits(ph,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var hh=ph.prototype,vh={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){vh[e]={value:e}})),Object.defineProperties(ph,vh),Object.defineProperty(hh,"isAxiosError",{value:!0}),ph.from=function(e,t,n,r,i,o){var a=Object.create(hh);return dh.toFlatObject(e,a,(function(e){return e!==Error.prototype})),ph.call(a,e.message,t,n,r,i),a.name=e.name,o&&Object.assign(a,o),a};var mh=ph,gh={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Eh=ih,_h=function(e,t){t=t||new FormData;var n=[];function r(e){return null===e?"":Eh.isDate(e)?e.toISOString():Eh.isArrayBuffer(e)||Eh.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(i,o){if(Eh.isPlainObject(i)||Eh.isArray(i)){if(-1!==n.indexOf(i))throw Error("Circular reference detected in "+o);n.push(i),Eh.forEach(i,(function(n,i){if(!Eh.isUndefined(n)){var a,s=o?o+"."+i:i;if(n&&!o&&"object"==typeof n)if(Eh.endsWith(i,"{}"))n=JSON.stringify(n);else if(Eh.endsWith(i,"[]")&&(a=Eh.toArray(n)))return void a.forEach((function(e){!Eh.isUndefined(e)&&t.append(s,r(e))}));e(n,s)}})),n.pop()}else t.append(o,r(i))}(e),t},bh=mh,yh=ih,Th=yh.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),yh.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),yh.isString(r)&&a.push("path="+r),yh.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Sh=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},wh=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},Rh=function(e,t){return e&&!Sh(t)?wh(e,t):t},Oh=ih,Ih=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Ah=ih,kh=Ah.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=Ah.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},Ch=mh;function Nh(e){Ch.call(this,null==e?"canceled":e,Ch.ERR_CANCELED),this.name="CanceledError"}ih.inherits(Nh,Ch,{__CANCEL__:!0});var xh=Nh,Dh=ih,Ph=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new bh("Request failed with status code "+n.status,[bh.ERR_BAD_REQUEST,bh.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)},Lh=Th,Mh=sh,Uh=Rh,jh=function(e){var t,n,r,i={};return e?(Oh.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=Oh.trim(e.substr(0,r)).toLowerCase(),n=Oh.trim(e.substr(r+1)),t){if(i[t]&&Ih.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i):i},Fh=kh,Bh=gh,Vh=mh,Gh=xh,Wh=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},qh=function(e){return new Promise((function(t,n){var r,i=e.data,o=e.headers,a=e.responseType;function s(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}Dh.isFormData(i)&&Dh.isStandardBrowserEnv()&&delete o["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",l=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+l)}var f=Uh(e.baseURL,e.url);function d(){if(c){var r="getAllResponseHeaders"in c?jh(c.getAllResponseHeaders()):null,i={data:a&&"text"!==a&&"json"!==a?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:r,config:e,request:c};Ph((function(e){t(e),s()}),(function(e){n(e),s()}),i),c=null}}if(c.open(e.method.toUpperCase(),Mh(f,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(d)},c.onabort=function(){c&&(n(new Vh("Request aborted",Vh.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new Vh("Network Error",Vh.ERR_NETWORK,e,c,c)),c=null},c.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||Bh;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new Vh(t,r.clarifyTimeoutError?Vh.ETIMEDOUT:Vh.ECONNABORTED,e,c)),c=null},Dh.isStandardBrowserEnv()){var p=(e.withCredentials||Fh(f))&&e.xsrfCookieName?Lh.read(e.xsrfCookieName):void 0;p&&(o[e.xsrfHeaderName]=p)}"setRequestHeader"in c&&Dh.forEach(o,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)})),Dh.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),a&&"json"!==a&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(r=function(e){c&&(n(!e||e&&e.type?new Gh:e),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r))),i||(i=null);var h=Wh(f);h&&-1===["http","https","file"].indexOf(h)?n(new Vh("Unsupported protocol "+h+":",Vh.ERR_BAD_REQUEST,e)):c.send(i)}))},Hh=ih,Kh=function(e,t){fh.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},zh=mh,Yh=_h,Jh={"Content-Type":"application/x-www-form-urlencoded"};function Xh(e,t){!Hh.isUndefined(e)&&Hh.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Qh,$h={transitional:gh,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Qh=qh),Qh),transformRequest:[function(e,t){if(Kh(t,"Accept"),Kh(t,"Content-Type"),Hh.isFormData(e)||Hh.isArrayBuffer(e)||Hh.isBuffer(e)||Hh.isStream(e)||Hh.isFile(e)||Hh.isBlob(e))return e;if(Hh.isArrayBufferView(e))return e.buffer;if(Hh.isURLSearchParams(e))return Xh(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=Hh.isObject(e),i=t&&t["Content-Type"];if((n=Hh.isFileList(e))||r&&"multipart/form-data"===i){var o=this.env&&this.env.FormData;return Yh(n?{"files[]":e}:e,o&&new o)}return r||"application/json"===i?(Xh(t,"application/json"),function(e,t,n){if(Hh.isString(e))try{return(t||JSON.parse)(e),Hh.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||$h.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||r&&Hh.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw zh.from(e,zh.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Hh.forEach(["delete","get","head"],(function(e){$h.headers[e]={}})),Hh.forEach(["post","put","patch"],(function(e){$h.headers[e]=Hh.merge(Jh)}));var Zh=$h,ev=ih,tv=Zh,nv=function(e){return!(!e||!e.__CANCEL__)},rv=ih,iv=function(e,t,n){var r=this||tv;return ev.forEach(n,(function(n){e=n.call(r,e,t)})),e},ov=nv,av=Zh,sv=xh;function cv(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new sv}var uv=ih,lv=function(e,t){t=t||{};var n={};function r(e,t){return uv.isPlainObject(e)&&uv.isPlainObject(t)?uv.merge(e,t):uv.isPlainObject(t)?uv.merge({},t):uv.isArray(t)?t.slice():t}function i(n){return uv.isUndefined(t[n])?uv.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function o(e){if(!uv.isUndefined(t[e]))return r(void 0,t[e])}function a(n){return uv.isUndefined(t[n])?uv.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function s(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s};return uv.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,r=t(e);uv.isUndefined(r)&&t!==s||(n[e]=r)})),n},fv="0.27.2",dv=fv,pv=mh,hv={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){hv[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var vv={};hv.transitional=function(e,t,n){function r(e,t){return"[Axios v"+dv+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,o){if(!1===e)throw new pv(r(i," has been removed"+(t?" in "+t:"")),pv.ERR_DEPRECATED);return t&&!vv[i]&&(vv[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var mv=ih,gv=sh,Ev=lh,_v=function(e){return cv(e),e.headers=e.headers||{},e.data=iv.call(e,e.data,e.headers,e.transformRequest),e.headers=rv.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),rv.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||av.adapter)(e).then((function(t){return cv(e),t.data=iv.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return ov(t)||(cv(e),t&&t.response&&(t.response.data=iv.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},bv=lv,yv=Rh,Tv={assertOptions:function(e,t,n){if("object"!=typeof e)throw new pv("options must be an object",pv.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],a=t[o];if(a){var s=e[o],c=void 0===s||a(s,o,e);if(!0!==c)throw new pv("option "+o+" must be "+c,pv.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new pv("Unknown option "+o,pv.ERR_BAD_OPTION)}},validators:hv},Sv=Tv.validators;function wv(e){this.defaults=e,this.interceptors={request:new Ev,response:new Ev}}wv.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=bv(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&Tv.assertOptions(n,{silentJSONParsing:Sv.transitional(Sv.boolean),forcedJSONParsing:Sv.transitional(Sv.boolean),clarifyTimeoutError:Sv.transitional(Sv.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var o,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!i){var s=[_v,void 0];for(Array.prototype.unshift.apply(s,r),s=s.concat(a),o=Promise.resolve(t);s.length;)o=o.then(s.shift(),s.shift());return o}for(var c=t;r.length;){var u=r.shift(),l=r.shift();try{c=u(c)}catch(e){l(e);break}}try{o=_v(c)}catch(e){return Promise.reject(e)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},wv.prototype.getUri=function(e){e=bv(this.defaults,e);var t=yv(e.baseURL,e.url);return gv(t,e.params,e.paramsSerializer)},mv.forEach(["delete","get","head","options"],(function(e){wv.prototype[e]=function(t,n){return this.request(bv(n||{},{method:e,url:t,data:(n||{}).data}))}})),mv.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(bv(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}wv.prototype[e]=t(),wv.prototype[e+"Form"]=t(!0)}));var Rv=wv,Ov=xh;function Iv(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new Ov(e),t(n.reason))}))}Iv.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Iv.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},Iv.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},Iv.source=function(){var e;return{token:new Iv((function(t){e=t})),cancel:e}};var Av=Iv,kv=ih,Cv=ih,Nv=Fp,xv=Rv,Dv=lv,Pv=function e(t){var n=new xv(t),r=Nv(xv.prototype.request,n);return Cv.extend(r,xv.prototype,n),Cv.extend(r,n),r.create=function(n){return e(Dv(t,n))},r}(Zh);Pv.Axios=xv,Pv.CanceledError=xh,Pv.CancelToken=Av,Pv.isCancel=nv,Pv.VERSION=fv,Pv.toFormData=_h,Pv.AxiosError=mh,Pv.Cancel=Pv.CanceledError,Pv.all=function(e){return Promise.all(e)},Pv.spread=function(e){return function(t){return e.apply(null,t)}},Pv.isAxiosError=function(e){return kv.isObject(e)&&!0===e.isAxiosError},jp.exports=Pv,jp.exports.default=Pv;var Lv,Mv=jp.exports,Uv=function(){function e(t){h(this,e),Mp(this,"logger",void 0),Mp(this,"prefixLists",[]),this.logger=t}return v(e,[{key:"debug",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).debug.apply(e,m(this.prefixLists).concat(n))}},{key:"info",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).info.apply(e,m(this.prefixLists).concat(n))}},{key:"warning",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).warning.apply(e,m(this.prefixLists).concat(n))}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).error.apply(e,m(this.prefixLists).concat(n))}},{key:"prefix",value:function(e){return this.prefixLists.push(e),this}},{key:"popPrefix",value:function(){return this.prefixLists.pop(),this}}]),e}(),jv=function(){function e(){h(this,e),Mp(this,"_events",{}),Mp(this,"addListener",this.on)}return v(e,[{key:"getListeners",value:function(e){return this._events[e]?this._events[e].map((function(e){return e.listener})):[]}},{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}},{key:"once",value:function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}},{key:"off",value:function(e,t){if(this._events[e]){var n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}}},{key:"removeAllListeners",value:function(e){e?delete this._events[e]:this._events={}}},{key:"emit",value:function(e){this._events[e]||(this._events[e]=[]);for(var t=this._events[e].map((function(e){return e})),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0;o<t.length;o+=1){var a=t[o];a.once&&this.off(e,a.listener),a.listener.apply(this,r||[])}}},{key:"_indexOfListener",value:function(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}}]),e}(),Fv=new(function(e){d(n,e);var t=p(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"reportLogUploadError",value:function(e){this.emit("REPORT_LOG_UPLOAD",e)}}]),n}(jv));!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION"}(Lv||(Lv={}));var Bv=function(e){d(n,e);var t=p(n);function n(e){var r;h(this,n);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;return r=t.call(this,i),Mp(l(r),"code",void 0),Mp(l(r),"message",void 0),Mp(l(r),"data",void 0),Mp(l(r),"name","AgoraRTCException"),r.code=e,r.message="AgoraRTCError ".concat(r.code,": ").concat(i),r.data=o,r}return v(n,[{key:"toString",value:function(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return"error"===e&&Jv.error(this.toString()),"warning"===e&&Jv.warning(this.toString()),this}},{key:"throw",value:function(){throw this.print(),this}}]),n}(f(Error)),Vv={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Gv(e,t){var n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Wv(e,t,n,r){var i=Object.assign({},Vv,r),o=i.timeout,a=function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(e){return new Bf((function(t){window.setTimeout(t,e)}))}(o);case 2:o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s=!1,l=new Bf(function(){var r=u(c().mark((function r(o,u){var l,f;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=t||function(){return!1},n=n||function(){return!0},l=0;case 2:if(!(l<i.maxRetryCount)){r.next=28;break}if(!s){r.next=5;break}return r.abrupt("return",u(new Bv(Lv.OPERATION_ABORTED)));case 5:return r.prev=5,r.next=8,e();case 8:if(f=r.sent,t(f,l)){r.next=11;break}return r.abrupt("return",o(f));case 11:if(l+1!==i.maxRetryCount){r.next=13;break}return r.abrupt("return",o(f));case 13:return r.next=15,a();case 15:r.next=25;break;case 17:if(r.prev=17,r.t0=r.catch(5),n(r.t0,l)){r.next=21;break}return r.abrupt("return",u(r.t0));case 21:if(l+1!==i.maxRetryCount){r.next=23;break}return r.abrupt("return",u(r.t0));case 23:return r.next=25,a();case 25:l+=1,r.next=2;break;case 28:case"end":return r.stop()}}),r,null,[[5,17]])})));return function(e,t){return r.apply(this,arguments)}}());return l.cancel=function(){return s=!0},l}function qv(){var e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function Hv(){var e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var Kv={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},zv=Date.now(),Yv=function(e){for(var t in Kv)if(Object.prototype.hasOwnProperty.call(Kv,t)&&Kv[t]===e)return t;return"DEFAULT"},Jv=new(function(){function e(){var t=this;h(this,e),Mp(this,"proxyServerURL",void 0),Mp(this,"logLevel",Kv.DEBUG),Mp(this,"uploadState","collecting"),Mp(this,"uploadLogWaitingList",[]),Mp(this,"uploadLogUploadingList",[]),Mp(this,"uploadErrorCount",0),Mp(this,"currentLogID",0),Mp(this,"url",void 0),Mp(this,"extLog",(function(e,n){t.appendLogToWaitingList.apply(t,[e].concat(m(n)))}))}return v(e,[{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Kv.DEBUG].concat(t);this.log.apply(this,r)}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Kv.INFO].concat(t);this.log.apply(this,r)}},{key:"warning",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Kv.WARNING].concat(t);this.log.apply(this,r)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Kv.ERROR].concat(t);this.log.apply(this,r)}},{key:"upload",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Kv.DEBUG].concat(t);this.uploadLog.apply(this,r)}},{key:"setLogLevel",value:function(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}},{key:"enableLogUpload",value:function(){um("UPLOAD_LOG",!0)}},{key:"disableLogUpload",value:function(){um("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}},{key:"setProxyServer",value:function(e){this.proxyServerURL=e}},{key:"prefix",value:function(e){return new Uv(this).prefix(e)}},{key:"log",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(Date.now()-zv<100)setTimeout((function(){e.log.apply(e,n)}),Date.now()-zv);else{var i=Math.max(0,Math.min(4,n[0]));if(n[0]=qv()+" Agora-SDK [".concat(Yv(i),"]:"),this.appendLogToWaitingList.apply(this,[i].concat(n)),!(i<this.logLevel)){var o=qv()+" %cAgora-SDK [".concat(Yv(i),"]:"),a=[];if(!lm("USE_NEW_LOG"))switch(i){case Kv.DEBUG:a=[o,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,a);break;case Kv.INFO:a=[o,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,a);break;case Kv.WARNING:a=[o,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,a);break;case Kv.ERROR:a=[o,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,a)}}}}},{key:"uploadLog",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(Date.now()-zv<100)setTimeout((function(){e.uploadLog.apply(e,n)}),Date.now()-zv);else{var i=Math.max(0,Math.min(4,n[0]));n[0]=qv()+" Agora-SDK [".concat(Yv(i),"]:"),this.appendLogToWaitingList.apply(this,[i].concat(n))}}},{key:"appendLogToWaitingList",value:function(e){if(lm("UPLOAD_LOG")){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=Hv()+" Agora-SDK [".concat(Yv(e),"]:"):n[0]=Hv()+" Agora-SDK [".concat(Yv(e),"]:");var i="";n.forEach((function(e){"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}}},{key:"startUpload",value:function(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}},{key:"uploadLogs",value:function(){var e=u(c().mark((function e(){var t,n,r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.uploadLogUploadingList,n={sdk_version:Qv,process_id:lm("PROCESS_ID"),payload:JSON.stringify(t)},e.abrupt("return",Wv(u(c().mark((function e(){var t,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mv.post(r.url||(r.proxyServerURL?"https://".concat(r.proxyServerURL,"/ls/?h=").concat(lm("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(lm("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});case 2:if("OK"===(t=e.sent).data){e.next=6;break}throw(i=new Error("unexpected upload log response")).response=t,i;case 6:case"end":return e.stop()}}),e)}))),(function(){return r.uploadLogUploadingList=[],!1}),(function(e){return e.response?Fv.reportLogUploadError({status:e.response.status,data:e.response.data,headers:e.response.headers,message:e.message}):e.request?Fv.reportLogUploadError({status:e.request.status,message:e.message}):Fv.reportLogUploadError({status:-1,message:e.message}),!0}),{timeout:lm("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:lm("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")}));case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"uploadLogInterval",value:function(){var e=this;0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,lm("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((function(){e.uploadErrorCount=0,e.uploadLogWaitingList.length>0&&window.setTimeout((function(){return e.uploadLogInterval()}),lm("UPLOAD_LOG_INTERVAL"))})).catch((function(t){e.uploadErrorCount+=1,e.uploadErrorCount<2?window.setTimeout((function(){return e.uploadLogInterval()}),lm("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((function(){return e.uploadLogInterval()}),lm("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}}]),e}()),Xv="v4.17.1-0-gab544cc9-dirty(4/14/2023, 6:27:40 PM)",Qv=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;var t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){var n=t[1],r=t[2];return"".concat(n,".").concat(r)}var i=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){var o=i[1],a=i[2];return"".concat(o,".").concat(100*(Number(a)+1))}return"4.0.0.999"}("4.17.1"),$v=function(){try{return!0===JSON.parse("true")}catch(y){return!0}}(),Zv=["CHINA","GLOBAL"],em=function(){var e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");for(var r=n.join(""),i=[],o=0;o<6;o++)i.push("1");var a=i.join(""),s={};return s[e]=r,s[t]=a,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=em;var tm={"90p":hm(160,90),"90p_1":hm(160,90),"120p":hm(160,120,15,30,65),"120p_1":hm(160,120,15,30,65),"120p_3":hm(120,120,15,30,50),"120p_4":hm(212,120),"180p":hm(320,180,15,30,140),"180p_1":hm(320,180,15,30,140),"180p_3":hm(180,180,15,30,100),"180p_4":hm(240,180,15,30,120),"240p":hm(320,240,15,40,200),"240p_1":hm(320,240,15,40,200),"240p_3":hm(240,240,15,40,140),"240p_4":hm(424,240,15,40,220),"360p":hm(640,360,15,80,400),"360p_1":hm(640,360,15,80,400),"360p_3":hm(360,360,15,80,260),"360p_4":hm(640,360,30,80,600),"360p_6":hm(360,360,30,80,400),"360p_7":hm(480,360,15,80,320),"360p_8":hm(480,360,30,80,490),"360p_9":hm(640,360,15,80,800),"360p_10":hm(640,360,24,80,800),"360p_11":hm(640,360,24,80,1e3),"480p":hm(640,480,15,100,500),"480p_1":hm(640,480,15,100,500),"480p_2":hm(640,480,30,100,1e3),"480p_3":hm(480,480,15,100,400),"480p_4":hm(640,480,30,100,750),"480p_6":hm(480,480,30,100,600),"480p_8":hm(848,480,15,100,610),"480p_9":hm(848,480,30,100,930),"480p_10":hm(640,480,10,100,400),"720p":hm(1280,720,15,120,1130),"720p_1":hm(1280,720,15,120,1130),"720p_2":hm(1280,720,30,120,2e3),"720p_3":hm(1280,720,30,120,1710),"720p_5":hm(960,720,15,120,910),"720p_6":hm(960,720,30,120,1380),"1080p":hm(1920,1080,15,120,2080),"1080p_1":hm(1920,1080,15,120,2080),"1080p_2":hm(1920,1080,30,120,3e3),"1080p_3":hm(1920,1080,30,120,3150),"1080p_5":hm(1920,1080,60,120,4780),"1440p":hm(2560,1440,30,120,4850),"1440p_1":hm(2560,1440,30,120,4850),"1440p_2":hm(2560,1440,60,120,7350),"4k":hm(3840,2160,30,120,8910),"4k_1":hm(3840,2160,30,120,8910),"4k_3":hm(3840,2160,60,120,13500)},nm={"480p":vm(640,480,5),"480p_1":vm(640,480,5),"480p_2":vm(640,480,30),"480p_3":vm(640,480,15),"720p":vm(1280,720,5),"720p_1":vm(1280,720,5),"720p_2":vm(1280,720,30),"720p_3":vm(1280,720,15),"1080p":vm(1920,1080,5),"1080p_1":vm(1920,1080,5),"1080p_2":vm(1920,1080,30),"1080p_3":vm(1920,1080,15)},rm={"1SL1TL":mm(1,1),"3SL3TL":mm(3,3),"2SL3TL":mm(2,3)};function im(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},tm[e]):e}function om(e){return"string"==typeof e?Object.assign({},nm[e]):e}function am(e){return"string"==typeof e?Object.assign({},rm[e]):e}var sm={speech_low_quality:pm(16e3,!1),speech_standard:pm(32e3,!1,18),music_standard:pm(48e3,!1),standard_stereo:pm(48e3,!0,56),high_quality:pm(48e3,!1,128),high_quality_stereo:pm(48e3,!0,192)};function cm(e){return"string"==typeof e?Object.assign({},sm[e]):e}function um(e,t,n){Object.keys(fm).includes(e)&&(!n&&Object.keys(dm).includes(e)||(fm[e]=t))}function lm(e){return fm[e]}var fm={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:Zv,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,AV_SYNC:!0,BLOCK_LOCAL_CLIENT:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},dm={};function pm(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function hm(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function vm(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function mm(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}$v||(fm.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],fm.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],fm.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],fm.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],fm.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],fm.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],fm.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",fm.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",fm.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",fm.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",fm.AREAS=["NORTH_AMERICA","OVERSEA"]);var gm=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Em=[],_m=[];function bm(e,t){return!!t&&Em.some((function(n){return n.uid===e&&n.channelName===t}))}var ym=Mt,Tm=dn,Sm=Q,wm=function(e,t,n){var r=ym(t);r in e?Tm.f(e,r,Sm(0,n)):e[r]=n},Rm=ri,Om=Qn,Im=wm,Am=D.Array,km=Math.max,Cm=function(e,t,n){for(var r=Om(e),i=Rm(t,r),o=Rm(void 0===n?r:n,r),a=Am(km(o-i,0)),s=0;i<o;i++,s++)Im(a,s,e[i]);return a.length=s,a},Nm=Cm,xm=Math.floor,Dm=function e(t,n){var r=t.length,i=xm(r/2);return r<8?Pm(t,n):Lm(t,e(Nm(t,0,i),n),e(Nm(t,i),n),n)},Pm=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},Lm=function(e,t,n,r){for(var i=t.length,o=n.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?r(t[a],n[s])<=0?t[a++]:n[s++]:a<i?t[a++]:n[s++];return e},Mm=Dm,Um=ye.match(/firefox\/(\d+)/i),jm=!!Um&&+Um[1],Fm=/MSIE|Trident/.test(ye),Bm=ye.match(/AppleWebKit\/(\d+)\./),Vm=!!Bm&&+Bm[1],Gm=qn,Wm=C,qm=qe,Hm=at,Km=Qn,zm=Qo,Ym=S,Jm=Mm,Xm=ar,Qm=jm,$m=Fm,Zm=Ae,eg=Vm,tg=[],ng=Wm(tg.sort),rg=Wm(tg.push),ig=Ym((function(){tg.sort(void 0)})),og=Ym((function(){tg.sort(null)})),ag=Xm("sort"),sg=!Ym((function(){if(Zm)return Zm<70;if(!(Qm&&Qm>3)){if($m)return!0;if(eg)return eg<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)tg.push({k:t+r,v:n})}for(tg.sort((function(e,t){return t.v-e.v})),r=0;r<tg.length;r++)t=tg[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Gm({target:"Array",proto:!0,forced:ig||!og||!ag||!sg},{sort:function(e){void 0!==e&&qm(e);var t=Hm(this);if(sg)return void 0===e?ng(t):ng(t,e);var n,r,i=[],o=Km(t);for(r=0;r<o;r++)r in t&&rg(i,t[r]);for(Jm(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:zm(t)>zm(n)?1:-1}}(e)),n=i.length,r=0;r<n;)t[r]=i[r++];for(;r<o;)delete t[r++];return t}});var cg,ug,lg,fg=dr("Array").sort,dg=N,pg=fg,hg=Array.prototype,vg=function(e){var t=e.sort;return e===hg||dg(hg,e)&&t===hg.sort?pg:t};function mg(e,t){if("boolean"!=typeof e)throw new Bv(Lv.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function gg(e,t,n){if(!n.includes(e))throw new Bv(Lv.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Eg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!Og(e))throw new Bv(Lv.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function _g(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new Bv(Lv.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&Eg(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&Eg(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&Eg(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&Eg(e.ideal,"".concat(t,".ideal"),1,1/0)}else Eg(e,t,1,1/0)}function bg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new Bv(Lv.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Rg(e,n,r,i))throw new Bv(Lv.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function yg(e,t){if(!Array.isArray(e))throw new Bv(Lv.INVALID_PARAMS,"".concat(t," should be an array"))}function Tg(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw Jv.error("Invalid Channel Name ".concat(e)),new Bv(Lv.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Sg(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||Rg(e,1,255)))throw Jv.error("Invalid UID ".concat(e," ").concat(typeof e)),new Bv(Lv.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&Jv.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function wg(e){return null==e}function Rg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||Ig(e))}function Og(e){return"number"==typeof e&&e%1==0}function Ig(e){if("string"!=typeof e)return!1;for(var t=0;t<e.length;t+=1){var n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}!function(e){e.FREE="free",e.UPLOADING="uploading"}(cg||(cg={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(ug||(ug={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(lg||(lg={}));var Ag={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function kg(e){return bg(e.reportId,"params.reportId",0,100,!1),bg(e.category,"params.category",0,100,!1),bg(e.event,"params.event",0,100,!1),bg(e.label,"params.label",0,100,!1),Eg(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}var Cg,Ng,xg,Dg,Pg,Lg,Mg,Ug,jg,Fg,Bg,Vg,Gg,Wg,qg,Hg,Kg,zg,Yg,Jg,Xg,Qg,$g,Zg,eE={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};function tE(e){return Eg(e.timeout,"config.timeout",0,1e5),Eg(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Eg(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Eg(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function nE(e){return gg(e.codec,"config.codec",["vp8","vp9","av1","h264"]),gg(e.mode,"config.mode",["rtc","live"]),void 0!==e.audioCodec&&gg(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&bg(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&iE(e.turnServer),void 0!==e.httpRetryConfig&&tE(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&tE(e.websocketRetryConfig),!0}function rE(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((function(e){if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function iE(e){return bg(e.turnServerURL,"turnServerURL"),bg(e.username,"username"),bg(e.password,"password"),e.udpport&&Eg(e.udpport,"udpport",1,99999,!0),e.forceturn&&mg(e.forceturn,"forceturn"),e.security&&mg(e.security,"security"),e.tcpport&&Eg(e.tcpport,"tcpport",1,99999,!0),!0}function oE(e){return void 0!==e.level&&gg(e.level,"level",[1,2,3]),!0}!function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics"}(Cg||(Cg={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed"}(Ng||(Ng={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(xg||(xg={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(Dg||(Dg={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(Pg||(Pg={})),function(e){e.TRACER="tracer"}(Lg||(Lg={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(Mg||(Mg={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Ug||(Ug={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(jg||(jg={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Fg||(Fg={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Bg||(Bg={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Vg||(Vg={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Gg||(Gg={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(Wg||(Wg={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(qg||(qg={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result"}(Hg||(Hg={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(Kg||(Kg={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(zg||(zg={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback"}(Yg||(Yg={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter"}(Jg||(Jg={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(Xg||(Xg={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Qg||(Qg={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}($g||($g={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(Zg||(Zg={}));var aE,sE,cE,uE={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},lE={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},fE={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},dE={uplinkNetworkQuality:0,downlinkNetworkQuality:0},pE={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};!function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(aE||(aE={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(sE||(sE={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(cE||(cE={}));var hE={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},vE={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function mE(e,t){bg(e.url,"".concat(t,".url"),1,1e3,!1),wg(e.x)||Eg(e.x,"".concat(t,".x"),0,1e4),wg(e.y)||Eg(e.y,"".concat(t,".y"),0,1e4),wg(e.width)||Eg(e.width,"".concat(t,".width"),0,1e4),wg(e.height)||Eg(e.height,"".concat(t,".height"),0,1e4),wg(e.zOrder)||Eg(e.zOrder,"".concat(t,".zOrder"),0,255),wg(e.alpha)||Eg(e.alpha,"".concat(t,".alpha"),0,1,!1)}var gE,EE,_E,bE,yE,TE,SE,wE,RE,OE,IE,AE,kE,CE,NE,xE,DE,PE,LE,ME={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},UE={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};function jE(e){if(!e.channelName)throw new Bv(Lv.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new Bv(Lv.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&bg(e.token,"info.token",1,2047),Sg(e.uid),Tg(e.channelName),!0}function FE(e){return gg(e,"mediaSource",["screen","window","application"]),!0}!function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(gE||(gE={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(EE||(EE={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(_E||(_E={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(bE||(bE={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(yE||(yE={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(TE||(TE={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(SE||(SE={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(wE||(wE={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(RE||(RE={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(OE||(OE={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data"}(IE||(IE={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(AE||(AE={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(kE||(kE={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(CE||(CE={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(NE||(NE={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(xE||(xE={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(DE||(DE={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(PE||(PE={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(LE||(LE={}));var BE,VE=[LE.AFRICA,LE.ASIA,LE.CHINA,LE.EUROPE,LE.GLOBAL,LE.INDIA,LE.JAPAN,LE.NORTH_AMERICA,LE.OCEANIA,LE.OVERSEA,LE.SOUTH_AMERICA];!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"}(BE||(BE={}));var GE,WE,qE,HE,KE,zE,YE,JE,XE,QE,$E,ZE,e_,t_,n_,r_={CHINA:{},ASIA:{CODE:BE.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:BE.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:BE.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:BE.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:BE.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:BE.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:BE.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:BE.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:BE.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:BE.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:BE.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:BE.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:BE.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};$v&&(r_.CHINA={CODE:BE.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(GE||(GE={}));var i_=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this),Mp(l(i),"onICEConnectionStateChange",void 0),Mp(l(i),"onConnectionStateChange",void 0),Mp(l(i),"onDTLSTransportStateChange",void 0),Mp(l(i),"onDTLSTransportError",void 0),Mp(l(i),"onICETransportStateChange",void 0),Mp(l(i),"onFirstAudioReceived",void 0),Mp(l(i),"onFirstVideoReceived",void 0),Mp(l(i),"onFirstAudioDecoded",void 0),Mp(l(i),"onFirstVideoDecoded",void 0),Mp(l(i),"onFirstVideoDecodedTimeout",void 0),Mp(l(i),"onSelectedLocalCandidateChanged",void 0),Mp(l(i),"onSelectedRemoteCandidateChanged",void 0),Mp(l(i),"establishPromise",void 0),i}return v(n)}(jv);!function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"}(WE||(WE={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(qE||(qE={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(HE||(HE={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(KE||(KE={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState"}(zE||(zE={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(YE||(YE={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(JE||(JE={})),function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(XE||(XE={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(QE||(QE={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}($E||($E={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(ZE||(ZE={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(e_||(e_={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(t_||(t_={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(n_||(n_={}));var o_,a_={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1};function s_(){return a_}!function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(o_||(o_={}));var c_=te,u_=Array.isArray||function(e){return"Array"==c_(e)},l_=D,f_=u_,d_=Oc,p_=he,h_=Rt("species"),v_=l_.Array,m_=function(e){var t;return f_(e)&&(t=e.constructor,(d_(t)&&(t===v_||f_(t.prototype))||p_(t)&&null===(t=t[h_]))&&(t=void 0)),void 0===t?v_:t},g_=function(e,t){return new(m_(e))(0===t?0:t)},E_=fn,__=se,b_=at,y_=Qn,T_=g_,S_=C([].push),w_=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,f){for(var d,p,h=b_(c),v=__(h),m=E_(u,l),g=y_(v),E=0,_=f||T_,b=t?_(c,g):n||a?_(c,0):void 0;g>E;E++)if((s||E in v)&&(p=m(d=v[E],E,h),e))if(t)b[E]=p;else if(p)switch(e){case 3:return!0;case 5:return d;case 6:return E;case 2:S_(b,d)}else switch(e){case 4:return!1;case 7:S_(b,d)}return o?-1:r||i?i:b}},R_={forEach:w_(0),map:w_(1),filter:w_(2),some:w_(3),every:w_(4),find:w_(5),findIndex:w_(6),filterReject:w_(7)},O_=R_.forEach,I_=ar("forEach")?[].forEach:function(e){return O_(this,e,arguments.length>1?arguments[1]:void 0)};qn({target:"Array",proto:!0,forced:[].forEach!=I_},{forEach:I_});var A_=dr("Array").forEach,k_=bo,C_=ut,N_=N,x_=A_,D_=Array.prototype,P_={DOMTokenList:!0,NodeList:!0},L_=function(e){var t=e.forEach;return e===D_||N_(D_,e)&&t===D_.forEach||C_(P_,k_(e))?x_:t},M_=at,U_=Di;qn({target:"Object",stat:!0,forced:S((function(){U_(1)}))},{keys:function(e){return U_(M_(e))}});var j_=ve.Object.keys,F_=gr,B_=qn,V_=u_,G_=C([].reverse),W_=[1,2];B_({target:"Array",proto:!0,forced:String(W_)===String(W_.reverse())},{reverse:function(){return V_(this)&&(this.length=this.length),G_(this)}});var q_=dr("Array").reverse,H_=N,K_=q_,z_=Array.prototype,Y_=function(e){var t=e.reverse;return e===z_||H_(z_,e)&&t===z_.reverse?K_:t},J_=S,X_=Ae,Q_=Rt("species"),$_=function(e){return X_>=51||!J_((function(){var t=[];return(t.constructor={})[Q_]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Z_=qn,eb=D,tb=u_,nb=Oc,rb=he,ib=ri,ob=Qn,ab=de,sb=wm,cb=Rt,ub=Pc,lb=$_("slice"),fb=cb("species"),db=eb.Array,pb=Math.max;Z_({target:"Array",proto:!0,forced:!lb},{slice:function(e,t){var n,r,i,o=ab(this),a=ob(o),s=ib(e,a),c=ib(void 0===t?a:t,a);if(tb(o)&&(n=o.constructor,(nb(n)&&(n===db||tb(n.prototype))||rb(n)&&null===(n=n[fb]))&&(n=void 0),n===db||void 0===n))return ub(o,s,c);for(r=new(void 0===n?db:n)(pb(c-s,0)),i=0;s<c;s++,i++)s in o&&sb(r,i,o[s]);return r.length=i,r}});var hb=dr("Array").slice,vb=N,mb=hb,gb=Array.prototype,Eb=function(e){var t=e.slice;return e===gb||vb(gb,e)&&t===gb.slice?mb:t};function _b(e,t,n,r,i){var o,a,s,c={};return L_(o=j_(r)).call(o,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=F_(a=Y_(s=Eb(n).call(n)).call(s)).call(a,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer&&(Lp(e,t,c),c=null),c}var bb=dr("Array").keys,yb=bo,Tb=ut,Sb=N,wb=bb,Rb=Array.prototype,Ob={DOMTokenList:!0,NodeList:!0},Ib=function(e){var t=e.keys;return e===Rb||Sb(Rb,e)&&t===Rb.keys||Tb(Ob,yb(e))?wb:t};function Ab(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ab(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ab(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Cb(e,t,n,r){return new Bf((function(i,o){t.timeout=t.timeout||lm("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),fS(t.data)):n&&(t.data.size?t.data.size:t.data instanceof FormData?function(e){var t=0;/DingTalk/i.test(navigator.userAgent)&&e.realFormData&&(e=e.realFormData),e.forEach((function(e){t+="string"==typeof e?fS(e):e.size}))}(t.data):fS(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mv.request(t).then((function(e){"string"==typeof e.data?fS(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?e.data.byteLength:fS(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((function(e){Mv.isCancel(e)?o(new Bv(Lv.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new Bv(Lv.NETWORK_TIMEOUT,e.message)):e.response?o(new Bv(Lv.NETWORK_RESPONSE_ERROR,e.response.status)):o(new Bv(Lv.NETWORK_ERROR,e.message))}))}))}function Nb(e,t){return xb.apply(this,arguments)}function xb(){return xb=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Blob([n.data],{type:"buffer"}),e.next=3,Cb(t,kb(kb({},n),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),xb.apply(this,arguments)}var Db=new(function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.call(this),Mp(l(e),"_moduleName","network-indicator"),Mp(l(e),"_networkState",YE.ONLINE),Mp(l(e),"onlineWaiter",void 0),window.addEventListener("online",(function(){e.networkState=YE.ONLINE})),window.addEventListener("offline",(function(){e.networkState=YE.OFFLINE})),e}return v(n,[{key:"networkState",get:function(){return this._networkState},set:function(e){var t=this;Jv.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(JE.NETWORK_STATE_CHANGE,e,this._networkState),e===YE.ONLINE?this.emit(JE.ONLINE):e===YE.OFFLINE&&(this.onlineWaiter=new Bf((function(e){t.once(JE.ONLINE,(function(){t.onlineWaiter=void 0,e(YE.ONLINE)}))})),this.emit(JE.OFFLINE)),this._networkState=e}}]),n}(jv)),Pb=!1,Lb=new(function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.apply(this,arguments),Mp(l(e),"onAutoplayFailed",void 0),Mp(l(e),"onAudioAutoplayFailed",void 0),e}return v(n)}(jv));function Mb(){if(rp(),!Pb){var e=function e(t){t.preventDefault(),Pb=!1,Ap()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Pb=!0,Ap()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Jv.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Lb.onAutoplayFailed?Lb.onAutoplayFailed():Lb.onAudioAutoplayFailed?Jv.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):Jv.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Lb.emit("autoplay-failed")}}function Ub(e){return(new TextEncoder).encode(e)}var jb=function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Fb=function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=function(e,t){var n="";return new Uint8Array(e).forEach((function(e){n+=e.toString(t).padStart(2,"0")})),n},e.next=3,crypto.subtle.digest("SHA-256",Ub(t));case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1,16));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Bb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bb(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gb(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){var i=r.value;if("function"==typeof i){var o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var s=r;if(e.argsMap)try{s=e.argsMap.apply(e,[this].concat(r))}catch(e){Jv.warning(e),s=[]}try{JSON.stringify(s)}catch(e){Jv.warning("arguments for method ".concat(o,".").concat(n," not serializable for apiInvoke.")),s=[]}var c=(e.report||Wb).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(n),options:s,tag:Lg.TRACER,reportResult:e.reportResult},e.throttleTime);try{var u=i.apply(this,r);return u instanceof Bf?u.then((function(t){return c.onSuccess(e.reportResult&&t),t})).catch((function(e){throw c.onError(e),e})):(c.onSuccess(e.reportResult&&u),u)}catch(e){throw c.onError(e),e}}}return r}}var Wb=new(function(){function e(){var t=this;h(this,e),Mp(this,"baseInfoMap",new Map),Mp(this,"proxyServer",void 0),Mp(this,"clientList",Em),Mp(this,"eventUploadTimer",void 0),Mp(this,"setSessionIdTimer",void 0),Mp(this,"url",void 0),Mp(this,"backupUrl",void 0),Mp(this,"_appId",void 0),Mp(this,"keyEventUploadPendingItems",[]),Mp(this,"normalEventUploadPendingItems",[]),Mp(this,"apiInvokeUploadPendingItems",[]),Mp(this,"apiInvokeCount",0),Mp(this,"ltsList",[]),Mp(this,"lastSendNormalEventTime",Date.now()),Mp(this,"customReportCounterTimer",void 0),Mp(this,"customReportCount",0),Mp(this,"extApiInvoke",function(){var e=u(c().mark((function e(n){var r,i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s(n);try{for(r.s();!(i=r.n()).done;)o=i.value,a=Vb(Vb({},o),{},{sid:null,invokeId:++t.apiInvokeCount,tag:Lg.TRACER}),t.sendApiInvoke(a)}catch(c){r.e(c)}finally{r.f()}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),lm("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),lm("EVENT_REPORT_SEND_INTERVAL"))}return v(e,[{key:"adjustSessionStartTime",value:function(e){if(this.baseInfoMap.has(e)||this.baseInfoMap.get(e)){var t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,Jv.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}else Jv.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"))}},{key:"setAppId",value:function(e){this._appId=e}},{key:"reportApiInvoke",value:function(e,t,n){var r=this;t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;var i=Date.now();this.apiInvokeCount+=1;var o=this.apiInvokeCount,a=function(){return{tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}},s=!!lm("SHOW_REPORT_INVOKER_LOG");s&&Jv.info("".concat(t.name," start"),t.options);var c=!1;dS(t.timeout).then((function(){c||(r.sendApiInvoke(Vb(Vb({},a()),{},{error:Lv.API_INVOKE_TIMEOUT,success:!1})),Jv.debug("".concat(t.name," timeout")))}));var u=new Bv(Lv.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:function(e){var i=function(){if(c)throw u;return c=!0,r.sendApiInvoke(Vb(Vb({},a()),{},{success:!0},t.reportResult&&{result:e})),s&&Jv.info("".concat(t.name," onSuccess")),e};return n?xS(i,t.name+"Success",n,(function(){return c=!0})):i()},onError:function(e){var i=function(){if(c)throw e;c=!0,r.sendApiInvoke(Vb(Vb({},a()),{},{success:!1,error:e})),s&&Jv.info("".concat(t.name," onFailure"),e.toString())};return n?xS(i,t.name+"Error",n,(function(){return c=!0})):i()}}}},{key:"sessionInit",value:function(e,t){if(!this.baseInfoMap.has(e)){var n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;var i=Object.assign({},{willUploadConsoleLog:lm("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:$v?"global":"oversea",areas:lm("AREAS")&&lm("AREAS").join(",")},t.extend),o=Date.now(),a=Vb(Vb({},r),{},{eventType:Cg.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:Xv,lts:o,elapse:o-n,extend:JSON.stringify(i),mode:t.mode,process:lm("PROCESS_ID"),appType:lm("APP_TYPE"),success:!0,version:Qv});this.send({type:Ng.SESSION,data:a},!0)}}},{key:"joinChooseServer",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb({},r),{},{eventType:Cg.JOIN_CHOOSE_SERVER,lts:i,eventElapse:i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:Ng.JOIN_CHOOSE_SERVER,data:o},!0)}}},{key:"reqUserAccount",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb({},r),{},{eventType:Cg.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Ng.REQ_USER_ACCOUNT,data:o},!0)}}},{key:"joinGateway",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;var i=Date.now(),o=t.firstSuccess,a=t.avoidJoinStartTime,s=t.isProxy,c=t.addr,u=i-(o&&a?a:n.startTime),l=Vb(Vb({},r),{},{eventType:Cg.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:u,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel}),f=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),o)this.send({type:Ng.JOIN_GATEWAY,data:l},!0);else{var d;if(c)if(s){var p=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),h=c.match(/p=[0-9]{1,6}/g);d={isSuccess:f,gatewayIp:p&&p.length?p[0].split("=")[1].replace(/-/g,"."):"",port:h&&h.length?h[0].split("=")[1]:"",isProxy:s?1:0}}else{var v=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),m=c.match(/:[0-9]{1,6}/g);d={isSuccess:f,gatewayIp:v&&v.length?v[0].split("//")[1].replace(/-/g,"."):"",port:m&&m.length?m[0].split(":")[1]:"",isProxy:s?1:0}}else d={isSuccess:f,gatewayIp:"",port:"",isProxy:s?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);var g=Object.assign({},l,d,{eventType:Cg.REJOIN_GATEWAY});this.send({type:Ng.RE_JOIN_GATEWAY,data:g},!0)}}}},{key:"joinChannelTimeout",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=Date.now(),i=Vb(Vb({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:Ng.JOIN_CHANNEL_TIMEOUT,data:i},!0)}}},{key:"publish",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb({},r),{},{eventType:Cg.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Ng.PUBLISH,data:o},!0)}}},{key:"subscribe",value:function(e,t,n){var r=this.baseInfoMap.get(e);if(r){var i=r.info,o=Date.now(),a=Vb(Vb({},i),{},{eventType:Cg.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:Ng.SUBSCRIBE,data:a},!0)}}},{key:"wsCompressorInit",value:function(e){var t,n=m(Ib(t=this.baseInfoMap).call(t)),r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(i){var o=i.info,a=Date.now(),s=Vb(Vb({},o),{},{eventType:Cg.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,status:e.status?1:2});this.send({type:Ng.WS_COMPRESSOR_INIT,data:s},!0)}}},{key:"firstRemoteVideoDecode",value:function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var o=i.info,a=Date.now(),s=Vb(Vb(Vb({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max(a-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}}},{key:"firstRemoteFrame",value:function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var o=i.info,a=Date.now(),s=Vb(Vb(Vb({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:s},!0)}}},{key:"onGatewayStream",value:function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var o=i.info,a=Date.now(),s=Vb(Vb(Vb({},o),r),{},{eventType:t,lts:a});this.send({type:n,data:s},!0)}}},{key:"streamSwitch",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb({},r),{},{eventType:Cg.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:Ng.STREAM_SWITCH,data:o},!0)}}},{key:"requestProxyAppCenter",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb({},r),{},{eventType:Cg.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ng.REQUEST_PROXY_APPCENTER,data:o},!0)}}},{key:"requestProxyWorkerManager",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb({},r),{},{eventType:Cg.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ng.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}}},{key:"setProxyServer",value:function(e){this.proxyServer=e,e?Jv.debug("reportProxyServerurl: ".concat(e)):Jv.debug("disable reportProxyServerurl: ".concat(e))}},{key:"peerPublishStatus",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Ng.PEER_PUBLISH_STATUS,data:o},!0)}}},{key:"workerEvent",value:function(e,t){var n=this,r=this.baseInfoMap.get(e);if(r){var i=r.info,o=Date.now();(function(e,t,n){var r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";for(var i=fS(JSON.stringify(e)),o=0,a=[],s=0,c=0;c<r.length;c++)(s+=r.charCodeAt(c)<=127?1:3)<=n-i||(a[a.length]=lS(lS({},e),{},g({},t,r.substring(o,c))),o=c,s=r.charCodeAt(c)<=127?1:3);return o!==r.length-1&&(a[a.length]=lS(lS({},e),{},g({},t,r.substring(o)))),a})(Vb(Vb(Vb({},i),t),{},{elapse:o-r.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach((function(e){return n.send({type:Ng.WORKER_EVENT,data:e},!0)}))}}},{key:"apworkerEvent",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb(Vb({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Ng.AP_WORKER_EVENT,data:o},!0)}}},{key:"joinWebProxyAP",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb(Vb({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:Ng.JOIN_WEB_PROXY_AP,data:o},!0)}}},{key:"WebSocketQuit",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),o=Vb(Vb(Vb({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Ng.WEBSOCKET_QUIT,data:o},!0)}}},{key:"sendCustomReportMessage",value:function(){var e=u(c().mark((function e(t,n){var r,i,o=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.customReportCount+=n.length,!(this.customReportCount>lm("CUSTOM_REPORT_LIMIT"))){e.next=2;break}throw new Bv(Lv.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);case 2:if(this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((function(){o.customReportCount=0}),5e3)),r=Date.now(),i=n.map((function(e){return{type:Ng.USER_ANALYTICS,data:Vb(Vb({sid:t},e),{},{lts:r})}})),e.prev=4,!lm("NEW_REPORT_SERVER")){e.next=10;break}return e.next=8,this.postDataToStatsCollector2(i);case 8:e.next=12;break;case 10:return e.next=12,this.postDataToStatsCollector(i);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(4),Jv.error("send custom report message failed",e.t0.toString()),new Bv(Lv.CUSTOM_REPORT_SEND_FAILED,e.t0.message);case 17:case"end":return e.stop()}}),e,this,[[4,14]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"autoplayFailed",value:function(e,t,n,r){if(e){var i=this.baseInfoMap.get(e);if(i){var o=i.info,a=Date.now(),s=Vb(Vb({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:a,elapse:a-i.startTime,cbRegistered:Lb.onAutoplayFailed||Lb.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});this.send({type:Ng.AUTOPLAY_FAILED,data:s},!0)}}}},{key:"sendApiInvoke",value:function(e){var t=lm("NOT_REPORT_EVENT");if(e.tag&&t.includes&&t.includes(e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;var n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;var r=n.info,i=r.cname,o=r.uid,a=r.cid;e.lts=e.lts||Date.now();var s=void 0;if(e.error)if(e.error instanceof Bv){var c=e.error,u=c.code,l=c.message;s=u||l||e.error.toString()}else s=e.error.toString();var f={invokeId:e.invokeId,sid:e.sid,cname:i,cid:a,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?s:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Ng.API_INVOKE,data:f},!1),!0}},{key:"appendSessionId",value:function(){var e=this;this.clientList.forEach((function(t){if(t._sessionId)for(var n=e.apiInvokeUploadPendingItems.length,r=0;r<n;r++){var i=e.apiInvokeUploadPendingItems.shift();i&&(i.sid=t._sessionId,e.sendApiInvoke(Object.assign({},i)))}}))}},{key:"send",value:function(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>lm("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}},{key:"doSend",value:function(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}},{key:"sendItems",value:function(e,t){for(var n=this,r=[],i=[];e.length;){var o=e.shift();r.length<20?r.push(o):i.push(o)}e.push.apply(e,i);for(var a=0,s=[].concat(r);a<s.length;a++){var c,u=s[a];-1!==this.ltsList.indexOf(u.data.lts)?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),vg(c=this.ltsList).call(c,(function(e,t){return e-t})))}return t||(this.lastSendNormalEventTime=Date.now()),lm("ENABLE_EVENT_REPORT")?(r.length&&(lm("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch(function(e){return function(r){lm("EVENT_REPORT_RETRY")&&(t?n.keyEventUploadPendingItems=n.keyEventUploadPendingItems.concat(e):(n.normalEventUploadPendingItems=n.normalEventUploadPendingItems.concat(e),n.normalEventUploadPendingItems.length>lm("NORMAL_EVENT_QUEUE_CAPACITY")&&(n.normalEventUploadPendingItems.splice(0,n.normalEventUploadPendingItems.length-lm("NORMAL_EVENT_QUEUE_CAPACITY")),Jv.warning("report: drop normal events"))))}}(r)),e):e}},{key:"postDataToStatsCollector2",value:function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Db.networkState===YE.OFFLINE,!e.t0){e.next=4;break}return e.next=4,Bf.race([Db.onlineWaiter,dS(2*Vv.maxRetryTimeout)]);case 4:n=function(e){var t=new Uint8Array;return e.forEach((function(e){var n=Ub(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=function(e){var t=0;return Object.entries(Ng).forEach((function(n){var r=a(n,2),i=r[0];r[1]===e.type&&(t=Dg[i])})),t}(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=jb(t,new Uint8Array(r)),t=jb(t,n)})),t},r="event",i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(lm("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(lm("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r),o=0;case 7:if(!(o<2)){e.next=23;break}return 1===o&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(lm("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(lm("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r)),e.prev=9,e.next=12,Cb(i,{timeout:1e4,data:n(t),headers:Vb(Vb({token:"32f24ab2ddb74f508aa9286c356cec84",biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0);case 12:e.next=19;break;case 14:if(e.prev=14,e.t1=e.catch(9),1!==o){e.next=18;break}throw e.t1;case 18:return e.abrupt("continue",20);case 19:return e.abrupt("return");case 20:o+=1,e.next=7;break;case 23:case"end":return e.stop()}}),e,this,[[9,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"postDataToStatsCollector",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s=this,u=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]&&u[1],r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map((function(e){return JSON.stringify(e)})),vid:function(e){var t=e&&e.data.sid&&s.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0}(t[0])},e.t0=Db.networkState===YE.OFFLINE,!e.t0){e.next=6;break}return e.next=6,Bf.race([Db.onlineWaiter,dS(2*Vv.maxRetryTimeout)]);case 6:i=n?"/events/proto-raws":"/events/messages",o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(lm("EVENT_REPORT_DOMAIN"),"&p=").concat(lm("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(lm("EVENT_REPORT_DOMAIN"),":").concat(lm("STATS_COLLECTOR_PORT")).concat(i)),a=0;case 9:if(!(a<2)){e.next=30;break}if(1===a&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(lm("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(lm("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(lm("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(lm("STATS_COLLECTOR_PORT")).concat(i))),e.prev=11,!n){e.next=17;break}return e.next=15,Nb(o,{timeout:1e4,data:r});case 15:e.next=19;break;case 17:return e.next=19,Cb(o,{timeout:1e4,data:r});case 19:e.next=26;break;case 21:if(e.prev=21,e.t1=e.catch(11),1!==a){e.next=25;break}throw e.t1;case 25:return e.abrupt("continue",27);case 26:return e.abrupt("return");case 27:a+=1,e.next=9;break;case 30:case"end":return e.stop()}}),e,this,[[11,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createBaseInfo",value:function(e,t){var n=Object.assign({},eE);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}},{key:"reportResourceTiming",value:function(e,t){var n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Lg.TRACER}).onSuccess()}}]),e}());Fv.on("REPORT_LOG_UPLOAD",(function(e){e.networkState=Db.networkState,Wb.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Lg.TRACER})}));var qb,Hb=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this),Mp(l(i),"trackMediaType",void 0),Mp(l(i),"_ID",void 0),Mp(l(i),"_hints",[]),Mp(l(i),"_isClosed",!1),Mp(l(i),"_originMediaStreamTrack",void 0),Mp(l(i),"_mediaStreamTrack",void 0),Mp(l(i),"_external",{}),i._ID=r||hS(8,"track-"),i._originMediaStreamTrack=e,i._mediaStreamTrack=e,function(e){_m.includes(e)||_m.push(e)}(l(i)),i}return v(n,[{key:"toString",value:function(){return this._ID}},{key:"getTrackId",value:function(){return this._ID}},{key:"getMediaStreamTrack",value:function(e){if(!e){var t=Wb.reportApiInvoke(null,{name:Pg.GET_MEDIA_STREAM_TRACK,options:[],tag:Lg.TRACER});this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?t.onSuccess(this._mediaStreamTrack.label):t.onSuccess("")}return this._mediaStreamTrack}},{key:"getMediaStreamTrackSettings",value:function(){return this.getMediaStreamTrack(!0).getSettings()}},{key:"close",value:function(){this._isClosed=!0,function(e){var t=_m.indexOf(e);-1!==t&&_m.splice(t,1)}(this),this.emit(DE.CLOSED)}}]),n}(jv),Kb=1,zb=function(){function e(t){h(this,e),Mp(this,"lockingPromise",Bf.resolve()),Mp(this,"locks",0),Mp(this,"name",""),Mp(this,"lockId",void 0),this.lockId=Kb++,t&&(this.name=t),Jv.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}return v(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(e){var t,n=this;this.locks+=1,Jv.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));var r=new Bf((function(r){t=function(){n.locks-=1,Jv.debug("[lock-".concat(n.name,"-").concat(n.lockId,"] is not locked, current queue ").concat(n.locks,". ").concat("string"==typeof e?e:"")),r()}})),i=this.lockingPromise.then((function(){return t}));return this.lockingPromise=this.lockingPromise.then((function(){return r})),i}}]),e}();function Yb(e,t){return function(n,r,i){var o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=u(c().mark((function n(){var i,a,s,u,l,f=arguments;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this[t]){n.next=3;break}throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));case 3:return n.next=5,i.lock("From ".concat(e,".").concat(r));case 5:for(a=n.sent,n.prev=6,s=f.length,u=new Array(s),l=0;l<s;l++)u[l]=f[l];return n.next=10,o.apply(this,u);case 10:return n.abrupt("return",n.sent);case 11:return n.prev=11,a(),n.finish(11);case 14:case"end":return n.stop()}}),n,this,[[6,,11,14]])}))),i}}var Jb=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this,e,r),Mp(l(i),"_enabled",!0),Mp(l(i),"_muted",!1),Mp(l(i),"_isExternalTrack",!1),Mp(l(i),"_isClosed",!1),Mp(l(i),"_enabledMutex",void 0),Mp(l(i),"processor",void 0),Mp(l(i),"_processorContext",void 0),Mp(l(i),"_handleTrackEnded",(function(){i.onTrackEnded()})),i._enabledMutex=new zb("".concat(i.getTrackId())),e.addEventListener("ended",i._handleTrackEnded),i}return v(n,[{key:"isExternalTrack",get:function(){return this._isExternalTrack}},{key:"muted",get:function(){return this._muted}},{key:"enabled",get:function(){return this._enabled}},{key:"processorContext",get:function(){return this._processorContext},set:function(e){this._processorContext=e}},{key:"getTrackLabel",value:function(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}},{key:"close",value:function(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Jv.debug("[".concat(this.getTrackId(),"] close")),this.emit(kE.NEED_CLOSE),i(o(n.prototype),"close",this).call(this))}},{key:"_updateOriginMediaStreamTrack",value:function(){var e=u(c().mark((function e(t,n){var r,i=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>2&&void 0!==i[2]&&i[2],this._isExternalTrack=r,e.t0=t!==this._originMediaStreamTrack,!e.t0){e.next=14;break}return this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),e.next=13,bS(this,kE.NEED_REPLACE_TRACK,this);case 13:this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext});case 14:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"_getDefaultPlayerConfig",value:function(){return{}}},{key:"onTrackEnded",value:function(){Jv.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(DE.TRACK_ENDED)}},{key:"stateCheck",value:function(e,t){if(Jv.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),mg(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new Bv(Lv.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new Bv(Lv.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}},{key:"getProcessorStats",value:function(){return this.processorContext.gatherStats()}},{key:"getProcessorUsage",value:function(){return this.processorContext.gatherUsage()}}]),n}(Hb);function Xb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}!function(e){e.IOS_15_INTERRUPTION_START="ios15-interruption-start",e.IOS_15_INTERRUPTION_END="ios15-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"}(qb||(qb={}));var Qb=window.AudioContext||window.webkitAudioContext,$b=null,Zb=new(function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.apply(this,arguments),Mp(l(e),"prevState",void 0),Mp(l(e),"curState",void 0),Mp(l(e),"currentTime",void 0),Mp(l(e),"currentTimeStuckAt",void 0),Mp(l(e),"interruptDetectorTrack",void 0),Mp(l(e),"onLocalAudioTrackMute",(function(){Jv.info("ios15-interruption-start"),e.emit(qb.IOS_15_INTERRUPTION_START)})),Mp(l(e),"onLocalAudioTrackUnmute",u(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Jv.info("ios15-interruption-end"),"running"===e.curState&&!e.duringInterruption){t.next=5;break}Jv.info("ios15-interruption-end-canceled"),t.next=10;break;case 5:if(t.t0=$b,!t.t0){t.next=9;break}return t.next=9,$b.suspend();case 9:e.emit(qb.IOS_15_INTERRUPTION_END);case 10:case"end":return t.stop()}}),t)})))),e}return v(n,[{key:"duringInterruption",get:function(){return"running"===this.prevState&&"interrupted"===this.curState}},{key:"bindInterruptDetectorTrack",value:function(e){Jv.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}},{key:"unbindInterruptDetectorTrack",value:function(e){Jv.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}}]),n}(jv));function ey(){if(Qb){Jv.info("create audio context");var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xb(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},lm("WEBAUDIO_INIT_OPTIONS"));Jv.debug("audio context init option:",JSON.stringify(e)),$b=new Qb(e),Zb.curState=$b.state,$b.onstatechange=function(){Zb.prevState=Zb.curState,Zb.curState=$b?$b.state:void 0,(pp()||Sp())&&"running"===Zb.prevState&&"interrupted"===Zb.curState&&(Jv.info("ios-interruption-start"),Zb.emit(qb.IOS_INTERRUPTION_START)),(pp()||Sp())&&"interrupted"===Zb.prevState&&"running"===Zb.curState&&(Jv.info("ios-interruption-end"),Zb.emit(qb.IOS_INTERRUPTION_END)),Zb.prevState!==Zb.curState&&(Jv.debug("AudioContext State Change","".concat(Zb.prevState,"=>").concat(Zb.curState)),Zb.emit(qb.STATE_CHANGE))},setInterval((function(){var e,t=null===(e=$b)||void 0===e?void 0:e.currentTime;Zb.currentTime!==t?(Zb.currentTimeStuckAt&&(Jv.debug("AudioContext current time resume at ".concat(t)),Zb.currentTimeStuckAt=void 0),Zb.currentTime=t):(t!==Zb.currentTimeStuckAt&&(Wb.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:Lg.TRACER}).onSuccess(),Jv.warning("AudioContext current time stuck at ".concat(t))),Zb.currentTimeStuckAt=t)}),5e3),function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s,u,l,f,d,p,h,v,m,g,E;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m=function(){p(!0)},v=function(){r.removeEventListener("playing",v),r.removeEventListener("abort",v),r.removeEventListener("error",v),a=!1,p(!1)},h=function(e){if(o!==e){o=e;for(var t=0,r=n;t<r.length;t++){var i=r[t];e?window.addEventListener(i,m,{capture:!0,passive:!0}):window.removeEventListener(i,m,{capture:!0,passive:!0})}}},p=function(e){if(!a)if(r.paused)if(e){h(!1),a=!0;var t=void 0;try{(t=r.play())?t.then(v,v):(r.addEventListener("playing",v),r.addEventListener("abort",v),r.addEventListener("error",v))}catch(e){v()}}else h(!0);else h(!1)},d=function(){s(!0)},f=function(){s(!1)},l=function(){s(!0)},u=function(e){if(i!==e){i=e;for(var t=0,r=n;t<r.length;t+=1){var o=r[t];e?window.addEventListener(o,d,{capture:!0,passive:!0}):window.removeEventListener(o,d,{capture:!0,passive:!0})}}},s=function(e){"running"===t.state?u(!1):pp()||Sp()?"suspended"===t.state&&(u(!0),e&&t.resume().then(f,f)):"closed"!==t.state&&(u(!0),e&&t.resume().then(f,f))},n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],i=!1,o=!1,a=!1,pp()&&(g=t.createMediaStreamDestination(),(E=document.createElement("div")).innerHTML="<audio x-webkit-airplay='deny'></audio>",(r=E.children.item(0)).controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=g.stream,p(!0)),Zb.on(qb.STATE_CHANGE,l),s(!1);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()($b)}else Jv.error("your browser is not support web audio")}function ty(){if(!$b){if(ey(),!$b)throw new Bv(Lv.NOT_SUPPORTED,"can not create audio context");return $b}return $b}function ny(){return!!$b}function ry(e){if(!function(){if(null!==iy)return iy;var e=ty(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);var i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),iy=i,i}()){var t=e.connect,n=e.disconnect;e.connect=function(n,r,i){return e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=function(r,i,o){n.call(e),r?SS(e._inputNodes,r):e._inputNodes=[];var a,c=s(e._inputNodes);try{for(c.s();!(a=c.n()).done;){var u=a.value;t.call(e,u)}}catch(l){c.e(l)}finally{c.f()}}}}var iy=null;function oy(e,t){var n=!1,r=1/t;if(lm("DISABLE_WEBAUDIO"))var i=window.setInterval((function(){n?window.clearInterval(i):e(performance.now()/1e3)}),1e3*r);else{var o=ty(),a=o.createGain();a.gain.value=0,a.connect(o.destination);var s=function t(){if(n)a=null;else{var i=o.createOscillator();i.onended=t,i.connect(a),i.start(0),i.stop(o.currentTime+r),e(o.currentTime)}};s()}return function(){n=!0}}var ay=function(){function e(){h(this,e),Mp(this,"context",void 0),Mp(this,"analyserNode",void 0),Mp(this,"sourceNode",void 0),this.context=ty(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}return v(e,[{key:"updateSource",value:function(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}},{key:"getVolumeLevel",value:function(){if(!this.sourceNode)return 0;if(!this.context||pp()||Sp()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;var e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{var t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(var n=0;n<e.length;++n)e[n]=t[n]/128-1}var r=Er(e).call(e,(function(e,t){return e+t*t}),0)/e.length;return Math.max(10*Math.log10(r)+100,0)/100}},{key:"getAnalyserNode",value:function(){return this.analyserNode}},{key:"rebuildAnalyser",value:function(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){Jv.warning("rebuild analyser node failed.")}}},{key:"destroy",value:function(){this.updateSource(void 0)}}]),e}(),sy=function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.call(this),Mp(l(e),"outputNode",void 0),Mp(l(e),"outputTrack",void 0),Mp(l(e),"isPlayed",!1),Mp(l(e),"sourceNode",void 0),Mp(l(e),"context",void 0),Mp(l(e),"audioBufferNode",void 0),Mp(l(e),"destNode",void 0),Mp(l(e),"audioOutputLevel",0),Mp(l(e),"volumeLevelAnalyser",void 0),Mp(l(e),"_processedNode",void 0),Mp(l(e),"playNode",void 0),Mp(l(e),"isDestroyed",!1),Mp(l(e),"onNoAudioInput",void 0),Mp(l(e),"isNoAudioInput",!1),Mp(l(e),"_noAudioInputCount",0),e.context=ty(),e.playNode=e.context.destination,e.outputNode=e.context.createGain(),ry(e.outputNode),e.volumeLevelAnalyser=new ay,e}return v(n,[{key:"processSourceNode",get:function(){return this.sourceNode}},{key:"processedNode",get:function(){return this._processedNode},set:function(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}},{key:"startGetAudioBuffer",value:function(e){var t=this;this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=function(e){t.emit(Zg.ON_AUDIO_BUFFER,function(e){for(var t=0;t<e.outputBuffer.numberOfChannels;t+=1)for(var n=e.outputBuffer.getChannelData(t),r=0;r<n.length;r+=1)n[r]=0;return e.inputBuffer}(e))})}},{key:"stopGetAudioBuffer",value:function(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}},{key:"createOutputTrack",value:function(){if(!s_().webAudioMediaStreamDest)throw new Bv(Lv.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}},{key:"play",value:function(e){"running"!==this.context.state&&RS((function(){Zb.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}},{key:"stop",value:function(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(y){}this.isPlayed=!1}},{key:"getAccurateVolumeLevel",value:function(){return this.volumeLevelAnalyser.getVolumeLevel()}},{key:"checkHasAudioInput",value:function(){var e=u(c().mark((function e(){var t,n,r,i,o,a=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=a.length>0&&void 0!==a[0]?a[0]:0)>5)){e.next=3;break}return e.abrupt("return",(this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1));case 3:for(pp()||Sp()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume(),(n=this.volumeLevelAnalyser.getAnalyserNode()).getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r)),i=!1,o=0;o<r.length;o++)0!==r[o]&&(i=!0);if(!i){e.next=12;break}e.t0=(this.isNoAudioInput=!1,!0),e.next=20;break;case 12:return e.next=14,dS(200);case 14:return e.next=16,this.checkHasAudioInput(t?t+1:1);case 16:if(e.t1=e.sent,!e.t1){e.next=19;break}e.t1=i;case 19:e.t0=e.t1;case 20:return e.abrupt("return",e.t0);case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAudioVolume",value:function(){return this.outputNode.gain.value}},{key:"setVolume",value:function(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}},{key:"destroy",value:function(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}},{key:"disconnect",value:function(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}},{key:"connect",value:function(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}]),n}(jv),cy=function(e){d(n,e);var t=p(n);function n(e,i,o){var a,s;if(h(this,n),a=t.call(this),Mp(l(a),"sourceNode",void 0),Mp(l(a),"track",void 0),Mp(l(a),"clonedTrack",void 0),Mp(l(a),"audioElement",void 0),Mp(l(a),"isCurrentTrackCloned",!1),Mp(l(a),"isRemoteTrack",!1),Mp(l(a),"originVolumeLevelAnalyser",void 0),Mp(l(a),"rebuildWebAudio",u(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jv.debug("ready to rebuild web audio, state:",a.context.state),e.t0=a.isNoAudioInput,!e.t0){e.next=5;break}return e.next=5,a.checkHasAudioInput();case 5:if(a.isNoAudioInput&&!a.isDestroyed){e.next=7;break}return e.abrupt("return",(document.body.removeEventListener("click",a.rebuildWebAudio,!0),void Jv.debug("rebuild web audio success, current volume status",a.getAccurateVolumeLevel())));case 7:a.context.resume().then((function(){return Jv.info("resume success")})),Jv.debug("rebuild web audio because of ios 12 bugs"),a.disconnect(),t=a.track,a.track=a.track.clone(),a.isCurrentTrackCloned?t.stop():a.isCurrentTrackCloned=!0,n=new MediaStream([a.track]),a.sourceNode=a.context.createMediaStreamSource(n),ry(a.sourceNode),a.volumeLevelAnalyser.rebuildAnalyser(),r=a.outputNode.gain.value,a.outputNode=a.context.createGain(),a.outputNode.gain.setValueAtTime(r,a.context.currentTime),ry(a.outputNode),a.emit(Zg.UPDATE_SOURCE),a.connect(),a.audioElement.srcObject=n,a.isPlayed&&a.play(a.playNode),a.checkHasAudioInput();case 14:case"end":return e.stop()}}),e)})))),"audio"!==e.kind)throw new Bv(Lv.UNEXPECTED_ERROR);a.track=e;var f=new MediaStream([a.track]);if(a.isRemoteTrack=!!i,a.sourceNode=a.context.createMediaStreamSource(f),ry(a.sourceNode),o){var d=o.clone();d.enabled=!0,a.clonedTrack=d,Jv.debug("create an unmuted track ".concat(d.id," from the original track ").concat(o.id," to get the volume"));var p=a.context.createMediaStreamSource(new MediaStream([d]));ry(p),a.originVolumeLevelAnalyser=new ay,a.originVolumeLevelAnalyser.updateSource(p)}a.connect(),a.audioElement=document.createElement("audio"),a.audioElement.srcObject=f;var v=rp();return i&&v.os===Xd.IOS&&Number(null===(s=v.osVersion)||void 0===s?void 0:s.split(".")[0])<15&&(Zb.on(qb.STATE_CHANGE,(function(){"suspended"===a.context.state?document.body.addEventListener("click",a.rebuildWebAudio,!0):"running"===a.context.state&&a.rebuildWebAudio()})),a.checkHasAudioInput().then((function(e){e||document.body.addEventListener("click",a.rebuildWebAudio,!0)}))),r(a)}return v(n,[{key:"isFreeze",get:function(){return!1}},{key:"updateTrack",value:function(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;var t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),ry(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Zg.UPDATE_SOURCE),this.audioElement.srcObject=t}},{key:"destroy",value:function(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Zb.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,i(o(n.prototype),"destroy",this).call(this)}},{key:"createMediaStreamSourceNode",value:function(e){return this.context.createMediaStreamSource(new MediaStream([e]))}},{key:"updateOriginTrack",value:function(e){var t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),Jv.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));var n=this.context.createMediaStreamSource(new MediaStream([t]));ry(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}},{key:"getOriginVolumeLevel",value:function(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}]),n}(sy);function uy(e,t){return ly.apply(this,arguments)}function ly(){return ly=u(c().mark((function e(t,n){var r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e,t){return e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t},i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:r(n.height,1080),maxWidth:r(n.width,1920)}}},n.frameRate&&"number"!=typeof n.frameRate?(i.video.mandatory.maxFrameRate=n.frameRate.max,i.video.mandatory.minFrameRate=n.frameRate.min):"number"==typeof n.frameRate&&(i.video.mandatory.maxFrameRate=n.frameRate),e.next=4,navigator.mediaDevices.getUserMedia(i);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),ly.apply(this,arguments)}function fy(e){return dy.apply(this,arguments)}function dy(){return dy=u(c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,py(t.mediaSource);case 2:return n=e.sent,e.next=5,function(e){return new Bf((function(t,n){var r=document.createElement("div");r.innerText="share screen",r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");var a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var s=document.createElement("div");s.setAttribute("style","text-align: right; padding: 16px 0;");var c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=function(){document.body.removeChild(u);var e=new Error("NotAllowedError");e.name="NotAllowedError",n(e)},s.appendChild(c),i.appendChild(o),i.appendChild(a),i.appendChild(s);var u=document.createElement("div");u.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),u.appendChild(r),u.appendChild(i),document.body.appendChild(u),e.map((function(e){if(e.id){var n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");var r=e.thumbnail;r.getSize().width>1920&&(r=r.resize({width:1920})),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",n.onclick=function(){document.body.removeChild(u),t(e.id)},a.appendChild(n)}}))}))}(n);case 5:return r=e.sent,e.next=8,uy(r,t);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),dy.apply(this,arguments)}function py(e){return hy.apply(this,arguments)}function hy(){return hy=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=["window","screen"],"application"!==t&&"window"!==t||(n=["window"]),"screen"===t&&(n=["screen"]),r=my()){e.next=5;break}throw new Bv(Lv.ELECTRON_IS_NULL);case 5:i=null;try{i=(null===(o=r.desktopCapturer)||void 0===o?void 0:o.getSources({types:n}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch(t){i=null}return i&&i.then||(i=new Bf((function(e,t){r.desktopCapturer.getSources({types:n},(function(n,r){n?t(n):e(r)}))}))),e.prev=8,e.next=11,i;case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(8),new Bv(Lv.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.t0.toString());case 17:case"end":return e.stop()}}),e,null,[[8,14]])}))),hy.apply(this,arguments)}var vy=null;function my(){if(vy)return vy;try{return vy=window.require("electron")}catch(y){return null}}function gy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Ey=new zb("safari"),_y=!1,by=!1;function yy(e,t){return Ty.apply(this,arguments)}function Ty(){return Ty=u(c().mark((function e(t,n){var r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0,i=null;case 1:if(!(r<2)){e.next=23;break}return e.prev=2,e.next=5,Sy(t,n,r>0);case 5:return i=e.sent,e.abrupt("break",23);case 9:if(e.prev=9,e.t0=e.catch(2),!(e.t0 instanceof Bv)){e.next=13;break}throw Jv.error("[".concat(n,"] ").concat(e.t0.toString())),e.t0;case 13:if((o=Ry(e.t0.name||e.t0.code||e.t0,e.t0.message)).code!==Lv.MEDIA_OPTION_INVALID){e.next=20;break}return Jv.debug("[".concat(n,"] detect media option invalid, retry")),r+=1,e.next=19,dS(500);case 19:return e.abrupt("continue",21);case 20:throw Jv.error("[".concat(n,"] ").concat(o.toString())),o;case 21:e.next=1;break;case 23:if(i){e.next=25;break}throw new Bv(Lv.UNEXPECTED_ERROR,"can not find stream after getUserMedia");case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,null,[[2,9]])}))),Ty.apply(this,arguments)}function Sy(e,t,n){return wy.apply(this,arguments)}function wy(){return wy=u(c().mark((function e(t,n,r){var i,o,a,s,u,l,f,d,p,h,v,g,E,_,b,y,T;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.next=2;break}throw new Bv(Lv.NOT_SUPPORTED,"can not find getUserMedia");case 2:if(r&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height)),i=s_(),o=new MediaStream,t.audioSource&&o.addTrack(t.audioSource),t.videoSource&&o.addTrack(t.videoSource),t.audio||t.video||t.screen){e.next=6;break}return e.abrupt("return",(Jv.debug("Using Video Source/ Audio Source"),o));case 6:if(!t.screen){e.next=64;break}if(!my()){e.next=25;break}if(!t.screen.sourceId){e.next=17;break}return e.t0=Oy,e.t1=o,e.next=13,uy(t.screen.sourceId,t.screen);case 13:e.t2=e.sent,(0,e.t0)(e.t1,e.t2),e.next=23;break;case 17:return e.t3=Oy,e.t4=o,e.next=21,fy(t.screen);case 21:e.t5=e.sent,(0,e.t3)(e.t4,e.t5);case 23:e.next=64;break;case 25:if(!(lp()&&t.screen.extensionId&&t.screen.mandatory)){e.next=41;break}if(i.getStreamFromExtension){e.next=28;break}throw new Bv(Lv.NOT_SUPPORTED,"This browser does not support screen sharing");case 28:return Jv.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"')),e.next=31,g=t.screen.extensionId,E=n,new Bf((function(e,t){try{chrome.runtime.sendMessage(g,{getStream:!0},(function(n){if(!n||!n.streamId)return Jv.error("[".concat(E,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new Bv(Lv.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){Jv.error("[".concat(E,"] AgoraRTC screensharing plugin is not accessible(").concat(g,")"),e.toString()),t(new Bv(Lv.CHROME_PLUGIN_NOT_INSTALL))}}));case 31:return a=e.sent,t.screen.mandatory.chromeMediaSourceId=a,e.t6=Oy,e.t7=o,e.next=37,navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}});case 37:e.t8=e.sent,(0,e.t6)(e.t7,e.t8),e.next=64;break;case 41:if(!i.getDisplayMedia){e.next=53;break}return t.screen.mediaSource&&FE(t.screen.mediaSource),u={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:null!==(s=t.screen.displaySurface)&&void 0!==s?s:"screen"===t.screen.mediaSource?"monitor":t.screen.mediaSource},l=t.screen,f=l.selfBrowserSurface,d=l.surfaceSwitching,p=l.systemAudio,h={selfBrowserSurface:f,surfaceSwitching:d,systemAudio:p},!f&&delete h.selfBrowserSurface,!d&&delete h.surfaceSwitching,!p&&delete h.systemAudio,Jv.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:u,audio:!!t.screenAudio,controls:h})),e.t9=Oy,e.t10=o,e.next=49,navigator.mediaDevices.getDisplayMedia(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gy(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gy(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({video:u,audio:!!t.screenAudio},h));case 49:e.t11=e.sent,(0,e.t9)(e.t10,e.t11),e.next=64;break;case 53:if(dp()){e.next=55;break}throw Jv.error("[".concat(n,"] This browser does not support screenSharing")),new Bv(Lv.NOT_SUPPORTED,"This browser does not support screen sharing");case 55:return t.screen.mediaSource&&FE(t.screen.mediaSource),v={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}},Jv.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(v))),e.t12=Oy,e.t13=o,e.next=62,navigator.mediaDevices.getUserMedia(v);case 62:e.t14=e.sent,(0,e.t12)(e.t13,e.t14);case 64:if(t.video||t.audio){e.next=66;break}return e.abrupt("return",o);case 66:if(_={video:t.video,audio:t.audio},b=lm("MEDIA_DEVICE_CONSTRAINTS"))try{"string"==typeof b&&(b=JSON.parse(b)),_=function e(t,n){if(!PS(t)||!PS(n))return n;if(Array.isArray(t)&&!Array.isArray(n)||!Array.isArray(t)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(t)){for(var r=m(t),i=0;i<n.length;i++)r[i]=e(t[i],n[i]);return r}var o=lS({},t);for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(Object.prototype.hasOwnProperty.call(t,a)?o[a]=e(t[a],n[a]):o[a]=n[a]);return o}(_,b)}catch(t){}if(Jv.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(_)),rp(),T=null,e.t15=fp()||pp()||sp(),!e.t15){e.next=75;break}return e.next=74,Ey.lock();case 74:T=e.sent;case 75:return e.prev=75,e.next=78,navigator.mediaDevices.getUserMedia(_);case 78:y=e.sent,e.next=84;break;case 81:throw e.prev=81,e.t16=e.catch(75),T&&T(),e.t16;case 84:return e.abrupt("return",(_.audio&&(_y=!0),_.video&&(by=!0),Oy(o,y),T&&T(),o));case 85:case"end":return e.stop()}}),e,null,[[75,81]])}))),wy.apply(this,arguments)}function Ry(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Bv(Lv.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Bv(Lv.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Bv(Lv.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Bv(Lv.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Bv(Lv.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Bv(Lv.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return Jv.error("getUserMedia unexpected error",e),new Bv(Lv.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Oy(e,t){var n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}var Iy=new(function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.call(this),Mp(l(e),"_state",Mg.IDLE),Mp(l(e),"isAccessMicrophonePermission",!1),Mp(l(e),"isAccessCameraPermission",!1),Mp(l(e),"lastAccessMicrophonePermission",!1),Mp(l(e),"lastAccessCameraPermission",!1),Mp(l(e),"checkdeviceMatched",!1),Mp(l(e),"deviceInfoMap",new Map),e.init().then((function(){navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",e.updateDevicesInfo.bind(l(e))),window.setInterval((function(){(lm("ENUMERATE_DEVICES_INTERVAL")||Ip()&&Op())&&e.updateDevicesInfo()}),lm("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((function(e){return Jv.error(e.toString())})),e}return v(n,[{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this.emit(Ug.STATE_CHANGE,e),this._state=e)}},{key:"enumerateDevices",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s,u,l,f,d,p,h,v,m=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.length>2&&void 0!==m[2]&&m[2],navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=3;break}return e.abrupt("return",new Bv(Lv.NOT_SUPPORTED,"enumerateDevices() not supported.").throw());case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:if(i=e.sent,o=this.checkMediaDeviceInfoIsOk(i),a=!this.isAccessMicrophonePermission&&t,s=!this.isAccessCameraPermission&&n,o.audio&&(a=!1),o.video&&(s=!1),u=null,l=null,f=null,r||!a&&!s){e.next=65;break}if(!Ey.isLocked){e.next=18;break}return Jv.debug("[device manager] wait GUM lock"),e.next=15,Ey.lock();case 15:e.t0=e.sent,(0,e.t0)(),Jv.debug("[device manager] GUM unlock");case 18:if(_y&&(a=!1,this.isAccessMicrophonePermission=!0),by&&(s=!1,this.isAccessCameraPermission=!0),Jv.debug("[device manager] check media device permissions",t,n,a,s),!a||!s){e.next=34;break}return e.prev=19,e.next=22,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 22:f=e.sent,e.next=31;break;case 25:if(e.prev=25,e.t1=e.catch(19),(d=Ry(e.t1.name||e.t1.code||e.t1,e.t1.message)).code!==Lv.PERMISSION_DENIED){e.next=30;break}throw d;case 30:Jv.warning("getUserMedia failed in getDevices",d);case 31:this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0,e.next=64;break;case 34:if(!a){e.next=50;break}return e.prev=35,e.next=38,navigator.mediaDevices.getUserMedia({audio:t});case 38:u=e.sent,e.next=47;break;case 41:if(e.prev=41,e.t2=e.catch(35),(p=Ry(e.t2.name||e.t2.code||e.t2,e.t2.message)).code!==Lv.PERMISSION_DENIED){e.next=46;break}throw p;case 46:Jv.warning("getUserMedia failed in getDevices",p);case 47:this.isAccessMicrophonePermission=!0,e.next=64;break;case 50:if(!s){e.next=64;break}return e.prev=51,e.next=54,navigator.mediaDevices.getUserMedia({video:n});case 54:l=e.sent,e.next=63;break;case 57:if(e.prev=57,e.t3=e.catch(51),(h=Ry(e.t3.name||e.t3.code||e.t3,e.t3.message)).code!==Lv.PERMISSION_DENIED){e.next=62;break}throw h;case 62:Jv.warning("getUserMedia failed in getDevices",h);case 63:this.isAccessCameraPermission=!0;case 64:Jv.debug("[device manager] mic permission",t,"cam permission",n);case 65:return e.prev=65,e.next=68,navigator.mediaDevices.enumerateDevices();case 68:return v=e.sent,e.abrupt("return",(u&&u.getTracks().forEach((function(e){return e.stop()})),l&&l.getTracks().forEach((function(e){return e.stop()})),f&&f.getTracks().forEach((function(e){return e.stop()})),u=null,l=null,f=null,v));case 72:return e.prev=72,e.t4=e.catch(65),u&&u.getTracks().forEach((function(e){return e.stop()})),l&&l.getTracks().forEach((function(e){return e.stop()})),f&&f.getTracks().forEach((function(e){return e.stop()})),u=null,l=null,f=null,e.abrupt("return",new Bv(Lv.ENUMERATE_DEVICES_FAILED,e.t4.toString()).throw());case 76:case"end":return e.stop()}}),e,this,[[19,25],[35,41],[51,57],[65,72]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getRecordingDevices",value:function(){var e=u(c().mark((function e(){var t,n=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!0,!1,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"audioinput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getCamerasDevices",value:function(){var e=u(c().mark((function e(){var t,n=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!1,!0,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"videoinput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSpeakers",value:function(){var e=u(c().mark((function e(){var t,n=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!0,!1,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"audiooutput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"searchDeviceIdByName",value:function(e){var t=null;return this.deviceInfoMap.forEach((function(n){n.device.label===e&&(t=n.device.deviceId)})),t}},{key:"getDeviceById",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices(!0,!0,!0);case 2:if(n=e.sent.find((function(e){return e.deviceId===t}))){e.next=5;break}throw new Bv(Lv.DEVICE_NOT_FOUND,"deviceId: ".concat(t));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"init",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state=Mg.INITING,e.prev=1,e.next=4,this.updateDevicesInfo();case 4:this.state=Mg.INITEND,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),Jv.warning("Device Detection functionality cannot start properly.",e.t0.toString()),this.state=Mg.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new Bv(Lv.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e.t0;case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateDevicesInfo",value:function(){var e=u(c().mark((function e(){var t,n,r,i,o,a,s=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices(!0,!0,!0);case 2:if(t=e.sent,n=Date.now(),r=[],t[0]&&t[0].label&&!1===this.checkdeviceMatched&&(this.checkdeviceMatched=!0,i=t.find((function(e){return"audioinput"===e.kind&&"default"===e.deviceId})),o=t.find((function(e){return"audiooutput"===e.kind&&"default"===e.deviceId})),i&&o?o.groupId===i.groupId?Jv.debug("[device-check] default input ".concat(i.label," and output ").concat(o.label," is the same group")):Jv.warning("[device-check] default input ".concat(i.label," and output ").concat(o.label," is not the same group")):Jv.debug("[device-check] default input or output not found")),a=this.checkMediaDeviceInfoIsOk(t),t.forEach((function(e){if(e.deviceId){var t=s.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(t?t.state:"INACTIVE")){var i={initAt:n,updateAt:n,device:e,state:"ACTIVE"};s.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),i),r.push(i)}t&&(t.updateAt=n)}})),this.deviceInfoMap.forEach((function(e,t){"ACTIVE"===e.state&&e.updateAt!==n&&(e.state="INACTIVE",r.push(e))})),this.state===Mg.INITEND){e.next=9;break}return e.abrupt("return",(a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0))));case 9:r.forEach((function(e){switch(e.device.kind){case"audioinput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(Ug.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":s.lastAccessCameraPermission&&s.isAccessCameraPermission&&s.emit(Ug.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(Ug.PLAYOUT_DEVICE_CHANGED,e)}})),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"checkMediaDeviceInfoIsOk",value:function(e){var t,n=e.filter((function(e){return"audioinput"===e.kind})),r=e.filter((function(e){return"videoinput"===e.kind})),i={audio:!1,video:!1},o=s(n);try{for(o.s();!(t=o.n()).done;){var a=t.value;if(a.label&&a.deviceId){i.audio=!0;break}}}catch(f){o.e(f)}finally{o.f()}var c,u=s(r);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(l.label&&l.deviceId){i.video=!0;break}}}catch(f){u.e(f)}finally{u.f()}return i}}]),n}(jv)),Ay=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ky=new(function(){function e(){var t=this;h(this,e),Mp(this,"onAutoplayFailed",void 0),Mp(this,"elementMap",new Map),Mp(this,"elementStateMap",new Map),Mp(this,"elementsNeedToResume",[]),Mp(this,"sinkIdMap",new Map),Mp(this,"autoResumeAfterInterruption",(function(){Array.from(t.elementMap.entries()).forEach((function(e){var n=a(e,2),r=n[0],i=n[1],o=t.elementStateMap.get(r),s=i.srcObject.getAudioTracks()[0];_p()?s&&"live"===s.readyState&&"running"===Zb.curState&&(Jv.debug("auto resume after interruption for iOS 15"),i.pause(),i.play()):o&&"paused"===o&&s&&"live"===s.readyState&&"running"===Zb.curState&&(Jv.debug("auto resume after interruption for iOS"),i.play())}))})),Mp(this,"autoResumeAfterInterruptionOnIOS15",(function(){Array.from(t.elementMap.entries()).forEach((function(e){var t=a(e,2),n=(t[0],t[1]),r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(Jv.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),Zb.on(qb.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zb.on(qb.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),Zb.on(qb.STATE_CHANGE,(function(){pp()&&"suspended"===Zb.prevState&&"running"===Zb.curState&&t.autoResumeAfterInterruption()}))}return v(e,[{key:"setSinkID",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.elementMap.get(t),this.sinkIdMap.set(t,n),!r){e.next=10;break}return e.prev=2,e.next=5,r.setSinkId(n);case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),new Bv(Lv.PERMISSION_DENIED,"can not set sink id: "+e.t0.toString());case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"play",value:function(e,t,n,r){var i=this;if(!this.elementMap.has(t)){var o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,lg.INIT),this.setVolume(t,n);var a=this.sinkIdMap.get(t);if(a)try{o.setSinkId(a).catch((function(e){Jv.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){Jv.warning("[".concat(t,"] set sink id failed"),e.toString())}var s=o.play();s&&s.then&&s.catch((function(e){r&&Wb.autoplayFailed(r,"audio",e.message,t),Jv.warning("audio element play warning",e.toString()),i.elementMap.has(t)&&"NotAllowedError"===e.name&&(Jv.warning("detected audio element autoplay failed"),i.elementsNeedToResume.push(o),RS((function(){i.onAutoplayFailed&&i.onAutoplayFailed(),Mb()})))}))}}},{key:"updateTrack",value:function(e,t){var n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}},{key:"isPlaying",value:function(e){return this.elementMap.has(e)}},{key:"setVolume",value:function(e,t){var n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}},{key:"stop",value:function(e){var t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),t){var n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}}},{key:"bindAudioElementEvents",value:function(e,t){var n=this;Ay.forEach((function(r){t.addEventListener(r,(function(r){var i=n.elementStateMap.get(e),o="pause"===r.type?"paused":r.type;if(Jv.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(o)),"error"===r.type){var a=null==t?void 0:t.error;a&&Jv.error("[".concat(e,"] media error, code: ").concat(a.code,", message: ").concat(a.message))}n.elementStateMap.set(e,o)}))}))}},{key:"getPlayerState",value:function(e){return this.elementStateMap.get(e)||"uninit"}},{key:"autoResumeAudioElement",value:function(){var e=this,t=function(){e.elementsNeedToResume.forEach((function(e){e.play().then((function(e){Jv.debug("Auto resume audio element success")})).catch((function(e){Jv.warning("Auto resume audio element failed!",e)}))})),e.elementsNeedToResume=[]};new Bf((function(e){document.body?e():window.addEventListener("load",(function(){return e()}))})).then((function(){Ap()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))}))}}]),e}());function Cy(){return function(e,t,n){var r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new Bv(Lv.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=r.apply(this,t);return i instanceof Bf?new Bf((function(e,t){i.then(e).catch(t)})):i}),n}}var Ny=dr("Array").values,xy=bo,Dy=ut,Py=N,Ly=Ny,My=Array.prototype,Uy={DOMTokenList:!0,NodeList:!0},jy=function(e){var t=e.values;return e===My||Py(My,e)&&t===My.values||Dy(Uy,xy(e))?Ly:t};function Fy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function By(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fy(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fy(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vy,Gy,Wy,qy,Hy,Ky,zy,Yy,Jy,Xy,Qy,$y,Zy,eT,tT,nT,rT,iT,oT,aT,sT,cT,uT,lT,fT,dT,pT,hT,vT,mT,gT,ET,_T,bT,yT,TT,ST,wT,RT,OT,IT,AT=function(e){d(n,e);var t=p(n);function n(e){var r;return h(this,n),r=t.call(this),Mp(l(r),"name","VideoProcessorDestination"),Mp(l(r),"ID","0"),Mp(l(r),"_source",void 0),Mp(l(r),"videoContext",void 0),Mp(l(r),"inputTrack",void 0),r.videoContext=e,r}return v(n,[{key:"kind",get:function(){return"video"}},{key:"enabled",get:function(){return!0}},{key:"pipe",value:function(){throw new Bv(Lv.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}},{key:"unpipe",value:function(){throw new Bv(Lv.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}},{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"updateInput",value:function(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(XE.ON_TRACK,e.track))}},{key:"reset",value:function(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(XE.ON_TRACK,void 0)}}]),n}(jv),kT=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this),Mp(l(i),"constraintsMap",new Map),Mp(l(i),"statsRegistry",[]),Mp(l(i),"usageRegistry",[]),Mp(l(i),"trackId",void 0),Mp(l(i),"direction",void 0),Mp(l(i),"_chained",!1),i.trackId=e,i.direction=r,i}return v(n,[{key:"chained",get:function(){return this._chained},set:function(e){this._chained=e}},{key:"getConstraints",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_S(this,QE.REQUEST_CONSTRAINTS);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestApplyConstraints",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(Jv.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),bS(this,QE.REQUEST_UPDATE_CONSTRAINTS,Array.from(jy(r=this.constraintsMap).call(r)))));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"requestRevertConstraints",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.constraintsMap.has(t)){e.next=2;break}return e.abrupt("return",(Jv.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),bS(this,QE.REQUEST_UPDATE_CONSTRAINTS,Array.from(jy(n=this.constraintsMap).call(n)))));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"registerStats",value:function(e,t,n){this.statsRegistry.find((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}},{key:"unregisterStats",value:function(e,t){var n=this.statsRegistry.findIndex((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}));-1!==n&&this.statsRegistry.splice(n,1)}},{key:"gatherStats",value:function(){var e,t=[],n=s(this.statsRegistry);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=r.processorID,o=r.processorName,a=r.type,c=r.cb;try{var u=c();t.push({processorID:i,processorName:o,type:a,stats:u})}catch(t){Jv.error(new Bv(Lv.UNEXPECTED_ERROR,t.message))}}}catch(l){n.e(l)}finally{n.f()}return t}},{key:"registerUsage",value:function(e,t){this.usageRegistry.find((function(t){return t.processorID===e.ID&&t.processorName===e.name}))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}},{key:"unregisterUsage",value:function(e){var t=this.usageRegistry.findIndex((function(t){return t.processorID===e.ID&&t.processorName===e.name}));-1!==t&&this.usageRegistry.splice(t,1)}},{key:"gatherUsage",value:function(){var e=u(c().mark((function e(){var t,n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],this.chained){e.next=3;break}return e.abrupt("return",[]);case 3:n=s(this.usageRegistry),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=23;break}if(i=r.value.cb,e.prev=8,o=i(),e.t0=o instanceof Bf,!e.t0){e.next=15;break}return e.next=14,o;case 14:o=e.sent;case 15:t.push(By(By({},o),{},{direction:this.direction})),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(8),Jv.error("gather extension usage error",e.t1);case 21:e.next=6;break;case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(4),n.e(e.t2);case 28:return e.prev=28,n.f(),e.finish(28);case 31:return e.abrupt("return",t);case 32:case"end":return e.stop()}}),e,this,[[4,25,28,31],[8,18]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDirection",value:function(){return this.direction}}]),n}(jv),CT=function(e){d(n,e);var t=p(n);function n(e){var r;return h(this,n),r=t.call(this),Mp(l(r),"name","AudioProcessorDestination"),Mp(l(r),"ID","0"),Mp(l(r),"inputTrack",void 0),Mp(l(r),"inputNode",void 0),Mp(l(r),"audioProcessorContext",void 0),Mp(l(r),"_source",void 0),r.audioProcessorContext=e,r}return v(n,[{key:"kind",get:function(){return"audio"}},{key:"enabled",get:function(){return!0}},{key:"pipe",value:function(){throw new Bv(Lv.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}},{key:"unpipe",value:function(){throw new Bv(Lv.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}},{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"reset",value:function(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(XE.ON_TRACK,void 0),this.emit(XE.ON_NODE,void 0)}},{key:"updateInput",value:function(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(XE.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(XE.ON_NODE,this.inputNode))}}]),n}(jv),NT=function(e){d(n,e);var t=p(n);function n(e,r,i){var o;return h(this,n),o=t.call(this),Mp(l(o),"constraintsMap",new Map),Mp(l(o),"statsRegistry",[]),Mp(l(o),"audioContext",void 0),Mp(l(o),"trackId",void 0),Mp(l(o),"direction",void 0),Mp(l(o),"usageRegistry",[]),Mp(l(o),"_chained",!1),o.audioContext=e,o.trackId=r,o.direction=i,o}return v(n,[{key:"chained",get:function(){return this._chained},set:function(e){this._chained=e}},{key:"getConstraints",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_S(this,QE.REQUEST_CONSTRAINTS));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAudioContext",value:function(){return this.audioContext}},{key:"requestApplyConstraints",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(Jv.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),bS(this,QE.REQUEST_UPDATE_CONSTRAINTS,Array.from(jy(r=this.constraintsMap).call(r)))));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"requestRevertConstraints",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.constraintsMap.has(t)){e.next=2;break}return e.abrupt("return",(this.constraintsMap.delete(t),bS(this,QE.REQUEST_UPDATE_CONSTRAINTS,Array.from(jy(n=this.constraintsMap).call(n)))));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"registerStats",value:function(e,t,n){this.statsRegistry.find((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}},{key:"unregisterStats",value:function(e,t){var n=this.statsRegistry.findIndex((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}));-1!==n&&this.statsRegistry.splice(n,1)}},{key:"gatherStats",value:function(){var e,t=[],n=s(this.statsRegistry);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=r.processorID,o=r.processorName,a=r.type,c=r.cb;try{var u=c();t.push({processorID:i,processorName:o,type:a,stats:u})}catch(t){Jv.error(new Bv(Lv.UNEXPECTED_ERROR,t.message))}}}catch(l){n.e(l)}finally{n.f()}return t}},{key:"registerUsage",value:function(e,t){this.usageRegistry.find((function(t){return t.processorID===e.ID&&t.processorName===e.name}))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}},{key:"unregisterUsage",value:function(e){var t=this.usageRegistry.findIndex((function(t){return t.processorID===e.ID&&t.processorName===e.name}));-1!==t&&this.usageRegistry.splice(t,1)}},{key:"gatherUsage",value:function(){var e=u(c().mark((function e(){var t,n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],this.chained){e.next=3;break}return e.abrupt("return",[]);case 3:n=s(this.usageRegistry),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=23;break}if(i=r.value.cb,e.prev=8,o=i(),e.t0=o instanceof Bf,!e.t0){e.next=15;break}return e.next=14,o;case 14:o=e.sent;case 15:t.push(By(By({},o),{},{direction:this.direction})),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(8),Jv.error("gather extension usage error",e.t1);case 21:e.next=6;break;case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(4),n.e(e.t2);case 28:return e.prev=28,n.f(),e.finish(28);case 31:return e.abrupt("return",t);case 32:case"end":return e.stop()}}),e,this,[[4,25,28,31],[8,18]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDirection",value:function(){return this.direction}}]),n}(jv),xT=function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.call(this),Mp(l(e),"context",void 0),Mp(l(e),"processSourceNode",void 0),Mp(l(e),"outputTrack",void 0),Mp(l(e),"processedNode",void 0),Mp(l(e),"clonedTrack",void 0),Mp(l(e),"outputNode",void 0),e.outputNode=new DT,e}return v(n,[{key:"isPlayed",get:function(){return!0}},{key:"isFreeze",get:function(){return!1}},{key:"setVolume",value:function(){}},{key:"createOutputTrack",value:function(){throw new Bv(Lv.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}},{key:"getOriginVolumeLevel",value:function(){return 0}},{key:"getAccurateVolumeLevel",value:function(){return 0}},{key:"stopGetAudioBuffer",value:function(){}},{key:"startGetAudioBuffer",value:function(){}},{key:"play",value:function(){}},{key:"stop",value:function(){}},{key:"destroy",value:function(){}},{key:"updateTrack",value:function(){}},{key:"updateOriginTrack",value:function(){}},{key:"createMediaStreamSourceNode",value:function(){}}]),n}(jv),DT=function(){function e(){h(this,e)}return v(e,[{key:"disconnect",value:function(){}},{key:"connect",value:function(){}}]),e}(),PT=null,LT=function(){function e(){var t=this;h(this,e),Mp(this,"state","open"),Mp(this,"trigger",void 0),Mp(this,"tasks",[]),Jv.debug("[macro-task-queue] is created."),this.trigger=setTimeout((function(){t.state="closed",Jv.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(t.tasks.map((function(e){return e.key})),"]")),t.trigger=void 0,t.tasks.forEach((function(e){return(0,e.func)()})),t.tasks.length=0,Jv.debug("[macro-task-queue] is closed.")}))}return v(e,[{key:"enqueue",value:function(e,t){"closed"!==this.state&&(this.tasks.push({key:e,func:t}),Jv.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")))}},{key:"runTask",value:function(e){if("closed"!==this.state){var t=this.tasks.findIndex((function(t){return t.key===e}));if(-1!==t){var n=this.tasks.splice(t,1);Jv.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")),n[0].func()}}}},{key:"release",value:function(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,Jv.debug("[macro-task-queue] is closed."))}}]),e}();function MT(e){return function(t,n,r){var i,o=null!==(i=r.value)&&void 0!==i?i:r.get,a=function(){PT&&"open"===PT.state&&PT.runTask(e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==o?void 0:o.apply.apply(o,[this].concat(n))};return r.value?r.value=a:r.get=a,r}}function UT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UT(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.UPDATE_TRACK_SOURCE="update-track-source"}(Vy||(Vy={}));var FT=(Gy=MT("INIT_WEBAUDIO"),Wy=MT("INIT_WEBAUDIO"),qy=MT("INIT_WEBAUDIO"),Hy=Gb({argsMap:function(e,t){return[e.getTrackId(),t]},throttleTime:300}),Ky=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),zy=Cy(),Yy=Yb("LocalAudioTrack","_enabledMutex"),Jy=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),Xy=Cy(),Qy=Yb("LocalAudioTrack","_enabledMutex"),$y=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),Zy=Cy(),eT=Cy(),tT=Cy(),nT=Gb({argsMap:function(e){return[e.getTrackId()]}}),rT=Cy(),iT=Gb({argsMap:function(e){return[e.getTrackId()]}}),oT=Cy(),aT=Gb({argsMap:function(e){return[e.getTrackId()]}}),sT=Gb({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),cT=Gb({argsMap:function(e){return[e.getTrackId()]}}),_b((uT=function(e){d(n,e);var t=p(n);function n(e,r,i,o,a){var s;h(this,n),s=t.call(this,e,i),Mp(l(s),"trackMediaType","audio"),Mp(l(s),"_encoderConfig",void 0),Mp(l(s),"_trackSource",void 0),Mp(l(s),"_enabled",!0),Mp(l(s),"_volume",100),Mp(l(s),"_useAudioElement",!1),Mp(l(s),"_bypassWebAudio",!1),Mp(l(s),"processor",void 0),Mp(l(s),"_processorContext",void 0),Mp(l(s),"_processorDestination",void 0),Mp(l(s),"_getOriginVolumeLevel",void 0),s._encoderConfig=r,s._getOriginVolumeLevel=!!o;var c=function(){s.processorContext=new NT(s._source.context,s.getTrackId(),"local"),s.processorDestination=new CT(s.processorContext),s.bindProcessorDestinationEvents(),s._source.on(Zg.UPDATE_SOURCE,(function(){s.processor&&s.processor.updateInput({node:s._source.processSourceNode,context:s.processorContext})}))},u=a&&fp()&&!ny();return lm("DISABLE_WEBAUDIO")?(s._source=new xT,s._useAudioElement=!0,s._bypassWebAudio=!0):u?s._source=new xT:(s._source=new cy(e,!1,s._getOriginVolumeLevel?e:void 0),lm("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(s._useAudioElement=!0)),c(),!lm("DISABLE_WEBAUDIO")&&u&&(PT||(PT=new LT),PT).enqueue("INIT_WEBAUDIO",(function(){s._source=new cy(e,!1,s._getOriginVolumeLevel?e:void 0),lm("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(s._useAudioElement=!0),c(),s.emit(Vy.UPDATE_TRACK_SOURCE)})),s}return v(n,[{key:"_source",get:function(){return this._trackSource},set:function(e){this._trackSource=e}},{key:"processorContext",get:function(){return this._processorContext},set:function(e){this._processorContext=e}},{key:"processorDestination",get:function(){return this._processorDestination},set:function(e){this._processorDestination=e}},{key:"isPlaying",get:function(){return this._useAudioElement?ky.isPlaying(this.getTrackId()):this._source.isPlayed}},{key:"__className__",get:function(){return"LocalAudioTrack"}},{key:"setVolume",value:function(e){var t=this;Eg(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ky.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void Jv.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));var n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,bS(this,kE.NEED_REPLACE_TRACK,this).then((function(){Jv.debug("[".concat(t.getTrackId(),"] replace web audio track success"))})).catch((function(e){Jv.warning("[".concat(t.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}},{key:"getVolumeLevel",value:function(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}},{key:"setPlaybackDevice",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._useAudioElement){e.next=2;break}throw new Bv(Lv.NOT_SUPPORTED,"your browser does not support setting the audio output device");case 2:return e.next=4,ky.setSinkID(this.getTrackId(),t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setEnabled",value:function(){var e=u(c().mark((function e(t,n,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._setEnabled(t,n,r));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"_setEnabled",value:function(){var e=u(c().mark((function e(t,n,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(Jv.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){e.next=18;break}return this._originMediaStreamTrack.enabled=!0,e.prev=6,r||(this._enabled=!0),e.next=10,bS(this,kE.NEED_ENABLE_TRACK,this);case 10:Jv.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success")),e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(6),r||(this._enabled=!1),Jv.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.t0.toString()),e.t0;case 16:e.next=27;break;case 18:return this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1),e.prev=19,e.next=22,bS(this,kE.NEED_DISABLE_TRACK,this);case 22:e.next=27;break;case 24:throw e.prev=24,e.t1=e.catch(19),r||(this._enabled=!0),Jv.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t1.toString()),e.t1;case 27:case"end":return e.stop()}}),e,this,[[6,13],[19,24]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"setMuted",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t!==this._muted,!e.t0){e.next=13;break}if(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,Jv.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),!t){e.next=11;break}return e.next=9,bS(this,kE.NEED_MUTE_TRACK,this);case 9:e.next=13;break;case 11:return e.next=13,bS(this,kE.NEED_UNMUTE_TRACK,this);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getStats",value:function(){return AS((function(){Jv.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),yS(this,kE.GET_STATS)||jT({},uE)}},{key:"setAudioFrameCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Zg.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Zg.ON_AUDIO_BUFFER),this._source.on(Zg.ON_AUDIO_BUFFER,(function(t){return e(t)}))}},{key:"play",value:function(){Jv.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Jv.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ky.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}},{key:"stop",value:function(){Jv.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ky.stop(this.getTrackId()):this._source.stop()}},{key:"close",value:function(){i(o(n.prototype),"close",this).call(this),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}},{key:"_updatePlayerSource",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Jv.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ky.updateTrack(this.getTrackId(),this._mediaStreamTrack)}},{key:"_updateOriginMediaStreamTrack",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._originMediaStreamTrack!==t,!e.t0){e.next=17;break}if(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t.addEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:t,context:this.processorContext}),this._mediaStreamTrack===this._source.outputTrack){e.next=15;break}return this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),e.next=13,bS(this,kE.NEED_REPLACE_TRACK,this);case 13:e.next=16;break;case 15:this._source.updateTrack(this._originMediaStreamTrack);case 16:this._getOriginVolumeLevel&&this._source.updateOriginTrack(t);case 17:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"renewMediaStreamTrack",value:function(e){return Bf.resolve(void 0)}},{key:"pipe",value:function(e){if(this._bypassWebAudio)throw new Bv(Lv.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Bv(Lv.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}},{key:"unpipe",value:function(){var e;if(this.processor){var t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}}},{key:"bindProcessorDestinationEvents",value:function(){var e=this;this.processorDestination.on(XE.ON_TRACK,function(){var t=u(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=10;break}if(t.t0=n!==e._mediaStreamTrack,!t.t0){t.next=8;break}return e._mediaStreamTrack=n,e._updatePlayerSource(!1),e._source.processedNode=e._source.createMediaStreamSourceNode(n),t.next=8,bS(e,kE.NEED_REPLACE_TRACK,e);case 8:t.next=16;break;case 10:if(t.t1=e._mediaStreamTrack!==e._originMediaStreamTrack,!t.t1){t.next=16;break}return e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource(),t.next=16,bS(e,kE.NEED_REPLACE_TRACK,e);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.processorDestination.on(XE.ON_NODE,(function(t){e._source.processedNode=t}))}},{key:"unbindProcessorDestinationEvents",value:function(){this.processorDestination.removeAllListeners(XE.ON_TRACK),this.processorDestination.removeAllListeners(XE.ON_NODE)}},{key:"unbindProcessorContextEvents",value:function(){this.processorContext.removeAllListeners(QE.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(QE.REQUEST_CONSTRAINTS)}}]),n}(Jb)).prototype,"_source",[Gy],Object.getOwnPropertyDescriptor(uT.prototype,"_source"),uT.prototype),_b(uT.prototype,"processorContext",[Wy],Object.getOwnPropertyDescriptor(uT.prototype,"processorContext"),uT.prototype),_b(uT.prototype,"processorDestination",[qy],Object.getOwnPropertyDescriptor(uT.prototype,"processorDestination"),uT.prototype),_b(uT.prototype,"setVolume",[Hy],Object.getOwnPropertyDescriptor(uT.prototype,"setVolume"),uT.prototype),_b(uT.prototype,"setPlaybackDevice",[Ky,zy],Object.getOwnPropertyDescriptor(uT.prototype,"setPlaybackDevice"),uT.prototype),_b(uT.prototype,"setEnabled",[Yy,Jy,Xy],Object.getOwnPropertyDescriptor(uT.prototype,"setEnabled"),uT.prototype),_b(uT.prototype,"setMuted",[Qy,$y,Zy],Object.getOwnPropertyDescriptor(uT.prototype,"setMuted"),uT.prototype),_b(uT.prototype,"getStats",[eT],Object.getOwnPropertyDescriptor(uT.prototype,"getStats"),uT.prototype),_b(uT.prototype,"setAudioFrameCallback",[tT],Object.getOwnPropertyDescriptor(uT.prototype,"setAudioFrameCallback"),uT.prototype),_b(uT.prototype,"play",[nT,rT],Object.getOwnPropertyDescriptor(uT.prototype,"play"),uT.prototype),_b(uT.prototype,"stop",[iT,oT],Object.getOwnPropertyDescriptor(uT.prototype,"stop"),uT.prototype),_b(uT.prototype,"close",[aT],Object.getOwnPropertyDescriptor(uT.prototype,"close"),uT.prototype),_b(uT.prototype,"pipe",[sT],Object.getOwnPropertyDescriptor(uT.prototype,"pipe"),uT.prototype),_b(uT.prototype,"unpipe",[cT],Object.getOwnPropertyDescriptor(uT.prototype,"unpipe"),uT.prototype),uT),BT=(lT=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),fT=Cy(),dT=Yb("MicrophoneAudioTrack","_enabledMutex"),pT=Gb({argsMap:function(e,t,n){return[e.getTrackId(),t,n]}}),hT=Cy(),vT=Gb({argsMap:function(e){return[e.getTrackId()]}}),_b((mT=function(e){d(n,e);var t=p(n);function n(e,r,i,o){var a;return h(this,n),a=t.call(this,e,r.encoderConfig?cm(r.encoderConfig):{},o,lm("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),Mp(l(a),"_config",void 0),Mp(l(a),"_deviceName","default"),Mp(l(a),"_constraints",void 0),Mp(l(a),"_originalConstraints",void 0),Mp(l(a),"_enabled",!0),a._config=r,a._constraints=i,a._originalConstraints=i,a._deviceName=e.label,"boolean"==typeof r.bypassWebAudio&&(a._bypassWebAudio=r.bypassWebAudio),_p()&&Zb.bindInterruptDetectorTrack(l(a)),a.on(Vy.UPDATE_TRACK_SOURCE,(function(){a.bindProcessorContextEvents()})),ny()&&a.bindProcessorContextEvents(),a}return v(n,[{key:"__className__",get:function(){return"MicrophoneAudioTrack"}},{key:"setDevice",value:function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jv.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),!this._enabled){e.next=35;break}return e.prev=1,e.next=4,Iy.getDeviceById(t);case 4:return n=e.sent,(r={}).audio=jT({},this._constraints),r.audio.deviceId={exact:t},this._originMediaStreamTrack.stop(),i=null,e.prev=8,e.next=11,yy(r,this.getTrackId());case 11:i=e.sent,e.next=23;break;case 14:return e.prev=14,e.t0=e.catch(8),Jv.error("[".concat(this.getTrackId(),"] setDevice failed"),e.t0.toString()),e.next=19,yy({video:this._constraints},this.getTrackId());case 19:return i=e.sent,e.next=22,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1);case 22:throw e.t0;case 23:return e.next=25,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1);case 25:this._deviceName=n.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t},e.next=33;break;case 30:throw e.prev=30,e.t1=e.catch(1),Jv.error("[".concat(this.getTrackId(),"] setDevice error"),e.t1.toString()),e.t1;case 33:e.next=45;break;case 35:return e.prev=35,e.next=38,Iy.getDeviceById(t);case 38:o=e.sent,this._deviceName=o.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t},e.next=45;break;case 42:throw e.prev=42,e.t2=e.catch(35),Jv.error("[".concat(this.getTrackId(),"] setDevice error"),e.t2.toString()),e.t2;case 45:Jv.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"));case 46:case"end":return e.stop()}}),e,this,[[1,30],[8,14],[35,42]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setEnabled",value:function(){var e=u(c().mark((function e(t,r,a){var s,u,l,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return Jv.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),e.next=4,i(o(n.prototype),"_setEnabled",this).call(this,t);case 4:return e.abrupt("return",e.sent);case 5:if(a){e.next=9;break}if(t!==this._enabled){e.next=8;break}return e.abrupt("return");case 8:this.stateCheck("enabled",t);case 9:if(Jv.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){e.next=20;break}return this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(s=this._source.clonedTrack)||void 0===s||s.stop(),a||(this._enabled=!1),e.prev=11,e.next=14,bS(this,kE.NEED_DISABLE_TRACK,this);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(11),Jv.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.t0.toString()),e.t0;case 19:return e.abrupt("return");case 20:return u=jT({},this._constraints),(l=Iy.searchDeviceIdByName(this._deviceName))&&!u.deviceId&&(u.deviceId=l),e.prev=22,a||(this._enabled=!0),e.next=26,yy({audio:this._constraints},this.getTrackId());case 26:return f=e.sent,e.next=29,this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1);case 29:return e.next=31,bS(this,kE.NEED_ENABLE_TRACK,this);case 31:e.next=36;break;case 33:throw e.prev=33,e.t1=e.catch(22),a||(this._enabled=!1),Jv.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.t1.toString()),e.t1;case 36:Jv.info("[".concat(this.getTrackId(),"] setEnabled success"));case 37:case"end":return e.stop()}}),e,this,[[11,16],[22,33]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){i(o(n.prototype),"close",this).call(this),_p()&&Zb.unbindInterruptDetectorTrack(this)}},{key:"onTrackEnded",value:function(){var e=this;if((pp()||Sp())&&this._enabled&&!this._isClosed&&Zb.duringInterruption){var t=function(){var n=u(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Zb.off(qb.IOS_INTERRUPTION_END,t),n.t0=e._enabled&&!e._isClosed,!n.t0){n.next=8;break}return Jv.debug("[".concat(e.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),n.next=6,e.setEnabled(!1);case 6:return n.next=8,e.setEnabled(!0);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();Zb.on(qb.IOS_INTERRUPTION_END,t)}else Jv.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(DE.TRACK_ENDED)}},{key:"renewMediaStreamTrack",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t||this._constraints,(r=Iy.searchDeviceIdByName(this._deviceName))&&!n.deviceId&&(n.deviceId=r),this._constraints=n,!this._enabled){e.next=8;break}return this._originMediaStreamTrack.stop(),e.next=5,yy({audio:this._constraints},this.getTrackId());case 5:return i=e.sent,e.next=8,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"bindProcessorContextEvents",value:function(){var e=this;this.processorContext.on(QE.REQUEST_UPDATE_CONSTRAINTS,function(){var t=u(c().mark((function t(n,r,i){var o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o=Object.assign.apply(Object,[{},e._originalConstraints].concat(m(n))),t.next=4,e.renewMediaStreamTrack(o);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this.processorContext.on(QE.REQUEST_CONSTRAINTS,function(){var t=u(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e._originMediaStreamTrack.getSettings());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),n}(FT)).prototype,"setDevice",[lT,fT],Object.getOwnPropertyDescriptor(mT.prototype,"setDevice"),mT.prototype),_b(mT.prototype,"setEnabled",[dT,pT,hT],Object.getOwnPropertyDescriptor(mT.prototype,"setEnabled"),mT.prototype),_b(mT.prototype,"close",[vT],Object.getOwnPropertyDescriptor(mT.prototype,"close"),mT.prototype),mT),VT=(gT=Gb({argsMap:function(e,t){return[e.getTrackId(),t,e.duration]}}),ET=Cy(),_T=Gb({argsMap:function(e){return[e.getTrackId()]}}),bT=Cy(),yT=Gb({argsMap:function(e){return[e.getTrackId()]}}),TT=Cy(),ST=Gb({argsMap:function(e){return[e.getTrackId()]}}),wT=Cy(),RT=Gb({argsMap:function(e){return[e.getTrackId()]}}),OT=Cy(),_b((IT=function(e){d(n,e);var t=p(n);function n(e,r,i,o){var a;h(this,n),a=t.call(this,r.createOutputTrack(),i,o),Mp(l(a),"source",void 0),Mp(l(a),"_bufferSource",void 0),a.source=e,a._bufferSource=r,a._bufferSource.on(Zg.AUDIO_SOURCE_STATE_CHANGE,(function(e){a.emit(DE.SOURCE_STATE_CHANGE,e)}));try{a._mediaStreamTrack=a._source.createOutputTrack()}catch(e){}return a}return v(n,[{key:"__className__",get:function(){return"BufferSourceAudioTrack"}},{key:"currentState",get:function(){return this._bufferSource.currentState}},{key:"duration",get:function(){return this._bufferSource.duration}},{key:"getCurrentTime",value:function(){return this._bufferSource.currentTime}},{key:"startProcessAudioBuffer",value:function(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}},{key:"pauseProcessAudioBuffer",value:function(){this._bufferSource.pauseProcessAudioBuffer()}},{key:"seekAudioBuffer",value:function(e){this._bufferSource.seekAudioBuffer(e)}},{key:"resumeProcessAudioBuffer",value:function(){this._bufferSource.resumeProcessAudioBuffer()}},{key:"stopProcessAudioBuffer",value:function(){this._bufferSource.stopProcessAudioBuffer()}}]),n}(FT)).prototype,"startProcessAudioBuffer",[gT,ET],Object.getOwnPropertyDescriptor(IT.prototype,"startProcessAudioBuffer"),IT.prototype),_b(IT.prototype,"pauseProcessAudioBuffer",[_T,bT],Object.getOwnPropertyDescriptor(IT.prototype,"pauseProcessAudioBuffer"),IT.prototype),_b(IT.prototype,"seekAudioBuffer",[yT,TT],Object.getOwnPropertyDescriptor(IT.prototype,"seekAudioBuffer"),IT.prototype),_b(IT.prototype,"resumeProcessAudioBuffer",[ST,wT],Object.getOwnPropertyDescriptor(IT.prototype,"resumeProcessAudioBuffer"),IT.prototype),_b(IT.prototype,"stopProcessAudioBuffer",[RT,OT],Object.getOwnPropertyDescriptor(IT.prototype,"stopProcessAudioBuffer"),IT.prototype),IT),GT=function(e){d(n,e);var t=p(n);function n(){var e;h(this,n);var r=ty().createMediaStreamDestination();e=t.call(this,r.stream.getAudioTracks()[0],void 0,hS(8,"track-mix-")),Mp(l(e),"trackList",void 0),Mp(l(e),"destNode",void 0);try{e._mediaStreamTrack=e._source.createOutputTrack()}catch(r){}return e.destNode=r,e.trackList=[],e}return v(n,[{key:"__className__",get:function(){return"MixingAudioTrack"}},{key:"isActive",get:function(){var e,t=s(this.trackList);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n._enabled&&!n._isClosed&&!n.muted)return!0}}catch(r){t.e(r)}finally{t.f()}return!1}},{key:"hasAudioTrack",value:function(e){return-1!==this.trackList.indexOf(e)}},{key:"addAudioTrack",value:function(e){-1===this.trackList.indexOf(e)?(Jv.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):Jv.debug("track ".concat(e.getTrackId()," is already added"))}},{key:"removeAudioTrack",value:function(e){if(-1!==this.trackList.indexOf(e)){Jv.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}SS(this.trackList,e),this.updateEncoderConfig()}}},{key:"updateEncoderConfig",value:function(){var e={};this.trackList.forEach((function(t){t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}}]),n}(FT),WT=function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.apply(this,arguments),Mp(l(e),"resultStorage",new Map),e}return v(n,[{key:"setLocalAudioStats",value:function(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}},{key:"setLocalVideoStats",value:function(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}},{key:"setRemoteAudioStats",value:function(e,t){var n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}},{key:"setRemoteVideoStats",value:function(e,t){var n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}},{key:"record",value:function(e,t,n){this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});var r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i=r.result.includes(!0);r.isPrevNormal&&!i&&this.emit("exception",qT[e],e,t),!r.isPrevNormal&&i&&this.emit("exception",qT[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=i,r.result=[]}}},{key:"checkAudioOutputLevel",value:function(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}},{key:"checkAudioInputLevel",value:function(e,t){return t instanceof GT&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}},{key:"checkFramerateInput",value:function(e,t){var n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=eS(t._encoderConfig.frameRate));var r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}},{key:"checkFramerateSent",value:function(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}},{key:"checkSendVideoBitrate",value:function(e,t){return!!t.muted||0!==e.sendBitrate}},{key:"checkSendAudioBitrate",value:function(e,t){return t instanceof GT&&!t.isActive||!!t.muted||0!==e.sendBitrate}},{key:"checkVideoDecode",value:function(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}]),n}(jv),qT={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},HT=new(function(){function e(){h(this,e)}return v(e,[{key:"markSubscribeStart",value:function(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}},{key:"markPublishStart",value:function(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}},{key:"measureFromSubscribeStart",value:function(e,t){var n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){var r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}},{key:"measureFromPublishStart",value:function(e,t){var n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){var r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}}]),e}());function KT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KT(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var YT=function(){function e(t){var n=this;h(this,e),Mp(this,"store",void 0),Mp(this,"onStatsException",void 0),Mp(this,"onUploadPublishDuration",void 0),Mp(this,"localStats",new Map),Mp(this,"remoteStats",new Map),Mp(this,"updateStatsInterval",void 0),Mp(this,"trafficStats",void 0),Mp(this,"trafficStatsPeerList",[]),Mp(this,"uplinkStats",void 0),Mp(this,"exceptionMonitor",void 0),Mp(this,"p2pChannel",void 0),Mp(this,"updateStats",(function(){n.p2pChannel&&(n.updateRemoteStats(n.p2pChannel),n.updateLocalStats(n.p2pChannel))})),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new WT,this.exceptionMonitor.on("exception",(function(e,t,r){n.onStatsException&&n.onStatsException(e,t,r)}))}return v(e,[{key:"reset",value:function(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}},{key:"getLocalAudioTrackStats",value:function(){return this.localStats.get(HE.LocalAudioTrack)||zT({},uE)}},{key:"getLocalVideoTrackStats",value:function(){return this.localStats.get(HE.LocalVideoTrack)||zT({},lE)}},{key:"getRemoteAudioTrackStats",value:function(e){var t=this,n=function(e,n){if(!t.trafficStats)return n;var r=t.trafficStats.peer_delay.find((function(t){return t.peer_uid===e}));return r&&(n.publishDuration=r.B_ppad+(Date.now()-t.trafficStats.timestamp)),n},r={};if(e){var i,o=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.audioStats;o&&(r[e]=n(e,o))}else Array.from(this.remoteStats.entries()).forEach((function(e){var t=a(e,2),i=t[0],o=t[1].audioStats;o&&(r[i]=n(i,o))}));return r}},{key:"getRemoteNetworkQualityStats",value:function(e){var t={};if(e){var n,r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((function(e){var n=a(e,2),r=n[0],i=n[1].networkStats;i&&(t[r]=i)}));return t}},{key:"getRemoteVideoTrackStats",value:function(e){var t=this,n=function(e,n){if(!t.trafficStats)return n;var r=t.trafficStats.peer_delay.find((function(t){return t.peer_uid===e}));return r&&(n.publishDuration=r.B_ppvd+(Date.now()-t.trafficStats.timestamp)),n},r={};if(e){var i,o=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.videoStats;o&&(r[e]=n(e,o))}else Array.from(this.remoteStats.entries()).forEach((function(e){var t=a(e,2),i=t[0],o=t[1].videoStats;o&&(r[i]=n(i,o))}));return r}},{key:"getRTCStats",value:function(){var e=0,t=0,n=0,r=0,i=this.localStats.get(HE.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);var o=this.localStats.get(HE.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);var a=this.localStats.get(HE.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach((function(e){var t=e.audioStats,i=e.videoStats;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));var s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}},{key:"addLocalStats",value:function(e){this.localStats.set(e,void 0)}},{key:"removeLocalStats",value:function(e){e?this.localStats.delete(e):this.localStats.clear()}},{key:"addRemoteStats",value:function(e){this.remoteStats.set(e,{})}},{key:"removeRemoteStats",value:function(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}},{key:"addP2PChannel",value:function(e){this.p2pChannel=e}},{key:"updateTrafficStats",value:function(e){var t=this;e.peer_delay=e.peer_delay.filter((function(e){return void 0!==e.B_ppad||void 0!==e.B_ppvd})),e.peer_delay.filter((function(e){return-1===t.trafficStatsPeerList.indexOf(e.peer_uid)})).forEach((function(e){var n,r=null===(n=t.p2pChannel)||void 0===n?void 0:n.getRemoteMedia(e.peer_uid),i=null!=r&&r.videoSSRC?HT.measureFromSubscribeStart(t.store.clientId,r.videoSSRC):0,o=null!=r&&r.audioSSRC?HT.measureFromSubscribeStart(t.store.clientId,r.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(t.onUploadPublishDuration&&t.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,i>o?i:o),t.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}},{key:"updateUplinkStats",value:function(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&Jv.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}},{key:"isLocalVideoFreeze",value:function(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}},{key:"updateLocalStats",value:function(e){var t=this;Array.from(this.localStats.entries()).forEach((function(n){var r=a(n,2),i=r[0],o=r[1];switch(i){case HE.LocalVideoTrack:case HE.LocalVideoLowTrack:var s=o,c=zT({},lE),u=e.getStats(),l=e.getLocalMedia(i);if(u){var f=u.videoSend.find((function(e){return e.ssrc===(null==l?void 0:l.ssrcs[0].ssrcId)}));if(f){var d=e.getLocalVideoSize(),p=e.getEncoderConfig(HE.LocalVideoTrack);"H264"!==f.codec&&"VP8"!==f.codec&&"VP9"!==f.codec&&"AV1X"!==f.codec&&"AV1"!==f.codec||(c.codecType=f.codec),c.sendBytes=f.bytes,c.sendBitrate=s?8*Math.max(0,c.sendBytes-s.sendBytes):0,f.inputFrame?(c.captureFrameRate=f.inputFrame.frameRate,c.captureResolutionHeight=f.inputFrame.height,c.captureResolutionWidth=f.inputFrame.width):d&&(c.captureResolutionWidth=d.width,c.captureResolutionHeight=d.height),f.sentFrame?(c.sendFrameRate=f.sentFrame.frameRate,c.sendResolutionHeight=f.sentFrame.height,c.sendResolutionWidth=f.sentFrame.width):d&&(c.sendResolutionWidth=d.width,c.sendResolutionHeight=d.height),f.avgEncodeMs&&(c.encodeDelay=f.avgEncodeMs),p&&p.bitrateMax&&(c.targetSendBitrate=1e3*p.bitrateMax),c.sendPackets=f.packets,c.sendPacketsLost=f.packetsLost,c.totalDuration=s?s.totalDuration+1:1,c.totalFreezeTime=s?s.totalFreezeTime:0,t.isLocalVideoFreeze(f)&&(c.totalFreezeTime+=1)}t.trafficStats&&(c.sendPacketsLost=t.trafficStats.B_pvlr4/100)}t.localStats.set(i,c),c&&l&&t.exceptionMonitor.setLocalVideoStats(t.store.uid,l.track,c);break;case HE.LocalAudioTrack:var h=o,v=zT({},uE),m=e.getStats(),g=e.getLocalMedia(i);if(m){var E=m.audioSend.find((function(e){return e.ssrc===(null==g?void 0:g.ssrcs[0].ssrcId)}));if(E){if("opus"!==E.codec&&"aac"!==E.codec&&"PCMU"!==E.codec&&"PCMA"!==E.codec&&"G722"!==E.codec||(v.codecType=E.codec),E.inputLevel)v.sendVolumeLevel=Math.round(32767*E.inputLevel);else{var _=e.getLocalAudioVolume();_&&(v.sendVolumeLevel=Math.round(32767*_))}v.sendBytes=E.bytes,v.sendPackets=E.packets,v.sendPacketsLost=E.packetsLost,v.sendBitrate=h?8*Math.max(0,v.sendBytes-h.sendBytes):0}}t.trafficStats&&(v.sendPacketsLost=t.trafficStats.B_pvlr4/100),t.localStats.set(HE.LocalAudioTrack,v),v&&g&&t.exceptionMonitor.setLocalAudioStats(t.store.uid,g.track,v)}}))}},{key:"updateRemoteStats",value:function(t){var n=this;Array.from(this.remoteStats.entries()).forEach((function(r){var i=a(r,2),o=i[0],s=i[1],c=s.videoStats,u=s.audioStats,l=c,f=s.videoPcStats,d=zT({},fE),p=zT({},pE),h=zT({},dE),v=t.getRemoteMedia(o),m=v.audioTrack,g=v.videoTrack,E=v.audioSSRC,_=v.videoSSRC,b=t.getStats(),y=null==b?void 0:b.audioRecv.find((function(e){return e.ssrc===E})),T=null==b?void 0:b.videoRecv.find((function(e){return e.ssrc===_})),S=n.trafficStats&&n.trafficStats.peer_delay.find((function(e){return e.peer_uid===o}));if(y&&("opus"!==y.codec&&"aac"!==y.codec&&"PCMU"!==y.codec&&"PCMA"!==y.codec&&"G722"!==y.codec||(d.codecType=y.codec),y.outputLevel?d.receiveLevel=Math.round(32767*y.outputLevel):m&&(d.receiveLevel=Math.round(32767*m.getVolumeLevel())),d.receiveBytes=y.bytes,d.receivePackets=y.packets,d.receivePacketsLost=y.packetsLost,d.packetLossRate=d.receivePacketsLost/(d.receivePackets+d.receivePacketsLost),d.receiveBitrate=u?8*Math.max(0,d.receiveBytes-u.receiveBytes):0,d.totalDuration=u?u.totalDuration+1:1,d.totalFreezeTime=u?u.totalFreezeTime:0,d.freezeRate=d.totalFreezeTime/d.totalDuration,d.receiveDelay=y.jitterBufferMs,d.totalDuration>10&&e.isRemoteAudioFreeze(m)&&(d.totalFreezeTime+=1)),T){"H264"!==T.codec&&"VP8"!==T.codec&&"VP9"!==T.codec&&"AV1X"!==T.codec&&"AV1"!==T.codec||(p.codecType=T.codec),p.receiveBytes=T.bytes,p.receiveBitrate=l?8*Math.max(0,p.receiveBytes-l.receiveBytes):0,p.decodeFrameRate=T.decodeFrameRate<0?0:T.decodeFrameRate,p.renderFrameRate=T.decodeFrameRate<0?0:T.decodeFrameRate,T.outputFrame&&(p.renderFrameRate=T.outputFrame.frameRate),T.receivedFrame?(p.receiveFrameRate=T.receivedFrame.frameRate,p.receiveResolutionHeight=T.receivedFrame.height,p.receiveResolutionWidth=T.receivedFrame.width):g&&(p.receiveResolutionHeight=g._videoHeight||0,p.receiveResolutionWidth=g._videoWidth||0),void 0!==T.framesRateFirefox&&(p.receiveFrameRate=Math.round(T.framesRateFirefox)),p.receivePackets=T.packets,p.receivePacketsLost=T.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.totalDuration=l?l.totalDuration+1:1,p.totalFreezeTime=l?l.totalFreezeTime:0,p.receiveDelay=T.jitterBufferMs||0;var w=!!_&&t.getRemoteVideoIsReady(_);g&&w&&e.isRemoteVideoFreeze(g,T,f)&&(p.totalFreezeTime+=1),p.freezeRate=p.totalFreezeTime/p.totalDuration}S&&(d.end2EndDelay=S.B_ad,p.end2EndDelay=S.B_vd,d.transportDelay=S.B_ed,p.transportDelay=S.B_ed,d.currentPacketLossRate=S.B_ealr4/100,p.currentPacketLossRate=S.B_evlr4/100,h.uplinkNetworkQuality=S.B_punq?S.B_punq:0,h.downlinkNetworkQuality=S.B_pdnq?S.B_pdnq:0),n.remoteStats.set(o,{audioStats:d,videoStats:p,videoPcStats:T,networkStats:h}),m&&n.exceptionMonitor.setRemoteAudioStats(m,d),g&&n.exceptionMonitor.setRemoteVideoStats(g,p)}))}}],[{key:"isRemoteVideoFreeze",value:function(e,t,n){if(!e)return!1;var r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}},{key:"isRemoteAudioFreeze",value:function(e){return!!e&&e._isFreeze()}}]),e}(),JT=new(function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.call(this),Mp(l(e),"_lastHiddenTime",0),Mp(l(e),"_lastVisibleTime",0),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?e._lastHiddenTime=performance.now():e._lastVisibleTime=performance.now(),Jv.debug("document visibility went ".concat(document.visibilityState)),e.emit("VISIBILITY_CHANGE",document.visibilityState)})),e}return v(n,[{key:"visibility",get:function(){return document.visibilityState}},{key:"lastHiddenTime",get:function(){return this._lastHiddenTime}},{key:"lastVisibleTime",get:function(){return this._lastVisibleTime}}]),n}(jv));function XT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function QT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?XT(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $T(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(lm("TURN_DOMAIN")):(Jv.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function ZT(e,t){var n,r,i=lm("GATEWAY_DOMAINS"),o=i[1]&&-1!==t.indexOf(i[1])?1:0;e.addresses=e.addresses||[];var a=e.addresses.map((function(e){return e.domain_prefix?{address:"".concat(e.domain_prefix,".").concat(i[o++%i.length],":").concat(e.port)}:e.ip.match(/^[\.\:\d]+$/)?{ip:e.ip,port:e.port,address:"".concat(e.ip.replace(/[^\d]/g,"-"),".").concat(i[o++%i.length],":").concat(e.port)}:(Jv.info("Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),{ip:e.ip,port:e.port,address:"".concat(e.ip,":").concat(e.port)})}));if(null!==(n=e.detail)&&void 0!==n&&n[18]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[18]))for(var s=e.detail[18],c=null==s?void 0:s.split(";"),u=0;u<c.length;u++){var l,f=jd(l=c[u]).call(l);a[u]&&f&&(a[u].ip6=f)}return{gatewayAddrs:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function eS(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function tS(e){var t=e._encoderConfig;if(!t)return{};var n={resolution:t.width&&t.height?"".concat(eS(t.width),"x").concat(eS(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function nS(e,t,n){var r,i,o,a,s,c,u,l,f=t.videoSend.find((function(t){return t.ssrc===e}));if(!f)return null;var d={id:hS(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:f.ssrc.toString()},p=null!==(r=null!==(i=null===(o=f.inputFrame)||void 0===o?void 0:o.height)&&void 0!==i?i:null==n?void 0:n._videoHeight)&&void 0!==r?r:0,h=null!==(a=null!==(s=null===(c=f.inputFrame)||void 0===c?void 0:c.width)&&void 0!==s?s:null==n?void 0:n._videoWidth)&&void 0!==a?a:0,v=null!==(u=null===(l=f.inputFrame)||void 0===l?void 0:l.frameRate)&&void 0!==u?u:0;return p&&(d.A_fhi=p+""),h&&(d.A_fwi=h+""),v&&(d.A_fri=v+""),d}function rS(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function iS(e,t){var n,r,i=void 0;switch(t){case o_.CHOOSE_SERVER:n=4096,r="choose server";break;case o_.CLOUD_PROXY:n=1048576,r="proxy";break;case o_.CLOUD_PROXY_5:n=4194304,r="proxy5";break;case o_.CLOUD_PROXY_FALLBACK:n=4194310,r="proxy fallback";break;default:throw new Bv(Lv.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((function(t){t.buffer&&t.buffer.flag===n&&(i={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((function(e){return QT(QT({},e),{},{ticket:t.buffer.cert})})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:QT(QT({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!i)throw new Bv(Lv.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}function oS(e,t){return aS.apply(this,arguments)}function aS(){return aS=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bf.all(t.addresses.map(function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=$T(t.ip),e.t1=t.port,e.t2=t.port,e.t3=n&&lm("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():em.username,!(n&&lm("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext)){e.next=10;break}return e.next=7,Fb(n.toString());case 7:e.t4=e.sent,e.next=11;break;case 10:e.t4=em.password;case 11:return e.t5=e.t4,e.abrupt("return",{address:e.t0,tcpport:e.t1,udpport:e.t2,username:e.t3,password:e.t5});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),aS.apply(this,arguments)}function sS(e,t){var n=t._videoWidth||t.getMediaStreamTrack(!0).getSettings().width;return n||Jv.warning("cannot get original video track's width, default scale down 4 times for low stream"),n?n/eS(e.width):4}function cS(e){var t=e.candidateType,n=e.relayProtocol,r=e.type,i=e.address,o=e.port,a=e.protocol;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:a}:{candidateType:t,relayProtocol:n,address:i,port:o,protocol:a}}function uS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uS(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fS(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function dS(e){return new Bf((function(t){window.setTimeout(t,e)}))}function pS(e){var t=new Bv(Lv.TIMEOUT,"timeout");return new Bf((function(n,r){window.setTimeout((function(){return r(t)}),e)}))}function hS(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+hS(e-n.length,"")}function vS(){return hS(32,"").toUpperCase()}var mS=function(){};function gS(e){return new Bf((function(t,n){var r=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);var o=pp()?"canplay":"playing";i.addEventListener(o,(function(){var e=i.videoWidth,n=i.videoHeight;!e&&dp()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(mS),setTimeout((function(){r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function ES(e){return Bf.all(e.map((function(e){return e.then((function(e){throw e}),(function(e){return e}))}))).then((function(e){throw e}),(function(e){return e}))}function _S(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?Bf.reject(new Bv(Lv.UNEXPECTED_ERROR,"can not emit promise")):new Bf((function(n,i){e.emit.apply(e,[t].concat(r,[n,i]))}))}function bS(e,t){if(0===e.getListeners(t).length)return Bf.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return _S.apply(void 0,[e,t].concat(r))}function yS(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return TS.apply(void 0,[e,t].concat(r))}function TS(e,t){for(var n=null,r=null,i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];if(e.emit.apply(e,[t].concat(o,[function(e){n=e},function(e){r=e}])),null!==r)throw r;if(null===n)throw new Bv(Lv.UNEXPECTED_ERROR,"handler is not sync");return n}function SS(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function wS(e){var t=[];return e.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),t}function RS(e){Bf.resolve().then(e)}function OS(e){return JSON.parse(JSON.stringify(e))}var IS={};function AS(e,t){IS[t]||(IS[t]=!0,e())}function kS(e){for(var t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length)),r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function CS(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}var NS=new(function(){function e(){h(this,e),Mp(this,"fnMap",new Map)}return v(e,[{key:"throttleByKey",value:function(e,t,n,r){for(var i=this,o=arguments.length,a=new Array(o>4?o-4:0),s=4;s<o;s++)a[s-4]=arguments[s];if(this.fnMap.has(t)){var c=this.fnMap.get(t);if(c.threshold!==n){c.fn.apply(c,m(c.args)),clearTimeout(c.timer);var u=window.setTimeout((function(){var e=i.fnMap.get(t);e&&e.fn.apply(e,m(e.args)),i.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:a,skipFn:r})}else c.skipFn&&c.skipFn.apply(c,m(c.args)),this.fnMap.set(t,lS(lS({},c),{},{fn:e,args:a,skipFn:r}))}else{var l=window.setTimeout((function(){var e=i.fnMap.get(t);e&&e.fn.apply(e,m(e.args)),i.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:a,skipFn:r})}}}]),e}()),xS=NS.throttleByKey.bind(NS),DS=function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s,l,f,d,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fragementLength,r=t.referenceList,i=t.asyncMapHandler,o=t.allFailedhandler,a=t.promisesCollector,s=0,l=n,d=0,p=function(){var e=u(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){var e=s*l,t=e+l;return r.slice(e,t).map(i)}(),a&&a.push.apply(a,m(t)),e.prev=2,e.next=5,ES(t);case 5:f=e.sent,e.next=15;break;case 8:if(e.prev=8,e.t0=e.catch(2),s++,(d+=l)>=r.length){e.next=14;break}return e.next=13,p();case 13:return e.abrupt("return",void e.sent);case 14:o(e.t0);case 15:t.forEach((function(e){return e.cancel()}));case 16:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}(),e.next=6,p();case 6:return e.abrupt("return",f);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function PS(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}var LS=(g(_={},jg.ACCESS_POINT,(g(e={},Vg.NO_FLAG_SET,{desc:"flag is zero",retry:!1}),g(e,Vg.FLAG_SET_BUT_EMPTY,{desc:"flag is empty",retry:!1}),g(e,Vg.INVALID_FALG_SET,{desc:"invalid flag",retry:!1}),g(e,Vg.FLAG_SET_BUT_NO_RE,{desc:"flag set unilbs but no request",retry:!1}),g(e,Vg.INVALID_SERVICE_ID,{desc:"invalid service id",retry:!1}),g(e,Vg.NO_SERVICE_AVAILABLE,{desc:"no service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_P2P,{desc:"no unilbs p2p service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_VOET,{desc:"no unilbs voice service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_WEBRTC,{desc:"no unilbs webrtc service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_CDS,{desc:"no cds service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_CDN,{desc:"no cdn dispatcher service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_TDS,{desc:"no tds service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_REPORT,{desc:"no unilbs report service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_APP_CENTER,{desc:"no app center service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_ENV0,{desc:"no unilbs sig env0 service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_VOET,{desc:"no unilbs voet service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_STRING_UID,{desc:"no string uid service available",retry:!0}),g(e,Vg.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS,{desc:"no webrtc unilbs service available",retry:!0}),e)),g(_,jg.UNILBS,(g(t={},Bg.INVALID_VENDOR_KEY,{desc:"invalid vendor key, can not find appid",retry:!1}),g(t,Bg.INVALID_CHANNEL_NAME,{desc:"invalid channel name",retry:!1}),g(t,Bg.INTERNAL_ERROR,{desc:"unilbs internal error",retry:!1}),g(t,Bg.NO_AUTHORIZED,{desc:"invalid token, authorized failed",retry:!1}),g(t,Bg.DYNAMIC_KEY_TIMEOUT,{desc:"dynamic key or token timeout",retry:!1}),g(t,Bg.NO_ACTIVE_STATUS,{desc:"no active status",retry:!1}),g(t,Bg.DYNAMIC_KEY_EXPIRED,{desc:"dynamic key expired",retry:!1}),g(t,Bg.STATIC_USE_DYNAMIC_KEY,{desc:"static use dynamic key",retry:!1}),g(t,Bg.DYNAMIC_USE_STATIC_KEY,{desc:"dynamic use static key",retry:!1}),g(t,Bg.USER_OVERLOAD,{desc:"amount of users over load",retry:!1}),g(t,Bg.FORBIDDEN_REGION,{desc:"the request is forbidden in this area",retry:!1}),g(t,Bg.CANNOT_MEET_AREA_DEMAND,{desc:"unable to allocate services in this area",retry:!1}),t)),g(_,jg.STRING_UID_ALLOCATOR,(g(E={},Fg.IIIEGAL_APPID,{desc:"invalid appid",retry:!1}),g(E,Fg.IIIEGAL_UID,{desc:"invalid string uid",retry:!1}),g(E,Fg.INTERNAL_ERROR,{desc:"string uid allocator internal error",retry:!0}),E)),_);function MS(e){var t=LS[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};var n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===jg.ACCESS_POINT){var r=e%1e4;if("1"===r.toString()[0])return{desc:e.toString(),retry:!1};if("2"===r.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}var US=(g(b={},Gg.K_TIMESTAMP_EXPIRED,{desc:"K_TIMESTAMP_EXPIRED",action:"failed"}),g(b,Gg.K_CHANNEL_PERMISSION_INVALID,{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"}),g(b,Gg.K_CERTIFICATE_INVALID,{desc:"K_CERTIFICATE_INVALID",action:"failed"}),g(b,Gg.K_CHANNEL_NAME_EMPTY,{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"}),g(b,Gg.K_CHANNEL_NOT_FOUND,{desc:"K_CHANNEL_NOT_FOUND",action:"failed"}),g(b,Gg.K_TICKET_INVALID,{desc:"K_TICKET_INVALID",action:"failed"}),g(b,Gg.K_CHANNEL_CONFLICTED,{desc:"K_CHANNEL_CONFLICTED",action:"failed"}),g(b,Gg.K_SERVICE_NOT_READY,{desc:"K_SERVICE_NOT_READY",action:"tryNext"}),g(b,Gg.K_SERVICE_TOO_HEAVY,{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"}),g(b,Gg.K_UID_BANNED,{desc:"K_UID_BANNED",action:"failed"}),g(b,Gg.K_IP_BANNED,{desc:"K_IP_BANNED",action:"failed"}),g(b,Gg.ERR_INVALID_VENDOR_KEY,{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"}),g(b,Gg.ERR_INVALID_CHANNEL_NAME,{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"}),g(b,Gg.WARN_NO_AVAILABLE_CHANNEL,{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"}),g(b,Gg.WARN_LOOKUP_CHANNEL_TIMEOUT,{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"}),g(b,Gg.WARN_LOOKUP_CHANNEL_REJECTED,{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"}),g(b,Gg.WARN_OPEN_CHANNEL_TIMEOUT,{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"}),g(b,Gg.WARN_OPEN_CHANNEL_REJECTED,{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"}),g(b,Gg.WARN_REQUEST_DEFERRED,{desc:"WARN_REQUEST_DEFERRED",action:"failed"}),g(b,Gg.ERR_DYNAMIC_KEY_TIMEOUT,{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"}),g(b,Gg.ERR_NO_AUTHORIZED,{desc:"ERR_NO_AUTHORIZED",action:"failed"}),g(b,Gg.ERR_VOM_SERVICE_UNAVAILABLE,{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"}),g(b,Gg.ERR_NO_CHANNEL_AVAILABLE_CODE,{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"}),g(b,Gg.ERR_MASTER_VOCS_UNAVAILABLE,{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"}),g(b,Gg.ERR_INTERNAL_ERROR,{desc:"ERR_INTERNAL_ERROR",action:"tryNext"}),g(b,Gg.ERR_NO_ACTIVE_STATUS,{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"}),g(b,Gg.ERR_INVALID_UID,{desc:"ERR_INVALID_UID",action:"failed"}),g(b,Gg.ERR_DYNAMIC_KEY_EXPIRED,{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"}),g(b,Gg.ERR_STATIC_USE_DYANMIC_KE,{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"}),g(b,Gg.ERR_DYNAMIC_USE_STATIC_KE,{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"}),g(b,Gg.ERR_NO_VOCS_AVAILABLE,{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"}),g(b,Gg.ERR_NO_VOS_AVAILABLE,{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"}),g(b,Gg.ERR_JOIN_CHANNEL_TIMEOUT,{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"}),g(b,Gg.ERR_JOIN_BY_MULTI_IP,{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"}),g(b,Gg.ERR_NOT_JOINED,{desc:"ERR_NOT_JOINED",action:"failed"}),g(b,Gg.ERR_REPEAT_JOIN_REQUEST,{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"}),g(b,Gg.ERR_REPEAT_JOIN_CHANNEL,{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"}),g(b,Gg.ERR_INVALID_VENDOR_KEY,{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"}),g(b,Gg.ERR_INVALID_CHANNEL_NAME,{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"}),g(b,Gg.ERR_INVALID_STRINGUID,{desc:"ERR_INVALID_STRINGUID",action:"failed"}),g(b,Gg.ERR_TOO_MANY_USERS,{desc:"ERR_TOO_MANY_USERS",action:"tryNext"}),g(b,Gg.ERR_SET_CLIENT_ROLE_TIMEOUT,{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"}),g(b,Gg.ERR_SET_CLIENT_ROLE_NO_PERMISSION,{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"}),g(b,Gg.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE,{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"}),g(b,Gg.ERR_PUBLISH_REQUEST_INVALID,{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"}),g(b,Gg.ERR_SUBSCRIBE_REQUEST_INVALID,{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"}),g(b,Gg.ERR_NOT_SUPPORTED_MESSAGE,{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"}),g(b,Gg.ERR_ILLEAGAL_PLUGIN,{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"}),g(b,Gg.ILLEGAL_CLIENT_ROLE_LEVEL,{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"}),g(b,Gg.ERR_REJOIN_TOKEN_INVALID,{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"}),g(b,Gg.ERR_REJOIN_USER_NOT_JOINED,{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"}),g(b,Gg.ERR_INVALID_OPTIONAL_INFO,{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"}),g(b,Gg.ERR_TEST_RECOVER,{desc:"ERR_TEST_RECOVER",action:"recover"}),g(b,Gg.ERR_TEST_TRYNEXT,{desc:"ERR_TEST_TRYNEXT",action:"recover"}),g(b,Gg.ERR_TEST_RETRY,{desc:"ERR_TEST_RETRY",action:"recover"}),g(b,Gg.ILLEGAL_AES_PASSWORD,{desc:"ERR_TEST_RETRY",action:"failed"}),g(b,Gg.ERR_TOO_MANY_BROADCASTERS,{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"}),g(b,Gg.ERR_TOO_MANY_SUBSCRIBERS,{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"}),g(b,Gg.ERR_LICENSE_ILLEGAL,{desc:"ERR_LICENSE_ILLEGAL",action:"quit"}),g(b,Gg.ERR_LICENSE_MISSING,{desc:"ERR_LICENSE_MISSING",action:"quit"}),g(b,Gg.ERR_LICENSE_EXPIRED,{desc:"ERR_LICENSE_EXPIRED",action:"quit"}),g(b,Gg.ERR_LICENSE_MINUTES_EXCEEDED,{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"}),g(b,Gg.ERR_LICENSE_PERIOD_INVALID,{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"}),g(b,Gg.ERR_LICENSE_MULTIPLE_SDK_SERVICE,{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}),b);function jS(e){return US[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function FS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var BS=function(e){d(n,e);var t=p(n);function n(e,r){var i;h(this,n);var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0;i=t.call(this),Mp(l(i),"connectionID",0),Mp(l(i),"currentURLIndex",0),Mp(l(i),"urls",void 0),Mp(l(i),"_reconnectMode","tryNext"),Mp(l(i),"reconnectReason",void 0),Mp(l(i),"_initMutex",new zb("websocket")),Mp(l(i),"name",void 0),Mp(l(i),"_state","closed"),Mp(l(i),"reconnectInterrupter",void 0),Mp(l(i),"websocket",void 0),Mp(l(i),"retryConfig",void 0),Mp(l(i),"reconnectCount",0),Mp(l(i),"forceCloseTimeout",5e3),Mp(l(i),"onlineReconnectListener",void 0),Mp(l(i),"useCompress",void 0),Mp(l(i),"tryDoubleDomain",!1),Mp(l(i),"wsInflateLength",0),Mp(l(i),"wsDeflateLength",0),Mp(l(i),"closeEstablishingWs",(function(){})),Mp(l(i),"store",void 0),Mp(l(i),"joinChannelServiceRecordIndex",void 0),i.store=s,i.name=e,i.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?FS(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r),i.useCompress=o,i.tryDoubleDomain=a;var c=r.timeout,u=r.timeoutFactor,f=Math.max(300,Math.floor(3*c/5)),d=Math.max(1.2,Math.floor(8*u)/10);return YE.ONLINE&&(i.retryConfig.timeout=f,i.retryConfig.timeoutFactor=d),Db.on(JE.NETWORK_STATE_CHANGE,(function(e,t){e!==t&&(i.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===YE.ONLINE?(i.retryConfig.timeout=f,i.retryConfig.timeoutFactor=d):(i.retryConfig.timeout=c,i.retryConfig.timeoutFactor=u))})),i}return v(n,[{key:"url",get:function(){return this.websocket?this.websocket.url:null}},{key:"reconnectMode",get:function(){return this._reconnectMode},set:function(e){["tryNext","recover"].includes(e)&&this.resetReconnectCount(e),this._reconnectMode=e}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(aE.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(aE.CONNECTED):"closed"===this._state?this.emit(aE.CLOSED):"failed"===this._state&&this.emit(aE.FAILED))}},{key:"resetReconnectCount",value:function(e){Jv.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}},{key:"getConnection",value:function(){return this.websocket||void 0}},{key:"init",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this.forceCloseTimeout=n;var r=function(n,r){t.urls=e;var i=t.urls[t.currentURLIndex];t.state="connecting",t.createWebSocketConnection(i).then(n).catch(r),t.once(aE.CLOSED,(function(){return r(new Bv(Lv.WS_DISCONNECT))})),t.once(aE.CONNECTED,(function(){return n()}))};return this._initMutex.lock().then((function(e){return new Bf((function(e,t){r(e,t)})).then((function(){e()})).catch((function(){e()}))}))}},{key:"close",value:function(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;var n=this.websocket;t?setTimeout((function(){return n.close()}),500):n.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}},{key:"reconnect",value:function(e,t){if(this.websocket){var n;void 0!==e&&(this.reconnectMode=e),Jv.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinChannelServiceRecordIndex&&(null===(n=this.store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinChannelServiceRecordIndex));var r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:t})}else Jv.warning("[".concat(this.name,"] can not reconnect, no websocket"))}},{key:"sendMessage",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Bv(Lv.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new Bv(Lv.WS_ERR,"send websocket message error"+e.toString())}}},{key:"setWsInflateData",value:function(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}},{key:"getWsInflateData",value:function(){var e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}},{key:"clearWsInflateData",value:function(){this.wsInflateLength=0,this.wsDeflateLength=0}},{key:"createWebSocketConnection",value:function(){var e=u(c().mark((function e(t,n){var r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new Bf((function(e,i){var o,a=function(t){var n;null===(n=r.store)||void 0===n||n.signalChannelOpen(),Jv.debug("[".concat(r.name,"] websocket opened:"),t),r.reconnectMode="retry",r.state="connected",r.resetReconnectCount("opened"),e()},s=function(){var t=u(c().mark((function t(n){var o,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Jv.debug("[".concat(r.name,"] websocket close ").concat(r.websocket&&r.websocket.url,", code: ").concat(n.code,", reason: ").concat(n.reason,", current mode: ").concat(r.reconnectMode)),!(r.reconnectCount<r.retryConfig.maxRetryCount)){t.next=13;break}return"connected"===r.state&&(r.reconnectReason=n.reason,r.state="reconnecting"),o=yS(r,aE.WILL_RECONNECT,r.reconnectMode)||r.reconnectMode,t.next=5,r.reconnectWithAction(o);case 5:if(a=t.sent,"closed"!==r.state){t.next=8;break}return t.abrupt("return",void Jv.debug("[".concat(r.connectionID,"] ws is closed, no need to reconnect")));case 8:if(a){t.next=10;break}return t.abrupt("return",(i(new Bv(Lv.WS_DISCONNECT,"websocket reconnect failed: ".concat(n.code))),void r.close(!0)));case 10:e(),t.next=14;break;case 13:i(new Bv(Lv.WS_DISCONNECT,"websocket close: ".concat(n.code))),r.close();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),l=function(e){r.emit(aE.ON_MESSAGE,e)};r.websocket&&(r.websocket.onclose=null,r.websocket.close()),lm("GATEWAY_WSS_ADDRESS")&&r.name.startsWith("gateway")&&(t=lm("GATEWAY_WSS_ADDRESS")),Jv.debug("[".concat(r.name,"] start connect, url: ").concat(t));var f=null===(o=r.store)||void 0===o?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});r.chooseBestWebsocketConnection(t,!!n,f).then((function(e){var t;r.websocket=e,a&&a(e.url),e.onclose=s,e.onmessage=l,null===(t=r.store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:"success"},f),r.joinChannelServiceRecordIndex=f})).catch((function(e){var t;if(null===(t=r.store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:e instanceof Bv&&e.code===Lv.WS_ABORT?"aborted":"error",errors:[e]},f),"closed"!==r.state){if(e instanceof Bv&&e.code===Lv.WS_ERR){var n=new Bv(Lv.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return Jv.error("[".concat(r.name,"]").concat(n)),void i(n)}s&&s(e)}else i(new Bv(Lv.WS_DISCONNECT,"websocket is closed: ".concat(e.toString())))}))}))));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"reconnectWithAction",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s,l,f,d=this,p=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(p.length>1&&void 0!==p[1])||p[1],!(this.reconnectCount>=this.retryConfig.maxRetryCount)){e.next=3;break}return e.abrupt("return",!1);case 3:if(this.urls){e.next=5;break}return e.abrupt("return",!1);case 5:if("closed"!==this.state){e.next=7;break}return e.abrupt("return",!1);case 7:if(this.onlineReconnectListener||Db.networkState!==YE.OFFLINE||(this.onlineReconnectListener=Db.onlineWaiter&&Db.onlineWaiter.then((function(){d.onlineReconnectListener=void 0}))),r=!0,this.reconnectInterrupter=function(){r=!1},!n){e.next=14;break}return i=Gv(this.reconnectCount,this.retryConfig),Jv.debug("[".concat(this.name,"] wait ").concat(i,"ms to reconnect websocket, mode: ").concat(t)),e.next=14,Bf.race([dS(i),this.onlineReconnectListener||new Bf((function(){}))]);case 14:if("closed"!==this.state&&r){e.next=16;break}return e.abrupt("return",!1);case 16:if(this.reconnectCount+=1,o=function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.emit(aE.RECONNECT_CREATE_CONNECTION,n),e.next=3,d.createWebSocketConnection(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.prev=18,"retry"!==t){e.next=26;break}return a=this.urls[this.currentURLIndex],this.emit(aE.RECONNECT_WAITTING_FINISH,t),e.next=24,o(a,t);case 24:e.next=49;break;case 26:if("tryNext"!==t){e.next=38;break}if(this.currentURLIndex+=1,!(this.currentURLIndex>=this.urls.length)){e.next=31;break}return e.next=30,this.reconnectWithAction("recover",!1);case 30:return e.abrupt("return",e.sent);case 31:return Jv.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),s=this.urls[this.currentURLIndex],this.emit(aE.RECONNECT_WAITTING_FINISH,t),e.next=36,o(s,t);case 36:e.next=49;break;case 38:if("recover"!==t){e.next=49;break}return Jv.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(aE.RECONNECT_WAITTING_FINISH,t),e.next=44,_S(this,aE.REQUEST_NEW_URLS);case 44:return this.urls=e.sent,this.currentURLIndex=0,l=this.urls[this.currentURLIndex],e.next=49,o(l,t);case 49:return e.abrupt("return",!0);case 52:if(e.prev=52,e.t0=e.catch(18),Jv.error("[".concat(this.name,"] reconnect failed"),e.t0.toString()),!(null!=e.t0&&null!==(f=e.t0.data)&&void 0!==f&&f.desc&&Array.isArray(e.t0.data.desc)&&e.t0.data.desc.length&&e.t0.data.desc.includes("dynamic key expired"))){e.next=59;break}e.t1=(this.emit(aE.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1),e.next=62;break;case 59:return e.next=61,this.reconnectWithAction(t,n);case 61:e.t1=e.sent;case 62:return e.abrupt("return",e.t1);case 63:case"end":return e.stop()}}),e,this,[[18,52]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"chooseBestWebsocketConnection",value:function(){var e=u(c().mark((function e(t,n,r){var i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Bf((function(e,o){var a=!1,s=[];i.closeEstablishingWs=function(){Jv.debug("[choose-best-ws] close establishing websockets"),s.forEach((function(e){e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),o(new Bv(Lv.WS_ABORT,"choose best websocket aborted"))};var c,u=lm("GATEWAY_DOMAINS"),l=t.indexOf("?h="),f=u.find((function(e){return-1!==l?t.includes(e,l):t.includes(e)}));Jv.debug("[choose-best-ws] currentDomain: ",f,", domains: ",u);var d=!i.tryDoubleDomain||n||!f;if(!d&&f){var p,h=Date.now();try{u.forEach((function(e){var n=-1===l?t.replace(f,e):t.substr(0,l)+t.substr(l).replace(f,e),r=new WebSocket(n);r.binaryType="arraybuffer",s.push(r),Jv.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(t){for(Jv.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach((function(e){return e.close()}));s.length;)s.pop();d=!0}null===(p=i.store)||void 0===p||p.recordJoinChannelService({urls:s.map((function(e){return e.url})),service:"gateway"},r),s.forEach((function(t){t.onopen=function(){if(!a){var n=Date.now()-h;Jv.debug("[choose-best-ws] ws open cost ".concat(n,"ms")),s.filter((function(e){return e!==t})).forEach((function(e){Jv.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),a=!0,e(t)}},t.onclose=function(e){c=e,a||s.find((function(e){return!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}))||(Jv.debug("[choose-best-ws] all websocket is closed"),a=!0,o(c))},t.onmessage=function(e){Jv.debug("[choose-best-ws]".concat(t.url," onmessage: ").concat(e.data))}})),dS(i.forceCloseTimeout).then((function(){s.forEach((function(e){e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(d){var v,m;Jv.debug("[choose-best-ws] use single url: ",t),null===(v=i.store)||void 0===v||v.recordJoinChannelService({urls:[t],service:"gateway"},r);try{m=new WebSocket(t),s.push(m),m.binaryType="arraybuffer"}catch(t){var g=new Bv(Lv.WS_ERR,"init websocket failed! Error: ".concat(t.toString()));return Jv.error("[".concat(i.name,"]").concat(g)),void o(g)}m.onopen=function(){e(m)},m.onclose=function(e){o(e)},m.onmessage=function(e){Jv.debug("[choose-best-ws]".concat(m.url," onmessage: ").concat(e.data))},dS(i.forceCloseTimeout).then((function(){m&&m.readyState!==WebSocket.OPEN&&m.close()}))}})).then((function(e){return i.closeEstablishingWs=void 0,e})).catch((function(e){throw i.closeEstablishingWs=void 0,e})));case 1:case"end":return e.stop()}}),e)})));function t(t,n,r){return e.apply(this,arguments)}return t}()}]),n}(jv),VS=function(){function e(t){h(this,e),Mp(this,"input",[]),Mp(this,"size",void 0),this.size=t}return v(e,[{key:"add",value:function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}},{key:"mean",value:function(){var e;return 0===this.input.length?0:Er(e=this.input).call(e,(function(e,t){return e+t}))/this.input.length}}]),e}(),GS=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this),Mp(l(i),"_disconnectedReason",void 0),Mp(l(i),"_websocketReconnectReason",void 0),Mp(l(i),"_connectionState",zg.CLOSED),Mp(l(i),"reconnectToken",void 0),Mp(l(i),"websocket",void 0),Mp(l(i),"openConnectionTime",void 0),Mp(l(i),"clientId",void 0),Mp(l(i),"lastMsgTime",Date.now()),Mp(l(i),"uploadCache",[]),Mp(l(i),"uploadCacheInterval",void 0),Mp(l(i),"rttRolling",new VS(5)),Mp(l(i),"pingpongTimer",void 0),Mp(l(i),"wsInflateDataTimer",void 0),Mp(l(i),"pingpongTimeoutCount",0),Mp(l(i),"joinResponse",void 0),Mp(l(i),"multiIpOption",void 0),Mp(l(i),"initError",void 0),Mp(l(i),"spec",void 0),Mp(l(i),"store",void 0),Mp(l(i),"onWebsocketMessage",(function(e){if(e.data instanceof ArrayBuffer)i.emit(Yg.ON_BINARY_DATA,e.data);else{var t=JSON.parse(e.data);if(i.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){var n="res-@".concat(t._id);i.emit(n,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(i.emit(t._type,t._message),t._type===Qg.ON_NOTIFICATION&&i.handleNotification(t._message),t._type===Qg.ON_USER_BANNED)switch(t._message.error_code){case 14:i.close(qg.UID_BANNED);break;case 15:i.close(qg.IP_BANNED);break;case 16:i.close(qg.CHANNEL_BANNED)}if(t._type===Qg.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Gg.ERR_LICENSE_MISSING:i.close(qg.LICENSE_MISSING);break;case Gg.ERR_LICENSE_EXPIRED:i.close(qg.LICENSE_EXPIRED);break;case Gg.ERR_LICENSE_MINUTES_EXCEEDED:i.close(qg.LICENSE_MINUTES_EXCEEDED);break;case Gg.ERR_LICENSE_PERIOD_INVALID:i.close(qg.LICENSE_PERIOD_INVALID);break;case Gg.ERR_LICENSE_MULTIPLE_SDK_SERVICE:i.close(qg.LICENSE_MULTIPLE_SDK_SERVICE);break;case Gg.ERR_LICENSE_ILLEGAL:i.close(qg.LICENSE_ILLEGAL);break;default:i.close()}}}})),i.clientId=e.clientId,i.spec=e,i.store=r,i.websocket=new BS("gateway-".concat(i.clientId),i.spec.retryConfig,!0,!0,r),i.handleWebsocketEvents(),window.addEventListener("offline",(function(){i.connectionState===zg.CONNECTED&&i.reconnect("retry",Kg.OFFLINE)})),i}return v(n,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){e!==this._connectionState&&(this._connectionState=e,e===zg.CONNECTED?this.emit(Yg.WS_CONNECTED):e===zg.RECONNECTING?this.emit(Yg.WS_RECONNECTING,this._websocketReconnectReason):e===zg.CLOSED&&this.emit(Yg.WS_CLOSED,this._disconnectedReason))}},{key:"currentURLIndex",get:function(){return this.websocket.currentURLIndex}},{key:"url",get:function(){return this.websocket?this.websocket.url:null}},{key:"rtt",get:function(){return this.rttRolling.mean()}},{key:"request",value:function(){var e=u(c().mark((function e(t,n,r,i){var o,a,s,u,l,f,d,p,h,v=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=hS(6,""),a={_id:o,_type:t,_message:n},s=this.websocket.connectionID,u=function(){return new Bf((function(e,n){if(v.connectionState===zg.CONNECTED)return e();var r=function(){v.off(Yg.WS_CLOSED,i),e()},i=function(){v.off(Yg.WS_CONNECTED,r),n(new Bv(Lv.WS_ABORT))};v.once(Yg.WS_CONNECTED,r),v.once(Yg.WS_CLOSED,i),t!==Jg.PUBLISH&&t!==Jg.SUBSCRIBE&&t!==Jg.UNSUBSCRIBE&&t!==Jg.UNPUBLISH&&t!==Jg.CONTROL&&t!==Jg.RESTART_ICE||v.once(Yg.DISCONNECT_P2P,(function(){n(new Bv(Lv.DISCONNECT_P2P))})),t!==Jg.PUBLISH&&t!==Jg.RESTART_ICE||v.once(Yg.ABORT_P2P_EXECUTION,(function(){n(new Bv(Lv.DISCONNECT_P2P))}))}))},e.t0=this.connectionState!==zg.CONNECTING&&this.connectionState!==zg.RECONNECTING||t===Jg.JOIN||t===Jg.REJOIN,e.t0){e.next=5;break}return e.next=5,u();case 5:if(this.websocket.sendMessage(a,!0),!i){e.next=8;break}return e.abrupt("return");case 8:return l=new Bf((function(e,r){var i=!1,a=function(r,o){i=!0,e({isSuccess:"success"===r,message:o||{}}),v.off(Yg.WS_CLOSED,c),v.off(Yg.WS_RECONNECTING,c),v.emit(Yg.REQUEST_SUCCESS,t,n)};v.once("res-@".concat(o),a);var c=function e(){r(new Bv(Lv.WS_ABORT,"type: ".concat(t))),v.off(Yg.WS_CLOSED,e),v.off(Yg.WS_RECONNECTING,e),v.off("res-@".concat(o),a)};v.once(Yg.WS_CLOSED,c),v.once(Yg.WS_RECONNECTING,c),dS(lm("SIGNAL_REQUEST_TIMEOUT")).then((function(){v.websocket.connectionID!==s||i||(Jv.warning("ws request timeout, type: ".concat(t)),v.emit(Yg.REQUEST_TIMEOUT,t,n))}))})),f=null,e.prev=10,e.next=13,l;case 13:f=e.sent,e.next=35;break;case 16:if(e.prev=16,e.t1=e.catch(10),this.connectionState!==zg.CLOSED&&t!==Jg.LEAVE){e.next=20;break}throw new Bv(Lv.WS_ABORT);case 20:if(this.spec.forceWaitGatewayResponse&&!r){e.next=24;break}e.t2=e.t1.throw(),e.next=34;break;case 24:if(t!==Jg.JOIN&&t!==Jg.REJOIN){e.next=28;break}e.t3=null,e.next=33;break;case 28:return e.next=30,u();case 30:return e.next=32,this.request(t,n);case 32:e.t3=e.sent;case 33:e.t2=e.t3;case 34:return e.abrupt("return",e.t2);case 35:if(!f.isSuccess){e.next=37;break}return e.abrupt("return",f.message);case 37:if(d=Number(f.message.error_code||f.message.code),p=jS(d),h=new Bv(Lv.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(f.message.error_str),{code:d,data:f.message}),"success"!==p.action){e.next=42;break}e.t4=f.message,e.next=67;break;case 42:if(Jv.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(d,", message: ").concat(p.desc,", action: ").concat(p.action)),d!==Gg.ERR_TOO_MANY_BROADCASTERS){e.next=47;break}e.t5=t===Jg.JOIN||t===Jg.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw(),e.next=66;break;case 47:if("failed"!==p.action){e.next=51;break}e.t6=h.throw(),e.next=65;break;case 51:if("quit"!==p.action){e.next=55;break}e.t7=(this.initError=h,this.close(),h.throw()),e.next=64;break;case 55:if(d===Gg.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,Jv.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Kg.MULTI_IP)):this.reconnect(p.action,Kg.SERVER_ERROR),t!==Jg.JOIN&&t!==Jg.REJOIN){e.next=60;break}e.t8=null,e.next=63;break;case 60:return e.next=62,this.request(t,n);case 62:e.t8=e.sent;case 63:e.t7=e.t8;case 64:e.t6=e.t7;case 65:e.t5=e.t6;case 66:e.t4=e.t5;case 67:return e.abrupt("return",e.t4);case 68:case"end":return e.stop()}}),e,this,[[10,16]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"waitMessage",value:function(e,t){var n=this;return new Bf((function(r){var i=function i(o){(!t||t(o))&&(n.off(e,i),r(o))};n.on(e,i)}))}},{key:"upload",value:function(e,t){var n=this,r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(e){var i=lm("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((function(){if(n.connectionState===zg.CONNECTED){var e=n.uploadCache.splice(0,1)[0];0===n.uploadCache.length&&(window.clearInterval(n.uploadCacheInterval),n.uploadCacheInterval=void 0),n.upload(e._type,e._message)}}),lm("UPLOAD_CACHE_INTERVAL")||2e3))}}},{key:"send",value:function(e,t){var n={_type:e,_message:t};this.websocket.sendMessage(n)}},{key:"init",value:function(e,t){var n=this;return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Bf((function(r,i){n.once(Yg.WS_CONNECTED,(function(){return r(n.joinResponse)})),n.once(Yg.WS_CLOSED,(function(){return i(n.initError||new Bv(Lv.WS_ABORT))})),n.connectionState=zg.CONNECTING,n.websocket.init(e).catch(i),n.wsInflateDataTimer&&window.clearInterval(n.wsInflateDataTimer),n.wsInflateDataTimer=window.setInterval((function(){n.handleWsInflateData()}),2e4),setTimeout((function(){t&&void 0===n.openConnectionTime&&(Jv.debug("[".concat(n.clientId,"] init websocket timeout while join with fallback to proxy")),i(new Bv(Lv.INIT_WEBSOCKET_TIMEOUT)))}),lm("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))}))}},{key:"close",value:function(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||qg.LEAVE,this.connectionState=zg.CLOSED,Jv.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===qg.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new BS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}},{key:"join",value:function(){var e=u(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.joinResponse){e.next=11;break}return this.emit(Yg.ABORT_P2P_EXECUTION),e.next=4,_S(this,Yg.REQUEST_JOIN_INFO);case 4:return t=e.sent,e.next=7,this.request(Jg.JOIN,t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",(this.emit(Yg.REPORT_JOIN_GATEWAY,Lv.TIMEOUT,this.url||""),!1));case 10:this.joinResponse=n,this.emit(Yg.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token;case 11:return e.abrupt("return",(this.connectionState=zg.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"rejoin",value:function(){var e=u(c().mark((function e(){var t,n,r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reconnectToken){e.next=2;break}throw new Bv(Lv.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");case 2:return(t=TS(this,Yg.REQUEST_REJOIN_INFO)).token=this.reconnectToken,e.next=6,this.request(Jg.REJOIN,t);case 6:return n=e.sent,e.abrupt("return",!!n&&(this.connectionState=zg.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach((function(e){r.emit(Qg.ON_USER_ONLINE,{uid:e.uid}),e.audio&&r.emit(Qg.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&r.emit(Qg.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?r.emit(Qg.MUTE_AUDIO,{uid:e.uid}):r.emit(Qg.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?r.emit(Qg.MUTE_VIDEO,{uid:e.uid}):r.emit(Qg.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?r.emit(Qg.ENABLE_LOCAL_AUDIO,{uid:e.uid}):r.emit(Qg.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?r.emit(Qg.ENABLE_LOCAL_VIDEO,{uid:e.uid}):r.emit(Qg.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||r.emit(Qg.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reconnect",value:function(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}},{key:"handleNotification",value:function(e){Jv.debug("[".concat(this.clientId,"] receive notification: "),e);var t=jS(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(qg.UID_BANNED),void this.close()):void this.reconnect(t.action,Kg.SERVER_ERROR);Jv.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}},{key:"handlePingPong",value:function(){var e=this;if(this.websocket&&"connected"===this.websocket.state){this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var t=lm("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(Jv.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>lm("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Kg.TIMEOUT):this.request(Jg.PING,void 0,!0).then((function(){e.pingpongTimeoutCount=0;var t=Date.now()-n;e.rttRolling.add(t),lm("REPORT_STATS")&&e.send(Jg.PING_BACK,{pingpongElapse:t})})).catch((function(e){}))}}},{key:"handleWsInflateData",value:function(){var e=this.websocket.getWsInflateData(),t=e.wsInflateLength,n=e.wsDeflateLength;0!==t&&0!==n&&this.upload(Xg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}},{key:"handleWebsocketEvents",value:function(){var e=this;this.websocket.on(aE.RECONNECT_WAITTING_FINISH,(function(t){e.emit(Yg.WS_RECONNECT_WAITTING_FINISH,t)})),this.websocket.on(aE.RECONNECT_CREATE_CONNECTION,(function(t){e.emit(Yg.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(aE.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(aE.CLOSED,(function(){e.connectionState=zg.CLOSED})),this.websocket.on(aE.FAILED,(function(){e._disconnectedReason=qg.NETWORK_ERROR,e.connectionState=zg.CLOSED})),this.websocket.on(aE.RECONNECTING,(function(t){e._websocketReconnectReason=t,e.joinResponse=void 0,e.connectionState===zg.CONNECTED?e.connectionState=zg.RECONNECTING:e.connectionState=zg.CONNECTING})),this.websocket.on(aE.WILL_RECONNECT,(function(t,n){if(TS(e,Yg.IS_P2P_DISCONNECTED)&&"retry"===t)return Jv.debug("".concat(e.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e.reconnectToken=void 0,e.emit(Yg.NEED_RENEW_SESSION),e.emit(Yg.DISCONNECT_P2P),n("tryNext");"retry"!==t&&(Jv.debug("".concat(e.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),e.reconnectToken=void 0,e.emit(Yg.NEED_RENEW_SESSION),e.emit(Yg.DISCONNECT_P2P)),n(t)})),this.websocket.on(aE.CONNECTED,(function(){e.openConnectionTime=Date.now(),e.reconnectToken?e.rejoin().catch((function(t){Jv.warning("[".concat(e.clientId,"] rejoin failed ").concat(t)),e.reconnect("tryNext",Kg.SERVER_ERROR)})):e.join().catch((function(t){if(e.emit(Yg.REPORT_JOIN_GATEWAY,t.message||t.code,e.url||""),t instanceof Bv&&t.code===Lv.UNEXPECTED_RESPONSE&&t.data.code===Gg.ERR_NO_AUTHORIZED)return Jv.warning("[".concat(e.clientId,"] reconnect no authorized, recover")),void e.reconnect("recover",Kg.SERVER_ERROR);Jv.error("[".concat(e.clientId,"] join gateway request failed"),t.toString()),e.spec.forceWaitGatewayResponse?e.reconnect("tryNext",Kg.SERVER_ERROR):(e.initError=t,e.close())}))})),this.websocket.on(aE.REQUEST_NEW_URLS,(function(t,n){_S(e,Yg.REQUEST_RECOVER,e.multiIpOption).then(t).catch(n)})),this.websocket.on(aE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){e.emit(Qg.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}]),n}(jv);function WS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var qS,HS=function(e){d(n,e);var t=p(n);function n(e,r,i,o){var a;return h(this,n),a=t.call(this),Mp(l(a),"connectionID",0),Mp(l(a),"currentURLIndex",0),Mp(l(a),"reconnectReason",void 0),Mp(l(a),"_reconnectMode","tryNext"),Mp(l(a),"_initMutex",void 0),Mp(l(a),"_name",void 0),Mp(l(a),"_state","closed"),Mp(l(a),"_reconnectInterrupter",void 0),Mp(l(a),"_url",void 0),Mp(l(a),"_retryConfig",void 0),Mp(l(a),"_reconnectCount",0),Mp(l(a),"_forceCloseTimeout",5e3),Mp(l(a),"_onlineReconnectListener",void 0),Mp(l(a),"_closeEstablishingTransmitter",(function(){})),Mp(l(a),"_store",void 0),Mp(l(a),"_joinChannelServiceRecordIndex",void 0),Mp(l(a),"_transmitter",void 0),Mp(l(a),"_useCompress",void 0),Mp(l(a),"_inflateLength",0),Mp(l(a),"_deflateLength",0),a._store=o,a._name=e,a._retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WS(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r),a._useCompress=i,a}return v(n,[{key:"url",get:function(){return this._url?this._url:null}},{key:"reconnectMode",get:function(){return this._reconnectMode},set:function(e){["tryNext","recover"].includes(e)&&this.resetReconnectCount(e),this._reconnectMode=e}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(n_.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(n_.CONNECTED):"closed"===this._state?this.emit(n_.CLOSED):"failed"===this._state&&this.emit(n_.FAILED))}},{key:"resetReconnectCount",value:function(e){Jv.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}},{key:"close",value:function(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;var n=this._transmitter;t?setTimeout((function(){return n.close()}),500):n.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}},{key:"reconnect",value:function(e,t){if(this._transmitter){var n;void 0!==e&&(this.reconnectMode=e),Jv.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(n=this._store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));var r=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),r&&r.bind(this._transmitter)({code:9999,reason:t})}else Jv.warning("[".concat(this._name,"] can not reconnect, no websocket"))}},{key:"getInflateData",value:function(){var e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}},{key:"setInflateData",value:function(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}},{key:"clearInflateData",value:function(){this._inflateLength=0,this._deflateLength=0}}]),n}(jv);function KS(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);var r=e.getUint32(t,n),i=e.getUint32(t+4,n),o=Number(!!n),a=Number(!n);return BigInt(r*a+i*o)<<BigInt(32)|BigInt(r*o+i*a)}function zS(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);var i=Number(n>>BigInt(32)),o=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,i,r),e.setUint32(t,o,r)):(e.setUint32(t,i,r),e.setUint32(t+4,o,r))}!function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"}(qS||(qS={}));var YS=function(){function e(t,n,r){h(this,e),Mp(this,"version",1),Mp(this,"initialRTO",void 0),Mp(this,"maxBatchAckCount",void 0),Mp(this,"maxRTO",void 0),Mp(this,"initialRTT",void 0),Mp(this,"ID",void 0),Mp(this,"rtt",void 0),Mp(this,"packetNumber",1),Mp(this,"rtoRatioMap",new Map),Mp(this,"timeoutMap",new Map),Mp(this,"unorderedPacketQueue",[]),Mp(this,"batchAckPacketQueue",[]),Mp(this,"lastOrderedPacketNumber",0),Mp(this,"batchAckTimer",void 0),Mp(this,"sendImpl",void 0),Mp(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=hS(7,"transmitter-"),this.initialRTO=void 0!==(null==r?void 0:r.initialRTO)?r.initialRTO:lm("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==r?void 0:r.initialRTT)?r.initialRTT:lm("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==r?void 0:r.initialRTT)?r.initialRTT:lm("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==r?void 0:r.maxBatchAckCount)?r.maxBatchAckCount:lm("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==r?void 0:r.maxRTO)?r.maxRTO:lm("TRANSMITTER_MAX_RTO")}return v(e,[{key:"packetize",value:function(e,t){return{type:qS.Default,version:this.version,packetNumber:t,payload:e}}},{key:"serialize",value:function(e){switch(e.type){case qS.Default:var t;t="string"==typeof e.payload?(new TextEncoder).encode(e.payload):e.payload;var n=new ArrayBuffer(t.length+15),r=new DataView(n);return r.setUint16(0,e.version),r.setUint8(2,e.type),r.setUint32(3,e.packetNumber),zS(r,7,BigInt(e.sendTs)),new Uint8Array(r.buffer).set(t,15),n;case qS.Ack:var i=new ArrayBuffer(16),o=new DataView(i);return o.setUint16(0,e.version),o.setUint8(2,e.type),o.setUint32(3,e.maxAckPacketNumber),o.setUint8(7,e.shift),zS(o,8,BigInt(e.ackSendTs)),i}}},{key:"deserialize",value:function(e){var t=new DataView(e),n=t.getUint16(0),r=t.getUint8(2);switch(r){case qS.Default:var i=t.getUint32(3),o=KS(t,7),a=e.slice(15),s=(new TextDecoder).decode(a);return{version:n,type:r,packetNumber:i,sendTs:Number(o),payload:s};case qS.Ack:var c=t.getUint32(3),u=t.getUint8(7),l=KS(t,8);return{version:n,type:r,maxAckPacketNumber:c,shift:u,ackSendTs:Number(l)};default:throw Jv.error("[".concat(this.ID,"] Unrecognized packet type ").concat(r)),new Error("Unrecognized packet type ".concat(r))}}},{key:"sendMessage",value:function(e){var t=this,n=this.packetize(e,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;var r=this.calculateRTO(n),i=window.setTimeout((function(){t.resendMessage(n)}),r);this.timeoutMap.set(n.packetNumber,i),this.sendPacket(n)}},{key:"onData",value:function(e){var t=this.deserialize(e);t.type===qS.Default?this.ack(t):t.type===qS.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}},{key:"close",value:function(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach((function(e){var t=a(e,2),n=(t[0],t[1]);window.clearTimeout(n)})),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}},{key:"resendMessage",value:function(e){var t=this,n=this.calculateRTO(e),r=window.setTimeout((function(){t.resendMessage(e)}),n);this.timeoutMap.set(e.packetNumber,r),this.sendPacket(e)}},{key:"calculateRTO",value:function(e){var t=this.rtoRatioMap.get(e.packetNumber);if(void 0===t)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;var n=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),n>this.maxRTO?this.maxRTO:n}},{key:"updateRTT",value:function(e,t){var n=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-n-this.rtt)/8}},{key:"ack",value:function(e){var t=this;if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout((function(){t.batchAck()}),this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){var n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){var r={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:qS.Ack,version:this.version};this.sendPacket(r)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;var i={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:qS.Ack,version:this.version};this.sendPacket(i)}}},{key:"batchAck",value:function(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;var e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:qS.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}},{key:"sendPacket",value:function(e){e.type===qS.Default&&(e.sendTs=Math.round(performance.now()));var t=this.serialize(e);this.sendImpl(t)}},{key:"clearRTO",value:function(e){for(var t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){var n=this.timeoutMap.get(t);void 0!==n&&window.clearTimeout(n),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}]),e}(),JS=function(e){d(n,e);var t=p(n);function n(e,r){var i;h(this,n),i=t.call(this,e,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),Mp(l(i),"_initMutex",void 0),Mp(l(i),"_reconnectInterrupter",void 0),Mp(l(i),"_url",void 0),Mp(l(i),"_transmitter",void 0),Mp(l(i),"_addresses",void 0),Mp(l(i),"_reliableTransmission",void 0),i._initMutex=new zb("datachannel");var o=r.timeout,a=r.timeoutFactor,s=Math.max(300,Math.floor(3*o/5)),c=Math.max(1.2,Math.floor(8*a)/10);return YE.ONLINE&&(i._retryConfig.timeout=s,i._retryConfig.timeoutFactor=c),Db.on(JE.NETWORK_STATE_CHANGE,(function(e,t){e!==t&&(i.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===YE.ONLINE?(i._retryConfig.timeout=s,i._retryConfig.timeoutFactor=c):(i._retryConfig.timeout=o,i._retryConfig.timeoutFactor=a))})),i}return v(n,[{key:"getConnection",value:function(){if(this._reliableTransmission)return this._reliableTransmission}},{key:"init",value:function(){var e=u(c().mark((function e(t){var n,r,i=this,o=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:5e3,this._forceCloseTimeout=n,r=function(e,n){i._addresses=t,i.currentURLIndex=i._addresses.findIndex((function(e){return e.fingerprint||lm("FINGERPRINT")}));var r=i._addresses[i.currentURLIndex];i.state="connecting",i.createTransmitterConnection(r).then(e).catch(n),i.once(n_.CLOSED,(function(){return n(new Bv(Lv.WS_DISCONNECT))})),i.once(n_.CONNECTED,(function(){return e()}))},e.abrupt("return",this._initMutex.lock().then((function(e){return new Bf((function(e,t){r(e,t)})).then((function(){e()})).catch((function(){e()}))})));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendMessage",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Bv(Lv.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(e){throw new Bv(Lv.WS_ERR,"send datachannel signal message error"+e.toString())}}},{key:"unbindDcCloseEventListener",value:function(){this._transmitter&&(this._transmitter.onclose=null)}},{key:"sendMessageWithJSON",value:function(e){var t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}},{key:"sendMessageWithUint8Array",value:function(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}},{key:"createTransmitterConnection",value:function(e){var t=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new Bf((function(n,r){var i,o=function(){Jv.debug("[".concat(t._name,"] datachannel opened:"),t._url),t.reconnectMode="retry",t.state="connected",t.resetReconnectCount("opened"),n()},a=function(){var e=u(c().mark((function e(i){var o,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(o=t._closeEstablishingTransmitter)||void 0===o||o.call(t),Jv.debug("[".concat(t._name,"] datachannel close ").concat(t._url,", code: ").concat(i.code,", reason: ").concat(i.reason,", current mode: ").concat(t.reconnectMode)),!(t._reconnectCount<t._retryConfig.maxRetryCount)){e.next=13;break}return"connected"===t.state&&(t.reconnectReason=i.reason,t.state="reconnecting"),a=yS(t,n_.WILL_RECONNECT,t.reconnectMode)||t.reconnectMode,e.next=5,t.reconnectWithAction(a);case 5:if(s=e.sent,"closed"!==t.state){e.next=8;break}return e.abrupt("return",void Jv.debug("[".concat(t.connectionID,"] dc is closed, no need to reconnect")));case 8:if(s){e.next=10;break}return e.abrupt("return",(r(new Bv(Lv.WS_DISCONNECT,"datachannel reconnect failed: ".concat(i.code))),void t.close(!0)));case 10:n(),e.next=14;break;case 13:r(new Bv(Lv.WS_DISCONNECT,"datachannel close: ".concat(i.code))),t.close();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(e){var n;null===(n=t._reliableTransmission)||void 0===n||n.onData(e.data)};t._transmitter&&(t._transmitter.onclose=null,t._transmitter.close()),t._reliableTransmission&&(t._reliableTransmission.close(),t._reliableTransmission=void 0),Jv.debug("[".concat(t._name,"] start connect, address: ").concat(JSON.stringify(e)));var l=null===(i=t._store)||void 0===i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),f=Date.now();_S(t,n_.TO_CONNECT_DATACHANNEL,e).then((function(e){var n,r;if(!e)throw new Error("transmissonInfo not exist yet");var i=e.transmitter,c=e.close;t._transmitter=i,null===(n=t._store)||void 0===n||n.signalChannelOpen();var u=Date.now()-f;Jv.debug("[choose dc] dc open cost ".concat(u,"ms")),t._reliableTransmission=new YS((function(e){var n;t._transmitter&&"open"===t._transmitter.readyState&&(null===(n=t._transmitter)||void 0===n||n.send(e))}),(function(e){"string"==typeof e&&t.emit(n_.ON_MESSAGE,e)})),t._closeEstablishingTransmitter=function(){var e;null===(e=t._reliableTransmission)||void 0===e||e.close(),t._reliableTransmission=void 0,c()},o&&o(),i.onclose=a,i.onmessage=s,null===(r=t._store)||void 0===r||r.recordJoinChannelService({endTs:Date.now(),status:"success"},l),t._joinChannelServiceRecordIndex=l})).catch((function(e){var n;if(null===(n=t._store)||void 0===n||n.recordJoinChannelService({endTs:Date.now(),status:e instanceof Bv&&e.code===Lv.WS_ABORT?"aborted":"error",errors:[e]},l),"closed"!==t.state){if(e instanceof Bv&&e.code===Lv.WS_ERR){var i=new Bv(Lv.WS_ERR,"init datachannel failed! Error: ".concat(e.toString()));return Jv.error("[".concat(t._name,"]").concat(i)),void r(i)}a&&a(e)}else r(new Bv(Lv.WS_DISCONNECT,"datachannel is closed: ".concat(e.toString())))}))}))}},{key:"reconnectWithAction",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s,l,f,d=this,p=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(p.length>1&&void 0!==p[1])||p[1],!(this._reconnectCount>=this._retryConfig.maxRetryCount)){e.next=3;break}return e.abrupt("return",!1);case 3:if(this._addresses){e.next=5;break}return e.abrupt("return",!1);case 5:if("closed"!==this.state){e.next=7;break}return e.abrupt("return",!1);case 7:if(this._onlineReconnectListener||Db.networkState!==YE.OFFLINE||(this._onlineReconnectListener=Db.onlineWaiter&&Db.onlineWaiter.then((function(){d._onlineReconnectListener=void 0}))),r=!0,this._reconnectInterrupter=function(){r=!1},!n){e.next=14;break}return i=Gv(this._reconnectCount,this._retryConfig),Jv.debug("[".concat(this._name,"] wait ").concat(i,"ms to reconnect datachannel, mode: ").concat(t)),e.next=14,Bf.race([dS(i),this._onlineReconnectListener||new Bf((function(){}))]);case 14:if("closed"!==this.state&&r){e.next=16;break}return e.abrupt("return",!1);case 16:if(this._reconnectCount+=1,o=function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.emit(n_.RECONNECT_CREATE_CONNECTION,n),e.next=3,d.createTransmitterConnection(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.prev=18,"retry"!==t){e.next=26;break}return a=this._addresses[this.currentURLIndex],this.emit(n_.RECONNECT_WAITTING_FINISH,t),e.next=24,o(a,t);case 24:e.next=50;break;case 26:if("tryNext"!==t){e.next=49;break}this.currentURLIndex+=1,s=this.currentURLIndex;case 29:if(!(s<this._addresses.length)){e.next=37;break}if(!this._addresses[s].fingerprint&&!lm("FINGERPRINT")){e.next=33;break}return this.currentURLIndex=s,e.abrupt("break",37);case 33:this.currentURLIndex+=1;case 34:s++,e.next=29;break;case 37:if(!(this.currentURLIndex>=this._addresses.length)){e.next=42;break}return Jv.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),e.next=41,this.reconnectWithAction("recover",!1);case 41:return e.abrupt("return",e.sent);case 42:return Jv.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex)),l=this._addresses[this.currentURLIndex],this.emit(n_.RECONNECT_WAITTING_FINISH,t),e.next=47,o(l,t);case 47:e.next=50;break;case 49:"recover"===t&&(Jv.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(n_.RECONNECT_WAITTING_FINISH,t),this.emit(n_.FAILBACK));case 50:return e.abrupt("return",!0);case 53:if(e.prev=53,e.t0=e.catch(18),Jv.error("[".concat(this._name,"] reconnect failed"),e.t0.toString()),!(null!=e.t0&&null!==(f=e.t0.data)&&void 0!==f&&f.desc&&Array.isArray(e.t0.data.desc)&&e.t0.data.desc.length&&e.t0.data.desc.includes("dynamic key expired"))){e.next=60;break}e.t1=(this.emit(n_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1),e.next=63;break;case 60:return e.next=62,this.reconnectWithAction(t,n);case 62:e.t1=e.sent;case 63:return e.abrupt("return",e.t1);case 64:case"end":return e.stop()}}),e,this,[[18,53]])})));function t(t){return e.apply(this,arguments)}return t}()}]),n}(HS),XS=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this),Mp(l(i),"_disconnectedReason",void 0),Mp(l(i),"_websocketReconnectReason",void 0),Mp(l(i),"_connectionState",zg.CLOSED),Mp(l(i),"reconnectToken",void 0),Mp(l(i),"websocket",void 0),Mp(l(i),"openConnectionTime",void 0),Mp(l(i),"clientId",void 0),Mp(l(i),"lastMsgTime",Date.now()),Mp(l(i),"uploadCache",[]),Mp(l(i),"uploadCacheInterval",void 0),Mp(l(i),"rttRolling",new VS(5)),Mp(l(i),"pingpongTimer",void 0),Mp(l(i),"inflateDataTimer",void 0),Mp(l(i),"pingpongTimeoutCount",0),Mp(l(i),"joinResponse",void 0),Mp(l(i),"multiIpOption",void 0),Mp(l(i),"initError",void 0),Mp(l(i),"spec",void 0),Mp(l(i),"store",void 0),Mp(l(i),"onWebsocketMessage",(function(e){if(e instanceof ArrayBuffer)i.emit(Yg.ON_BINARY_DATA,e);else{var t=JSON.parse(e);if(i.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){var n="res-@".concat(t._id);i.emit(n,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")&&(i.emit(t._type,t._message),t._type===Qg.ON_NOTIFICATION&&i.handleNotification(t._message),t._type===Qg.ON_USER_BANNED))switch(t._message.error_code){case 14:i.close(qg.UID_BANNED);break;case 15:i.close(qg.IP_BANNED);break;case 16:i.close(qg.CHANNEL_BANNED)}}})),i.clientId=e.clientId,i.spec=e,i.store=r,i.websocket=new JS("gateway-".concat(i.clientId),i.spec.retryConfig,!0,r),i.handleWebsocketEvents(),window.addEventListener("offline",(function(){i.connectionState===zg.CONNECTED&&i.reconnect("retry",t_.OFFLINE)})),i}return v(n,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){e!==this._connectionState&&(this._connectionState=e,e===zg.CONNECTED?this.emit(Yg.WS_CONNECTED):e===zg.RECONNECTING?this.emit(Yg.WS_RECONNECTING,this._websocketReconnectReason):e===zg.CLOSED&&this.emit(Yg.WS_CLOSED,this._disconnectedReason))}},{key:"currentURLIndex",get:function(){return this.websocket.currentURLIndex}},{key:"url",get:function(){return this.websocket?this.websocket.url:null}},{key:"rtt",get:function(){return this.rttRolling.mean()}},{key:"request",value:function(){var e=u(c().mark((function e(t,n,r,i){var o,a,s,u,l,f,d,p,h,v=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=hS(6,""),a={_id:o,_type:t,_message:n},s=this.websocket.connectionID,u=function(){return new Bf((function(e,n){if(v.connectionState===zg.CONNECTED)return e();var r=function(){v.off(Yg.WS_CLOSED,i),e()},i=function(){v.off(Yg.WS_CONNECTED,r),n(new Bv(Lv.WS_ABORT))};v.once(Yg.WS_CONNECTED,r),v.once(Yg.WS_CLOSED,i),t!==Jg.PUBLISH&&t!==Jg.SUBSCRIBE&&t!==Jg.UNSUBSCRIBE&&t!==Jg.UNPUBLISH&&t!==Jg.CONTROL&&t!==Jg.RESTART_ICE||v.once(Yg.DISCONNECT_P2P,(function(){n(new Bv(Lv.DISCONNECT_P2P))})),t!==Jg.PUBLISH&&t!==Jg.RESTART_ICE||v.once(Yg.ABORT_P2P_EXECUTION,(function(){n(new Bv(Lv.DISCONNECT_P2P))}))}))},e.t0=this.connectionState!==zg.CONNECTING&&this.connectionState!==zg.RECONNECTING||t===Jg.JOIN||t===Jg.REJOIN,e.t0){e.next=5;break}return e.next=5,u();case 5:if(t===Jg.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),this.websocket.sendMessage(a,!0,!1),!i){e.next=9;break}return e.abrupt("return");case 9:return l=new Bf((function(e,r){var i=!1,a=function(r,o){i=!0,e({isSuccess:"success"===r,message:o||{}}),v.off(Yg.WS_CLOSED,c),v.off(Yg.WS_RECONNECTING,c),v.emit(Yg.REQUEST_SUCCESS,t,n)};v.once("res-@".concat(o),a);var c=function e(){r(new Bv(Lv.WS_ABORT,"type: ".concat(t))),v.off(Yg.WS_CLOSED,e),v.off(Yg.WS_RECONNECTING,e),v.off("res-@".concat(o),a)};v.once(Yg.WS_CLOSED,c),v.once(Yg.WS_RECONNECTING,c),dS(lm("SIGNAL_REQUEST_TIMEOUT")).then((function(){v.websocket.connectionID!==s||i||(Jv.warning("dc request timeout, type: ".concat(t)),v.emit(Yg.REQUEST_TIMEOUT,t,n))}))})),f=null,e.prev=11,e.next=14,l;case 14:f=e.sent,e.next=36;break;case 17:if(e.prev=17,e.t1=e.catch(11),this.connectionState!==zg.CLOSED&&t!==Jg.LEAVE){e.next=21;break}throw new Bv(Lv.WS_ABORT);case 21:if(this.spec.forceWaitGatewayResponse&&!r){e.next=25;break}e.t2=e.t1.throw(),e.next=35;break;case 25:if(t!==Jg.JOIN&&t!==Jg.REJOIN){e.next=29;break}e.t3=null,e.next=34;break;case 29:return e.next=31,u();case 31:return e.next=33,this.request(t,n);case 33:e.t3=e.sent;case 34:e.t2=e.t3;case 35:return e.abrupt("return",e.t2);case 36:if(!f.isSuccess){e.next=38;break}return e.abrupt("return",f.message);case 38:if(d=Number(f.message.error_code||f.message.code),p=jS(d),h=new Bv(Lv.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(f.message.error_str),{code:d,data:f.message}),"success"!==p.action){e.next=43;break}e.t4=f.message,e.next=68;break;case 43:if(Jv.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(d,", message: ").concat(p.desc,", action: ").concat(p.action)),d!==Gg.ERR_TOO_MANY_BROADCASTERS){e.next=48;break}e.t5=t===Jg.JOIN||t===Jg.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw(),e.next=67;break;case 48:if("failed"!==p.action){e.next=52;break}e.t6=h.throw(),e.next=66;break;case 52:if("quit"!==p.action){e.next=56;break}e.t7=(this.initError=h,this.close(),h.throw()),e.next=65;break;case 56:if(d===Gg.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,Jv.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",t_.MULTI_IP)):this.reconnect(p.action,t_.SERVER_ERROR),t!==Jg.JOIN&&t!==Jg.REJOIN){e.next=61;break}e.t8=null,e.next=64;break;case 61:return e.next=63,this.request(t,n);case 63:e.t8=e.sent;case 64:e.t7=e.t8;case 65:e.t6=e.t7;case 66:e.t5=e.t6;case 67:e.t4=e.t5;case 68:return e.abrupt("return",e.t4);case 69:case"end":return e.stop()}}),e,this,[[11,17]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"waitMessage",value:function(e,t){var n=this;return new Bf((function(r){var i=function i(o){(!t||t(o))&&(n.off(e,i),r(o))};n.on(e,i)}))}},{key:"upload",value:function(e,t){var n=this,r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(e){var i=lm("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((function(){if(n.connectionState===zg.CONNECTED){var e=n.uploadCache.splice(0,1)[0];0===n.uploadCache.length&&(window.clearInterval(n.uploadCacheInterval),n.uploadCacheInterval=void 0),n.upload(e._type,e._message)}}),lm("UPLOAD_CACHE_INTERVAL")||2e3))}}},{key:"send",value:function(e,t){var n={_type:e,_message:t};this.websocket.sendMessage(n)}},{key:"init",value:function(e,t){var n=this;return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Bf((function(r,i){n.once(Yg.WS_CONNECTED,(function(){return r(n.joinResponse)})),n.once(Yg.WS_CLOSED,(function(){return i(n.initError||new Bv(Lv.WS_ABORT))})),n.connectionState=zg.CONNECTING,n.websocket.init(e).catch(i),n.websocket.once(n_.FAILBACK,(function(){void 0===n.openConnectionTime&&i(new Bv(Lv.INIT_DATACHANNEL_TIMEOUT))})),n.inflateDataTimer&&window.clearInterval(n.inflateDataTimer),n.inflateDataTimer=window.setInterval((function(){n.handleInflateData()}),2e4),setTimeout((function(){t&&void 0===n.openConnectionTime&&(Jv.debug("[".concat(n.clientId,"] init datachannel timeout while join with failback to websocket")),i(new Bv(Lv.INIT_DATACHANNEL_TIMEOUT)))}),lm("DC_JOIN_WITH_FAILBACK"))}))}},{key:"close",value:function(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||qg.LEAVE,this.connectionState=zg.CLOSED,Jv.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===qg.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new JS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}},{key:"join",value:function(){var e=u(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.joinResponse){e.next=11;break}return this.emit(Yg.ABORT_P2P_EXECUTION),e.next=4,_S(this,Yg.DATACHANNEL_CONNECTING);case 4:return t=e.sent,e.next=7,this.request(Jg.JOIN,t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",(this.emit(Yg.REPORT_JOIN_GATEWAY,Lv.TIMEOUT,this.url||""),!1));case 10:this.joinResponse=n,this.emit(Yg.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token;case 11:return e.abrupt("return",(this.connectionState=zg.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"rejoin",value:function(){var e=u(c().mark((function e(){var t,n,r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reconnectToken){e.next=2;break}throw new Bv(Lv.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");case 2:return(t=TS(this,Yg.REQUEST_REJOIN_INFO)).token=this.reconnectToken,e.next=6,this.request(Jg.REJOIN,t);case 6:return n=e.sent,e.abrupt("return",!!n&&(this.connectionState=zg.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach((function(e){r.emit(Qg.ON_USER_ONLINE,{uid:e.uid}),e.audio&&r.emit(Qg.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&r.emit(Qg.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?r.emit(Qg.MUTE_AUDIO,{uid:e.uid}):r.emit(Qg.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?r.emit(Qg.MUTE_VIDEO,{uid:e.uid}):r.emit(Qg.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?r.emit(Qg.ENABLE_LOCAL_AUDIO,{uid:e.uid}):r.emit(Qg.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?r.emit(Qg.ENABLE_LOCAL_VIDEO,{uid:e.uid}):r.emit(Qg.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||r.emit(Qg.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reconnect",value:function(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}},{key:"handleNotification",value:function(e){Jv.debug("[".concat(this.clientId,"] receive notification: "),e);var t=jS(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(qg.UID_BANNED),void this.close()):void this.reconnect(t.action,t_.SERVER_ERROR);Jv.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}},{key:"handlePingPong",value:function(){var e=this;if(this.websocket&&"connected"===this.websocket.state){this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var t=lm("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(Jv.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>lm("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",t_.TIMEOUT):this.request(Jg.PING,void 0,!0).then((function(){e.pingpongTimeoutCount=0;var t=Date.now()-n;e.rttRolling.add(t),lm("REPORT_STATS")&&e.send(Jg.PING_BACK,{pingpongElapse:t})})).catch((function(e){}))}}},{key:"handleInflateData",value:function(){var e=this.websocket.getInflateData(),t=e.inflateLength,n=e.deflateLength;0!==t&&0!==n&&this.upload(Xg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}},{key:"handleWebsocketEvents",value:function(){var e=this;this.websocket.on(n_.RECONNECT_WAITTING_FINISH,(function(t){e.emit(Yg.WS_RECONNECT_WAITTING_FINISH,t)})),this.websocket.on(n_.RECONNECT_CREATE_CONNECTION,(function(t){e.emit(Yg.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(n_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(n_.CLOSED,(function(){e.connectionState=zg.CLOSED})),this.websocket.on(n_.FAILED,(function(){e._disconnectedReason=qg.NETWORK_ERROR,e.connectionState=zg.CLOSED})),this.websocket.on(n_.RECONNECTING,(function(t){e._websocketReconnectReason=t,e.joinResponse=void 0,e.connectionState===zg.CONNECTED?e.connectionState=zg.RECONNECTING:e.connectionState=zg.CONNECTING})),this.websocket.on(n_.WILL_RECONNECT,(function(t,n){if(TS(e,Yg.IS_P2P_DISCONNECTED)&&"retry"===t)return Jv.debug("".concat(e.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e.reconnectToken=void 0,e.emit(Yg.NEED_RENEW_SESSION),e.emit(Yg.DISCONNECT_P2P),n("tryNext");"retry"!==t&&(Jv.debug("".concat(e.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),e.reconnectToken=void 0,e.emit(Yg.NEED_RENEW_SESSION),e.emit(Yg.DISCONNECT_P2P)),n(t)})),this.websocket.on(n_.CONNECTED,(function(){e.openConnectionTime=Date.now(),e.reconnectToken?e.rejoin().catch((function(t){Jv.warning("[".concat(e.clientId,"] rejoin failed ").concat(t)),e.reconnect("tryNext",t_.SERVER_ERROR)})):e.join().catch((function(t){if(e.emit(Yg.REPORT_JOIN_GATEWAY,t.message||t.code,e.url||""),t instanceof Bv&&t.code===Lv.UNEXPECTED_RESPONSE&&t.data.code===Gg.ERR_NO_AUTHORIZED)return Jv.warning("[".concat(e.clientId,"] reconnect no authorized, recover")),void e.reconnect("recover",t_.SERVER_ERROR);Jv.error("[".concat(e.clientId,"] join gateway request failed"),t.toString()),e.spec.forceWaitGatewayResponse?e.reconnect("tryNext",t_.SERVER_ERROR):(e.initError=t,e.close())}))})),this.websocket.on(n_.REQUEST_NEW_URLS,(function(t,n){_S(e,Yg.REQUEST_RECOVER,e.multiIpOption).then(t).catch(n)})),this.websocket.on(n_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){e.emit(Qg.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(n_.TO_CONNECT_DATACHANNEL,function(){var t=u(c().mark((function t(n,r,i){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_S(e,Yg.DATACHANNEL_PRECONNECT,n).then(r).catch(i));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()),this.websocket.on(n_.FAILBACK,(function(){void 0!==e.openConnectionTime&&e.emit(Yg.DATACHANNEL_FAILBACK)}))}}]),n}(jv);function QS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QS(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ZS=new Map,ew=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this),Mp(l(i),"store",void 0),Mp(l(i),"joinInfo",void 0),Mp(l(i),"key",void 0),Mp(l(i),"signal",void 0),Mp(l(i),"role",void 0),Mp(l(i),"inChannelInfo",{joinAt:null,duration:0}),Mp(l(i),"spec",void 0),Mp(l(i),"_state","DISCONNECTED"),Mp(l(i),"_statsCollector",void 0),Mp(l(i),"_disconnectedReason",void 0),Mp(l(i),"isSignalRecover",!1),Mp(l(i),"hasChangeBGPAddress",!1),Mp(l(i),"trafficStatsInterval",void 0),Mp(l(i),"networkQualityInterval",void 0),Mp(l(i),"_joinGatewayStartTime",0),Mp(l(i),"_signalTimeout",!1),Mp(l(i),"_clientRoleOptions",void 0),Mp(l(i),"_isProactiveJoin",!1),i.store=e,i.spec=r,i.signal=i.store.useDataChannel?new XS($S($S({},r),{},{retryConfig:r.websocketRetryConfig}),e):new GS($S($S({},r),{},{retryConfig:r.websocketRetryConfig}),e),i._statsCollector=r.statsCollector,i.role=r.role||"audience",i._clientRoleOptions=r.clientRoleOptions,i.handleSignalEvents(),i}return v(n,[{key:"state",get:function(){return this._state},set:function(e){if(e!==this._state){var t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(OE.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(OE.CONNECTION_STATE_CHANGE,e,t)}}},{key:"joinGatewayStartTime",get:function(){return this._joinGatewayStartTime},set:function(e){Jv.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}},{key:"join",value:function(){var e=u(c().mark((function e(t,n,r){var i,o,a,s,u,l,f,d,p,h=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signal instanceof XS&&(i=!1,"disabled"!==t.cloudProxyServer?(Jv.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),i=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(Jv.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),i=!0):t.apResponse.addresses.some((function(e){return e.fingerprint}))||lm("FINGERPRINT")||(Jv.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),i=!0),i&&this.resetSignal()),this.store.joinGatewayStart(),"disabled"!==t.cloudProxyServer&&(this.hasChangeBGPAddress=!0),o=Date.now(),(a=ZS.get(t.cname))||(a=new Map,ZS.set(t.cname,a)),this._isProactiveJoin=!0,!a.has(t.uid)){e.next=7;break}throw s=new Bv(Lv.UID_CONFLICT),Wb.joinGateway(t.sid,{lts:o,succ:!1,ec:s.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof XS?"1":"0"}),this._isProactiveJoin=!1,s;case 7:if(a.set(t.uid,!0),this.joinInfo=t,this.key=n,u=0,this.joinGatewayStartTime=o,l=t.proxyServer,e.prev=11,Jv.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof XS?"datachannel":"websocket"," join uid ").concat(u)),!(this.signal instanceof XS)){e.next=18;break}return e.next=15,this.signal.init(t.apResponse.addresses,r);case 15:f=e.sent,e.next=22;break;case 18:return d=t.proxyServer,p=d?t.gatewayAddrs.map((function(e){var t=e.address.split(":");return"wss://".concat(d,"/ws/?h=").concat(t[0],"&p=").concat(t[1])})):t.gatewayAddrs.map((function(e){return"wss://".concat(e.address)})),e.next=21,this.signal.init(p,r);case 21:f=e.sent;case 22:u=f.uid,Jv.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof XS?"datachannel":"websocket"," join uid ").concat(u," cost ").concat(Date.now()-this.joinGatewayStartTime)),e.next=32;break;case 25:if(e.prev=25,e.t0=e.catch(11),!e.t0||e.t0.code!==Lv.INIT_WEBSOCKET_TIMEOUT){e.next=29;break}throw Jv.warning("[".concat(this.store.clientId,"] User join failed"),e.t0.toString()),e.t0;case 29:if(!e.t0||e.t0.code!==Lv.INIT_DATACHANNEL_TIMEOUT){e.next=31;break}throw Jv.warning("[".concat(this.store.clientId,"] User join datachannel failed"),e.t0.toString()),this.resetSignal(),e.t0;case 31:throw Jv.error("[".concat(this.store.clientId,"] User join failed"),e.t0.toString()),Wb.joinGateway(t.sid,{lts:o,succ:!1,ec:e.t0.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:this.signal instanceof XS?"1":"0"}),this._isProactiveJoin=!1,a.delete(t.uid),this.signal.close(),e.t0;case 32:return e.abrupt("return",(this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Jv.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((function(){h.updateTrafficStats().catch((function(e){Jv.warning("[".concat(h.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((function(){navigator&&void 0!==navigator.onLine&&!navigator.onLine?h.emit(OE.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):h._signalTimeout?h.emit(OE.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===h.state&&h._statsCollector.trafficStats?h.emit(OE.NETWORK_QUALITY,{uplinkNetworkQuality:rS(h._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:rS(h._statsCollector.trafficStats.B_dnq)}):h.emit(OE.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),u));case 33:case"end":return e.stop()}}),e,this,[[11,25]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"leave",value:function(){var e=u(c().mark((function e(){var t,n,r=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],n=r.length>1?r[1]:void 0,"DISCONNECTED"===this.state){e.next=14;break}if(n!==qg.FALLBACK&&(this.state="DISCONNECTING"),e.prev=3,e.t0=t||this.signal.connectionState!==zg.CONNECTED,e.t0){e.next=8;break}return e.next=8,function(e,t){return t===1/0?e:Bf.race([e,pS(t)])}(this.signal.request(Jg.LEAVE,void 0,!0),3e3);case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(3),Jv.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e.t1);case 13:this.signal.close(n),n!==qg.FALLBACK&&(this.state="DISCONNECTED"),this.reset();case 14:case"end":return e.stop()}}),e,this,[[3,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"publish",value:function(){var e=u(c().mark((function e(t,n,r){var i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 2:return i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:lm("PUB_EXTEND"),twcc:!!lm("PUBLISH_TWCC")},e.prev=3,e.next=6,this.signal.request(Jg.PUBLISH,i,!0);case 6:return e.abrupt("return",e.sent._message);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==Gg.ERR_PUBLISH_REQUEST_INVALID){e.next=16;break}return Jv.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),e.t0.toString()),e.next=15,this.tryUnpubBeforeRepub(t,n);case 15:return e.abrupt("return",this.publish(t,n,!1));case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"unpublish",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=3;break}throw new Bv(Lv.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 3:return e.next=5,this.signal.request(Jg.UNPUBLISH,{stream_id:n,ortc:t},!0);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Jv.warning("unpublish warning: ",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(){var e=u(c().mark((function e(t,n,r){var i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));case 2:return i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!lm("SUBSCRIBE_TWCC"),extend:lm("SUB_EXTEND"),ssrcId:n.ssrcId},e.prev=3,e.next=6,this.signal.request(Jg.SUBSCRIBE,i,!0);case 6:return e.abrupt("return",e.sent._message);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==Gg.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=18;break}return Jv.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),e.t0.toString()),e.next=15,this.tryUnsubBeforeResub(t,n);case 15:return e.next=17,this.subscribe(t,n,!1);case 17:return e.abrupt("return",e.sent);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"subscribeAll",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));case 2:return r={p2p_id:this.store.p2pId,users:t,dtx:!1},e.prev=3,e.next=6,this.signal.request(Jg.SUBSCRIBE_STREAMS,r,!0);case 6:case 17:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!n||!e.t0.data||e.t0.data.code!==Gg.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=18;break}return Jv.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),e.t0.toString()),e.next=15,this.tryMassUnsubBeforeResub(t);case 15:return e.next=17,this.subscribeAll(t,!1);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setVideoProfile",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e){if(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width){var t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&((t=t.exact||t.ideal||t.max||t.min||0)||(i=!1)),"number"!=typeof n&&((n=n.exact||n.ideal||n.max||n.min||0)||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}}(t),!n){e.next=3;break}return e.abrupt("return",this.signal.request(Jg.SET_VIDEO_PROFILE,n));case 3:Jv.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unsubscribe",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Jg.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Jv.warning("unsubscribe warning: ",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribe",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Jg.UNSUBSCRIBE_STREAMS,t,!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Jv.warning("unsubscribeAll warning: ",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"reconnectPC",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.iceParameters,r=t.dtlsParameters,i=t.rtpCapabilities,e.next=3,this.signal.request(Jg.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0);case 3:return e.t0=e.sent,e.t1=this.getCurrentGatewayAddress(),e.abrupt("return",{gatewayEstablishParams:e.t0,gatewayAddress:e.t1});case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getGatewayInfo",value:function(){return this.signal.request(Jg.GATEWAY_INFO)}},{key:"renewToken",value:function(e){return this.signal.request(Jg.RENEW_TOKEN,e)}},{key:"setClientRole",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&(this._clientRoleOptions=Object.assign({},n)),"CONNECTED"===this.state){e.next=2;break}return e.abrupt("return",void(this.role=t));case 2:return r=void 0,r="audience"===t?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,e.next=6,this.signal.request(Jg.SET_CLIENT_ROLE,{role:t,level:r,client_ts:Date.now()});case 6:this.role=t;case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setRemoteVideoStreamType",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Jg.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n});case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setDefaultRemoteVideoStreamType",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Jg.DEFAULT_VIDEO_STREAM,{stream_type:t});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setStreamFallbackOption",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Jg.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n});case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"pickSVCLayer",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Jg.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer});case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getInChannelInfo",value:function(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),$S({},this.inChannelInfo)}},{key:"getGatewayVersion",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Jg.GATEWAY_INFO);case 2:return e.abrupt("return",e.sent.version);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reset",value:function(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){var e=ZS.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}},{key:"updateTurnConfigFromSignal",value:function(){if(this.joinInfo){var e=function(e){var t;return(t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/))?{username:em.username,password:em.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push($S($S({},em),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}}},{key:"updateTrafficStats",value:function(){var e=u(c().mark((function e(){var t,n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.signal.request(Jg.TRAFFIC_STATS,void 0,!0);case 4:(t=e.sent).timestamp=Date.now(),t.peer_delay.forEach((function(e){var t=n._statsCollector.trafficStats&&n._statsCollector.trafficStats.peer_delay.find((function(t){return t.peer_uid===e.peer_uid}));t&&t.B_st!==e.B_st&&RS((function(){n.emit(OE.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(t);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getJoinMessage",value:function(e){if(!this.joinInfo||!this.key)throw new Bv(Lv.UNEXPECTED_ERROR,"can not generate join message, no join info");var t=Object.assign({},this.joinInfo.apResponse),n=lm("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n=void 0}n&&n.length>128&&(n=void 0);var r=$S({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Qv,browser:navigator.userAgent,process_id:lm("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:lm("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:lm("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:lm("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof lm("SUBSCRIBE_AUDIO_FILTER_TOPN")?lm("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof lm("ENABLE_PUBLISH_AUDIO_FILTER")?lm("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof lm("ENABLE_USER_LICENSE_CHECK")?lm("ENABLE_USER_LICENSE_CHECK"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(r.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(r.aes_mode=this.joinInfo.aesmode,lm("ENCRYPT_AES")?(r.aes_secret=this.joinInfo.aespassword,r.aes_encrypt=!0):r.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(r.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(r.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(r.default_video_stream=this.joinInfo.defaultVideoStream),r}},{key:"getRejoinMessage",value:function(){if(!this.joinInfo)throw new Bv(Lv.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}},{key:"handleSignalEvents",value:function(){var e=this;this.signal.on(Yg.WS_RECONNECT_WAITTING_FINISH,(function(t){["tryNext","recover"].includes(t)&&e.joinInfo&&Wb.adjustSessionStartTime(e.joinInfo.sid)})),this.signal.on(Yg.WS_RECONNECT_CREATE_CONNECTION,(function(t){e.joinGatewayStartTime=Date.now()})),this.signal.on(Yg.WS_RECONNECTING,(function(t){e.joinInfo&&Wb.WebSocketQuit(e.joinInfo.sid,{lts:Date.now(),succ:-1,cname:e.joinInfo.cname,uid:e.joinInfo.uid,cid:e.joinInfo.cid,errorCode:t||Kg.NETWORK_ERROR}),e.joinInfo&&(e.state="RECONNECTING",Wb.sessionInit(e.joinInfo.sid,{lts:(new Date).getTime(),extend:e.isSignalRecover?{recover:!0}:{rejoin:!0},cname:e.joinInfo.cname,appid:e.joinInfo.appId,mode:e.spec.mode}),e.isSignalRecover=!1,e.joinGatewayStartTime=Date.now())})),this.signal.on(Yg.WS_CLOSED,(function(t){var n;switch(t){case qg.LEAVE:n=Kg.LEAVE;break;case qg.UID_BANNED:case qg.IP_BANNED:case qg.CHANNEL_BANNED:case qg.SERVER_ERROR:n=Kg.SERVER_ERROR;break;case qg.FALLBACK:n=Kg.FALLBACK;break;case qg.LICENSE_MISSING:case qg.LICENSE_EXPIRED:case qg.LICENSE_MINUTES_EXCEEDED:case qg.LICENSE_PERIOD_INVALID:case qg.LICENSE_MULTIPLE_SDK_SERVICE:case qg.LICENSE_ILLEGAL:n=t;break;default:n=Kg.NETWORK_ERROR}Jv.debug("[signal] websocket closed, reason: ".concat(n||"undefined -> "+Kg.NETWORK_ERROR)),e.joinInfo&&Wb.WebSocketQuit(e.joinInfo.sid,{lts:Date.now(),succ:t===qg.LEAVE?1:-1,cname:e.joinInfo.cname,uid:e.joinInfo.uid,cid:e.joinInfo.cid,errorCode:n}),e._disconnectedReason=t,t!==qg.FALLBACK&&(e.state="DISCONNECTED"),e.reset()})),this.signal.on(Yg.WS_CONNECTED,(function(){if(e.updateTurnConfigFromSignal(),e.state="CONNECTED",e.joinInfo&&("audience"===e.role&&e._clientRoleOptions&&e._clientRoleOptions.level&&(Jv.debug("[".concat(e.store.clientId,"] patch to send set client role, role: ").concat(e.role,", mode: ").concat(e.spec.mode,", level: ").concat(e._clientRoleOptions&&e._clientRoleOptions.level)),e.setClientRole(e.role,e._clientRoleOptions)),Wb.joinGateway(e.joinInfo.sid,{lts:e.joinGatewayStartTime,succ:!0,ec:null,vid:e.joinInfo.vid,addr:e.signal.url,uid:e.joinInfo.uid,cid:e.joinInfo.cid,firstSuccess:e._isProactiveJoin,avoidJoinStartTime:e.store.avoidJoinStart,isProxy:!!e.joinInfo.proxyServer,signalChannel:e.signal instanceof XS?"1":"0"}),e._isProactiveJoin=!1,e.joinInfo.useLocalAccessPoint&&1===e.joinInfo.setLocalAPVersion)){var t=e.signal.url&&e.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void Jv.error("[".concat(e.store.clientId,"] set local access point after joined failed: ").concat(t));um("EVENT_REPORT_DOMAIN",t[1]),um("EVENT_REPORT_BACKUP_DOMAIN",t[1]),um("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}})),this.signal.on(Qg.ON_UPLINK_STATS,(function(t){e._statsCollector.updateUplinkStats(t)})),this.signal.on(Yg.REQUEST_RECOVER,(function(t,n,r){if(!e.joinInfo)return r(new Bv(Lv.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(e.joinInfo.multiIP=t,e.hasChangeBGPAddress=!0),e.isSignalRecover=!0,_S(e,OE.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)})),this.signal.on(Yg.REQUEST_JOIN_INFO,function(){var t=u(c().mark((function t(n){var r,i,o,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.updateTurnConfigFromSignal(),t.next=3,_S(e,OE.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(r=e.joinInfo)||void 0===r?void 0:r.turnServer});case 3:i=t.sent,o=i.iceParameters,a=i.dtlsParameters,s=i.rtpCapabilities,n(e.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:a,rtpCapabilities:s,version:"2"}}));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.signal.on(Yg.REQUEST_REJOIN_INFO,(function(t){t(e.getRejoinMessage())})),this.signal.on(Yg.REPORT_JOIN_GATEWAY,(function(t,n){e.joinInfo&&(Wb.joinGateway(e.joinInfo.sid,{lts:e.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:e.joinInfo.uid,cid:e.joinInfo.cid,firstSuccess:e._isProactiveJoin,avoidJoinStartTime:e.store.avoidJoinStart,isProxy:!!e.joinInfo.proxyServer,signalChannel:e.signal instanceof XS?"1":"0"}),e._isProactiveJoin=!1)})),this.signal.on(Yg.IS_P2P_DISCONNECTED,(function(t){t(TS(e,OE.IS_P2P_DISCONNECTED))})),this.signal.on(Yg.DISCONNECT_P2P,(function(){e.emit(OE.DISCONNECT_P2P)})),this.signal.on(Yg.NEED_RENEW_SESSION,(function(){e.emit(OE.NEED_RENEW_SESSION)})),this.signal.on(Yg.REQUEST_SUCCESS,(function(){e._signalTimeout=!1})),this.signal.on(Yg.REQUEST_TIMEOUT,(function(){e._signalTimeout=!0})),this.signal.on(Yg.JOIN_RESPONSE,(function(t){var n=e.getCurrentGatewayAddress();e.emit(OE.JOIN_RESPONSE,t,n)})),this.signal.on(Yg.DATACHANNEL_PRECONNECT,function(){var t=u(c().mark((function t(n,r,i){var o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.updateTurnConfigFromSignal(),o=e.getCurrentGatewayAddress(),t.abrupt("return",_S(e,OE.DATACHANNEL_PRECONNECT,n,o).then(r).catch(i));case 3:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()),this.signal.on(Yg.DATACHANNEL_CONNECTING,function(){var t=u(c().mark((function t(n){var r,i,o,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_S(e,OE.REQUEST_DC_CONNECTION_PARAMS);case 2:r=t.sent,i=r.iceParameters,o=r.dtlsParameters,a=r.rtpCapabilities,n(e.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:a,version:"2"}}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.signal.on(Yg.DATACHANNEL_FAILBACK,(function(){Jv.warning("[".concat(e.store.clientId,"] User join datachannel failed")),e.reset(),e.resetSignal(),e.emit(OE.DATACHANNEL_FAILBACK)}))}},{key:"tryUnsubBeforeResub",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Jg.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),Jv.warning("unsubscribe warning",e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"tryUnpubBeforeRepub",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Jg.UNPUBLISH,{stream_id:t,ortc:n},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),Jv.warning("unpublish warning: ",e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"tryMassUnsubBeforeResub",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={users:t.map((function(e){return{stream_id:e.stream_id,stream_type:e.stream_type}}))},e.prev=1,e.next=4,this.signal.request(Jg.UNSUBSCRIBE_STREAMS,n,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Jv.warning("massUnsubscribe warning",e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t.find((function(e){return e.stream_type===RE.Audio}))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n},e.prev=1,e.next=4,this.signal.request(Jg.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Jv.warning("gateway unmuteLocal warning: ",e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t.find((function(e){return e.stream_type===RE.Audio}))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n},e.prev=1,e.next=4,this.signal.request(Jg.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Jv.warning("gateway muteLocal warning: ",e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"uploadStats",value:function(e,t){this.signal.upload(e,t)}},{key:"getSignalRTT",value:function(){return this.signal.rtt}},{key:"restartICE",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t},e.prev=1,e.next=4,this.signal.request(Jg.RESTART_ICE,n,!0);case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(1),Jv.warning("P2PChannel.restartICE warning: ",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"reconnect",value:function(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Kg.P2P_FAILED)}},{key:"getCurrentGatewayAddress",value:function(){var e;if(!lm("GATEWAY_WSS_ADDRESS"))return null!==(e=this.joinInfo)&&void 0!==e&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}},{key:"setPublishAudioFilterEnabled",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Jg.SET_PARAMETER,{enablePublishAudioFilter:t});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"resetSignal",value:function(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(qg.FALLBACK)),this.store.useDataChannel=!1,this.signal=new GS($S($S({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(OE.RESET_SIGNAL,AE.websocket)}}]),n}(jv);!function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof T&&T];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function o(e,t){if(t)e:{var n=i;e=e.split(".");for(var o=0;o<e.length-1;o++){var a=e[o];if(!(a in n))break e;n=n[a]}(t=t(o=n[e=e[e.length-1]]))!=o&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}function a(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function s(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}if(o("Symbol",(function(e){function t(e,t){this.A=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(r||"")+"_"+i++,r)}})),o("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<n.length;o++){var s=i[n[o]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&r(s.prototype,e,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return e})),"function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var c;e:{var u={};try{u.__proto__={a:!0},c=u.a;break e}catch(e){}c=!1}n=c?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var l=n;function f(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function d(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function p(e,t){return e.h=3,{value:t}}function h(e){this.g=new f,this.G=e}function v(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(t){return e.g.j=null,e.g.s(t),m(e)}return e.g.j=null,r.call(e.g,o),m(e)}function m(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function g(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){d(e.g);var n=e.g.j;return n?v(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),m(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function E(e,t){return t=new g(new h(t)),l&&e.prototype&&l(t,e.prototype),t}if(f.prototype.o=function(e){this.v=e},f.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},f.prototype.return=function(e){this.l={return:e},this.h=this.u},h.prototype.o=function(e){return d(this.g),this.g.j?v(this,this.g.j.next,e,this.g.o):(this.g.o(e),m(this))},h.prototype.s=function(e){return d(this.g),this.g.j?v(this,this.g.j.throw,e,this.g.o):(this.g.s(e),m(this))},o("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var _=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},b=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},y=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},S=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},w="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,R=w.FormData,O=w.XMLHttpRequest&&w.XMLHttpRequest.prototype.send,I=w.Request&&w.fetch,A=w.navigator&&w.navigator.sendBeacon,k=w.Element&&w.Element.prototype,C=w.Symbol&&Symbol.toStringTag;C&&(Blob.prototype[C]||(Blob.prototype[C]="Blob"),"File"in w&&!File.prototype[C]&&(File.prototype[C]="File"));try{new File([],"")}catch(e){w.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),C&&Object.defineProperty(e,C,{value:"File"}),e}}var N=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},x=function(e){this.i=[];var t=this;e&&_(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];_(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?_(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?b(e.value):e.value,t.append(e.name,n))}))};if((e=x.prototype).append=function(e,t,n){S(arguments,2),this.i.push(y(e,t,n))},e.delete=function(e){S(arguments,1);var t=[];e=String(e),_(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return E(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=p(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){S(arguments,1);for(var n=s(this),r=n.next();!r.done;r=n.next()){var i=s(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){S(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){S(arguments,1);var t=[];return e=String(e),_(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){S(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return E(e,(function(e){if(1==e.h&&(t=s(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,p(e,s(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){S(arguments,2),e=String(e);var r=[],i=y(e,t,n),o=!0;_(this.i,(function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)})),o&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,o=this;return E(e,(function(e){if(1==e.h&&(t=s(o),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=s(r)).next(),p(e,i.next().value));n=t.next(),e.h=2}))},x.prototype._asNative=function(){for(var e=new R,t=s(this),n=t.next();!n.done;n=t.next()){var r=s(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},x.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+N(b(r))+'"\r\n\r\n'+b(e)+"\r\n"):t.push(n+N(b(r))+'"; filename="'+N(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},x.prototype[Symbol.iterator]=function(){return this.entries()},x.prototype.toString=function(){return"[object FormData]"},k&&!k.matches&&(k.matches=k.matchesSelector||k.mozMatchesSelector||k.msMatchesSelector||k.oMatchesSelector||k.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),C&&(x.prototype[C]="FormData"),O){var D=w.XMLHttpRequest.prototype.setRequestHeader;w.XMLHttpRequest.prototype.setRequestHeader=function(e,t){D.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},w.XMLHttpRequest.prototype.send=function(e){e instanceof x?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),O.call(this,e)):O.call(this,e)}}I&&(w.fetch=function(e,t){return t&&t.body&&t.body instanceof x&&(t.body=t.body._blob()),I.call(this,e,t)}),A&&(w.navigator.sendBeacon=function(e,t){return t instanceof x&&(t=t._asNative()),A.call(this,e,t)}),w.FormData=x}}();var tw=function(){var e=lm("AREAS");return 0===e.length&&e.push(LE.GLOBAL),Er(e).call(e,(function(e,t,n){var r=nw(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},nw=function(e){return e===LE.OVERSEA?"".concat(BE.ASIA,",").concat(BE.EUROPE,",").concat(BE.AFRICA,",").concat(BE.NORTH_AMERICA,",").concat(BE.SOUTH_AMERICA,",").concat(BE.OCEANIA):BE[e]},rw=function(e){var t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((function(e){var n=r_[e],r=Object.keys(n);r&&r.map((function(e){"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},iw={GLOBAL:{ASIA:[LE.CHINA,LE.JAPAN,LE.INDIA,LE.KOREA,LE.HKMC],EUROPE:[],NORTH_AMERICA:[LE.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},ow=Object.keys(iw[LE.GLOBAL]),aw=[LE.CHINA,LE.NORTH_AMERICA,LE.EUROPE,LE.ASIA,LE.JAPAN,LE.INDIA,LE.OCEANIA,LE.SOUTH_AMERICA,LE.AFRICA,LE.KOREA,LE.HKMC,LE.US],sw=function(e,t){var n,r,i=[];if(e.includes(LE.GLOBAL)){var o=[LE.GLOBAL,LE.OVERSEA],a=Object.keys(r_);if(t===LE.GLOBAL)throw new Bv(Lv.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===LE.CHINA)i=[LE.OVERSEA];else if(r=t,ow.includes(r)){var s=(n=t,iw[LE.GLOBAL][n]||[]),c=[].concat(o,[t],m(s));i=a.filter((function(e){return!c.includes(e)}))}else if(function(e){var t=!1;return ow.forEach((function(n){iw[LE.GLOBAL][n].includes(e)&&(t=!0)})),t}(t)){var u=function(e){var t;return ow.forEach((function(n){iw[LE.GLOBAL][n].includes(e)&&(t=n)})),t}(t),l=[].concat(o,[u,t]);i=a.filter((function(e){return!l.includes(e)}))}else i=e;i=function(e){var t=[];return aw.forEach((function(n){e.includes(n)&&t.push(n)})),t.concat(e.filter((function(e){return!aw.includes(e)})))}(i)}else i=e;return i};function cw(e){if(!e&&lm("AREAS").includes(LE.EXTENSIONS))return Jv.debug("update area from ap : reset"),void uw(Zv,!0);if(lm("AREAS").includes(LE.GLOBAL)&&e){var t=r_.EXTENSIONS;t&&(t={CODE:nw(LE.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},Jv.debug("update area from ap success: ".concat(e,",config is "),t),um("AREAS",[LE.EXTENSIONS],!0),Object.keys(t).map((function(e){um(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?t[e][0]:t[e])})))}}function uw(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Wb.reportApiInvoke(null,{name:Pg.SET_AREA,options:e,tag:Lg.TRACER});try{var r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((function(e){if(!VE.includes(e))throw new Bv(Lv.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){var i=e.areaCode,o=e.excludedArea;if(!i)throw new Bv(Lv.INVALID_PARAMS,"area code is needed");var a=i;"string"==typeof i&&(a=[i]),r=o?sw(a,o):a}if(!t){if(dm.AREAS){var s=new Bv(Lv.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void Jv.warning("setArea is prohibited because of config-distribute")}if(r.includes(LE.GLOBAL)&&lm("AREAS")===LE.EXTENSIONS){var c=new Bv(Lv.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void Jv.warning("setArea is prohibited because of ap extensions")}}um("AREAS",r,t);var u=rw(r);Object.keys(u).map((function(e){um(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?u[e][0]:u[e])})),Jv.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function lw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lw(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dw=1;function pw(e,t,n,r,i){dw+=1;var o,a,s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:dw,requestId:dw,version:Qv,cname:n.cname},l={service_name:t,json_body:JSON.stringify(s)},f=e[0];return Wv(u(c().mark((function e(){var n,i,s,u,d,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Date.now(),e.next=3,Cb(f,{data:l,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});case 3:if(n=e.sent,a=Date.now()-o,0===n.code){e.next=7;break}throw i=new Bv(Lv.UNEXPECTED_RESPONSE,"live streaming ap error, code"+n.code,{retry:!0,responseTime:a}),Jv.error(i.toString()),i;case 7:if(200===(s=JSON.parse(n.json_body)).code){e.next=11;break}throw u=new Bv(Lv.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(s.code,", reason: ").concat(s.reason),{code:s.code,responseTime:a}),Jv.error(u.toString()),u;case 11:if(s.servers&&0!==s.servers.length){e.next=14;break}throw d=new Bv(Lv.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:s.code,responseTime:a}),Jv.error(d.toString()),d;case 14:return p=function(e,t){return{addressList:e.servers.map((function(e){return"wss://".concat(e.address.replace(/\./g,"-"),".").concat(lm("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t))})),workerToken:e.workerToken,vid:e.vid}}(s,t),e.abrupt("return",(lm("LIVE_STREAMING_ADDRESS")&&(p.addressList=lm("LIVE_STREAMING_ADDRESS")instanceof Array?lm("LIVE_STREAMING_ADDRESS"):[lm("LIVE_STREAMING_ADDRESS")]),fw(fw({},p),{},{responseTime:a})));case 16:case"end":return e.stop()}}),e)}))),(function(r,i){return Wb.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:a,serverIp:e[i%e.length]}),!1}),(function(r,i){return Wb.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:a,serverIp:e[i%e.length]}),!!(r.code!==Lv.OPERATION_ABORTED&&r.code!==Lv.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(f=e[(i+1)%e.length],!0)}),i)}var hw=1;function vw(e,t,n,r){var i,o=e.url,s=e.areaCode,l=Date.now(),f=bw(t,s,[o_.CHOOSE_SERVER]),d=a(f,2),p=d[0],h=d[1],v=Db.networkState;return Wv(u(c().mark((function e(){var a,s,u,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=v&&Db.networkState===YE.OFFLINE&&Db.onlineWaiter,!e.t0){e.next=4;break}return e.next=4,Bf.race([Db.onlineWaiter,dS(r&&r.maxRetryTimeout||Vv.maxRetryTimeout)]);case 4:return v=Db.networkState,e.next=7,Cb(o,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);case 7:return a=e.sent,s=a.data,u=a.headers,i="1"===u.http3?1:-1,Wb.reportResourceTiming(o,t.sid),gw(s,o,t,l,[o_.CHOOSE_SERVER],i),f=iS(s,o_.CHOOSE_SERVER),e.abrupt("return",(Ew(f),ZT(f,o)));case 13:case"end":return e.stop()}}),e)}))),(function(e){return e&&Wb.joinChooseServer(t.sid,{lts:l,succ:!0,csAddr:o,opid:h,serverList:e.gatewayAddrs.map((function(e){return e.address})),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[o_.CHOOSE_SERVER].toString(),isHttp3:i}),!1}),(function(e){return e.code!==Lv.OPERATION_ABORTED&&(e.code===Lv.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(Wb.joinChooseServer(t.sid,{lts:l,succ:!1,csAddr:o,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[o_.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:v}),isHttp3:i}),Jv.warning("[".concat(t.clientId,"] Choose server network error, retry"),e),!0))}),r)}function mw(e,t,n,r){var i,o=e.url,s=e.areaCode,l=e.serviceIds,f=Date.now(),d=bw(t,s,l),p=a(d,2),h=p[0],v=p[1],m=void 0;return Wv(u(c().mark((function e(){var a,s,u,d,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=m&&Db.networkState===YE.OFFLINE&&Db.onlineWaiter,!e.t0){e.next=4;break}return e.next=4,Bf.race([Db.onlineWaiter,dS(r&&r.maxRetryTimeout||Vv.maxRetryTimeout)]);case 4:return m=Db.networkState,e.next=7,Cb(o,{data:h,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);case 7:return a=e.sent,s=a.data,u=a.headers,i="1"===u.http3?1:-1,Wb.reportResourceTiming(o,t.sid),gw(s,o,t,f,l,i),d=iS(s,o_.CHOOSE_SERVER),p=iS(s,"proxy5"===t.cloudProxyServer?o_.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?o_.CLOUD_PROXY:o_.CLOUD_PROXY_FALLBACK),e.abrupt("return",(Ew(d),{gatewayInfo:ZT(d,o),proxyInfo:p,url:o}));case 13:case"end":return e.stop()}}),e)}))),(function(e){return e.gatewayInfo&&Wb.joinChooseServer(t.sid,{lts:f,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((function(e){return e.address})),ec:null,opid:v,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:i}),e.proxyInfo&&Wb.joinWebProxyAP(t.sid,{lts:f,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((function(e){return e.ip})).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1}),(function(e){return e.code!==Lv.OPERATION_ABORTED&&(e.code===Lv.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(Wb.joinWebProxyAP(t.sid,{lts:f,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:m})}),Jv.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))}),r)}var gw=function(e,t,n,r,i,o){var a=[],s=function(a){4096===a.flag?Wb.joinChooseServer(n.sid,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:a.error.message,csIp:a.error.data&&a.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o}):1048576!==a.flag&&4194304!==a.flag&&4194310!==a.flag||Wb.joinWebProxyAP(n.sid,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:a.error.code,eventType:n.cloudProxyServer,unilbsServerIds:i.toString()})};if(e.response_body.forEach((function(t){var n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)Jv.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{var r={error:new Bv(Lv.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};a.push(r),s(r)}if(0!==n){var i=MS(n),o={error:new Bv(Lv.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?Jv.warning(o.error.toString()):a.push(o),s(o)}})),a.length)throw Jv.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(a.map((function(e){return"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)})).join(" | "))),new Bv(Lv.CAN_NOT_GET_GATEWAY_SERVER,a.map((function(e){return"flag: ".concat(e.flag,", message: ").concat(e.error.message)})).join(" | "),{retry:!!a.find((function(e){return e.error.data.retry})),csIp:e.detail[502],desc:m(new Set(a.map((function(e){var t,n;return null==e||null===(t=e.error)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.desc})).filter((function(e){return!!e}))))})},Ew=function(e){var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new Bv(Lv.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(null!==(t=e.detail)&&void 0!==t&&t[23]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[23])?cw(e.detail[23].toLowerCase()):cw(),null!==(r=e.detail)&&void 0!==r&&r[19]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[19]))for(var o=e.detail[19],a=null==o?void 0:o.split(";"),s=0;s<a.length;s++){var c,u=jd(c=a[s]).call(c);e.addresses[s]&&a&&(e.addresses[s].fingerprint=u)}if(lm("GATEWAY_ADDRESS")&&lm("GATEWAY_ADDRESS").length>0){Jv.debug("assign gateway address to",lm("GATEWAY_ADDRESS"));var l=lm("GATEWAY_ADDRESS").map((function(t){var n,r,i=null!==(n=null===(r=e.addresses.find((function(e){return e.ip===t.ip&&e.port===t.port})))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=l}},_w=function(e,t){if(e.response_body&&e.response_body.length){var n=e.response_body[0];if(0!==n.buffer.code){var r=MS(n.buffer.code);throw new Bv(Lv.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw Jv.debug("update ticket request received ap response without response body:",t),new Bv(Lv.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},bw=function(e,t,n){var r=Math.floor(Math.random()*Math.pow(10,12)),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:lm("USE_NEW_TOKEN")?"1":void 0,22:t},key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach((function(t){e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));var o=new FormData;return o.append("request",JSON.stringify(i)),[o,r]},yw=function(e,t){var n=Math.floor(Math.random()*Math.pow(10,12)),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((function(e){return{ip:e.ip,port:e.port}}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]},Tw=0;function Sw(e,t,n,r){return ww.apply(this,arguments)}function ww(){return ww=u(c().mark((function e(t,n,r,i){var o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){var e=u(c().mark((function e(t,n,r,i){var o,a,s,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null,a=[],s=function(){var e=u(c().mark((function e(){var o,s,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=lm("WEBCS_DOMAIN").slice(0,lm("AJAX_REQUEST_CONCURRENT")).map((function(e){return{url:t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:tw()}})),s=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:o.map((function(e){return e.url}))}),e.next=4,DS({fragementLength:lm("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:function(e){return Jv.debug("[".concat(t.clientId,"] Connect to choose_server:"),e.url),vw(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:a});case 4:return u=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},s),u));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=u(c().mark((function e(){var s,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dS(1e3);case 2:if(null===o){e.next=4;break}return e.abrupt("return",o);case 4:return s=lm("WEBCS_DOMAIN_BACKUP_LIST").map((function(e){return{url:t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:tw()}})),u=i.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map((function(e){return e.url}))}),e.next=8,DS({fragementLength:lm("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:function(e){return Jv.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),e.url),vw(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},u),e[0]},promisesCollector:a});case 8:return l=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},u),l));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=2,e.next=5,ES([s(),l()]);case 5:return o=e.sent,a.length&&a.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),e.abrupt("return",o);case 10:throw e.prev=10,e.t0=e.catch(2),e.t0[0];case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()(t,n,r,i),e.next=3,o;case 3:return e.t0=e.sent,e.abrupt("return",{gatewayInfo:e.t0});case 5:case"end":return e.stop()}}),e)}))),ww.apply(this,arguments)}function Rw(e,t,n,r,i){return Ow.apply(this,arguments)}function Ow(){return Ow=u(c().mark((function e(t,n,r,i,o){var a,s,u,l,f,d,p,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("disabled"!==(a=t.cloudProxyServer)){e.next=18;break}if(i){e.next=4;break}return e.abrupt("return");case 4:if(!t.useLocalAccessPoint){e.next=8;break}return e.next=7,Sw(t,n,r,o);case 7:case 17:return e.abrupt("return",e.sent);case 8:if(!lm("JOIN_WITH_FALLBACK_MEDIA_PROXY")){e.next=15;break}return e.next=11,Nw(t,n,r,o);case 11:return s=e.sent,u=s.gatewayInfo,l=s.proxyInfo,e.abrupt("return",(t.turnServer&&"auto"!==t.turnServer.mode||(t.turnServer={mode:"manual",servers:l.map((function(e){return{turnServerURL:e.address,tcpport:e.tcpport||em.tcpport,udpport:e.udpport||em.udpport,username:e.username||em.username,password:e.password||em.password,forceturn:!1,security:!0}}))}),{gatewayInfo:u}));case 15:return e.next=17,Sw(t,n,r,o);case 18:return e.next=20,Nw(t,n,r,o);case 20:return f=e.sent,d=f.proxyInfo,p=f.gatewayInfo,h={gatewayInfo:p},e.abrupt("return",(t.turnServer={mode:"manual",servers:d.map((function(e){return{turnServerURL:e.address,tcpport:"proxy3"===a?void 0:e.tcpport?e.tcpport:em.tcpport,udpport:"proxy4"===a?void 0:e.udpport?e.udpport:em.udpport,username:e.username||em.username,password:e.password||em.password,forceturn:"proxy4"!==a,security:"proxy5"===a}}))},Jv.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(a)),h));case 25:case"end":return e.stop()}}),e)}))),Ow.apply(this,arguments)}function Iw(e,t,n,r,i){return Aw.apply(this,arguments)}function Aw(){return Aw=u(c().mark((function e(t,n,r,i,o){var a,s,l,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=lm("ACCOUNT_REGISTER").slice(0,lm("AJAX_REQUEST_CONCURRENT")),s=[],s=n.proxyServer?a.map((function(e){return"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1")})):a.map((function(e){return"https://".concat(e,"/api/v1")})),l=null==o?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s}),e.prev=4,e.next=7,function(){var e=u(c().mark((function e(t,n,r,i,o){var a,s,u,l,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),s={sid:r.sid,opid:10,appid:r.appId,string_uid:n},u=t[0],e.next=4,Wv((function(){return Cb(u+"".concat(-1===u.indexOf("?")?"?":"&","action=stringuid"),{data:s,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})}),(function(e,r){if(0===e.code){if(e.uid<=0||e.uid>=Math.pow(2,32))throw Jv.error("Invalid Uint Uid ".concat(n," => ").concat(e.uid),e),Wb.reqUserAccount(s.sid,{lts:a,success:!1,serverAddr:u,stringUid:s.string_uid,uid:e.uid,errorCode:Lv.INVALID_UINT_UID_FROM_STRING_UID,extend:s}),new Bv(Lv.INVALID_UINT_UID_FROM_STRING_UID);return Wb.reqUserAccount(s.sid,{lts:a,success:!0,serverAddr:u,stringUid:s.string_uid,uid:e.uid,errorCode:null,extend:s}),!1}var i=MS(e.code);return i.retry&&(u=t[(r+1)%t.length]),Wb.reqUserAccount(s.sid,{lts:a,success:!1,serverAddr:u,stringUid:s.string_uid,uid:e.uid,errorCode:i.desc,extend:s}),i.retry}),(function(e,n){return e.code!==Lv.OPERATION_ABORTED&&(Wb.reqUserAccount(s.sid,{lts:a,success:!1,serverAddr:u,stringUid:s.string_uid,uid:null,errorCode:e.code,extend:s}),u=t[(n+1)%t.length],!0)}),o);case 4:if(0===(l=e.sent).code){e.next=8;break}throw f=MS(l.code),new Bv(Lv.UNEXPECTED_RESPONSE,f.desc);case 8:return e.abrupt("return",l);case 9:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()(s,t,n,r,i);case 7:return f=e.sent,e.abrupt("return",(null==o||o.recordJoinChannelService({status:"success",endTs:Date.now()},l),f.uid));case 11:throw e.prev=11,e.t0=e.catch(4),null==o||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e.t0]},l),e.t0;case 14:case"end":return e.stop()}}),e,null,[[4,11]])}))),Aw.apply(this,arguments)}function kw(e,t,n){return Cw.apply(this,arguments)}function Cw(){return Cw=u(c().mark((function e(t,n,r){var i,o,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=lm("CDS_AP").slice(0,lm("AJAX_REQUEST_CONCURRENT")).map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"):"https://".concat(e,"/api/v1?action=config")})).map((function(e){return function(e,t,n,r){var i=rp(),o={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:Qv,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return Wv((function(){return Cb(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})}),void 0,(function(e){return e.code!==Lv.OPERATION_ABORTED}),r)}(e,t,n,r)})),o=null,a=null,s={},e.prev=2,e.next=5,ES(i);case 5:o=e.sent,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(2),e.t0.code!==Lv.OPERATION_ABORTED){e.next=12;break}throw e.t0;case 12:a=e.t0;case 13:if(i.forEach((function(e){return e.cancel()})),Wb.reportApiInvoke(t.sid,{name:Pg.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{s=function(e){if(!e.test_tags)return{};var t=e.test_tags,n=Object.keys(t),r={};return n.forEach((function(e){var n,i=jd(n=e.slice(4)).call(n),o=JSON.parse(t[e])[1];r[i]=o})),r}(o)}catch(t){}return e.abrupt("return",s);case 16:case"end":return e.stop()}}),e,null,[[2,8]])}))),Cw.apply(this,arguments)}function Nw(e,t,n,r){return xw.apply(this,arguments)}function xw(){return xw=u(c().mark((function e(t,n,r,i){var o,a,s,l,f,d,p,h,v,m,g;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=lm("PROXY_SERVER_TYPE3"),a=function(e,t,n){var r=n||o;return Array.isArray(r)&&(r=t%2==0?o[1]:o[0]),"https://".concat(r,"/ap/?url=").concat(e)},s=null,l=[],f=function(){var e=u(c().mark((function e(){var o,s,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=lm("WEBCS_DOMAIN").slice(0,lm("AJAX_REQUEST_CONCURRENT")).map((function(e,n){return{url:"disabled"===t.cloudProxyServer&&t.proxyServer?a("".concat(e,"/api/v2/transpond/webrtc?v=2"),n,t.proxyServer):"disabled"===t.cloudProxyServer||"fallback"===t.cloudProxyServer?"https://".concat(e,"/api/v2/transpond/webrtc?v=2"):a("".concat(e,"/api/v2/transpond/webrtc?v=2"),n),areaCode:tw(),serviceIds:[o_.CHOOSE_SERVER,"proxy5"===t.cloudProxyServer?o_.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?o_.CLOUD_PROXY:o_.CLOUD_PROXY_FALLBACK]}})),s=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:o.map((function(e){return e.url}))}),e.next=4,DS({fragementLength:lm("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:function(e){return Jv.debug("[".concat(t.clientId,"] Connect to choose_server:"),e.url),mw(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:l});case 4:return u=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},s),u));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=function(){var e=u(c().mark((function e(){var o,u,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dS(1e3);case 2:if(null===s){e.next=4;break}return e.abrupt("return",s);case 4:return o=lm("WEBCS_DOMAIN_BACKUP_LIST").map((function(e,n){return{url:"disabled"===t.cloudProxyServer&&t.proxyServer?a("".concat(e,"/api/v2/transpond/webrtc?v=2"),n,t.proxyServer):"disabled"===t.cloudProxyServer||"fallback"===t.cloudProxyServer?"https://".concat(e,"/api/v2/transpond/webrtc?v=2"):a("".concat(e,"/api/v2/transpond/webrtc?v=2"),n),areaCode:tw(),serviceIds:[o_.CHOOSE_SERVER,"proxy5"===t.cloudProxyServer?o_.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?o_.CLOUD_PROXY:o_.CLOUD_PROXY_FALLBACK]}})),u=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:o.map((function(e){return e.url}))}),e.next=8,DS({fragementLength:lm("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:function(e){return Jv.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),e.url),mw(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},u),e[0]},promisesCollector:l});case 8:return f=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},u),f));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,ES([f(),d()]);case 6:m=e.sent,p=m.gatewayInfo,h=m.proxyInfo,v=m.url,e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(3),e.t0[0];case 15:if(l.length&&l.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),p&&h){e.next=17;break}throw new Bv(Lv.UNEXPECTED_ERROR,"missing gateway or proxy response").print();case 17:return t.apUrl=v,"disabled"!==t.cloudProxyServer&&Array.isArray(o)&&v&&(g=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1],o.includes(g)&&(t.proxyServer=g,Jv.setProxyServer(g),Wb.setProxyServer(g))),e.t1=p,e.next=21,oS(h,p.uid);case 21:return e.t2=e.sent,s={gatewayInfo:e.t1,proxyInfo:e.t2},e.abrupt("return",s);case 24:case"end":return e.stop()}}),e,null,[[3,12]])}))),xw.apply(this,arguments)}function Dw(e,t,n,r){return Pw.apply(this,arguments)}function Pw(){return Pw=u(c().mark((function e(t,n,r,i){var o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=lm("UAP_AP").slice(0,lm("AJAX_REQUEST_CONCURRENT")).map((function(e){return n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")})),e.next=3,pw(o,t,n,r,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),Pw.apply(this,arguments)}function Lw(e,t,n){return Mw.apply(this,arguments)}function Mw(){return Mw=u(c().mark((function e(t,n,r){var i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=lm("UAP_AP").slice(0,lm("AJAX_REQUEST_CONCURRENT")).map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")})).map((function(e){return function(e,t,n,r){var i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:Qv,cname:t.cname,uid:t.uid.toString(),requestId:hw,seq:hw};hw+=1;var o={service_name:"tele_channel",json_body:JSON.stringify(i)};return Wv(u(c().mark((function t(){var r,i,a,s,u;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Cb(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});case 2:if(0===(r=t.sent).code){t.next=6;break}throw i=new Bv(Lv.UNEXPECTED_RESPONSE,"cross channel ap error, code"+r.code,{retry:!0}),Jv.error(i.toString()),i;case 6:if(200===(a=JSON.parse(r.json_body)).code){t.next=10;break}throw s=new Bv(Lv.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(a.code,", reason: ").concat(a.reason)),Jv.error(s.toString()),s;case 10:if(a.servers&&0!==a.servers.length){t.next=13;break}throw u=new Bv(Lv.UNEXPECTED_RESPONSE,"cross channel app center empty server"),Jv.error(u.toString()),u;case 13:return t.abrupt("return",{vid:a.vid,workerToken:a.workerToken,addressList:(lm("CHANNEL_MEDIA_RELAY_SERVERS")||a.servers).map((function(e){return"wss://".concat(e.address.replace(/\./g,"-"),".").concat(lm("WORKER_DOMAIN"),":").concat(e.wss)}))});case 14:case"end":return t.stop()}}),t)}))),void 0,(function(e){return!!(e.code!==Lv.OPERATION_ABORTED&&e.code!==Lv.UNEXPECTED_RESPONSE||e.data&&e.data.retry)}),r)}(e,t,n,r)})),e.prev=1,e.next=4,ES(i);case 4:return o=e.sent,e.abrupt("return",(i.forEach((function(e){return e.cancel()})),o));case 8:throw e.prev=8,e.t0=e.catch(1),e.t0[0];case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),Mw.apply(this,arguments)}function Uw(e,t,n){return jw.apply(this,arguments)}function jw(){return jw=u(c().mark((function e(t,n,r){var i,o,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null,o=[],s=function(){var e=u(c().mark((function e(s){var l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=lm(s?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2")})),e.t0=s,!e.t0){e.next=6;break}return e.next=5,dS(1e3);case 5:e.t0=null!==i;case 6:if(!e.t0){e.next=10;break}e.t1=i,e.next=13;break;case 10:return e.next=12,DS({fragementLength:lm("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:function(e){return Jv.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(s?"backup":""," choose_server:"),e),function(e,t,n,r){var i=yw(t,[o_.CHOOSE_SERVER]),o=a(i,1)[0],s=Db.networkState;return Wv(u(c().mark((function t(){var i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=s&&Db.networkState===YE.OFFLINE&&Db.onlineWaiter,!t.t0){t.next=4;break}return t.next=4,Bf.race([Db.onlineWaiter,dS(r&&r.maxRetryTimeout||Vv.maxRetryTimeout)]);case 4:return s=Db.networkState,t.next=7,Cb(e,{data:o,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);case 7:return i=t.sent,t.abrupt("return",_w(i,e));case 9:case"end":return t.stop()}}),t)}))),(function(){return!1}),(function(e){return e.code!==Lv.OPERATION_ABORTED&&(e.code===Lv.UPDATE_TICKET_FAILED?e.data.retry:(Jv.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))}),r)}(e,t,n,r)},allFailedhandler:function(e){throw e[0]},promisesCollector:o});case 12:e.t1=e.sent;case 13:return e.abrupt("return",e.t1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=2,e.next=5,ES([s(!1),s(!0)]);case 5:return i=e.sent,o.length&&o.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),e.abrupt("return",i);case 10:throw e.prev=10,e.t0=e.catch(2),e.t0[0];case 13:case"end":return e.stop()}}),e,null,[[2,10]])}))),jw.apply(this,arguments)}function Fw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fw(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vw=function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.call(this),Mp(l(e),"configs",void 0),Mp(l(e),"joinInfo",void 0),Mp(l(e),"cancelToken",void 0),Mp(l(e),"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Mp(l(e),"interval",void 0),Mp(l(e),"mutex",new zb("config-distribute")),Mp(l(e),"mutableParamsRead",!1),e}return v(n,[{key:"startGetConfigDistribute",value:function(e,t){var n=this;this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),lm("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((function(){n.updateConfigDistribute()}),lm("CONFIG_DISTRIBUTE_INTERVAL")))}},{key:"stopGetConfigDistribute",value:function(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}},{key:"awaitConfigDistributeComplete",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mutex.isLocked){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.mutex.lock();case 4:e.t0=e.sent,(0,e.t0)();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateConfigDistribute",value:function(){var e=u(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mutableParamsRead||(this.mutableParamsRead=!0,Wb.reportApiInvoke(null,{options:void 0,name:Pg.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Lg.TRACER}).onSuccess(JSON.stringify(dm))),this.joinInfo&&this.cancelToken&&this.retryConfig){e.next=3;break}return e.abrupt("return",void Jv.debug("[config-distribute] get config distribute interrupted have no joininfo"));case 3:return e.next=5,this.mutex.lock();case 5:return n=e.sent,e.prev=6,e.next=9,kw(this.joinInfo,this.cancelToken,this.retryConfig);case 9:t=e.sent,Jv.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(6),r=new Bv(Lv.NETWORK_RESPONSE_ERROR,e.t0),Jv.warning("[config-distribute] ".concat(r.toString()));case 20:return e.prev=20,n(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[6,16,20,23]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getBitrateLimit",value:function(){return this.configs?this.configs.limit_bitrate:void 0}},{key:"handleBitrateLimit",value:function(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(GE.UPDATE_BITRATE_LIMIT,e):this.emit(GE.UPDATE_BITRATE_LIMIT,e))}},{key:"getLowStreamConfigDistribute",value:function(){return this.configs&&this.configs.limit_bitrate&&Bw({},this.configs.limit_bitrate.low_stream_uplink)}},{key:"cacheGlobalParameterConfig",value:function(e){for(var t,n=vg(t=Object.keys(e).filter((function(e){return/^webrtc_ng_global_parameter/.test(e)}))).call(t),r=0;r<n.length;r++)for(var i=n.length-1;i>r;i--){var o=n[i];if("number"==typeof e[o].__priority){var a=e[o].__priority,s=n[i-1];if("number"==typeof e[s].__priority){if(!(a>e[s].__priority))continue;var c=o;n[i]=n[i-1],n[i-1]=c}else{var u=o;n[i]=n[i-1],n[i-1]=u}}}var l={};n.forEach((function(t){var n=e[t],r=n.__expires;Object.keys(n).forEach((function(e){"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(l,e)||(l[e]=Bw({value:n[e]},r&&{expires:r}))}))}));try{var f=JSON.stringify(l),d=window.btoa(f);window.localStorage.setItem("websdk_ng_global_parameter",d),Jv.debug("Caching global parameters ".concat(f))}catch(e){Jv.error("Error caching global parameters:",e.message)}}}]),n}(jv);function Gw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ww(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gw(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qw=function(e){d(n,e);var t=p(n);function n(e,r,i,o){var a;return h(this,n),a=t.call(this),Mp(l(a),"spec",void 0),Mp(l(a),"token",void 0),Mp(l(a),"websocket",void 0),Mp(l(a),"pingpongTimer",void 0),Mp(l(a),"reconnectMode","retry"),Mp(l(a),"serviceMode",void 0),Mp(l(a),"reqId",0),Mp(l(a),"commandReqId",0),Mp(l(a),"handleWebSocketOpen",(function(){a.reconnectMode="retry",a.startPingPong()})),Mp(l(a),"handleWebSocketMessage",(function(e){if(e.data){var t=JSON.parse(e.data);t.requestId?a.emit("@".concat(t.requestId,"-").concat(t.sid),t):a.serviceMode===sE.INJECT?a.emit(gE.INJECT_STREAM_STATUS,t):(Wb.workerEvent(a.spec.sid,{actionType:"status",serverCode:t.code,workerType:a.serviceMode===sE.TRANSCODE?1:2}),a.emit(gE.PUBLISH_STREAM_STATUS,t))}})),a.spec=r,a.token=e,a.serviceMode=o,a.websocket=new BS("live-streaming",i),a.websocket.on(aE.CONNECTED,a.handleWebSocketOpen),a.websocket.on(aE.ON_MESSAGE,a.handleWebSocketMessage),a.websocket.on(aE.REQUEST_NEW_URLS,(function(e,t){_S(l(a),gE.REQUEST_NEW_ADDRESS).then(e).catch(t)})),a.websocket.on(aE.RECONNECTING,(function(){a.websocket.reconnectMode=a.reconnectMode})),a}return v(n,[{key:"init",value:function(e){return this.websocket.init(e)}},{key:"request",value:function(){var e=u(c().mark((function e(t,n,r,i){var o,a,s,u,l,f,d,p=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reqId+=1,"request"===t&&(this.commandReqId+=1),o=this.commandReqId,(a=this.reqId)&&this.websocket){e.next=4;break}throw new Bv(Lv.UNEXPECTED_ERROR);case 4:if(s=Ww({command:t,sdkVersion:"4.17.1"===Qv?"0.0.1":Qv,seq:a,requestId:a,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n),"closed"!==this.websocket.state){e.next=7;break}throw new Bv(Lv.WS_DISCONNECT);case 7:if(u=function(){return new Bf((function(e,t){p.websocket.once(aE.CLOSED,(function(){return t(new Bv(Lv.WS_ABORT))})),p.websocket.once(aE.CONNECTED,e)}))},e.t0="connected"!==this.websocket.state,!e.t0){e.next=12;break}return e.next=12,u();case 12:return s.clientRequest&&(s.clientRequest.workerToken=this.token),l=new Bf((function(e,t){var n=function(){t(new Bv(Lv.WS_ABORT))};p.websocket.once(aE.RECONNECTING,n),p.websocket.once(aE.CLOSED,n),p.once("@".concat(a,"-").concat(p.spec.sid),(function(t){e(t)}))})),i&&Wb.workerEvent(this.spec.sid,Ww(Ww({},i),{},{requestId:o,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0})),f=Date.now(),this.websocket.sendMessage(s),d=null,e.prev=18,e.next=21,l;case 21:d=e.sent,e.next=33;break;case 24:if(e.prev=24,e.t1=e.catch(18),"closed"!==this.websocket.state){e.next=28;break}throw e.t1;case 28:return e.next=30,u();case 30:return e.next=32,this.request(t,n,r);case 32:return e.abrupt("return",e.sent);case 33:return e.abrupt("return",(i&&Wb.workerEvent(this.spec.sid,Ww(Ww({},i),{},{requestId:o,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:200===d.code,responseTime:Date.now()-f})),200!==d.code&&this.handleResponseError(d),d));case 34:case"end":return e.stop()}}),e,this,[[18,24]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"tryNextAddress",value:function(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}},{key:"close",value:function(){var e="4.17.1"===Qv?"0.0.1":Qv;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}},{key:"handleResponseError",value:function(e){switch(e.code){case _E.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Jv.warning("live stream response already exists stream");case _E.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case _E.LIVE_STREAM_RESPONSE_BAD_STREAM:case _E.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Bv(Lv.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case _E.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new Bv(Lv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case _E.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Bv(Lv.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case _E.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var t=new Bv(Lv.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(gE.WARNING,t,e.serverResponse.url);case _E.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:var n=new Bv(Lv.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(gE.WARNING,n,e.serverResponse.url);case _E.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Bv(Lv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case _E.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Bv(Lv.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case _E.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:var r=new Bv(Lv.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(gE.WARNING,r,e.serverResponse.url);case _E.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Bv(Lv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case _E.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Bv(Lv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case _E.LIVE_STREAM_RESPONSE_WORKER_LOST:case _E.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new Bv(Lv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case _E.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new Bv(Lv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new Bv(Lv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case _E.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case _E.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case _E.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case _E.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Bv(Lv.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}},{key:"startPingPong",value:function(){var e=this;this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((function(){"connected"===e.websocket.state&&e.request("ping",{}).catch(mS)}),6e3)}}]),n}(jv);function Hw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hw(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zw=function(e){d(n,e);var t=p(n);function n(e){var r;h(this,n);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vv,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Vv;return r=t.call(this),Mp(l(r),"onLiveStreamWarning",void 0),Mp(l(r),"onLiveStreamError",void 0),Mp(l(r),"onInjectStatusChange",void 0),Mp(l(r),"spec",void 0),Mp(l(r),"retryTimeout",1e4),Mp(l(r),"connection",void 0),Mp(l(r),"httpRetryConfig",void 0),Mp(l(r),"wsRetryConfig",void 0),Mp(l(r),"streamingTasks",new Map),Mp(l(r),"isStartingStreamingTask",!1),Mp(l(r),"taskMutex",new zb("live-streaming")),Mp(l(r),"cancelToken",Mv.CancelToken.source()),Mp(l(r),"transcodingConfig",void 0),Mp(l(r),"injectConfig",Kw({},UE)),Mp(l(r),"injectLoopTimes",0),Mp(l(r),"uapResponse",void 0),Mp(l(r),"lastTaskId",1),Mp(l(r),"statusError",new Map),r.spec=e,r.httpRetryConfig=o,r.wsRetryConfig=i,r}return v(n,[{key:"setTranscodingConfig",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 66!==(n=Kw(Kw({},ME),t)).videoCodecProfile&&77!==n.videoCodecProfile&&100!==n.videoCodecProfile&&(Jv.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map((function(e){return Kw(Kw(Kw({},hE),e),{},{zOrder:e.zOrder?e.zOrder+1:1})}))),function(e){wg(e.width)||Eg(e.width,"config.width",0,1e4),wg(e.height)||Eg(e.height,"config.height",0,1e4),wg(e.videoBitrate)||Eg(e.videoBitrate,"config.videoBitrate",1,1e6),wg(e.videoFrameRate)||Eg(e.videoFrameRate,"config.videoFrameRate"),wg(e.lowLatency)||mg(e.lowLatency,"config.lowLatency"),wg(e.audioSampleRate)||gg(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),wg(e.audioBitrate)||Eg(e.audioBitrate,"config.audioBitrate",1,128),wg(e.audioChannels)||gg(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),wg(e.videoGop)||Eg(e.videoGop,"config.videoGop"),wg(e.videoCodecProfile)||gg(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),wg(e.userCount)||Eg(e.userCount,"config.userCount",0,17),wg(e.backgroundColor)||Eg(e.backgroundColor,"config.backgroundColor",0,16777215),wg(e.userConfigExtraInfo)||bg(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!wg(e.transcodingUsers)&&(yg(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((function(e,t){Sg(e.uid),wg(e.x)||Eg(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),wg(e.y)||Eg(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),wg(e.width)||Eg(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),wg(e.height)||Eg(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),wg(e.zOrder)||Eg(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),wg(e.alpha)||Eg(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),wg(e.watermark)||mE(e.watermark,"watermark"),wg(e.backgroundImage)||mE(e.backgroundImage,"backgroundImage"),e.images&&!wg(e.images)&&(yg(e.images,"config.images"),e.images.forEach((function(e,t){mE(e,"images[".concat(t,"]"))})))}(n),r=[],n.images&&r.push.apply(r,m(n.images.map((function(e){return Kw(Kw(Kw({},vE),e),{},{zOrder:255})})))),n.backgroundImage&&(r.push(Kw(Kw(Kw({},vE),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(Kw(Kw(Kw({},vE),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map((function(e){return Kw({},e)})),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers),i=(n.userConfigs||[]).map((function(e){return"number"==typeof e.uid?Bf.resolve(e.uid):Iw(e.uid,s.spec,s.cancelToken.token,s.httpRetryConfig)})),e.next=7,Bf.all(i);case 7:if(e.sent.forEach((function(e,t){n.userConfigs&&n.userConfigs[t]&&(n.userConfigs[t].uid=e)})),this.transcodingConfig=n,!this.connection){e.next=22;break}return e.prev=10,e.next=13,this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(jy(o=this.streamingTasks).call(o)).map((function(e){return e.taskId})).join("#")});case 13:a=e.sent,Jv.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(a.code,", config:"),JSON.stringify(this.transcodingConfig)),e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(10),e.t0.data&&e.t0.data.retry){e.next=21;break}throw e.t0;case 21:e.t0.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((function(t){Jv.warning("[".concat(s.spec.clientId,"] live streaming receive error"),e.t0.toString(),"try to republish",t.url),s.startLiveStreamingTask(t.url,t.mode,e.t0).then((function(){Jv.debug("[".concat(s.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((function(e){Jv.error("[".concat(s.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),s.onLiveStreamError&&s.onLiveStreamError(t.url,e)}))}));case 22:case"end":return e.stop()}}),e,this,[[10,17]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setInjectStreamConfig",value:function(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}},{key:"startLiveStreamingTask",value:function(){var e=u(c().mark((function e(t,n,r){var i,o,a,s,u,l,f=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.from(jy(i=this.streamingTasks).call(i)).find((function(e){return e.mode===sE.INJECT}))||n!==sE.INJECT){e.next=2;break}return e.abrupt("return",new Bv(Lv.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw());case 2:if(this.transcodingConfig||n!==sE.TRANSCODE){e.next=4;break}throw new Bv(Lv.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");case 4:return o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0},Jv.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n)),e.next=8,this.taskMutex.lock();case 8:if(a=e.sent,this.connection||!r){e.next=11;break}return e.abrupt("return",void a());case 11:if(!this.streamingTasks.get(t)||r){e.next=13;break}return e.abrupt("return",(a(),new Bv(Lv.LIVE_STREAMING_TASK_CONFLICT).throw()));case 13:if(e.prev=13,e.t0=this.connection,e.t0){e.next=19;break}return e.next=18,this.connect(n);case 18:this.connection=e.sent;case 19:e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(13),a(),e.t1;case 24:e.t2=n,e.next=e.t2===sE.TRANSCODE?27:e.t2===sE.RAW?29:e.t2===sE.INJECT?30:31;break;case 27:return o.transcodingConfig=Kw({},this.transcodingConfig),e.abrupt("break",31);case 29:return e.abrupt("break",31);case 30:o={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes};case 31:return this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,s=this.lastTaskId++,e.prev=33,u=new Bf((function(e,n){dS(f.retryTimeout).then((function(){if(r)return n(r);var e=f.statusError.get(t);return e?(f.statusError.delete(t),n(e)):void 0}))})),e.next=37,Bf.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===sE.TRANSCODE?1:2,requestByUser:!r,tid:s.toString()}),u]);case 37:l=e.sent,this.isStartingStreamingTask=!1,Jv.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:s}),a(),e.next=56;break;case 41:if(e.prev=41,e.t3=e.catch(33),a(),this.isStartingStreamingTask=!1,e.t3.data&&e.t3.data.retry&&!r){e.next=45;break}throw e.t3;case 45:if(!e.t3.data.changeAddress){e.next=52;break}return this.connection.tryNextAddress(),e.next=49,this.startLiveStreamingTask(t,n,e.t3);case 49:e.t4=e.sent,e.next=55;break;case 52:return e.next=54,this.startLiveStreamingTask(t,n,e.t3);case 54:e.t4=e.sent;case 55:return e.abrupt("return",e.t4);case 56:case"end":return e.stop()}}),e,this,[[13,21],[33,41]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"stopLiveStreamingTask",value:function(e){var t=this;return new Bf((function(n,r){var i=t.streamingTasks.get(e);if(!i||!t.connection)return new Bv(Lv.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();var o=i.mode;i.abortTask=function(){Jv.debug("[".concat(t.spec.clientId,"] stop live streaming success(worker exception)")),t.streamingTasks.delete(e),n()},t.connection.request("request",{clientRequest:{command:o===sE.INJECT?"UninjectStream":"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:o===sE.TRANSCODE?1:2,requestByUser:!0,tid:(t.lastTaskId++).toString()}).then((function(r){Jv.debug("[".concat(t.spec.clientId,"] stop live streaming success, code: ").concat(r.code)),t.streamingTasks.delete(e),0===t.streamingTasks.size&&o!==sE.INJECT&&(t.connection&&t.connection.close(),t.connection=void 0),n(),o===sE.INJECT&&t.onInjectStatusChange&&t.onInjectStatusChange(cE.INJECT_STREAM_STATUS_STOP_SUCCESS,t.spec.uid,e)})).catch(r)}))}},{key:"controlInjectStream",value:function(){var e=u(c().mark((function e(t,n,r,i){var o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=this.streamingTasks.get(t))&&this.connection&&o.mode===sE.INJECT){e.next=3;break}throw new Bv(Lv.INVALID_OPERATION,"can not find inject stream task to control");case 3:return e.next=5,this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:r,position:i}});case 5:return e.abrupt("return",e.sent.serverResponse);case 6:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"resetAllTask",value:function(){var e,t=this,n=Array.from(jy(e=this.streamingTasks).call(e));this.terminate();for(var r=function(){var e=o[i];t.startLiveStreamingTask(e.url,e.mode).catch((function(n){t.onLiveStreamError&&t.onLiveStreamError(e.url,n)}))},i=0,o=n;i<o.length;i++)r()}},{key:"terminate",value:function(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Mv.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}},{key:"connect",value:function(){var e=u(c().mark((function e(t){var n,r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connection){e.next=2;break}throw new Bv(Lv.UNEXPECTED_ERROR,"live streaming connection has already connected");case 2:return e.next=4,_S(this,EE.REQUEST_WORKER_MANAGER_LIST,t);case 4:return n=e.sent,this.uapResponse=n,this.connection=new qw(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(gE.WARNING,(function(e,t){return r.onLiveStreamWarning&&r.onLiveStreamWarning(t,e)})),this.connection.on(gE.PUBLISH_STREAM_STATUS,(function(e){return r.handlePublishStreamServer(e)})),this.connection.on(gE.INJECT_STREAM_STATUS,(function(e){return r.handleInjectStreamServerStatus(e)})),this.connection.on(gE.REQUEST_NEW_ADDRESS,(function(e,n){if(!r.connection)return n(new Bv(Lv.UNEXPECTED_ERROR,"can not get new live streaming address list"));_S(r,EE.REQUEST_WORKER_MANAGER_LIST,t).then((function(t){r.uapResponse=t,e(t.addressList)})).catch(n)})),e.next=13,this.connection.init(n.addressList);case 13:return e.abrupt("return",this.connection);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handlePublishStreamServer",value:function(e){var t=this,n=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=e.reason;switch(e.code){case _E.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case _E.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case _E.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case _E.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:var o=new Bv(Lv.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return Jv.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o);case _E.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var a=new Bv(Lv.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,a);case _E.LIVE_STREAM_RESPONSE_WORKER_LOST:case _E.LIVE_STREAM_RESPONSE_WORKER_QUIT:var s;if(!this.connection)return;this.connection.tryNextAddress();for(var c=Array.from(jy(s=this.streamingTasks).call(s)),u=function(){var n=f[l];n.abortTask?n.abortTask():(Jv.warning("[".concat(t.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),t.startLiveStreamingTask(n.url,n.mode,new Bv(Lv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((function(){Jv.debug("[".concat(t.spec.clientId,"] republish live stream success"),n.url)})).catch((function(e){Jv.error(e.toString()),t.onLiveStreamError&&t.onLiveStreamError(n.url,e)})))},l=0,f=c;l<f.length;l++)u();return}}},{key:"handleInjectStreamServerStatus",value:function(e){var t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(cE.INJECT_STREAM_STATUS_START_SUCCESS,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(cE.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(cE.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(cE.INJECT_STREAM_STATUS_BROKEN,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(cE.INJECT_STREAM_STATUS_START_TIMEOUT,t,n),void this.streamingTasks.delete(n);default:return void Jv.debug("inject stream server status",e)}}},{key:"hasUrl",value:function(e){return this.streamingTasks.has(e)}}]),n}(jv),Yw=function(){function e(){h(this,e),Mp(this,"destChannelMediaInfos",new Map),Mp(this,"srcChannelMediaInfo",void 0)}return v(e,[{key:"setSrcChannelInfo",value:function(e){jE(e),this.srcChannelMediaInfo=e}},{key:"addDestChannelInfo",value:function(e){jE(e),this.destChannelMediaInfos.set(e.channelName,e)}},{key:"removeDestChannelInfo",value:function(e){Tg(e),this.destChannelMediaInfos.delete(e)}},{key:"getSrcChannelMediaInfo",value:function(){return this.srcChannelMediaInfo}},{key:"getDestChannelMediaInfo",value:function(){return this.destChannelMediaInfos}}]),e}();function Jw(e){if(!(e instanceof Yw))return new Bv(Lv.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();var t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new Bv(Lv.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new Bv(Lv.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}var Xw=function(e){d(n,e);var t=p(n);function n(e,r,i){var o;return h(this,n),o=t.call(this),Mp(l(o),"ws",void 0),Mp(l(o),"requestId",1),Mp(l(o),"heartBeatTimer",void 0),Mp(l(o),"joinInfo",void 0),Mp(l(o),"clientId",void 0),Mp(l(o),"onOpen",(function(){o.emit("open"),o.startHeartBeatCheck()})),Mp(l(o),"onClose",(function(e){o.emit("close"),o.dispose()})),Mp(l(o),"onMessage",(function(e){var t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(o.emit("status",t.serverStatus),void o.emit(t.serverStatus.command,t.serverStatus)):void 0;o.emit("req_".concat(t.requestId),t)})),o.joinInfo=e,o.clientId=r,o.ws=new BS("cross-channel-".concat(o.clientId),i),o.ws.on(aE.RECONNECTING,(function(){o.ws.reconnectMode="retry",o.emit("reconnecting")})),o.ws.on(aE.CONNECTED,o.onOpen),o.ws.on(aE.ON_MESSAGE,o.onMessage),o.ws.on(aE.CLOSED,o.onClose),o}return v(n,[{key:"isConnect",value:function(){return"connected"===this.ws.state}},{key:"sendMessage",value:function(e){var t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}},{key:"waitStatus",value:function(e){var t=this;return new Bf((function(n,r){var i=window.setTimeout((function(){r(new Bv(Lv.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);t.once(e,(function(t){window.clearTimeout(i),t.state&&0!==t.state?r(new Bv(Lv.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)})),t.once("dispose",(function(){window.clearTimeout(i),r(new Bv(Lv.WS_ABORT))}))}))}},{key:"request",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("closed"!==this.ws.state){e.next=2;break}throw new Bv(Lv.WS_DISCONNECT);case 2:if(n=function(){return new Bf((function(e,t){a.ws.once(aE.CLOSED,(function(){return t(new Bv(Lv.WS_ABORT))})),a.ws.once(aE.CONNECTED,e)}))},e.t0="connected"!==this.ws.state,!e.t0){e.next=7;break}return e.next=7,n();case 7:return r=this.sendMessage(t),i=new Bf((function(e,t){var n=function(){t(new Bv(Lv.WS_ABORT))};a.ws.once(aE.RECONNECTING,n),a.ws.once(aE.CLOSED,n),a.once("req_".concat(r),e),dS(3e3).then((function(){a.removeAllListeners("req_".concat(r)),a.ws.off(aE.RECONNECTING,n),a.ws.off(aE.CLOSED,n),t(new Bv(Lv.TIMEOUT,"cross channel ws request timeout"))}))})),e.next=11,i;case 11:if((o=e.sent)&&200===o.code){e.next=14;break}throw new Bv(Lv.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ws.removeAllListeners(aE.REQUEST_NEW_URLS),this.ws.on(aE.REQUEST_NEW_URLS,(function(e){e(t)})),e.next=4,this.ws.init(t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dispose",value:function(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}},{key:"sendPing",value:function(e){var t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}},{key:"startHeartBeatCheck",value:function(){var e=this;this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((function(){e.sendPing({command:"ping",appId:e.joinInfo.appId,cname:e.joinInfo.cname,uid:e.joinInfo.uid.toString(),sid:e.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}},{key:"clearHeartBeatCheck",value:function(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}]),n}(jv),Qw=function(e){d(n,e);var t=p(n);function n(e,r,i,o){var a;return h(this,n),a=t.call(this),Mp(l(a),"joinInfo",void 0),Mp(l(a),"sid",void 0),Mp(l(a),"clientId",void 0),Mp(l(a),"cancelToken",Mv.CancelToken.source()),Mp(l(a),"workerToken",void 0),Mp(l(a),"requestId",0),Mp(l(a),"signal",void 0),Mp(l(a),"prevChannelMediaConfig",void 0),Mp(l(a),"httpRetryConfig",void 0),Mp(l(a),"_state",SE.RELAY_STATE_IDLE),Mp(l(a),"errorCode",wE.RELAY_OK),Mp(l(a),"onStatus",(function(e){Jv.debug("[".concat(a.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&a.emit("event",TE.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&a.emit("event",TE.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(a.errorCode=wE.SRC_TOKEN_EXPIRED,a.state=SE.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(a.errorCode=wE.DEST_TOKEN_EXPIRED,a.state=SE.RELAY_STATE_FAILURE))})),Mp(l(a),"onReconnect",u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Jv.debug("[".concat(a.clientId,"] ChannelMediaSocket disconnect, reconnecting")),a.emit("event",TE.NETWORK_DISCONNECTED),a.state=SE.RELAY_STATE_IDLE,a.prevChannelMediaConfig&&a.sendStartRelayMessage(a.prevChannelMediaConfig).catch((function(e){a.state!==SE.RELAY_STATE_IDLE&&(Jv.error("auto restart channel media relay failed",e.toString()),a.errorCode=wE.SERVER_CONNECTION_LOST,a.state=SE.RELAY_STATE_FAILURE)}));case 1:case"end":return e.stop()}}),e)})))),a.joinInfo=e,a.clientId=r,a.sid=vS(),a.signal=new Xw(a.joinInfo,a.clientId,i),a.httpRetryConfig=o,a}return v(n,[{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(e!==SE.RELAY_STATE_FAILURE&&(this.errorCode=wE.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}},{key:"startChannelMediaRelay",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state===SE.RELAY_STATE_IDLE){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION);case 2:return this.state=SE.RELAY_STATE_CONNECTING,e.next=5,this.connect();case 5:return Jv.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success")),e.prev=6,e.next=9,this.sendStartRelayMessage(t);case 9:e.next=20;break;case 11:if(e.prev=11,e.t0=e.catch(6),!e.t0.data||!e.t0.data.serverResponse||"SetSourceChannel"!==e.t0.data.serverResponse.command){e.next=15;break}throw new Bv(Lv.CROSS_CHANNEL_FAILED_JOIN_SRC);case 15:if(!e.t0.data||!e.t0.data.serverResponse||"SetDestChannelStatus"!==e.t0.serverResponse.command){e.next=17;break}throw new Bv(Lv.CROSS_CHANNEL_FAILED_JOIN_DEST);case 17:if(!e.t0.data||!e.t0.data.serverResponse||"StartPacketTransfer"!==e.t0.serverResponse.command){e.next=19;break}throw new Bv(Lv.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);case 19:throw e.t0;case 20:this.prevChannelMediaConfig=t;case 21:case"end":return e.stop()}}),e,this,[[6,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateChannelMediaRelay",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state===SE.RELAY_STATE_RUNNING){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION);case 2:return e.next=4,this.sendUpdateMessage(t);case 4:this.prevChannelMediaConfig=t;case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopChannelMediaRelay",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendStopRelayMessage();case 2:Jv.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=SE.RELAY_STATE_IDLE,this.dispose();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"dispose",value:function(){Jv.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Mv.CancelToken.source(),this.state=SE.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}},{key:"connect",value:function(){var e=u(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lw(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);case 2:return t=e.sent,this.workerToken=t.workerToken,e.next=6,this.signal.connect(t.addressList);case 6:this.emit("event",TE.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"sendStartRelayMessage",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.genMessage(yE.StopPacketTransfer),e.next=3,this.signal.request(n);case 3:return e.next=5,this.signal.waitStatus("Normal Quit");case 5:return Jv.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),r=this.genMessage(yE.SetSdkProfile,t),e.next=9,this.signal.request(r);case 9:return Jv.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success")),i=this.genMessage(yE.SetSourceChannel,t),e.next=13,this.signal.request(i);case 13:return e.next=15,this.signal.waitStatus("SetSourceChannelStatus");case 15:return this.emit("event",TE.PACKET_JOINED_SRC_CHANNEL),Jv.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success")),o=this.genMessage(yE.SetSourceUserId,t),e.next=20,this.signal.request(o);case 20:return Jv.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success")),a=this.genMessage(yE.SetDestChannel,t),e.next=24,this.signal.request(a);case 24:return e.next=26,this.signal.waitStatus("SetDestChannelStatus");case 26:return this.emit("event",TE.PACKET_JOINED_DEST_CHANNEL),Jv.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success")),s=this.genMessage(yE.StartPacketTransfer,t),e.next=31,this.signal.request(s);case 31:this.emit("event",TE.PACKET_SENT_TO_DEST_CHANNEL),this.state=SE.RELAY_STATE_RUNNING,Jv.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"));case 34:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendUpdateMessage",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.genMessage(yE.UpdateDestChannel,t),e.next=3,this.signal.request(n);case 3:this.emit("event",TE.PACKET_UPDATE_DEST_CHANNEL),Jv.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendStopRelayMessage",value:function(){var e=u(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.genMessage(yE.StopPacketTransfer),e.next=3,this.signal.request(t);case 3:Jv.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"genMessage",value:function(e,t){var n=this,r=[],i=[],o=[];this.requestId+=1;var a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Qv,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.17.1"===a.sdkVersion&&(a.sdkVersion="0.0.1");var s=null,c=null;switch(e){case yE.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case yE.SetSourceChannel:if(!(c=t&&t.getSrcChannelMediaInfo()))throw new Bv(Lv.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c.channelName,token:c.token||this.joinInfo.appId},a;case yE.SetSourceUserId:if(!(c=t&&t.getSrcChannelMediaInfo()))throw new Bv(Lv.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:c.uid+""},a;case yE.SetDestChannel:if(!(s=t&&t.getDestChannelMediaInfo()))throw new Bv(Lv.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((function(e){r.push(e.channelName),i.push(e.uid+""),o.push(e.token||n.joinInfo.appId)})),a.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:o},a;case yE.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case yE.Reconnect:return a.clientRequest={command:"Reconnect"},a;case yE.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case yE.UpdateDestChannel:if(!(s=t&&t.getDestChannelMediaInfo()))throw new Bv(Lv.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((function(e){r.push(e.channelName),i.push(e.uid+""),o.push(e.token||n.joinInfo.appId)})),a.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:o},a}return a}}]),n}(jv),$w=function(e){var t=document.createElement("canvas");return t.width=2,t.height=2,new Bf((function(n,r){t.toBlob(function(){var e=u(c().mark((function e(i){var o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.remove(),!i){e.next=7;break}return e.next=3,Zw(i);case 3:o=e.sent,n({buffer:o,width:t.width,height:t.height}),e.next=8;break;case 7:r(new Bv(Lv.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e,1)}))},Zw=function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function eR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eR(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nR,rR,iR=function(){function e(t){var n=this;h(this,e),Mp(this,"trackId",void 0),Mp(this,"config",void 0),Mp(this,"onFirstVideoFrameDecoded",void 0),Mp(this,"freezeTimeCounterList",[]),Mp(this,"renderFreezeAccTime",0),Mp(this,"timeUpdatedCount",0),Mp(this,"freezeTime",0),Mp(this,"playbackTime",0),Mp(this,"lastTimeUpdatedTime",0),Mp(this,"autoplayFailed",!1),Mp(this,"videoTrack",void 0),Mp(this,"videoElement",void 0),Mp(this,"cacheVideoElement",void 0),Mp(this,"videoElementCheckInterval",void 0),Mp(this,"_videoElementStatus",lg.NONE),Mp(this,"isGettingVideoDimensions",!1),Mp(this,"startGetVideoDimensions",(function(){var e=function e(){if(n.isGettingVideoDimensions=!0,n.videoElement.videoWidth*n.videoElement.videoHeight>4)return Jv.debug("[".concat(n.trackId,"] current video dimensions:"),n.videoElement.videoWidth,n.videoElement.videoHeight),void(n.isGettingVideoDimensions=!1);setTimeout(e,500)};!n.isGettingVideoDimensions&&e()})),Mp(this,"autoResumeAfterInterruption",(function(){n.videoTrack&&"live"===n.videoTrack.readyState&&"running"===Zb.curState&&(Tp()?(Jv.debug("[track-".concat(n.trackId,"] video element paused, auto resume for iOS 15.2")),n.videoElement.srcObject=null,n.videoElement.srcObject=new MediaStream([n.videoTrack]),n.videoElement.play()):yp()?(Jv.debug("[track-".concat(n.trackId,"] video element paused, auto resume for iOS 15.1")),n.videoElement.srcObject=null,n.videoElement.srcObject=new MediaStream([n.videoTrack]),n.videoElement.play()):bp()&&(Jv.debug("[track-".concat(n.trackId,"] video element paused, auto resume for iOS 15.0")),n.videoElement.pause(),n.videoElement.play()))})),Mp(this,"handleVideoEvents",(function(e){switch(e.type){case"play":case"playing":n.startGetVideoDimensions(),n.videoElementStatus=lg.PLAYING;break;case"loadeddata":if(n.onFirstVideoFrameDecoded&&n.onFirstVideoFrameDecoded(),n.cacheVideoElement){try{n.cacheVideoElement.remove()}catch(e){}n.cacheVideoElement=void 0}break;case"canplay":n.videoElementStatus=lg.CANPLAY;break;case"stalled":n.videoElementStatus=lg.STALLED;break;case"suspend":n.videoElementStatus=lg.SUSPEND;break;case"pause":n.videoElementStatus=lg.PAUSED,pp()||Sp()||fp()&&n.autoplayFailed||!n.videoTrack||"live"!==n.videoTrack.readyState||(Jv.debug("[track-".concat(n.trackId,"] video element paused, auto resume")),n.videoElement.play());break;case"waiting":n.videoElementStatus=lg.WAITING;break;case"abort":n.videoElementStatus=lg.ABORT;break;case"ended":n.videoElementStatus=lg.ENDED;break;case"emptied":n.videoElementStatus=lg.EMPTIED;break;case"error":n.videoElementStatus=lg.ERROR;var t=n.videoElement.error;t&&Jv.error("[".concat(n.trackId,"] media error, code: ").concat(t.code,", message: ").concat(t.message));break;case"timeupdate":var r=performance.now();if(n.timeUpdatedCount+=1,n.timeUpdatedCount<10)return void(n.lastTimeUpdatedTime=r);var i=r-n.lastTimeUpdatedTime,o=n.lastTimeUpdatedTime;if(n.lastTimeUpdatedTime=r,JT.lastVisibleTime<JT.lastHiddenTime||o<JT.lastHiddenTime||o<JT.lastVisibleTime)return;for(i>lm("VIDEO_FREEZE_DURATION")&&(n.freezeTime+=i),n.playbackTime+=i;n.playbackTime>=6e3;){n.playbackTime-=6e3;var a=Math.min(6e3,n.freezeTime);n.freezeTimeCounterList.push(a),n.freezeTime=Math.max(0,n.freezeTime-6e3)}}})),Mp(this,"autoResumeAfterInterruptionOnIOS15",(function(){n.videoTrack&&"live"===n.videoTrack.readyState&&(Tp()?(Jv.debug("[track-".concat(n.trackId,"] video element paused, auto resume for iOS 15.2")),n.videoElement.srcObject=null,n.videoElement.srcObject=new MediaStream([n.videoTrack]),n.videoElement.play()):yp()?(Jv.debug("[track-".concat(n.trackId,"] video element paused, auto resume for iOS 15.1")),n.videoElement.srcObject=null,n.videoElement.srcObject=new MediaStream([n.videoTrack]),n.videoElement.play()):bp()&&(Jv.debug("[track-".concat(n.trackId,"] video element paused, auto resume for iOS 15.0")),n.videoElement.pause(),n.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Zb.on(qb.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zb.on(qb.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}return v(e,[{key:"videoElementStatus",get:function(){return this._videoElementStatus},set:function(e){e!==this._videoElementStatus&&(Jv.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}},{key:"getVideoElement",value:function(){return this.videoElement}},{key:"getContainerElement",value:function(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}},{key:"updateConfig",value:function(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}},{key:"updateVideoTrack",value:function(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}},{key:"play",value:function(e){var t=this,n=this.videoElement.play();n&&n.catch&&n.catch((function(n){e&&Wb.autoplayFailed(e,"video",n.message,t.trackId),"NotAllowedError"===n.name?(Jv.warning("detected video element autoplay failed",n),t.autoplayFailed=!0,t.handleAutoPlayFailed()):Jv.warning("[".concat(t.trackId,"] play warning: "),n)}));var r=rp();if(("Safari"===r.name&&15===Number(r.version)||_p())&&n&&n.then&&n.catch){var i=function(){t.config.mirror&&(t.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}},{key:"getCurrentFrame",value:function(){var e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;var t=e.getContext("2d");if(!t)return Jv.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);var n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}},{key:"getCurrentFrameToUint8Array",value:function(){var e=u(c().mark((function e(t){var n,r,i,o=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:1,(r=document.createElement("canvas")).width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight,!(i=r.getContext("2d"))){e.next=8;break}e.t0=(i.drawImage(this.videoElement,0,0,r.width,r.height),new Bf((function(e,i){r.toBlob(function(){var t=u(c().mark((function t(n){var o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.remove(),!n){t.next=7;break}return t.next=3,Zw(n);case 3:o=t.sent,e({buffer:o,width:r.width,height:r.height}),t.next=8;break;case 7:i(new Bv(Lv.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t,n<0?.1:n>1?1:n)}))),e.next=11;break;case 8:return e.next=10,$w(t);case 10:e.t0=e.sent;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){Zb.off(qb.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zb.off(qb.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}},{key:"initVideoElement",value:function(){var e=this;if(this.videoElementStatus=lg.INIT,!this.videoElementCheckInterval&&(oR.forEach((function(t){e.videoElement.addEventListener(t,e.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((function(){(function(e){return e!==document.body&&document.body.contains(e)})(e.videoElement)||(e.videoElementStatus=lg.DESTROYED)}),1e3),lm("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n,r,i=function t(n,i){if(e.videoElementStatus===lg.PLAYING){if(r){var o=i.presentationTime-r.presentationTime;o>lm("VIDEO_FREEZE_DURATION")&&JT.lastVisibleTime>=JT.lastHiddenTime&&r.timestamp>JT.lastVisibleTime&&r.timestamp>JT.lastHiddenTime&&(e.renderFreezeAccTime+=o)}r=tR(tR({},i),{},{timestamp:n})}var a,s;lm("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(a=(s=e.videoElement).requestVideoFrameCallback)||void 0===a||a.call(s,t))};null===(t=(n=this.videoElement).requestVideoFrameCallback)||void 0===t||t.call(n,i)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Ip()&&(this.videoElement.poster="noposter");var o=rp();"Safari"===o.name&&15===Number(o.version)||_p()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,dp()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,dp()&&this.videoElement.load());var a=this.videoElement.play();void 0!==a&&a.catch((function(t){Jv.debug("[".concat(e.trackId,"] playback interrupted"),t.toString())}))}},{key:"resetVideoElement",value:function(){var e=this;oR.forEach((function(t){e.videoElement&&e.videoElement.removeEventListener(t,e.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=lg.NONE}},{key:"handleAutoPlayFailed",value:function(){var e=this,t=function t(n){n.preventDefault(),e.videoElement.play().then((function(){Jv.debug("[".concat(e.trackId,"] Video element for trackId:").concat(e.trackId," autoplay resumed."))})).catch((function(e){Jv.error(e)})),e.autoplayFailed=!1,Ap()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Ap()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),Mb()}}]),e}(),oR=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],aR=function(e){d(n,e);var t=p(n);function n(e){var r;return h(this,n),r=t.call(this,e),Mp(l(r),"container",void 0),Mp(l(r),"slot",void 0),r.slot=e.element,r.updateConfig(e),r}return v(n,[{key:"updateConfig",value:function(e){this.config=e,this.trackId=e.trackId;var t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}},{key:"updateVideoTrack",value:function(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}},{key:"play",value:function(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&i(o(n.prototype),"play",this).call(this,e)}},{key:"getCurrentFrame",value:function(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?new ImageData(2,2):i(o(n.prototype),"getCurrentFrame",this).call(this)}},{key:"getCurrentFrameToUint8Array",value:function(){var e=u(c().mark((function e(t){var r,a,s=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>1&&void 0!==s[1]?s[1]:1,null===(r=this.container)||void 0===r||!r.contains(this.videoElement)){e.next=7;break}return e.next=4,$w(t);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,i(o(n.prototype),"getCurrentFrameToUint8Array",this).call(this,t,a);case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){if(i(o(n.prototype),"destroy",this).call(this),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(y){}this.container=void 0}}},{key:"createElements",value:function(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",lm("KEEP_LAST_FRAME")&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}},{key:"mountedVideoElement",value:function(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),i(o(n.prototype),"initVideoElement",this).call(this),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}},{key:"unmountedVideoElement",value:function(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){i(o(n.prototype),"resetVideoElement",this).call(this);try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}},{key:"resetVideoElement",value:function(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(i(o(n.prototype),"resetVideoElement",this).call(this),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}},{key:"getContainerElement",value:function(){return this.container}}]),n}(iR);function sR(e){var t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});var n=im(e.encoderConfig);return t.width=n.width,t.height=n.height,!Rp()&&n.frameRate&&(t.frameRate=n.frameRate),rp().name===Qd.EDGE&&"object"==typeof t.frameRate&&(t.frameRate.max=60),dp()&&(t.frameRate={ideal:30,max:30}),t}function cR(e){var t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&lp()&&(t.extensionId=e.extensionId);var n=e.displaySurface,r=e.selfBrowserSurface,i=e.surfaceSwitching,o=e.systemAudio;(hp(107)||vp(107)||mp(93))&&(n&&(gg(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(gg(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(gg(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(hp(105)||vp(105)||mp(91))&&o&&(gg(o,"systemAudio",["exclude","include"]),t.systemAudio=o),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);var a=e.encoderConfig?om(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:a?a.width:void 0,maxHeight:a?a.height:void 0},a&&(a.frameRate&&("number"==typeof a.frameRate?(t.mandatory.maxFrameRate=a.frameRate,t.mandatory.minFrameRate=a.frameRate):(t.mandatory.maxFrameRate=a.frameRate.max||a.frameRate.ideal||a.frameRate.exact||void 0,t.mandatory.minFrameRate=a.frameRate.min||a.frameRate.ideal||a.frameRate.exact||void 0),t.frameRate=a.frameRate),a.width&&(t.width=a.width),a.height&&(t.height=a.height)),t}function uR(e){var t={};if(Rp()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,lp()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){var n=cm(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Ip()&&(t.sampleRate=void 0),t}!function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"}(nR||(nR={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(rR||(rR={}));var lR,fR,dR,pR,hR,vR,mR,gR,ER,_R,bR,yR,TR,SR,wR,RR,OR,IR,AR,kR,CR,NR,xR,DR,PR,LR,MR,UR,jR,FR,BR,VR,GR,WR,qR=new(function(){function e(){var t=this;h(this,e),Mp(this,"_clientSize",null),Mp(this,"getClientWidth",(function(){return document.documentElement?document.documentElement.clientWidth:document.body.clientWidth})),Mp(this,"getClientHeight",(function(){return document.documentElement?document.documentElement.clientHeight:document.body.clientHeight})),Mp(this,"getStyle",(function(e){return window.getComputedStyle(e,null)})),Mp(this,"checkCssVisibleProperty",(function(e){var n=!0,r=t.getStyle(e),i=r.display,o=r.visibility,s=r.opacity,c=r.filter;return("none"===i||["hidden","collapse"].includes(o)||Number(s)<.1)&&(n=!1),!!n&&(c&&c.split(" ").filter((function(e){var t=e.split("(")[0];return["brightness","blur","opacity"].includes(t)})).map((function(e){var t=e.split(/\(|\)/),n=a(t,2),r=n[0],i=n[1];return[r,Number(i.match(/^[0-9\.]+/))]})).forEach((function(e){var t=a(e,2),r=t[0],i=t[1];switch(r){case"brightness":(i<.1||i>3)&&(n=!1);break;case"blur":i>3&&(n=!1);break;case"opacity":i<.1&&(n=!1)}})),n)})),Mp(this,"checkPropertyUpToAllParentNodes",(function(e,t){for(var n=!0,r=!0,i=function(e){return t(e)},o=e;o&&r;)i(o)||(n=!1,r=!1),(o=o.parentElement)||(r=!1);return n})),Mp(this,"checkActualCssVisibleIncludeInherit",(function(e){return t.checkPropertyUpToAllParentNodes(e,t.checkCssVisibleProperty)})),Mp(this,"getSizeAboutClient",(function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height,o=n.left,a=n.right,s=n.top,c=n.bottom,u=t.getClientWidth(),l=t.getClientHeight();return{width:r,height:i,left:o,right:a,top:s,bottom:c,clientWidth:u,clientHeight:l,clientMin:Math.min(u,l)}})),Mp(this,"checkActualSize",(function(){var e=t._clientSize,n=e.width,r=e.height,i=e.clientMin;return t.checkSizeIsVisible(n,r,i)})),Mp(this,"elementFromPoint",(function(e,t){return document.elementFromPoint?document.elementFromPoint(e,t):null})),Mp(this,"checkCoverForAPoint",(function(e,n,r){var i=t.elementFromPoint(e,n);return null!==i&&i!==r})),Mp(this,"getPointPositionList",(function(){for(var e=t._clientSize,n=e.width,r=e.height,i=e.left,o=e.top,a=n/6,s=r/6,c=[],u=Math.pow(10,6),l=0;l<5;l++)for(var f=0;f<5;f++){var d=(i*u+(0===l?.1:4===l?(a*l*u-1e5)/u:a*l)*u)/u,p=(o*u+(0===f?.1:4===f?(s*f*u-1e5)/u:s*f)*u)/u;c.push({x:d,y:p})}return[].concat(c)})),Mp(this,"checkElementCover",(function(e){return t.getPointPositionList().map((function(n){return t.checkCoverForAPoint(n.x,n.y,e)})).filter((function(e){return!!e})).length>6})),Mp(this,"checkSizeIsVisible",(function(e,t,n){return(e>50||n/e<=10)&&(t>50||n/t<=10)})),Mp(this,"checkSizeOfPartInClient",(function(){var e,n,r=t._clientSize,i=r.left,o=r.right,a=r.top,s=r.bottom,c=r.clientHeight,u=r.clientWidth,l=r.clientMin;if(i<0)e=0;else{if(!(i<u))return!1;e=i}if(o<0)return!1;if(a<0)n=0;else{if(!(a<c))return!1;n=a}if(s<0)return!1;var f=(o<u?o:u)-e,d=(s<c?s:c)-n;return t.checkSizeIsVisible(f,d,l)})),Mp(this,"returnHiddenResult",(function(e){return t._clientSize=null,{visible:!1,reason:e}})),Mp(this,"checkOneElementVisible",(function(e){if(e instanceof HTMLElement){if(t.checkElementIsMountedOnDom(e)){if(t.checkActualCssVisibleIncludeInherit(e)){if(t._clientSize=t.getSizeAboutClient(e),t.checkElementCover(e))return t.returnHiddenResult(nR.COVERED);var n=t.checkActualSize(),r=t.checkSizeOfPartInClient();return n&&!r?t.returnHiddenResult(nR.POSITION):n?(t._clientSize=null,{visible:!0}):t.returnHiddenResult(nR.SIZE)}return t.returnHiddenResult(nR.STYLE)}return t.returnHiddenResult(rR.UNMOUNTED)}return t.returnHiddenResult(rR.INVALID_HTML_ELEMENT)})),Mp(this,"checkElementIsMountedOnDom",(function(e){return t.checkPropertyUpToAllParentNodes(e,(function(e){return"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement}))}))}return v(e)}());function HR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function KR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?HR(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zR=(lR=Gb({argsMap:function(e,t,n){return[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}}),fR=Cy(),dR=Gb({argsMap:function(e){return[e.getTrackId()]}}),pR=Yb("LocalVideoTrack","_enabledMutex"),hR=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),vR=Cy(),mR=Yb("LocalVideoTrack","_enabledMutex"),gR=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),ER=Cy(),_R=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),bR=Cy(),yR=Cy(),TR=Gb({argsMap:function(e,t,n){return[e.getTrackId(),t,n]}}),SR=Cy(),wR=Cy(),RR=Cy(),OR=Cy(),IR=Cy(),AR=Cy(),kR=Cy(),CR=Gb({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),NR=Gb({argsMap:function(e){return[e.getTrackId()]}}),xR=Gb({argsMap:function(e){return[e.getTrackId()]}}),DR=Gb({argsMap:function(e,t,n){return[e.getTrackId(),t.label,n]}}),_b((PR=function(e){d(n,e);var t=p(n);function n(e,i,o,a,s,c){var u;if(h(this,n),u=t.call(this,e,s),Mp(l(u),"trackMediaType","video"),Mp(l(u),"_player",void 0),Mp(l(u),"_videoVisibleTimer",null),Mp(l(u),"_previousVideoVisibleStatus",void 0),Mp(l(u),"_clearPreviousVideoVisibleStatus",(function(){return u._previousVideoVisibleStatus=void 0})),Mp(l(u),"_encoderConfig",void 0),Mp(l(u),"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),Mp(l(u),"_optimizationMode",void 0),Mp(l(u),"_videoHeight",void 0),Mp(l(u),"_videoWidth",void 0),Mp(l(u),"_forceBitrateLimit",void 0),Mp(l(u),"_enabled",!0),Mp(l(u),"processorDestination",void 0),Mp(l(u),"_processorContext",void 0),fp()){var f=e.getSettings(),d=f.width,p=f.height;u._videoWidth=d,u._videoHeight=p}else u.updateMediaStreamTrackResolution();return u._encoderConfig=i,u._scalabiltyMode=o,u._optimizationMode=a,u._hints=c||[],-1===u._hints.indexOf(CE.SCREEN_TRACK)&&u.updateBitrateFromProfile(),i&&-1!==u._hints.indexOf(CE.CUSTOM_TRACK)&&u.setEncoderConfiguration(i),u.processorContext=new kT(u.getTrackId(),"local"),u.processorDestination=new AT(u.processorContext),u.bindProcessorDestinationEvents(),r(u)}return v(n,[{key:"isPlaying",get:function(){return!(!this._player||this._player.videoElementStatus!==lg.PLAYING)}},{key:"processorContext",get:function(){return this._processorContext},set:function(e){this._processorContext=e}},{key:"__className__",get:function(){return"LocalVideoTrack"}},{key:"play",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){var r=document.getElementById(e);r?e=r:(Jv.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Jv.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));var i=KR(KR(KR({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new iR(i):this._player=new aR(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((function(){try{var e=t.getVideoElementVisibleStatus();t.emit(DE.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(n){}}),lm("CHECK_VIDEO_VISIBLE_INTERVAL"))}},{key:"stop",value:function(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Jv.debug("[".concat(this.getTrackId(),"] stop video playback")))}},{key:"setEnabled",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(Jv.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){e.next=15;break}return this._originMediaStreamTrack.enabled=!1,e.prev=6,e.next=9,bS(this,kE.NEED_DISABLE_TRACK,this);case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(6),Jv.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t0.toString()),e.t0;case 14:return e.abrupt("return",(n||(this._enabled=!1),void Jv.info("[".concat(this.getTrackId(),"] setEnabled to false success"))));case 15:return this._originMediaStreamTrack.enabled=!0,e.prev=16,e.next=19,bS(this,kE.NEED_ENABLE_TRACK,this);case 19:e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(16),Jv.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.t1.toString()),e.t1;case 24:Jv.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0);case 25:case"end":return e.stop()}}),e,this,[[6,11],[16,21]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setMuted",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t!==this._muted,!e.t0){e.next=13;break}if(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,Jv.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),!t){e.next=11;break}return e.next=9,bS(this,kE.NEED_MUTE_TRACK,this);case 9:e.next=13;break;case 11:return e.next=13,bS(this,kE.NEED_UNMUTE_TRACK,this);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setEncoderConfiguration",value:function(){var e=u(c().mark((function e(t,n){var r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._enabled){e.next=2;break}throw new Bv(Lv.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");case 2:if(t=im(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),!(t.width||t.height||t.frameRate)){e.next=15;break}return r=sR({encoderConfig:t}),(fp()||pp()||Sp())&&(r.deviceId=void 0),Jv.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r)),e.prev=5,e.next=8,this._originMediaStreamTrack.applyConstraints(r);case 8:this.updateMediaStreamTrackResolution(),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),i=new Bv(Lv.UNEXPECTED_ERROR,e.t0.toString()),Jv.error("[".concat(this.getTrackId(),"] applyConstraints error"),i.toString()),i;case 15:return this._encoderConfig=t,-1===this._hints.indexOf(CE.SCREEN_TRACK)&&this.updateBitrateFromProfile(),e.prev=16,e.next=19,bS(this,kE.NEED_UPDATE_VIDEO_ENCODER,this);case 19:e.next=24;break;case 21:return e.prev=21,e.t1=e.catch(16),e.abrupt("return",e.t1.throw());case 24:case"end":return e.stop()}}),e,this,[[5,11],[16,21]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getStats",value:function(){return AS((function(){Jv.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),yS(this,kE.GET_STATS)||KR({},lE)}},{key:"setBeautyEffect",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Jv.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect");case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCurrentFrameData",value:function(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}},{key:"getCurrentFrameImage",value:function(){var e=u(c().mark((function e(t){var n,r=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:1,!this._player){e.next=5;break}e.t0=this._player.getCurrentFrameToUint8Array(t,n),e.next=8;break;case 5:return e.next=7,$w(t);case 7:e.t0=e.sent;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"clone",value:function(e,t,r,i){return new n(this._mediaStreamTrack.clone(),e,t,r,i)}},{key:"setBitrateLimit",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jv.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),!t){e.next=10;break}return this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate),e.prev=2,e.next=5,bS(this,kE.NEED_UPDATE_VIDEO_ENCODER,this);case 5:e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(2),e.abrupt("return",e.t0.throw());case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setOptimizationMode",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("motion"===t||"detail"===t||"balanced"===t){e.next=2;break}return e.abrupt("return",void Jv.error(Lv.INVALID_PARAMS,"optimization mode must be motion, detail or balanced"));case 2:return n=this._optimizationMode,e.prev=3,this._optimizationMode=t,e.next=7,bS(this,kE.SET_OPTIMIZATION_MODE,this);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),this._optimizationMode=n,Jv.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.t0.toString()),e.t0;case 12:Jv.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"));case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setScalabiltyMode",value:function(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return Jv.error(Lv.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=e,Jv.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}},{key:"updateMediaStreamTrackResolution",value:function(){var e=this;gS(this._originMediaStreamTrack).then((function(t){var n=a(t,2),r=n[0],i=n[1];e._videoHeight=i,e._videoWidth=r})).catch(mS)}},{key:"_updatePlayerSource",value:function(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}},{key:"_getDefaultPlayerConfig",value:function(){return{fit:"contain"}}},{key:"updateBitrateFromProfile",value:function(){if(this._encoderConfig){var e=this.getMediaStreamTrackSettings(),t=e.width,n=e.height,r=e.frameRate;if(t&&n&&r){var i=function(e,t,n){var r,i=lm("BITRATE_ADAPTER_TYPE"),o=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75),a=o;if("STANDARD_BITRATE"===i)r=4*o;else{if("COMPATIABLE_BITRATE"!==i)return;r=2*o}return[Math.floor(r),Math.floor(a)]}(t,n,r)||[void 0,void 0],o=a(i,2),s=o[0],c=o[1];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=s,Jv.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(s,", brMin: ").concat(c,"]")))}}}},{key:"getVideoElementVisibleStatus",value:function(){try{var e,t,n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},i=r.element,o=r.slot;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){var a=qR.checkOneElementVisible(i),s=Object.assign({},a);if(s.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=s.visible;var c=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});s.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(s.reason))}return s}return}catch(u){throw new Bv(Lv.GET_VIDEO_ELEMENT_VISIBLE_ERROR,u.message)}}},{key:"renewMediaStreamTrack",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"pipe",value:function(e){if(this.processor===e)return e;if(e._source)throw new Bv(Lv.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}},{key:"unpipe",value:function(){if(this.processor){var e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}}},{key:"close",value:function(){i(o(n.prototype),"close",this).call(this),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}},{key:"replaceTrack",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof MediaStreamTrack){e.next=2;break}throw new Bv(Lv.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");case 2:if("video"===t.kind){e.next=4;break}throw new Bv(Lv.INVALID_PARAMS,"track should be a video MediaStreamTrack");case 4:return e.next=6,this._updateOriginMediaStreamTrack(t,n,!0);case 6:this.updateMediaStreamTrackResolution();case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"bindProcessorDestinationEvents",value:function(){var e=this;this.processorDestination.on(XE.ON_TRACK,function(){var t=u(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}if(t.t0=n!==e._mediaStreamTrack,!t.t0){t.next=7;break}return e._mediaStreamTrack=n,e._updatePlayerSource(),t.next=7,bS(e,kE.NEED_REPLACE_TRACK,e);case 7:t.next=15;break;case 9:if(t.t1=e._mediaStreamTrack!==e._originMediaStreamTrack,!t.t1){t.next=15;break}return e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource(),t.next=15,bS(e,kE.NEED_REPLACE_TRACK,e);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"unbindProcessorDestinationEvents",value:function(){this.processorDestination.removeAllListeners(XE.ON_TRACK)}},{key:"unbindProcessorContextEvents",value:function(){this.processorContext.removeAllListeners(QE.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(QE.REQUEST_CONSTRAINTS)}}]),n}(Jb)).prototype,"play",[lR,fR],Object.getOwnPropertyDescriptor(PR.prototype,"play"),PR.prototype),_b(PR.prototype,"stop",[dR],Object.getOwnPropertyDescriptor(PR.prototype,"stop"),PR.prototype),_b(PR.prototype,"setEnabled",[pR,hR,vR],Object.getOwnPropertyDescriptor(PR.prototype,"setEnabled"),PR.prototype),_b(PR.prototype,"setMuted",[mR,gR,ER],Object.getOwnPropertyDescriptor(PR.prototype,"setMuted"),PR.prototype),_b(PR.prototype,"setEncoderConfiguration",[_R,bR],Object.getOwnPropertyDescriptor(PR.prototype,"setEncoderConfiguration"),PR.prototype),_b(PR.prototype,"getStats",[yR],Object.getOwnPropertyDescriptor(PR.prototype,"getStats"),PR.prototype),_b(PR.prototype,"setBeautyEffect",[TR,SR],Object.getOwnPropertyDescriptor(PR.prototype,"setBeautyEffect"),PR.prototype),_b(PR.prototype,"getCurrentFrameData",[wR],Object.getOwnPropertyDescriptor(PR.prototype,"getCurrentFrameData"),PR.prototype),_b(PR.prototype,"getCurrentFrameImage",[RR],Object.getOwnPropertyDescriptor(PR.prototype,"getCurrentFrameImage"),PR.prototype),_b(PR.prototype,"setBitrateLimit",[OR],Object.getOwnPropertyDescriptor(PR.prototype,"setBitrateLimit"),PR.prototype),_b(PR.prototype,"setOptimizationMode",[IR],Object.getOwnPropertyDescriptor(PR.prototype,"setOptimizationMode"),PR.prototype),_b(PR.prototype,"setScalabiltyMode",[AR],Object.getOwnPropertyDescriptor(PR.prototype,"setScalabiltyMode"),PR.prototype),_b(PR.prototype,"updateMediaStreamTrackResolution",[kR],Object.getOwnPropertyDescriptor(PR.prototype,"updateMediaStreamTrackResolution"),PR.prototype),_b(PR.prototype,"pipe",[CR],Object.getOwnPropertyDescriptor(PR.prototype,"pipe"),PR.prototype),_b(PR.prototype,"unpipe",[NR],Object.getOwnPropertyDescriptor(PR.prototype,"unpipe"),PR.prototype),_b(PR.prototype,"close",[xR],Object.getOwnPropertyDescriptor(PR.prototype,"close"),PR.prototype),_b(PR.prototype,"replaceTrack",[DR],Object.getOwnPropertyDescriptor(PR.prototype,"replaceTrack"),PR.prototype),PR),YR=(LR=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),MR=Cy(),UR=Yb("CameraVideoTrack","_enabledMutex"),jR=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),FR=Cy(),BR=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),VR=Cy(),GR=Gb({argsMap:function(e){return[e.getTrackId()]}}),_b((WR=function(e){d(n,e);var t=p(n);function n(e,r,i,o,a,s){var f;return h(this,n),f=t.call(this,e,im(r.encoderConfig),o,a,s),Mp(l(f),"_config",void 0),Mp(l(f),"_originalConstraints",void 0),Mp(l(f),"_constraints",void 0),Mp(l(f),"_enabled",!0),Mp(l(f),"_deviceName","default"),Mp(l(f),"tryResumeVideoForIOS15WeChat",u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=_p()&&!Tp()&&wp()&&f._enabled&&!f._isClosed,!e.t0){e.next=5;break}return Jv.debug("[".concat(f.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),e.next=5,f.renewMediaStreamTrack();case 5:case"end":return e.stop()}}),e)})))),f._config=r,f._originalConstraints=i,f._constraints=i,f._deviceName=e.label,f._encoderConfig=im(f._config.encoderConfig),Zb.on(qb.IOS_15_INTERRUPTION_END,f.tryResumeVideoForIOS15WeChat),Zb.on(qb.IOS_INTERRUPTION_END,f.tryResumeVideoForIOS15WeChat),f.bindProcessorContextEvents(),f}return v(n,[{key:"__className__",get:function(){return"CameraVideoTrack"}},{key:"setDevice",value:function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jv.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),!this._enabled){e.next=36;break}return e.prev=1,e.next=4,Iy.getDeviceById(t);case 4:return n=e.sent,(r={}).video=KR({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop(),i=null,e.prev=8,e.next=11,yy(r,this.getTrackId());case 11:i=e.sent,e.next=23;break;case 14:return e.prev=14,e.t0=e.catch(8),Jv.error("[".concat(this.getTrackId(),"] setDevice failed"),e.t0.toString()),e.next=19,yy({video:this._constraints},this.getTrackId());case 19:return i=e.sent,e.next=22,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1);case 22:throw e.t0;case 23:return e.next=25,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1);case 25:this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t},e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(1),Jv.error("[".concat(this.getTrackId(),"] setDevice error"),e.t1.toString()),e.t1;case 34:e.next=46;break;case 36:return e.prev=36,e.next=39,Iy.getDeviceById(t);case 39:o=e.sent,this._deviceName=o.label,this._config.cameraId=t,this._constraints.deviceId={exact:t},e.next=46;break;case 43:throw e.prev=43,e.t2=e.catch(36),Jv.error("[".concat(this.getTrackId(),"] setDevice error"),e.t2.toString()),e.t2;case 46:Jv.info("[".concat(this.getTrackId(),"] setDevice success"));case 47:case"end":return e.stop()}}),e,this,[[1,31],[8,14],[36,43]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setEnabled",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(Jv.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){e.next=25;break}if(e.prev=5,!this.isExternalTrack){e.next=10;break}this._originMediaStreamTrack.enabled=!0,e.next=15;break;case 10:return e.next=12,yy({video:this._constraints},this.getTrackId());case 12:return r=e.sent,e.next=15,this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1);case 15:return e.next=17,bS(this,kE.NEED_ENABLE_TRACK,this);case 17:e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(5),Jv.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.t0.toString()),e.t0;case 22:this.updateMediaStreamTrackResolution(),Jv.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0),e.next=35;break;case 25:return this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1),e.prev=26,e.next=29,bS(this,kE.NEED_DISABLE_TRACK,this);case 29:e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(26),Jv.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t1.toString()),e.t1;case 34:Jv.info("[".concat(this.getTrackId(),"] setEnabled to false success"));case 35:case"end":return e.stop()}}),e,this,[[5,19],[26,31]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setEncoderConfiguration",value:function(){var e=u(c().mark((function e(t,n){var r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._enabled){e.next=2;break}throw new Bv(Lv.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");case 2:return t=im(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),(r=OS(this._config)).encoderConfig=t,i=sR(r),(fp()||pp()||Sp())&&(i.deviceId=void 0),Jv.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i)),e.prev=7,e.next=10,this._originMediaStreamTrack.applyConstraints(i);case 10:this.updateMediaStreamTrackResolution(),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),o=new Bv(Lv.UNEXPECTED_ERROR,e.t0.toString()),Jv.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o;case 17:return this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,-1===this._hints.indexOf(CE.SCREEN_TRACK)&&this.updateBitrateFromProfile(),e.prev=18,e.next=21,bS(this,kE.NEED_UPDATE_VIDEO_ENCODER,this);case 21:e.next=26;break;case 23:return e.prev=23,e.t1=e.catch(18),e.abrupt("return",e.t1.throw());case 26:case"end":return e.stop()}}),e,this,[[7,13],[18,23]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"_getDefaultPlayerConfig",value:function(){return{mirror:!0,fit:"cover"}}},{key:"onTrackEnded",value:function(){var e=this;if((pp()||Sp())&&this._enabled&&!this._isClosed&&Zb.duringInterruption){var t=function(){var n=u(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Zb.off(qb.IOS_INTERRUPTION_END,t),n.t0=e._enabled&&!e._isClosed,!n.t0){n.next=8;break}return Jv.debug("[".concat(e.getTrackId(),"] try capture camera media device for interrupted iOS device.")),n.next=6,e.setEnabled(!1);case 6:return n.next=8,e.setEnabled(!0);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();Zb.on(qb.IOS_INTERRUPTION_END,t)}else Jv.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(DE.TRACK_ENDED)}},{key:"renewMediaStreamTrack",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t||this._constraints,(r=Iy.searchDeviceIdByName(this._deviceName))&&!n.deviceId&&(n.deviceId={exact:r}),!this._enabled){e.next=9;break}return e.next=4,yy({video:n},this.getTrackId());case 4:return i=e.sent,this._constraints=n,e.next=8,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0);case 8:this.updateMediaStreamTrackResolution();case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){i(o(n.prototype),"close",this).call(this),Zb.off(qb.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),Zb.off(qb.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}},{key:"bindProcessorContextEvents",value:function(){var e=this;this.processorContext.on(QE.REQUEST_UPDATE_CONSTRAINTS,function(){var t=u(c().mark((function t(n,r,i){var o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o=Object.assign.apply(Object,[{},e._originalConstraints].concat(m(n))),t.next=4,e.renewMediaStreamTrack(o);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this.processorContext.on(QE.REQUEST_CONSTRAINTS,function(){var t=u(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e._originMediaStreamTrack.getSettings());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),n}(zR)).prototype,"setDevice",[LR,MR],Object.getOwnPropertyDescriptor(WR.prototype,"setDevice"),WR.prototype),_b(WR.prototype,"setEnabled",[UR,jR,FR],Object.getOwnPropertyDescriptor(WR.prototype,"setEnabled"),WR.prototype),_b(WR.prototype,"setEncoderConfiguration",[BR,VR],Object.getOwnPropertyDescriptor(WR.prototype,"setEncoderConfiguration"),WR.prototype),_b(WR.prototype,"close",[GR],Object.getOwnPropertyDescriptor(WR.prototype,"close"),WR.prototype),WR),JR=function(){function e(t,n){h(this,e),Mp(this,"uid",void 0),Mp(this,"_uintid",void 0),Mp(this,"_trust_in_room_",!0),Mp(this,"_trust_audio_enabled_state_",!0),Mp(this,"_trust_video_enabled_state_",!0),Mp(this,"_trust_audio_mute_state_",!0),Mp(this,"_trust_video_mute_state_",!0),Mp(this,"_audio_muted_",!1),Mp(this,"_video_muted_",!1),Mp(this,"_audio_enabled_",!0),Mp(this,"_video_enabled_",!0),Mp(this,"_audio_added_",!1),Mp(this,"_video_added_",!1),Mp(this,"_trust_video_stream_added_state_",!0),Mp(this,"_trust_audio_stream_added_state_",!0),Mp(this,"_audioTrack",void 0),Mp(this,"_videoTrack",void 0),Mp(this,"_audioSSRC",void 0),Mp(this,"_videoSSRC",void 0),Mp(this,"_audioOrtc",void 0),Mp(this,"_videoOrtc",void 0),Mp(this,"_cname",void 0),Mp(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=n}return v(e,[{key:"hasVideo",get:function(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}},{key:"hasAudio",get:function(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}},{key:"audioTrack",get:function(){if(this.hasAudio)return this._audioTrack}},{key:"videoTrack",get:function(){if(this.hasVideo)return this._videoTrack}}]),e}(),XR=Ff,QR=Pu,$R=Gu;qn({target:"Promise",stat:!0},{try:function(e){var t=QR.f(this),n=$R(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var ZR=XR,eO=qn,tO=D,nO=S,rO=u_,iO=he,oO=at,aO=Qn,sO=wm,cO=g_,uO=$_,lO=Ae,fO=Rt("isConcatSpreadable"),dO=9007199254740991,pO="Maximum allowed index exceeded",hO=tO.TypeError,vO=lO>=51||!nO((function(){var e=[];return e[fO]=!1,e.concat()[0]!==e})),mO=uO("concat"),gO=function(e){if(!iO(e))return!1;var t=e[fO];return void 0!==t?!!t:rO(e)};eO({target:"Array",proto:!0,forced:!vO||!mO},{concat:function(e){var t,n,r,i,o,a=oO(this),s=cO(a,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(gO(o=-1===t?a:arguments[t])){if(c+(i=aO(o))>dO)throw hO(pO);for(n=0;n<i;n++,c++)n in o&&sO(s,c,o[n])}else{if(c>=dO)throw hO(pO);sO(s,c++,o)}return s.length=c,s}});var EO={},_O=te,bO=de,yO=Zr.f,TO=Cm,SO="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];EO.f=function(e){return SO&&"Window"==_O(e)?function(e){try{return yO(e)}catch(e){return TO(SO)}}(e):yO(bO(e))};var wO={},RO=Rt;wO.f=RO;var OO=ve,IO=ut,AO=wO,kO=dn.f,CO=function(e){var t=OO.Symbol||(OO.Symbol={});IO(t,e)||kO(t,e,{value:AO.f(e)})},NO=qn,xO=D,DO=be,PO=j,LO=q,MO=C,UO=V,jO=Ne,FO=S,BO=ut,VO=u_,GO=F,WO=he,qO=N,HO=je,KO=En,zO=at,YO=de,JO=Mt,XO=Qo,QO=Q,$O=Zi,ZO=Di,eI=Zr,tI=EO,nI=_i,rI=B,iI=dn,oI=Ci,aI=H,sI=Pc,cI=is,uI=Qe.exports,lI=ui,fI=ht,dI=Rt,pI=wO,hI=CO,vI=Ts,mI=Xa,gI=R_.forEach,EI=Pr("hidden"),_I="Symbol",bI=dI("toPrimitive"),yI=mI.set,TI=mI.getterFor(_I),SI=Object.prototype,wI=xO.Symbol,RI=wI&&wI.prototype,OI=xO.TypeError,II=xO.QObject,AI=DO("JSON","stringify"),kI=rI.f,CI=iI.f,NI=tI.f,xI=aI.f,DI=MO([].push),PI=uI("symbols"),LI=uI("op-symbols"),MI=uI("string-to-symbol-registry"),UI=uI("symbol-to-string-registry"),jI=uI("wks"),FI=!II||!II.prototype||!II.prototype.findChild,BI=UO&&FO((function(){return 7!=$O(CI({},"a",{get:function(){return CI(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=kI(SI,t);r&&delete SI[t],CI(e,t,n),r&&e!==SI&&CI(SI,t,r)}:CI,VI=function(e,t){var n=PI[e]=$O(RI);return yI(n,{type:_I,tag:e,description:t}),UO||(n.description=t),n},GI=function e(t,n,r){t===SI&&e(LI,n,r),KO(t);var i=JO(n);return KO(r),BO(PI,i)?(r.enumerable?(BO(t,EI)&&t[EI][i]&&(t[EI][i]=!1),r=$O(r,{enumerable:QO(0,!1)})):(BO(t,EI)||CI(t,EI,QO(1,{})),t[EI][i]=!0),BI(t,i,r)):CI(t,i,r)},WI=function(e,t){KO(e);var n=YO(t),r=ZO(n).concat(zI(n));return gI(r,(function(t){UO&&!LO(qI,n,t)||GI(e,t,n[t])})),e},qI=function(e){var t=JO(e),n=LO(xI,this,t);return!(this===SI&&BO(PI,t)&&!BO(LI,t))&&(!(n||!BO(this,t)||!BO(PI,t)||BO(this,EI)&&this[EI][t])||n)},HI=function(e,t){var n=YO(e),r=JO(t);if(n!==SI||!BO(PI,r)||BO(LI,r)){var i=kI(n,r);return!i||!BO(PI,r)||BO(n,EI)&&n[EI][r]||(i.enumerable=!0),i}},KI=function(e){var t=NI(YO(e)),n=[];return gI(t,(function(e){BO(PI,e)||BO(lI,e)||DI(n,e)})),n},zI=function(e){var t=e===SI,n=NI(t?LI:YO(e)),r=[];return gI(n,(function(e){!BO(PI,e)||t&&!BO(SI,e)||DI(r,PI[e])})),r};if(jO||(cI(RI=(wI=function(){if(qO(RI,this))throw OI("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?XO(arguments[0]):void 0,t=fI(e),n=function e(n){this===SI&&LO(e,LI,n),BO(this,EI)&&BO(this[EI],t)&&(this[EI][t]=!1),BI(this,t,QO(1,n))};return UO&&FI&&BI(SI,t,{configurable:!0,set:n}),VI(t,e)}).prototype,"toString",(function(){return TI(this).tag})),cI(wI,"withoutSetter",(function(e){return VI(fI(e),e)})),aI.f=qI,iI.f=GI,oI.f=WI,rI.f=HI,eI.f=tI.f=KI,nI.f=zI,pI.f=function(e){return VI(dI(e),e)},UO&&CI(RI,"description",{configurable:!0,get:function(){return TI(this).description}})),NO({global:!0,wrap:!0,forced:!jO,sham:!jO},{Symbol:wI}),gI(ZO(jI),(function(e){hI(e)})),NO({target:_I,stat:!0,forced:!jO},{for:function(e){var t=XO(e);if(BO(MI,t))return MI[t];var n=wI(t);return MI[t]=n,UI[n]=t,n},keyFor:function(e){if(!HO(e))throw OI(e+" is not a symbol");if(BO(UI,e))return UI[e]},useSetter:function(){FI=!0},useSimple:function(){FI=!1}}),NO({target:"Object",stat:!0,forced:!jO,sham:!UO},{create:function(e,t){return void 0===t?$O(e):WI($O(e),t)},defineProperty:GI,defineProperties:WI,getOwnPropertyDescriptor:HI}),NO({target:"Object",stat:!0,forced:!jO},{getOwnPropertyNames:KI,getOwnPropertySymbols:zI}),NO({target:"Object",stat:!0,forced:FO((function(){nI.f(1)}))},{getOwnPropertySymbols:function(e){return nI.f(zO(e))}}),AI&&NO({target:"JSON",stat:!0,forced:!jO||FO((function(){var e=wI();return"[null]"!=AI([e])||"{}"!=AI({a:e})||"{}"!=AI(Object(e))}))},{stringify:function(e,t,n){var r=sI(arguments),i=t;if((WO(t)||void 0!==e)&&!HO(e))return VO(t)||(t=function(e,t){if(GO(i)&&(t=LO(i,this,e,t)),!HO(t))return t}),r[1]=t,PO(AI,null,r)}}),!RI[bI]){var YI=RI.valueOf;cI(RI,bI,(function(e){return LO(YI,this)}))}vI(wI,_I),lI[EI]=!0,CO("asyncIterator"),CO("hasInstance"),CO("isConcatSpreadable"),CO("iterator"),CO("match"),CO("matchAll"),CO("replace"),CO("search"),CO("species"),CO("split"),CO("toPrimitive"),CO("toStringTag"),CO("unscopables"),Ts(D.JSON,"JSON",!0);var JI=ve.Symbol;CO("asyncDispose"),CO("dispose"),CO("matcher"),CO("metadata"),CO("observable"),CO("patternMatch"),CO("replaceAll");var XI=JI,QI=wO.f("asyncIterator"),$I=QI;function ZI(e){this.wrapped=e}function eA(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof ZI;ZR.resolve(s?a.wrapped:a).then((function(e){s?r("return"===t?"return":"next",e):i(o.done?"return":"normal",e)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new ZR((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function tA(e){return function(){return new eA(e.apply(this,arguments))}}function nA(e){return new ZI(e)}eA.prototype["function"==typeof XI&&$I||"@@asyncIterator"]=function(){return this},eA.prototype.next=function(e){return this._invoke("next",e)},eA.prototype.throw=function(e){return this._invoke("throw",e)},eA.prototype.return=function(e){return this._invoke("return",e)};var rA=wO.f("iterator");function iA(e,t){var n={},r=!1;function i(n,i){return r=!0,i=new ZR((function(t){t(e[n](i))})),{done:!1,value:t(i)}}return n[void 0!==XI&&rA||"@@iterator"]=function(){return this},n.next=function(e){return r?(r=!1,e):i("next",e)},"function"==typeof e.throw&&(n.throw=function(e){if(r)throw r=!1,e;return i("throw",e)}),"function"==typeof e.return&&(n.return=function(e){return r?(r=!1,e):i("return",e)}),n}var oA=QI,aA={exports:{}};function sA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sA(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function uA(e,t,n,r,i,o,a){var s=[],c=[],u=[],l=[],f=!1,d=!1;if(aA.exports.parse(e).mediaDescriptions.forEach((function(e){a&&a!==e.attributes.direction||("video"!==e.media.mediaType||f||(c=e.attributes.payloads,l=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||d||(s=e.attributes.payloads,u=e.attributes.extmaps,d=!0))})),!l||0===c.length)throw new Error("Cannot get video capabilities from SDP.");if(!u||0===s.length)throw new Error("Cannot get audio capabilities from SDP.");return c.forEach((function(e){var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate))})),s.forEach((function(e){var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate))})),t&&(s=s.filter((function(e){var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),c=c.filter((function(e){var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),n&&(c=c.filter((function(e){var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),r&&(s=s.filter((function(e){var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),i&&(null==i?void 0:i.length)>0&&(s=s.filter((function(e){var t;return i.includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),o&&(null==o?void 0:o.length)>0&&(c=c.filter((function(e){var t;return o.includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),{audioCodecs:s,videoCodecs:c,audioExtensions:u,videoExtensions:l}}function lA(e){var t,n,r,i=aA.exports.parse(e),o=s(i.mediaDescriptions);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(!t){var c=a.attributes.iceUfrag,u=a.attributes.icePwd;if(!c||!u)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:c,icePwd:u}}if(!n){var l=a.attributes.fingerprints;l.length>0&&(n={fingerprints:l})}}}catch(f){o.e(f)}finally{o.f()}if(!n&&i.attributes.fingerprints.length>0&&(n={fingerprints:i.attributes.fingerprints}),!n||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:n}}function fA(e,t){var n=[],r=e.attributes.ssrcGroups.filter((function(e){return"FID"===e.semantic})),i=e.attributes.ssrcGroups.find((function(e){return"SIM"===e.semantic})),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((function(e){var i,o=null===(i=r.find((function(t){return t.ssrcIds[0]===e})))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})}));else if(r.length>0){var a=r[0].ssrcIds[0],s=r[0].ssrcIds[1];n.push({ssrcId:a,rtx:t?s:void 0})}else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function dA(e,t){var n,r=e.cname;t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],Jv.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),Jv.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=e.iceParameters.candidates.map((function(e){return{foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}}}));var i,o={fingerprints:e.dtlsParameters.fingerprints.map((function(e){return{hashFunction:e.algorithm,fingerprint:e.fingerprint}}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};switch(e.dtlsParameters.role){case"server":i="passive";break;case"client":i="active";break;case"auto":i="actpass"}return{dtlsParameters:o,iceParameters:a,candidates:n,rtpCapabilities:SA(e.rtpCapabilities),setup:i,cname:r}}function pA(e,t,n){var r=[],i=[];return e.forEach((function(e){var o=e.ssrcId,a=e.rtx,s=hS(8,"track-"),c={ssrcId:o,attributes:cA({label:s,mslabel:n=n||hS(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(c),void 0!==a){var u={ssrcId:a,attributes:cA({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(u),i.push({semantic:"FID",ssrcIds:[o,a]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((function(e){return e.ssrcId}))}),{ssrcs:r,ssrcGroups:i}}function hA(e,t){t instanceof FT&&e.attributes.payloads.forEach((function(e){var n,r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(r&&-1!==["opus","pcmu","pcma","g722"].indexOf(r)){e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";var i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!dp()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}}))}function vA(e){var t=e.attributes.unrecognized.findIndex((function(e){return"x-google-flag"===e.attField&&"conference"===e.attValue}));-1!==t&&e.attributes.unrecognized.splice(t,1)}function mA(e,t){if(t instanceof zR&&t._encoderConfig&&-1===t._hints.indexOf(CE.SCREEN_TRACK)){var n=t._encoderConfig;s_().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach((function(e){var t;["h264","vp8","vp9","av1"].includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))})),s_().supportMinBitrate&&!t._hints.includes(CE.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach((function(e){var t;["h264","vp8","vp9","av1"].includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(lm("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))}))}}function gA(e){if("video"===e.media.mediaType){var t=rp();if(t.name===Qd.SAFARI||t.os===Xd.IOS){var n=e.attributes.extmaps.findIndex((function(e){return/video-orientation/g.test(e.extensionName)}));-1!==n&&e.attributes.extmaps.splice(n,1)}}}function EA(e,t,n){if(t){var r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){var o=r.find((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName}));o&&(e.attributes.extmaps.find((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName}))||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(e,t){return t.filter((function(t){return!!e.find((function(e){return e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((function(e){return"transport-cc"===e.type}))}))}))}(i,e.attributes.payloads).forEach((function(e){e.rtcpFeedbacks.find((function(e){return"transport-cc"===e.type}))||e.rtcpFeedbacks.push({type:"transport-cc"})})))}else if(!1===t.twcc){var a=e.attributes.extmaps.findIndex((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName}));-1!==a&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"transport-cc"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){var s=r.find((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName}));s&&(e.attributes.extmaps.find((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName}))||e.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(e,t){return t.filter((function(t){return!!e.find((function(e){return e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((function(e){return"goog-remb"===e.type}))}))}))}(i,e.attributes.payloads).forEach((function(e){e.rtcpFeedbacks.find((function(e){return"goog-remb"===e.type}))||e.rtcpFeedbacks.push({type:"goog-remb"})})))}else if(!1===t.remb){var c=e.attributes.extmaps.findIndex((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName}));-1!==c&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"goog-remb"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}}function _A(e,t,n){if(!dp()&&"video"===e.media.mediaType&&t instanceof zR&&("vp9"===n||"vp8"===n)&&("vp8"!==n||lm("SIMULCAST"))&&!(void 0===t._scalabiltyMode||t._scalabiltyMode.numSpatialLayers<=1)){for(var r="vp8"===n?2:t._scalabiltyMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((function(e){return"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId})),a={semantic:"SIM",ssrcIds:[i.ssrcId]},s=1;s<r;s++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+s,attributes:OS(i.attributes)}),a.ssrcIds.push(i.ssrcId+s),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+s,attributes:OS(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+s,o.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(a)}}function bA(e,t,n,r,i){return yA.apply(this,arguments)}function yA(){return yA=u(c().mark((function e(t,n,r,i,o){var a,s,u,l,f,d,p,h,v,m;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new RTCPeerConnection).addTransceiver("video",{direction:"sendonly"}),a.addTransceiver("audio",{direction:"sendonly"}),a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),e.next=4,a.createOffer();case 4:s=e.sent.sdp,u=uA(s,t,n,r,i,o,"sendonly"),l=uA(s,t,n,r,i,o,"recvonly"),TA(u,l,"videoExtensions",f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}),TA(u,l,"videoCodecs",f,d,p),TA(u,l,"audioExtensions",f,d,p),TA(u,l,"audioCodecs",f,d,p),lm("RAISE_H264_BASELINE_PRIORITY")&&(h=p.videoCodecs.findIndex((function(e){var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])})),-1!==h&&(v=p.videoCodecs.findIndex((function(e){var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())})),v<h&&(Jv.debug("raising H264 baseline profile priority"),m=p.videoCodecs[h],p.videoCodecs.splice(h,1),p.videoCodecs.splice(v,0,m)),-1!==v&&(d.videoCodecs=d.videoCodecs.filter((function(e){var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==v&&lm("FILTER_SEND_H264_BASELINE")&&(f.videoCodecs=f.videoCodecs.filter((function(e){var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))));try{a.close()}catch(t){}return e.abrupt("return",{send:f,recv:d,sendrecv:p});case 13:case"end":return e.stop()}}),e)}))),yA.apply(this,arguments)}function TA(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){var a=[];return e[n].forEach((function(e){t[n].some((function(t,n){if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach((function(e,t){-1===a.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){var s=[];return e[n].forEach((function(e){t[n].some((function(t,n){if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach((function(e,t){-1===s.indexOf(t)&&i[n].push(e)}))}}function SA(e){var t,n,r=e.send,i=e.recv,o=e.sendrecv;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}return r?((t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[].concat(m(r.audioCodecs),m(o.audioCodecs)),t.videoCodecs=[].concat(m(r.videoCodecs),m(o.videoCodecs)),t.audioExtensions=[].concat(m(r.audioExtensions),m(o.audioExtensions)),t.videoExtensions=[].concat(m(r.videoExtensions),m(o.videoExtensions))):t=o,i?((n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[].concat(m(i.audioCodecs),m(o.audioCodecs)),n.videoCodecs=[].concat(m(i.videoCodecs),m(o.videoCodecs)),n.audioExtensions=[].concat(m(i.audioExtensions),m(o.audioExtensions)),n.videoExtensions=[].concat(m(i.videoExtensions),m(o.videoExtensions))):n=o,{send:t,recv:n}}function wA(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((function(e){var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((function(e){e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}!function(e,t){e.exports=function(){var e={8:function(e,t,n){n.r(t),n.d(t,{Parser:function(){return C},Printer:function(){return L},parse:function(){return F},print:function(){return B}});var r,i="\n",o="".concat("\r").concat(i),c=" ";function u(e){return e>="0"&&e<="9"}function f(e){return e>="!"&&e<="~"}function m(e){return f(e)||e>="\x80"&&e<="\xff"}function E(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function _(e){return e>="1"&&e<="9"}function b(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function y(e){return"d"===e||"h"===e||"m"===e||"s"===e}function T(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function S(e){return b(e)||u(e)||"+"===e||"/"===e}function w(e){return u(e)||b(e)||"+"===e||"/"===e||"-"===e||"_"===e}function R(e){return b(e)||u(e)||"+"===e||"/"===e}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(r||(r={}));var k=function(){function e(){h(this,e)}return v(e,[{key:"consumeText",value:function(e,t){for(var n=t;n<e.length;){var r=e[n];if("\0"===r||"\r"===r||r===i)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}},{key:"consumeUnicastAddress",value:function(e,t,n){return this.consumeTill(e,t,c)}},{key:"consumeOneOrMore",value:function(e,t,n){for(var r=t;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}},{key:"consumeSpace",value:function(e,t){if(e[t]===c)return t+1;throw new Error("Invalid space at ".concat(t,"."))}},{key:"consumeIP4Address",value:function(e,t){for(var n=t,r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}},{key:"consumeDecimalUChar",value:function(e,t){for(var n=t,r=0;r<3&&u(e[n]);r++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");var i=parseInt(e.slice(t,n));if(i>=0&&i<=255)return n;throw new Error("Invalid decimal uchar")}},{key:"consumeIP6Address",value:function(e,t){var n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n)):n}},{key:"consumeHexpart",value:function(e,t){var n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(":"===e[n=this.consumeHexseq(e,n)]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}},{key:"consumeHexseq",value:function(e,t){for(var n=t;":"===e[n=this.consumeHex4(e,n)]&&":"!==e[n+1];)n+=1;return n}},{key:"consumeHex4",value:function(e,t){for(var n,r=0;r<4;r++)if(!((n=e[t+r])>="0"&&n<="9"||n>="a"&&n<="f"||n>="A"&&n<="F")){if(0===r)throw new Error("Invalid hex 4");break}return t+r}},{key:"consumeFQDN",value:function(e,t){for(var n=t;u(e[n])||b(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}},{key:"consumeExtnAddr",value:function(e,t){return this.consumeOneOrMore(e,t,m)}},{key:"consumeMulticastAddress",value:function(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}},{key:"consumeIP6MulticastAddress",value:function(e,t){var n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}},{key:"consumeIP4MulticastAddress",value:function(e,t){var n=t+3,r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(var o=0;o<3;o++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),"/"===e[n=this.consumeTTL(e,n)]&&(n=this.consumeInteger(e,n)),n}},{key:"consumeInteger",value:function(e,t){if(!_(e[t]))throw new Error("Invalid integer.");for(t+=1;u(e[t]);)t+=1;return t}},{key:"consumeTTL",value:function(e,t){if("0"===e[t])return t+1;if(!_(e[t]))throw new Error("Invalid TTL.");t+=1;for(var n=0;n<2&&u(e[t]);n++)t+=1;return t}},{key:"consumeToken",value:function(e,t){return this.consumeOneOrMore(e,t,E)}},{key:"consumeTime",value:function(e,t){var n=t;if("0"===e[n])return n+1;for(_(e[n])&&(n+=1);u(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}},{key:"consumeAddress",value:function(e,t){return this.consumeTill(e,t,c)}},{key:"consumeTypedTime",value:function(e,t){var n=t;return y(e[n=this.consumeOneOrMore(e,n,u)])?n+1:n}},{key:"consumeRepeatInterval",value:function(e,t){if(!_(e[t]))throw new Error("Invalid repeat interval");for(t+=1;u(e[t]);)t+=1;return y(e[t])&&(t+=1),t}},{key:"consumePort",value:function(e,t){return this.consumeOneOrMore(e,t,u)}},{key:"consume",value:function(e,t,n){for(var r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}},{key:"consumeTill",value:function(e,t,n){for(var r=t;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}]),e}(),C=function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.call(this),A(l(e),"records",[]),A(l(e),"currentLine",0),e}return v(n,[{key:"parse",value:function(e){var t=this.probeEOL(e);this.records=e.split(t).filter((function(e){return!!e.trim()})).map(this.parseLine),this.currentLine=0;var n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),a=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),u=this.parseConnection(),l=this.parseBandWidth(),f=this.parseTimeFields(),d=this.parseKey(),p=this.parseSessionAttribute(),h=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:a,emails:s,phones:c,connection:u,bandwidths:l,timeFields:f,key:d,attributes:p,mediaDescriptions:h}}},{key:"getCurrentRecord",value:function(){var e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}},{key:"probeEOL",value:function(e){for(var t=0;t<e.length;t++)if(e[t]===i)return"\r"===e[t-1]?o:i;throw new Error("Invalid newline character.")}},{key:"parseLine",value:function(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");var n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}},{key:"parseSessionAttribute",value:function(){for(var e=new x;this.currentLine<this.records.length;){var t=this.getCurrentRecord();if(t.type!==r.ATTRIBUTE)break;var n={attField:this.extractOneOrMore(t,(function(e){return E(e)&&":"!==e})),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,T)),e.parse(n),this.currentLine++}return e.digest()}},{key:"parseMediaAttributes",value:function(e){for(var t=new D(e);this.currentLine<this.records.length;){var n=this.getCurrentRecord();if(n.type!==r.ATTRIBUTE)break;var i={attField:this.extractOneOrMore(n,(function(e){return E(e)&&":"!==e})),_cur:0};":"===n.value[n.cur]&&(n.cur+=1,i.attValue=this.extractOneOrMore(n,T)),t.parse(i),this.currentLine++}return t.digest()}},{key:"parseKey",value:function(){var e=this.getCurrentRecord();if(e.type===r.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}},{key:"parseZone",value:function(){var e=this.getCurrentRecord();if(e.type===r.ZONE_ADJUSTMENTS){for(var t=[];;)try{var n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);var i=!1;"-"===e.value[e.cur]&&(i=!0,e.cur+=1);var o=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:o,back:i})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}},{key:"parseRepeat",value:function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==r.REPEAT)break;var n=this.extract(t,this.consumeRepeatInterval),i=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:i}),this.currentLine++}return e}},{key:"parseTypedTime",value:function(e){for(var t=[];;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}},{key:"parseTime",value:function(){var e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);var n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}},{key:"parseBandWidth",value:function(){for(var e=[];this.currentLine<this.records.length;){var t=this.getCurrentRecord();if(t.type!==r.BANDWIDTH)break;var n=this.extractOneOrMore(t,E);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;var i=this.extractOneOrMore(t,u);e.push({bwtype:n,bandwidth:i}),this.currentLine++}return e}},{key:"parseVersion",value:function(){var e=this.getCurrentRecord();if(e.type!==r.VERSION)throw new Error("first sdp record must be version");var t=e.value.slice(0,this.consumeOneOrMore(e.value,0,u));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}},{key:"parseOrigin",value:function(){var e=this.getCurrentRecord();if(e.type!==r.ORIGIN)throw new Error("second line of sdp must be origin");var t=this.extractOneOrMore(e,m);this.consumeSpaceForRecord(e);var n=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);var i=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);var o=this.extractOneOrMore(e,E);this.consumeSpaceForRecord(e);var a=this.extractOneOrMore(e,E);this.consumeSpaceForRecord(e);var s=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:i,nettype:o,addrtype:a,unicastAddress:s}}},{key:"parseSessionName",value:function(){var e=this.getCurrentRecord();if(e.type===r.SESSION_NAME){var t=this.extract(e,this.consumeText);return this.currentLine++,t}}},{key:"parseInformation",value:function(){var e=this.getCurrentRecord();if(e.type===r.INFORMATION){var t=this.extract(e,this.consumeText);return this.currentLine++,t}}},{key:"parseUri",value:function(){var e=this.getCurrentRecord();if(e.type===r.URI)return this.currentLine++,e.value}},{key:"parseEmail",value:function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==r.EMAIL)break;e.push(t.value),this.currentLine++}return e}},{key:"parsePhone",value:function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==r.PHONE)break;e.push(t.value),this.currentLine++}return e}},{key:"parseConnection",value:function(){var e=this.getCurrentRecord();if(e.type===r.CONNECTION){var t=this.extractOneOrMore(e,E);this.consumeSpaceForRecord(e);var n=this.extractOneOrMore(e,E);this.consumeSpaceForRecord(e);var i=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:i}}}},{key:"parseMedia",value:function(){var e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);var n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);var r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");var i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}},{key:"parseTimeFields",value:function(){for(var e=[];this.getCurrentRecord().type===r.TIME;){var t=this.parseTime(),n=this.parseRepeat(),i=this.parseZone();e.push({time:t,repeats:n,zones:i})}return e}},{key:"parseMediaDescription",value:function(){for(var e=[];this.currentLine<this.records.length&&this.getCurrentRecord().type===r.MEDIA;){var t=this.parseMedia(),n=this.parseInformation(),i=this.parseConnections(),o=this.parseBandWidth(),a=this.parseKey(),s=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:i,bandwidths:o,key:a,attributes:s})}return e}},{key:"parseConnections",value:function(){for(var e=[];this.currentLine<this.records.length&&this.getCurrentRecord().type===r.CONNECTION;)e.push(this.parseConnection());return e}},{key:"parseFmt",value:function(e){for(var t=[];;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}},{key:"extract",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o=t.call.apply(t,[this,e.value,e.cur].concat(r)),a=e.value.slice(e.cur,o);return e.cur=o,a}},{key:"extractOneOrMore",value:function(e,t){var n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}},{key:"consumeSpaceForRecord",value:function(e){if(e.value[e.cur]!==c)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}]),n}(k),N=function(e){d(n,e);var t=p(n);function n(){var e;h(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),A(l(e),"attributes",void 0),A(l(e),"digested",!1),e}return v(n,[{key:"extractOneOrMore",value:function(e,t,n){var r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),o=a(n||[],2),s=o[0],c=o[1];if("number"==typeof s&&i.length<s)throw new Error("error in length, should be more or equal than ".concat(s," characters."));if("number"==typeof c&&i.length>c)throw new Error("error in length, should be less or equal than ".concat(c," characters."));return e._cur=r,i}},{key:"consumeAttributeSpace",value:function(e){if(e.attValue[e._cur]!==c)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}},{key:"extract",value:function(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o=t.call.apply(t,[this,e.attValue,e._cur].concat(r)),a=e.attValue.slice(e._cur,o);return e._cur=o,a}},{key:"atEnd",value:function(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}},{key:"peekChar",value:function(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}},{key:"peek",value:function(e,t){if(!e.attValue)throw new Error;for(var n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}},{key:"parseIceUfrag",value:function(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,S,[4,256])}},{key:"parseIcePwd",value:function(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,S,[22,256])}},{key:"parseIceOptions",value:function(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");for(var t=[];!this.atEnd(e);){t.push(this.extractOneOrMore(e,S));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}},{key:"parseFingerprint",value:function(e){var t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}},{key:"parseExtmap",value:function(e){var t,n=this.extractOneOrMore(e,u);"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),t=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeTill,c),i=I(I({entry:parseInt(n,10)},t&&{direction:t}),{},{extensionName:r});this.peekChar(e)===c&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}},{key:"parseSetup",value:function(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");var t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}]),n}(k),x=function(e){d(r,e);var n=p(r);function r(){var e;h(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A(l(e),"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]}),e}return v(r,[{key:"parse",value:function(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}},{key:"digest",value:function(){return this.digested=!0,this.attributes}},{key:"parseGroup",value:function(e){for(var t=this.extract(e,this.consumeToken),n=[];!this.atEnd(e)&&this.peekChar(e)===c;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}},{key:"parseIceLite",value:function(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}},{key:"parseTlsId",value:function(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,w)}},{key:"parseIdentity",value:function(e){for(var t=this.extractOneOrMore(e,R),n=[];!this.atEnd(e)&&this.peekChar(e)===c;){this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");var i=this.extractOneOrMore(e,(function(e){return e!==c&&T(e)}));n.push({name:r,value:i})}this.attributes.identities.push({assertionValue:t,extensions:n})}},{key:"parseMsidSemantic",value:function(e){this.peekChar(e)===c&&this.consumeAttributeSpace(e);for(var t={semantic:this.extract(e,this.consumeToken),identifierList:[]};;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}var n=this.extract(e,this.consumeTill,c);t.identifierList.push(n)}this.attributes.msidSemantic=t}}]),r}(N),D=function(e){d(r,e);var n=p(r);function r(e){var t;return h(this,r),t=n.call(this),A(l(t),"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),t.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]},t}return v(r,[{key:"parse",value:function(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}},{key:"parseCandidate",value:function(e){var t=this.extractOneOrMore(e,S,[1,32]);this.consumeAttributeSpace(e);var n=this.extractOneOrMore(e,u,[1,5]);this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var i=this.extractOneOrMore(e,u,[1,10]);this.consumeAttributeSpace(e);var o=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);var a=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);var s={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:o,port:a,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),s.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),s.relPort=this.extract(e,this.consumePort));this.peekChar(e)===c;){this.consumeAttributeSpace(e);var l=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),s.extension[l]=this.extractOneOrMore(e,f)}this.attributes.candidates.push(s)}},{key:"parseRemoteCandidate",value:function(e){for(var t=[];;){var n=this.extractOneOrMore(e,u,[1,5]);this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);var i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}},{key:"parseEndOfCandidates",value:function(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}},{key:"parseRtpmap",value:function(e){var t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");var r={encodingName:n,clockRate:this.extractOneOrMore(e,u)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));var i=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}},{key:"parsePtime",value:function(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}},{key:"parseMaxPtime",value:function(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}},{key:"parseDirection",value:function(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}},{key:"parseSSRC",value:function(e){var t=this.extractOneOrMore(e,u);this.consumeAttributeSpace(e);var n,r=this.extract(e,this.consumeTill,":");":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),n=this.extract(e,this.consumeTill));var i=this.attributes.ssrcs.find((function(e){return e.ssrcId===parseInt(t,10)}));i?i.attributes[r]=n:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:g({},r,n)})}},{key:"parseFmtp",value:function(e){var t=this.extract(e,this.consumeTill,c);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((function(e){var t=e.split("="),n=a(t,2),i=n[0],o=n[1];i=i.trim();var s="string"==typeof o?o.trim():null;"string"==typeof i&&i.length>0&&(r[i]=s)}));var i=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}},{key:"parseFmtParameters",value:function(e){var t={},n=this.extract(e,this.consumeTill,"=");e._cur++;var r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){var i=this.extract(e,this.consumeTill,"=");e._cur++;var o=this.extract(e,this.consumeTill,";");t[i]=o}return t}},{key:"parseRtcpFb",value:function(e){var t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,c),this.consumeAttributeSpace(e);var n,r=this.extract(e,this.consumeTill,c);if("trr-int"===r)n={type:r,interval:this.extract(e,this.consumeTill)};else{var i={type:r};this.peekChar(e)===c&&(this.consumeAttributeSpace(e),i.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===c&&(i.additional=this.extract(e,this.consumeTill))),n=i}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(n);else{var o=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));o?o.rtcpFeedbacks.push(n):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[n]})}}},{key:"parseRTCPMux",value:function(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}},{key:"parseRTCPMuxOnly",value:function(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}},{key:"parseRTCPRsize",value:function(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}},{key:"parseRTCP",value:function(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");var t={port:this.extract(e,this.consumePort)};this.peekChar(e)===c&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,E),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,E),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}},{key:"parseMsid",value:function(e){var t={id:this.extractOneOrMore(e,E,[1,64])};this.peekChar(e)===c&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,E,[1,64])),this.attributes.msids.push(t)}},{key:"parseImageAttr",value:function(e){this.attributes.imageattr.push(e.attValue)}},{key:"parseRid",value:function(e){var t=this.extractOneOrMore(e,(function(e){return b(e)||u(e)||"_"===e||"-"===e}));this.consumeAttributeSpace(e);var n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===c){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");for(var r=[];;){var i=this.extract(e,this.consumeToken);r.push(i);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=r,this.peekChar(e)===c&&this.extract(e,this.consume,c)}for(;;){var o=this.extract(e,this.consumeToken);if("depend"===o){var a={type:o,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(a)}else{var s={type:o};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),s.val=this.extract(e,this.consumeTill,";")),n.params.push(s)}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}},{key:"parseSimulcast",value:function(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}},{key:"parseSctpPort",value:function(e){this.attributes.sctpPort=this.extractOneOrMore(e,u,[1,5])}},{key:"parseMaxMessageSize",value:function(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,u,[1,void 0])}},{key:"digest",value:function(){return this.digested=!0,this.attributes}},{key:"parseMid",value:function(e){this.attributes.mid=this.extract(e,this.consumeToken)}},{key:"parseSSRCGroup",value:function(e){for(var t=this.extract(e,this.consumeToken),n=[];;)try{this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeInteger);n.push(parseInt(r,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}]),r}(N);function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=function(){function e(){h(this,e),P(this,"eol",o)}return v(e,[{key:"print",value:function(e,t){var n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions)}},{key:"printVersion",value:function(e){return"v=".concat(e).concat(this.eol)}},{key:"printOrigin",value:function(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}},{key:"printSessionName",value:function(e){return e?"s=".concat(e).concat(this.eol):""}},{key:"printInformation",value:function(e){return e?"i=".concat(e).concat(this.eol):""}},{key:"printUri",value:function(e){return e?"u=".concat(e).concat(this.eol):""}},{key:"printEmail",value:function(e){var t,n="",r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="e=".concat(i).concat(this.eol)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"printPhone",value:function(e){var t,n="",r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="e=".concat(i).concat(this.eol)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"printConnection",value:function(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}},{key:"printBandwidth",value:function(e){var t,n="",r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="b=".concat(i.bwtype,":").concat(i.bandwidth).concat(this.eol)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"printTimeFields",value:function(e){var t,n="",r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="t=".concat(i.time.startTime," ").concat(i.time.startTime).concat(this.eol);var o,a=s(i.repeats);try{for(a.s();!(o=a.n()).done;){var c=o.value;n+="r=".concat(c.repeatInterval," ").concat(c.typedTimes.join(" ")).concat(this.eol)}}catch(u){a.e(u)}finally{a.f()}i.zoneAdjustments&&(n+="z=",n+="z=".concat(i.zoneAdjustments.map((function(e){return"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)})).join(" ")).concat(this.eol),n+=this.eol)}}catch(u){r.e(u)}finally{r.f()}return n}},{key:"printKey",value:function(e){return e?"k=".concat(e).concat(this.eol):""}},{key:"printAttributes",value:function(e){var t,n="",r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="a=".concat(i.attField).concat(i.attValue?":".concat(i.attValue):"").concat(this.eol)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"printMediaDescription",value:function(e){var t,n="",r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+=this.printMedia(i.media),n+=this.printInformation(i.information),n+=this.printConnections(i.connections),n+=this.printBandwidth(i.bandwidths),n+=this.printKey(i.key),n+=this.printMediaAttributes(i)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"printConnections",value:function(e){var t,n="",r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+=this.printConnection(i)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"printMedia",value:function(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}},{key:"printSessionAttributes",value:function(e){return new U(this.eol).print(e)}},{key:"printMediaAttributes",value:function(e){return new j(this.eol).print(e)}}]),e}(),M=function(){function e(t){h(this,e),P(this,"eol",void 0),this.eol=t}return v(e,[{key:"printIceUfrag",value:function(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}},{key:"printIcePwd",value:function(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}},{key:"printIceOptions",value:function(e){return void 0===e?"":"a=ice-options:".concat(e.join(c)).concat(this.eol)}},{key:"printFingerprints",value:function(e){return e.length>0?e.map((function(e){return"a=fingerprint:".concat(e.hashFunction).concat(c).concat(e.fingerprint)})).join(this.eol)+this.eol:""}},{key:"printExtmap",value:function(e){var t=this;return e.map((function(e){return"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(c).concat(e.extensionName).concat(e.extensionAttributes?"".concat(c).concat(e.extensionAttributes):"").concat(t.eol)})).join("")}},{key:"printSetup",value:function(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}},{key:"printUnrecognized",value:function(e){var t=this;return e.map((function(e){return"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(t.eol)})).join("")}}]),e}(),U=function(e){d(n,e);var t=p(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"print",value:function(e){var t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized)}},{key:"printGroups",value:function(e){var t=this,n="";return e.length>0&&(n+=e.map((function(e){return"a=group:".concat(e.semantic).concat(e.identificationTag.map((function(e){return"".concat(c).concat(e)})).join("")).concat(t.eol)})).join("")),n}},{key:"printIceLite",value:function(e){return void 0===e?"":"a=ice-lite"+this.eol}},{key:"printTlsId",value:function(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}},{key:"printIdentity",value:function(e){return 0===e.length?"":e.map((function(e){return"a=identity:".concat(e.assertionValue).concat(e.extensions.map((function(e){return"".concat(c).concat(e.name).concat(e.value?"=".concat(e.value):"")})))})).join(this.eol)+this.eol}},{key:"printMsidSemantic",value:function(e){if(!e)return"";var t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(c,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((function(e){return"".concat(c).concat(e)}))),t+this.eol}}]),n}(M),j=function(e){d(n,e);var t=p(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"print",value:function(e){var t=e.attributes,n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized)}},{key:"printCandidates",value:function(e){var t=this;return e.map((function(e){return"a=candidate:".concat(e.foundation).concat(c).concat(e.componentId).concat(c).concat(e.transport).concat(c).concat(e.priority).concat(c).concat(e.connectionAddress).concat(c).concat(e.port).concat(c,"typ").concat(c).concat(e.type).concat(e.relAddr?"".concat(c,"raddr").concat(c).concat(e.relAddr):"").concat(e.relPort?"".concat(c,"rport").concat(c).concat(e.relPort):"").concat(Object.keys(e.extension).map((function(t){return"".concat(c).concat(t).concat(c).concat(e.extension[t])})).join("")).concat(t.eol)})).join("")}},{key:"printRemoteCandidatesList",value:function(e){var t=this;return e.map((function(e){return"a=remote-candidates:".concat(e.join(c)).concat(t.eol)})).join("")}},{key:"printEndOfCandidates",value:function(e){return void 0===e?"":"a=end-of-candidates"+this.eol}},{key:"printRTPRelated",value:function(e){var t=this;if(!e.payloads)return"";var n=e.payloads,r="";r+=e.rtcpFeedbackWildcards.map((function(e){return t.printRTCPFeedback("*",e)})).join("");var i,o=s(n);try{var a=function(){var e=i.value;r+=t.printRtpMap(e.payloadType,e.rtpMap),r+=t.printFmtp(e.payloadType,e.fmtp),r+=e.rtcpFeedbacks.map((function(n){return t.printRTCPFeedback(e.payloadType,n)})).join("")};for(o.s();!(i=o.n()).done;)a()}catch(c){o.e(c)}finally{o.f()}return r}},{key:"printFmtp",value:function(e,t){if(!t)return"";var n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(c).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(c).concat(Object.keys(t.parameters).map((function(e){return"".concat(e,"=").concat(t.parameters[e])})).join(";")).concat(this.eol)}},{key:"printRtpMap",value:function(e,t){return t?"a=rtpmap:".concat(e).concat(c).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}},{key:"printRTCPFeedback",value:function(e,t){var n="a=rtcp-fb:".concat(e).concat(c),r=t;return"trr-int"===r.type?n+="ttr-int".concat(c).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(c).concat(r.parameter),r.additional&&(n+="".concat(c).concat(r.additional)))),n+this.eol}},{key:"printPtime",value:function(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}},{key:"printMaxPtime",value:function(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}},{key:"printDirection",value:function(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}},{key:"printSSRC",value:function(e){var t=this;return e.map((function(e){return Object.keys(e.attributes).map((function(n){return"a=ssrc:".concat(e.ssrcId.toString(10)).concat(c).concat(n).concat(e.attributes[n]?":".concat(e.attributes[n]):"").concat(t.eol)})).join("")})).join("")}},{key:"printRTCPMux",value:function(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}},{key:"printRTCPMuxOnly",value:function(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}},{key:"printRTCPRsize",value:function(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}},{key:"printRTCP",value:function(e){if(void 0===e)return"";var t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(c).concat(e.netType)),e.addressType&&(t+="".concat(c).concat(e.addressType)),e.address&&(t+="".concat(c).concat(e.address)),t+this.eol}},{key:"printMSId",value:function(e){var t=this;return e.map((function(e){return"a=msid:".concat(e.id).concat(e.appdata?"".concat(c).concat(e.appdata):"").concat(t.eol)})).join("")}},{key:"printImageattr",value:function(e){var t=this;return e.map((function(e){return"a=imageattr:".concat(e).concat(t.eol)})).join("")}},{key:"printRid",value:function(e){var t=this;return e.map((function(e){var n="a=rid:".concat(e.id).concat(c).concat(e.direction);return e.payloads&&(n+="".concat(c,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(n+="".concat(c).concat(e.params.map((function(e){return"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)})).join(";"))),n+t.eol})).join("")}},{key:"printSimulcast",value:function(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}},{key:"printSCTPPort",value:function(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}},{key:"printMaxMessageSize",value:function(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}},{key:"printMid",value:function(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}},{key:"printSSRCGroups",value:function(e){var t=this;return e.map((function(e){return"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((function(e){return"".concat(c).concat(e.toString(10))})).join("")).concat(t.eol)})).join("")}}]),n}(M);function F(e){return(new C).parse(e)}function B(e,t){return(new L).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)}()}(aA);var RA=function(){function e(t){h(this,e),Mp(this,"sessionDesc",void 0),Mp(this,"localCapabilities",void 0),Mp(this,"rtpCapabilities",void 0),Mp(this,"candidates",void 0),Mp(this,"iceParameters",void 0),Mp(this,"dtlsParameters",void 0),Mp(this,"setup",void 0),Mp(this,"currentMidIndex",void 0),Mp(this,"cname",void 0);var n=t=OS(t),r=n.remoteIceParameters,i=n.remoteDtlsParameters,o=n.candidates,a=n.remoteRTPCapabilities,s=n.remoteSetup,c=n.localCapabilities,u=n.sdkCodec,l=n.cname,f=aA.exports.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=a,this.candidates=o,this.iceParameters=r,this.dtlsParameters=i,this.setup=s,this.localCapabilities=c,this.cname=l;for(var d=0;d<f.mediaDescriptions.length;d++){var p=f.mediaDescriptions[d];if(p.attributes.iceUfrag=r.iceUfrag,p.attributes.icePwd=r.icePwd,p.attributes.fingerprints=i.fingerprints,p.attributes.candidates=o,p.attributes.setup=s,"video"===p.media.mediaType){p.media.fmts=a.videoCodecs.map((function(e){return e.payloadType.toString(10)}));var v=a.videoCodecs.filter((function(e){var t;return null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase().includes(u)}));if(0===v.length)throw new Error("Codec ".concat(u," not supported by remote SDP."));p.attributes.payloads=v,p.attributes.extmaps=a.videoExtensions}"audio"===p.media.mediaType&&(p.media.fmts=a.audioCodecs.map((function(e){return e.payloadType.toString(10)})),p.attributes.payloads=a.audioCodecs,p.attributes.extmaps=a.audioExtensions),f.mediaDescriptions[d]=this.mungMediaDesc(p)}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}return v(e,[{key:"toString",value:function(){return aA.exports.print(this.sessionDesc)}},{key:"send",value:function(e,t,n){var r=pA(t,this.cname),i=r.ssrcs,o=r.ssrcGroups,a=this.sessionDesc.mediaDescriptions.find((function(t){return e===qE.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType})),s=i[0].attributes.label,c=i[0].attributes.mslabel;return a.attributes.ssrcs=a.attributes.ssrcs.concat(i),a.attributes.ssrcGroups=a.attributes.ssrcGroups.concat(o),{id:s,mslabel:c}}},{key:"batchSend",value:function(e){var t=this;return e.map((function(e){var n=e.kind,r=e.ssrcMsg;return t.send(n,r,void 0)}))}},{key:"stopSending",value:function(e){this.sessionDesc.mediaDescriptions.forEach((function(t){var n=[],r=[],i=[];t.attributes.ssrcs.forEach((function(t){e.includes(t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((function(e){i.map((function(e){return e.ssrcId})).includes(e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}},{key:"mute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}},{key:"unmute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}},{key:"receive",value:function(e,t,n){var r=this;e.forEach((function(e,t){var n=e._mediaStreamTrack,i=r.sessionDesc.mediaDescriptions.findIndex((function(e){return e.attributes.mid===n.kind})),o=r.mungRecvMediaDsec(r.sessionDesc.mediaDescriptions[i],e);r.sessionDesc.mediaDescriptions[i]=o}))}},{key:"stopReceiving",value:function(e){}},{key:"restartICE",value:function(e){e=OS(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}},{key:"predictReceivingMids",value:function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}},{key:"mungRecvMediaDsec",value:function(e,t){var n=OS(e);return hA(n,t),mA(n,t),n}},{key:"updateRecvMedia",value:function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}},{key:"bumpMid",value:function(e){this.currentMidIndex+=e}},{key:"updateTrackLabel",value:function(e,t,n){var r=this.sessionDesc.mediaDescriptions.find((function(t){return e===qE.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid}));if(r){var i,o=r.attributes.ssrcs.find((function(e){return e.attributes.label===t}));o&&(o.attributes.label=n,null===(i=o.attributes.msid)||void 0===i||i.replace(t,n))}}},{key:"mungMediaDesc",value:function(e){var t=OS(e);return vA(t),function(e){var t=e.attributes.extmaps.find((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName}));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"transport-cc"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}},{key:"getSSRC",value:function(e){var t,n=s(this.sessionDesc.mediaDescriptions);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,o=s(i.attributes.ssrcs);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(a.attributes.label===e)return[a]}}catch(c){o.e(c)}finally{o.f()}}}catch(c){n.e(c)}finally{n.f()}}}]),e}();function OA(e){if(Array.isArray(e))return e.map((function(e){return e}));if(!IA(e))return e;var t={};for(var n in e)IA(e[n])||Array.isArray(e[n])?t[n]=OA(e[n]):t[n]=e[n];return t}function IA(e){return!("object"!=typeof e||Array.isArray(e)||!e)}function AA(){var e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}function kA(e){return!!window.RTCStatsReport&&e.getStats()instanceof Bf}var CA=function(){function e(t){h(this,e),Mp(this,"input",[]),Mp(this,"size",void 0),this.size=t}return v(e,[{key:"add",value:function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}},{key:"diffMean",value:function(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}]),e}(),NA={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},xA={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:NA,remoteCandidate:NA}},DA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},PA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},LA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},MA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0},UA=function(){function e(t,n){var r=this;h(this,e),Mp(this,"onFirstVideoReceived",void 0),Mp(this,"onFirstVideoDecoded",void 0),Mp(this,"onFirstAudioReceived",void 0),Mp(this,"onFirstVideoDecodedTimeout",void 0),Mp(this,"onFirstAudioDecoded",void 0),Mp(this,"onSelectedLocalCandidateChanged",void 0),Mp(this,"onSelectedRemoteCandidateChanged",void 0),Mp(this,"videoIsReady",!1),Mp(this,"videoIsReady2",{}),Mp(this,"pc",void 0),Mp(this,"options",void 0),Mp(this,"intervalTimer",void 0),Mp(this,"stats",OA(xA)),Mp(this,"isFirstVideoReceived",{}),Mp(this,"isFirstVideoDecoded",{}),Mp(this,"isFirstAudioReceived",{}),Mp(this,"isFirstAudioDecoded",{}),Mp(this,"isFirstVideoDecodedTimeout",{}),Mp(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.updateStats();case 1:case"end":return e.stop()}}),e)}))),this.options.updateInterval)}return v(e,[{key:"getStats",value:function(){return this.stats}},{key:"setVideoIsReady",value:function(e){this.videoIsReady=e}},{key:"setVideoIsReady2",value:function(e,t){this.videoIsReady2[e]=t}},{key:"getVideoIsReady",value:function(e){return this.videoIsReady2[e]||!1}},{key:"setIsFirstAudioDecoded",value:function(e){}},{key:"destroy",value:function(){window.clearInterval(this.intervalTimer),this.pc=void 0}},{key:"calcLossRate",value:function(e){var t=this;this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var n=this.lossRateWindowStats.length,r=0,i=0,o=0,a=0,s=function(){var s=u[c];e[s].forEach((function(e,c){if(t.lossRateWindowStats[n-1][s][c]&&t.lossRateWindowStats[0][s][c]){var u=t.lossRateWindowStats[n-1][s][c].packets-t.lossRateWindowStats[0][s][c].packets,l=t.lossRateWindowStats[n-1][s][c].packetsLost-t.lossRateWindowStats[0][s][c].packetsLost;"videoSend"===s||"audioSend"===s?(r+=u,o+=l):(i+=u,a+=l),Number.isNaN(u)||Number.isNaN(u)?e.packetLostRate=0:e.packetLostRate=u<=0||l<=0?0:l/(u+l)}}))},c=0,u=["videoSend","audioSend","videoRecv","audioRecv"];c<u.length;c++)s();e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}}]),e}();function jA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function FA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jA(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var BA=function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.apply(this,arguments),Mp(l(e),"_stats",xA),Mp(l(e),"lastDecodeVideoReceiverStats",new Map),e}return v(n,[{key:"updateStats",value:function(){var e=u(c().mark((function e(){var t,n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStats();case 2:t=e.sent,n=this.statsResponsesToObjects(t),this._stats=OA(xA),r=n.filter((function(e){return"ssrc"===e.type})),this.processSSRCStats(r),i=n.find((function(e){return"VideoBwe"===e.type})),i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processBandwidthStats",value:function(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}},{key:"processSSRCStats",value:function(e){var t=this;e.forEach((function(e){var n=e.id.includes("send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":var r=OA(PA);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),t._stats.videoSend.push(r),t._stats.rtt=r.rttMs;break;case"video_recv":var i=OA(DA),o=t.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(i.codec=e.googCodecName,i.targetDelayMs=Number(e.googTargetDelayMs),i.renderDelayMs=Number(e.googRenderDelayMs),i.currentDelayMs=Number(e.googCurrentDelayMs),i.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),i.decodeMs=Number(e.googDecodeMs),i.maxDecodeMs=Number(e.googMaxDecodeMs),i.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},i.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},i.decodeFrameRate=Number(e.googFrameRateDecoded),i.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},i.jitterBufferMs=Number(e.googJitterBufferMs),i.firsCount=Number(e.googFirsSent),i.nacksCount=Number(e.googNacksSent),i.plisCount=Number(e.googPlisSent),i.framesDecodeCount=Number(e.framesDecoded),i.bytes=Number(e.bytesReceived),i.packets=Number(e.packetsReceived),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.packets>0&&!t.isFirstVideoReceived[i.ssrc]&&(t.onFirstVideoReceived&&t.onFirstVideoReceived(i.ssrc),t.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!t.isFirstVideoDecoded[i.ssrc]&&(t.onFirstVideoDecoded&&t.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),t.isFirstVideoDecoded[i.ssrc]=!0),o){var a=o.stats,s=Date.now()-o.lts;i.framesDecodeFreezeTime=a.framesDecodeFreezeTime,i.framesDecodeInterval=a.framesDecodeInterval,i.framesDecodeCount>a.framesDecodeCount&&t.isFirstVideoDecoded[i.ssrc]?(o.lts=Date.now(),i.framesDecodeInterval=s,i.framesDecodeInterval>=t.options.freezeRateLimit&&(t.getVideoIsReady(parseInt(e.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:t.setVideoIsReady2(parseInt(e.ssrc,10),!0))):i.framesDecodeCount<o.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}t.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:FA({},i),lts:Date.now()}),t._stats.videoRecv.push(i);break;case"audio_recv":var c=OA(MA);c.codec=e.googCodecName,c.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,c.decodingCNG=Number(e.googDecodingCNG),c.decodingCTN=Number(e.googDecodingCTN),c.decodingCTSG=Number(e.googDecodingCTSG),c.decodingNormal=Number(e.googDecodingNormal),c.decodingPLC=Number(e.googDecodingPLC),c.decodingPLCCNG=Number(e.googDecodingPLCCNG),c.expandRate=Number(e.googExpandRate),c.accelerateRate=Number(e.googAccelerateRate),c.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),c.speechExpandRate=Number(e.googSpeechExpandRate),c.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),c.jitterBufferMs=Number(e.googJitterBufferMs),c.jitterMs=Number(e.googJitterReceived),c.bytes=Number(e.bytesReceived),c.packets=Number(e.packetsReceived),c.packetsLost=Number(e.packetsLost),c.ssrc=Number(e.ssrc),c.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),c.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),c.receivedFrames>0&&!t.isFirstAudioReceived[c.ssrc]&&(t.onFirstAudioReceived&&t.onFirstAudioReceived(c.ssrc),t.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!t.isFirstAudioDecoded[c.ssrc]&&(t.onFirstAudioDecoded&&t.onFirstAudioDecoded(c.ssrc),t.isFirstAudioDecoded[c.ssrc]=!0),t._stats.audioRecv.push(c);break;case"audio_send":var u=OA(LA);u.codec=e.googCodecName,u.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,u.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),u.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),u.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),u.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),u.bytes=Number(e.bytesSent),u.packets=Number(e.packetsSent),u.packetsLost=Number(e.packetsLost),u.ssrc=Number(e.ssrc),u.rttMs=Number(e.googRtt||0),t._stats.rtt=u.rttMs,t._stats.audioSend.push(u)}}))}},{key:"_getStats",value:function(){var e=this;return new Bf((function(t,n){e.pc.getStats(t,n)}))}},{key:"statsResponsesToObjects",value:function(e){var t=[];return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t.push(n)})),t}}]),n}(UA);function VA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VA(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var WA,qA=function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.apply(this,arguments),Mp(l(e),"_stats",xA),Mp(l(e),"report",void 0),Mp(l(e),"lastDecodeVideoReceiverStats",new Map),Mp(l(e),"lastVideoFramesRecv",new Map),Mp(l(e),"lastVideoFramesSent",new Map),Mp(l(e),"lastVideoFramesDecode",new Map),Mp(l(e),"lastVideoJBDelay",new Map),Mp(l(e),"lastAudioJBDelay",new Map),Mp(l(e),"mediaBytesSent",new Map),Mp(l(e),"mediaBytesRetransmit",new Map),Mp(l(e),"mediaBytesTargetEncode",new Map),Mp(l(e),"lastEncoderMs",new Map),e}return v(n,[{key:"updateStats",value:function(){var e=u(c().mark((function e(){var t=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pc.getStats();case 2:this.report=e.sent,this._stats=OA(xA),this.report.forEach((function(e){switch(e.type){case ep.OUTBOUND:"audio"===e.mediaType?t.processAudioOutboundStats(e):"video"===e.mediaType&&t.processVideoOutboundStats(e);break;case ep.INBOUND:"audio"===e.mediaType?t.processAudioInboundStats(e):"video"===e.mediaType&&t.processVideoInboundStats(e);break;case ep.TRANSPORT:var n=t.report.get(e.selectedCandidatePairId);n&&t.processCandidatePairStats(n);break;case ep.CANDIDATE_PAIR:e.selected&&t.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processCandidatePairStats",value:function(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((function(t){e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((function(t){e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){var t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){var n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}},{key:"processCandidateStats",value:function(e){var t;e.type===ep.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ep.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ep.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(GA({},t),GA({},this.stats.selectedCandidatePair.localCandidate)),e.type===ep.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(GA({},t),GA({},this.stats.selectedCandidatePair.remoteCandidate)))}},{key:"processAudioInboundStats",value:function(e){var t=this._stats.audioRecv.find((function(t){return t.ssrc===e.ssrc}));t||(t=OA(MA),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}},{key:"processVideoInboundStats",value:function(e){var t=this._stats.videoRecv.find((function(t){return t.ssrc===e.ssrc}));t||(t=OA(DA),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay;var n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){var o=t.decodedFrame?t.decodedFrame.width:0,a=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,o,a),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){var s=n.stats,c=i-n.lts;t.framesDecodeFreezeTime=s.framesDecodeFreezeTime,t.framesDecodeInterval=s.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=c,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<s.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&i-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:GA({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}},{key:"processVideoOutboundStats",value:function(e){var t=this._stats.videoSend.find((function(t){return t.ssrc===e.ssrc}));t||(t=OA(PA),this._stats.videoSend.push(t));var n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{var r=new CA(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(void 0!==e.retransmittedBytesSent){var i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{var o=new CA(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){var a=this.mediaBytesTargetEncode.get(e.ssrc);if(a)a.add(e.totalEncodedBytesTarget);else{var s=new CA(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,e.totalEncodeTime&&e.framesEncoded){var c=this.lastEncoderMs.get(e.ssrc);if(!c||c.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{var u=e.framesEncoded-c.lastFrameCount,l=e.totalEncodeTime-c.lastEncoderTime;t.avgEncodeMs=1e3*l/u}}if(e.framesEncoded&&e.qpSum){var f=this.lastEncoderMs.get(e.ssrc);!f||f.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-f.lastQpSum)/(e.framesEncoded-f.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var d=this.findRemoteStatsId(e.ssrc,ep.REMOTE_INBOUND);d&&this.processRemoteInboundStats(d,t)}}},{key:"processAudioOutboundStats",value:function(e){var t=this._stats.audioSend.find((function(t){return t.ssrc===e.ssrc}));if(t||(t=OA(LA),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var n=this.findRemoteStatsId(e.ssrc,ep.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}},{key:"findRemoteStatsId",value:function(e,t){var n,r=Array.from(jy(n=this.report).call(n)).find((function(n){return n.type===t&&n.ssrc===e}));return r?r.id:null}},{key:"processVideoMediaSource",value:function(e,t){var n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}},{key:"processAudioMediaSource",value:function(e,t){var n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}},{key:"processVideoTrackSenderStats",value:function(e,t,n){var r,i,o,a=t?this.report.get(t):void 0,s=null!==(r=null==a?void 0:a.framesSent)&&void 0!==r?r:e.framesSent,c=null!==(i=null==a?void 0:a.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(o=null==a?void 0:a.frameHeight)&&void 0!==o?o:e.frameHeight;if("number"==typeof s){0!==s||"number"==typeof c&&"number"==typeof u||(c=0,u=0);var l=0,f=Date.now(),d=this.lastVideoFramesSent.get(n.ssrc);d&&f-d.lts>=800?(l=Math.round((s-d.count)/((f-d.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:s,lts:f,rate:l})):d?l=d.rate:this.lastVideoFramesSent.set(n.ssrc,{count:s,lts:f,rate:0}),n.sentFrame={width:c,height:u,frameRate:Math.max(0,l)}}}},{key:"processVideoTrackReceiverStats",value:function(e,t,n){var r,i,o,a,s,c=t?this.report.get(t):void 0,u=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,l=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,f=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,d=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof u){var h=this.lastVideoFramesRecv.get(n.ssrc),v=Date.now();n.framesReceivedCount=u;var m=0;h&&v-h.lts>=800?(m=Math.round((u-h.count)/((v-h.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:v,rate:m})):h?m=h.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:v,rate:0}),n.receivedFrame={width:l||0,height:f||0,frameRate:m||0},n.decodedFrame={width:l||0,height:f||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:l||0,height:f||0,frameRate:n.decodeFrameRate||0}}if(d&&p){var g=this.lastVideoJBDelay.get(n.ssrc);this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:d,jitterBufferEmittedCount:p}),g||(g={jitterBufferDelay:0,jitterBufferEmittedCount:0});var E=1e3*(d-g.jitterBufferDelay)/(p-g.jitterBufferEmittedCount);n.jitterBufferMs=E,n.currentDelayMs=Math.round(E)}}},{key:"processAudioTrackSenderStats",value:function(e,t,n){var r,i,o,a,s=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,u=null!==(o=null!==(a=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=u}},{key:"processAudioTrackReceiverStats",value:function(e,t,n){var r,i,o,a,s,c,u,l=t?this.report.get(t):void 0,f=null!==(r=null==l?void 0:l.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,d=null!==(i=null==l?void 0:l.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,p=null!==(o=null==l?void 0:l.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,h=null!==(a=null==l?void 0:l.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,v=null!==(s=null==l?void 0:l.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,m=null!==(c=null==l?void 0:l.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,g=null!==(u=null==l?void 0:l.concealedSamples)&&void 0!==u?u:e.concealedSamples;if(f&&d&&(n.accelerateRate=f/d),p&&h){var E=this.lastAudioJBDelay.get(n.ssrc);this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:h}),E||(E={jitterBufferDelay:0,jitterBufferEmittedCount:0});var _=1e3*(p-E.jitterBufferDelay)/(h-E.jitterBufferEmittedCount);n.jitterBufferMs=Math.round(_)}n.outputLevel=v;var b=1920;m&&d&&(b=d/m/50,n.receivedFrames=Math.round(d/b)),g&&(n.droppedFrames=Math.round(g/b))}},{key:"processRemoteInboundStats",value:function(e,t){var n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime))}},{key:"getCodecFromCodecStats",value:function(e){var t=this.report.get(e);if(!t)return"";var n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}},{key:"updateSendBitrate",value:function(){var e=0,t=null,n=null;this.mediaBytesSent.forEach((function(t){e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((function(e){t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((function(e){n=null===n?e.diffMean():n+e.diffMean()}));var r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}]),n}(UA),HA=function(e){d(n,e);var t=p(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"updateStats",value:function(){return Bf.resolve()}}]),n}(UA);function KA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,o=AA();return o?o<76?new BA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new qA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):kA(e)?new qA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new HA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}function zA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function YA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zA(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var JA=(_b((WA=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this,e,r),Mp(l(i),"store",void 0),Mp(l(i),"peerConnection",void 0),Mp(l(i),"remoteSDP",void 0),Mp(l(i),"initialOffer",void 0),Mp(l(i),"statsFilter",void 0),Mp(l(i),"useRTX",!1),Mp(l(i),"localCapabilities",void 0),Mp(l(i),"localCandidateCount",0),Mp(l(i),"allCandidatesReceived",!1),Mp(l(i),"establishPromise",void 0),Mp(l(i),"mutex",new zb("P2PConnection-mutex")),i.store=r,i.peerConnection=new RTCPeerConnection(n.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),i.statsFilter=KA(i.peerConnection,void 0,void 0,dp()?1200:void 0),i.bindPCEvents(),i.bindStatsEvents(),i.store.p2pId=i.store.p2pId+1,i.establishPromise=i.establish(),i}return v(n,[{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"establish",value:function(){var e=u(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 3:if((t=e.sent).sdp){e.next=6;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 6:return n=lA(t.sdp),r=uA(t.sdp,!this.useRTX,lm("FILTER_VIDEO_FEC"),lm("FILTER_AUDIO_FEC"),["opus"]),e.abrupt("return",(this.localCapabilities=r,this.initialOffer=t,YA(YA({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})));case 10:throw e.prev=10,e.t0=e.catch(0),new Bv(Lv.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=u(c().mark((function e(t,n,r,i,o,a){var s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish P2PConnection without initial offer.");case 3:return this.remoteSDP=new RA({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i.send,remoteSetup:o,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:a}),s=this.remoteSDP.toString(),e.next=7,this.peerConnection.setLocalDescription(this.initialOffer);case 7:return e.next=9,this.peerConnection.setRemoteDescription({type:"answer",sdp:s});case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.t0.toString()));case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(t,n,r,i,o,a){return e.apply(this,arguments)}return t}()},{key:"send",value:function(e,t){var n=this;return tA(c().mark((function r(){var i,o,a,s,u,l,f,d;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,nA(n.mutex.lock());case 2:if(i=r.sent,r.prev=3,n.remoteSDP){r.next=6;break}throw new Error("Cannot call P2PConnection.send before remote SDP created");case 6:return o=e.map((function(e){return n.peerConnection.addTrack(e._mediaStreamTrack)})),r.next=9,nA(n.peerConnection.createOffer());case 9:return a=r.sent,s=aA.exports.parse(a.sdp),u=e.map((function(e){var t=e._mediaStreamTrack,r=s.mediaDescriptions.find((function(e){return e.attributes.mid===t.kind}));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){var r=e.attributes.ssrcs.filter((function(e){return e.attributes.label===t})),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){var o=i.find((function(e){return-1!==e.ssrcIds.indexOf(r[0].ssrcId)}));return o?[{ssrcId:o.ssrcIds[0],rtx:n?o.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)})),r.prev=12,r.next=15,u;case 15:l=r.sent,r.next=21;break;case 18:throw r.prev=18,r.t0=r.catch(12),o.forEach((function(e){fp()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),r.t0;case 21:return f=n.mungSendOfferSDP(a.sdp,e),n.remoteSDP.receive(e,t,l),d=n.remoteSDP.toString(),r.next=26,nA(n.peerConnection.setLocalDescription({type:"offer",sdp:f}));case 26:return r.next=28,nA(n.applySendEncodings(o,e));case 28:return r.next=30,nA(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}));case 30:return r.abrupt("return",e.map((function(e,t){var n=e._mediaStreamTrack.id;return{localSSRC:u[t],id:n}})));case 33:throw r.prev=33,r.t1=r.catch(3),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(r.t1.toString()));case 36:return r.prev=36,i(),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[3,33,36,39],[12,18]])})))()}},{key:"stopSending",value:function(){var e=u(c().mark((function e(t){var n,r,i,o=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");case 3:if(n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")})),n.length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");case 6:return n.map((function(e){fp()&&e.replaceTrack(null),o.peerConnection.removeTrack(e)})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:return this.remoteSDP.stopReceiving(t),i=this.remoteSDP.toString(),e.next=16,this.peerConnection.setRemoteDescription({type:"answer",sdp:i});case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.t0.toString()));case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=u(c().mark((function e(t,n,r,i){var o,a,s,u,l,f,d=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));case 3:return o=this.remoteSDP.send(t,n,i),a=o.id,s=o.mslabel,u=new Bf((function(e,n){var r=setTimeout((function(){n(new Error("Cannot receive track, id: ".concat(a)))}),1e4),i=function n(i){var o=rp();if(("Safari"===o.name&&11===Number(o.version)||pp())&&i.track.id!==a&&i.streams[0].id===s){var c,u=i.streams[0].getTracks()[0];return null===(c=d.remoteSDP)||void 0===c||c.updateTrackLabel(t,a,i.track.id),d.peerConnection.removeEventListener("track",n),clearTimeout(r),void e(u)}if(i.track.id===a)return d.peerConnection.removeEventListener("track",n),clearTimeout(r),void e(i.track)};d.peerConnection.addEventListener("track",i)})),l=this.remoteSDP.toString(),e.next=6,this.peerConnection.setRemoteDescription({type:"offer",sdp:l});case 6:return e.next=8,this.peerConnection.createAnswer();case 8:return f=e.sent,e.next=11,this.peerConnection.setLocalDescription(f);case 11:return e.next=13,u;case 13:return e.t0=e.sent,e.t1=a,e.abrupt("return",{track:e.t0,id:e.t1});case 18:throw e.prev=18,e.t2=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t2.toString()));case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=u(c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");case 3:return this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");case 3:if(n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")})),n.length===t.length){e.next=6;break}throw new Error("sender' length doesn't match mids' length.");case 6:n.map((function(e){if(fp()&&e.track)e.track.enabled=!1;else{var t=e.getParameters();t.encodings.forEach((function(e){return e.active=!1})),e.setParameters(t)}})),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.t0.toString()));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");case 3:if(n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")})),n.length===t.length){e.next=6;break}throw new Error("Senders' length doesn't match mids' length.");case 6:return n.map(function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fp()||!t.track){e.next=4;break}t.track.enabled=!0,e.next=8;break;case 4:return(n=t.getParameters()).encodings.forEach((function(e){return e.active=!0})),e.next=8,t.setParameters(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:return i=this.remoteSDP.toString(),e.next=15,this.peerConnection.setRemoteDescription({type:"answer",sdp:i});case 15:e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(){var e=this;return tA(c().mark((function t(){var n,r,i,o,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,nA(e.mutex.lock("From P2PConnection.restartICE"));case 2:return n=t.sent,t.prev=3,t.next=6,nA(e.peerConnection.createOffer({iceRestart:!0}));case 6:if((r=t.sent).sdp){t.next=9;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 9:return i=lA(r.sdp),t.next=12,i.iceParameters;case 12:if(o=t.sent,a=o.remoteIceParameters,e.remoteSDP){t.next=16;break}throw new Error("Cannot restartICE before remoteSDP created.");case 16:return e.remoteSDP.restartICE(a),s=e.remoteSDP.toString(),t.next=20,nA(e.peerConnection.setLocalDescription(r));case 20:return t.next=22,nA(e.peerConnection.setRemoteDescription({type:"answer",sdp:s}));case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(3),Jv.warning("restart ICE failed, abort operation",t.t0);case 27:return t.prev=27,n(),t.finish(27);case 30:case"end":return t.stop()}}),t,null,[[3,24,27,30]])})))()}},{key:"close",value:function(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}},{key:"getStats",value:function(){return this.statsFilter.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this.statsFilter.getVideoIsReady(e)}},{key:"updateEncoderConfig",value:function(){var e=u(c().mark((function e(t,n){var r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n]),this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n),o=this.remoteSDP.toString(),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return e.next=13,this.peerConnection.setRemoteDescription({type:"answer",sdp:o});case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,e.t0.toString());case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getSenders().filter((function(e){var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t})),e.t0=1===r.length,!e.t0){e.next=5;break}return e.next=5,this.applySendEncodings(r,[n]);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this.statsFilter.setVideoIsReady2(e,t)}},{key:"replaceTrack",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.id)===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"bindPCEvents",value:function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidate=function(t){t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,Jv.debug("[pc-".concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,Jv.debug("[pc-".concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),lm("CANDIDATE_TIMEOUT"))}},{key:"unbindPCEvents",value:function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}},{key:"applySendEncodings",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s,u,l,f,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s_().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=29;break}if(o=t[r],a=n[r]){e.next=10;break}return e.abrupt("continue",26);case 10:if(s={},u={},!(a instanceof zR)){e.next=20;break}e.t0=a._optimizationMode,e.next="motion"===e.t0?15:"detail"===e.t0?17:19;break;case 15:return s.degradationPreference="maintain-framerate",e.abrupt("break",20);case 17:return s.degradationPreference="maintain-resolution",e.abrupt("break",20);case 19:s.degradationPreference="balanced";case 20:return lm("DSCP_TYPE")&&Op()&&(l=lm("DSCP_TYPE"),["very-low","low","medium","high"].includes(l)&&(u.networkPriority=l)),f=o.getParameters(),(d=null===(i=f.encodings)||void 0===i?void 0:i[0])&&Object.assign(d,u),Object.assign(f,s),e.next=26,o.setParameters(f);case 26:r++,e.next=6;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(0),Jv.debug("Apply RTPSendEncodings failed.");case 34:case"end":return e.stop()}}),e,null,[[0,31]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"mungSendOfferSDP",value:function(e,t){var n=aA.exports.parse(e);return t.forEach((function(e,t){var r=e._mediaStreamTrack,i=n.mediaDescriptions.find((function(e){return e.attributes.mid===r.kind}));i&&hA(i,e)})),aA.exports.print(n)}},{key:"bindStatsEvents",value:function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)}}},{key:"unbindStatsEvents",value:function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}},{key:"batchReceive",value:function(){var e=u(c().mark((function e(t){var n,r,i,o=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");case 3:return n=this.remoteSDP.batchSend(t).map((function(e,n){var r=e.id,i=e.mslabel,a=t[n].kind;return new Bf((function(e,t){var n=setTimeout((function(){t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),s=function t(s){var c=rp();if("Safari"===c.name&&11===Number(c.version)&&s.track.id!==r&&s.streams[0].id===i){var u,l=s.streams[0].getTracks()[0];return null===(u=o.remoteSDP)||void 0===u||u.updateTrackLabel(a,r,s.track.id),o.peerConnection.removeEventListener("track",t),clearTimeout(n),void e({track:l,id:r})}if(s.track.id===r)return o.peerConnection.removeEventListener("track",t),clearTimeout(n),void e({track:s.track,id:r})};o.peerConnection.addEventListener("track",s)}))})),r=this.remoteSDP.toString(),e.next=6,this.peerConnection.setRemoteDescription({type:"offer",sdp:r});case 6:return e.next=8,this.peerConnection.createAnswer();case 8:return i=e.sent,e.next=11,this.peerConnection.setLocalDescription(i);case 11:return e.next=13,Bf.all(n);case 13:return e.abrupt("return",e.sent);case 16:throw e.prev=16,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getRemoteSSRC",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP){e.next=2;break}return e.abrupt("return");case 2:return n=this.remoteSDP.getSSRC(t),e.abrupt("return",null==n?void 0:n[0].ssrcId);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setConfiguration",value:function(e){if(s_().supportPCSetConfiguration){var t=n.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(rE(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),lm("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}}]),n}(i_)).prototype,"connect",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"connect"),WA.prototype),_b(WA.prototype,"stopSending",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"stopSending"),WA.prototype),_b(WA.prototype,"receive",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"receive"),WA.prototype),_b(WA.prototype,"stopReceiving",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"stopReceiving"),WA.prototype),_b(WA.prototype,"muteRemote",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"muteRemote"),WA.prototype),_b(WA.prototype,"unmuteRemote",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"unmuteRemote"),WA.prototype),_b(WA.prototype,"muteLocal",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"muteLocal"),WA.prototype),_b(WA.prototype,"unmuteLocal",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"unmuteLocal"),WA.prototype),_b(WA.prototype,"close",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"close"),WA.prototype),_b(WA.prototype,"updateEncoderConfig",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"updateEncoderConfig"),WA.prototype),_b(WA.prototype,"updateSendParameters",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"updateSendParameters"),WA.prototype),_b(WA.prototype,"replaceTrack",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"replaceTrack"),WA.prototype),_b(WA.prototype,"getRemoteSSRC",[XA],Object.getOwnPropertyDescriptor(WA.prototype,"getRemoteSSRC"),WA.prototype),WA);function XA(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=u(c().mark((function e(){var n,i,o,a,s,u=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("Locking from P2PConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,o=u.length,a=new Array(o),s=0;s<o;s++)a[s]=u[s];return e.next=8,r.apply(this,a);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}var QA,$A="9",ZA=4e4,ek=function(){function e(t){h(this,e),Mp(this,"sessionDesc",void 0),Mp(this,"_localCapabilities",void 0),Mp(this,"_rtpCapabilities",void 0),Mp(this,"_candidates",void 0),Mp(this,"_iceParameters",void 0),Mp(this,"_dtlsParameters",void 0),Mp(this,"setup",void 0),Mp(this,"currentMidIndex",void 0),Mp(this,"cname",void 0),Mp(this,"firefoxSsrcMidMap",new Map);var n=t=OS(t),r=n.remoteIceParameters,i=n.remoteDtlsParameters,o=n.candidates,a=n.remoteRTPCapabilities,c=n.remoteSetup,u=n.localCapabilities,l=n.cname,f=aA.exports.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=a,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u,this.setup=c,this.cname=l;var d,p=this.rtpCapabilities.send,v=s(f.mediaDescriptions);try{for(v.s();!(d=v.n()).done;){var m=d.value;if(m.attributes.iceUfrag=r.iceUfrag,m.attributes.icePwd=r.icePwd,m.attributes.fingerprints=i.fingerprints,m.attributes.candidates=o,m.attributes.setup=c,"video"===m.media.mediaType&&(m.media.fmts=p.videoCodecs.map((function(e){return e.payloadType.toString(10)})),m.attributes.payloads=p.videoCodecs,m.attributes.extmaps=p.videoExtensions,lm("PRELOAD_MEDIA_COUNT")>0)){var g=pA([{ssrcId:ZA,rtx:lm("USE_RTX")?40001:void 0}],this.cname),E=g.ssrcs,_=g.ssrcGroups;m.attributes.ssrcs=E,m.attributes.ssrcGroups=_}if("audio"===m.media.mediaType&&(m.media.fmts=p.audioCodecs.map((function(e){return e.payloadType.toString(10)})),m.attributes.payloads=p.audioCodecs,m.attributes.extmaps=p.audioExtensions,wA(m),lm("PRELOAD_MEDIA_COUNT")>0)){var b=pA([{ssrcId:2e4}],this.cname),y=b.ssrcs,T=b.ssrcGroups;m.attributes.ssrcs=y,m.attributes.ssrcGroups=T}}}catch(S){v.e(S)}finally{v.f()}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}return v(e,[{key:"localCapabilities",get:function(){return OS(this._localCapabilities)}},{key:"rtpCapabilities",get:function(){return OS(this._rtpCapabilities)}},{key:"candidates",get:function(){return OS(this._candidates)}},{key:"iceParameters",get:function(){return OS(this._iceParameters)}},{key:"dtlsParameters",get:function(){return OS(this._dtlsParameters)}},{key:"preloadRemoteMedia",value:function(){var e=lm("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;for(var t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send,o=1;o<e;o++){var a=2*o+ZA,s=pA([{ssrcId:2*o+2e4}],this.cname),c=s.ssrcs,u=s.ssrcGroups,l=pA([{ssrcId:a,rtx:lm("USE_RTX")?a+1:void 0}],this.cname),f=l.ssrcs,d=l.ssrcGroups;this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:$A,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:$A,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}},{key:"toString",value:function(){return aA.exports.print(this.sessionDesc)}},{key:"send",value:function(e,t,n,r){var i=pA(t,this.cname,lm("AV_SYNC")?n:void 0),o=i.ssrcs,a=i.ssrcGroups,s=this.findPreloadMediaDesc(o);if(s){if(dp()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){var c=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}var u,l=this.findAvailableMediaIndex(e,o);return-1===l||1===l&&(fp()||gp())||Ep()?(u=this.createOrRecycleSendMedia(e,o,a,"sendonly",r),this.updateBundleMids()):((u=OS(this.sessionDesc.mediaDescriptions[l])).attributes.direction="sendonly",u.attributes.ssrcs=o,u.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(u,r)),dp()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}},{key:"batchSend",value:function(e){var t=this,n=e.map((function(e){var n=e.kind,r=e.ssrcMsg,i=e.mslabel;return t.send(n,r,i)})),r=[],i=!1;return n.forEach((function(e){var t=e.mid;e.needExchangeSDP&&(i=!0),r.push(t)})),{mids:r,needExchangeSDP:i}}},{key:"stopSending",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((function(e){"0"===e.attributes.mid||dp()||Ep()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}},{key:"mute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}},{key:"unmute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}},{key:"muteRemote",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return e.includes(t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="inactive"}))}},{key:"unmuteRemote",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return e.includes(t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="recvonly"}))}},{key:"receive",value:function(e,t,n,r){var i=this;e.forEach((function(e,o){i.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[o])})),this.updateBundleMids()}},{key:"stopReceiving",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((function(e){e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}},{key:"restartICE",value:function(e){e=OS(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}},{key:"predictReceivingMids",value:function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}},{key:"findAvailableMediaIndex",value:function(e,t){var n=this;return this.sessionDesc.mediaDescriptions.findIndex((function(r){var i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(dp()){if(i){var o=n.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!o||o!==r.attributes.mid)}return!1}return i}))}},{key:"createOrRecycleRecvMedia",value:function(e,t,n,r,i,o){var a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=this.localCapabilities.send,u=[];if(a===qE.VIDEO){var l,f;if(lm("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(u=s.videoCodecs.filter((function(e){var t,n;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)&&(null==e||null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])===lm("H264_PROFILE_LEVEL_ID")}))),!u||0===(null===(l=u)||void 0===l?void 0:l.length)){var d=c.videoCodecs.filter((function(e){var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)}));0!==d.length&&(u=s.videoCodecs.filter((function(e){return d.some((function(t){return t.payloadType===e.payloadType}))})))}if(lm("USE_RTX")){var p=u.map((function(e){return e.payloadType.toString()})),h=s.videoCodecs.filter((function(e){var t,n;return"rtx"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)&&p.includes((null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)||"")}));u=[].concat(m(u),m(h))}0===u.length&&(Jv.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(f=s.videoCodecs[0].rtpMap)||void 0===f?void 0:f.encodingName)),u=s.videoCodecs)}else u=s.audioCodecs.filter((function(e){var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(i)})),0===u.length&&(Jv.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),u=s.audioCodecs.filter((function(e){var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes("opus")})));var v=a===qE.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;var g="".concat(this.currentMidIndex),E={media:{mediaType:a,port:$A,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};E=this.mungRecvMediaDsec(E,e,o);var _=this.findFirstClosedMedia(a);if(_){var b=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[b]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}},{key:"createOrRecycleSendMedia",value:function(e,t,n,r,i){var o=this.rtpCapabilities.send,a=e===qE.VIDEO?o.videoCodecs:o.audioCodecs,s=e===qE.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;var c="".concat(this.currentMidIndex),u={media:{mediaType:e,port:$A,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);var l=this.findFirstClosedMedia(e);if(l){var f=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[f]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}},{key:"updateBundleMids",value:function(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((function(e){return"0"!==e.media.port})).map((function(e){return e.attributes.mid}))}},{key:"mungRecvMediaDsec",value:function(e,t,n){var r=OS(e);return vA(r),hA(r,t),mA(r,t),gA(r),EA(r,n,this.localCapabilities.send),r}},{key:"mungSendMediaDesc",value:function(e,t){var n=OS(e);return EA(n,t,this.localCapabilities.recv),wA(n),n}},{key:"updateRecvMedia",value:function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}},{key:"bumpMid",value:function(e){this.currentMidIndex+=e}},{key:"findFirstClosedMedia",value:function(e){return this.sessionDesc.mediaDescriptions.find((function(t){return dp()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port}))}},{key:"findPreloadMediaDesc",value:function(e){return this.sessionDesc.mediaDescriptions.find((function(t){var n,r;return(null===(n=t.attributes)||void 0===n||null===(r=n.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId}))}},{key:"getSSRC",value:function(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e})))||void 0===t?void 0:t.attributes.ssrcs}}]),e}();function tk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tk(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rk,ik,ok,ak,sk,ck,uk,lk,fk,dk,pk,hk,vk=(_b((QA=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this,e,r),Mp(l(i),"store",void 0),Mp(l(i),"peerConnection",void 0),Mp(l(i),"remoteSDP",void 0),Mp(l(i),"initialOffer",void 0),Mp(l(i),"transportEventReceiver",void 0),Mp(l(i),"statsFilter",void 0),Mp(l(i),"useRTX",lm("USE_RTX")),Mp(l(i),"localCapabilities",void 0),Mp(l(i),"localCandidateCount",0),Mp(l(i),"allCandidatesReceived",!1),Mp(l(i),"establishPromise",void 0),Mp(l(i),"mutex",new zb("P2PConnection-mutex")),i.store=r,i.peerConnection=new RTCPeerConnection(n.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),i.statsFilter=KA(i.peerConnection,void 0,void 0,dp()?1200:void 0),i.bindPCEvents(),i.bindStatsEvents(),i.store.p2pId=i.store.p2pId+1,i.establishPromise=i.establish(),i}return v(n,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"establish",value:function(){var e=u(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),e.next=4,this.peerConnection.createOffer();case 4:if((t=e.sent).sdp){e.next=7;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 7:return n=lA(t.sdp),e.next=10,bA(!this.useRTX,lm("FILTER_VIDEO_FEC"),lm("FILTER_AUDIO_FEC"));case 10:return r=e.sent,e.abrupt("return",(this.localCapabilities=SA(r),this.initialOffer=t,nk(nk({},n),{},{rtpCapabilities:r,offerSDP:t.sdp})));case 14:throw e.prev=14,e.t0=e.catch(0),new Bv(Lv.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=u(c().mark((function e(t,n,r,i,o,a){var s,u,l,f,d,p,h,v;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish P2PConnection without initial offer.");case 3:return this.remoteSDP=new ek({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:this.localCapabilities,cname:a}),s=this.remoteSDP.toString(),u=aA.exports.parse(this.initialOffer.sdp),(l=u.mediaDescriptions.find((function(e){return"audio"===e.media.mediaType})))&&wA(l),f=aA.exports.print(u),d=this.logSDPExchange(f||"","offer","local","connect"),e.next=9,this.peerConnection.setLocalDescription({type:"offer",sdp:f});case 9:return null==d||d(s),e.next=12,this.peerConnection.setRemoteDescription({type:"answer",sdp:s});case 12:if(null!=(p=this.peerConnection.getTransceivers()[0])&&p.receiver&&this.tryBindTransportEvents(p.receiver),!(lm("PRELOAD_MEDIA_COUNT")>0)){e.next=23;break}return this.remoteSDP.preloadRemoteMedia(),h=this.remoteSDP.toString(),e.next=18,this.peerConnection.setRemoteDescription({type:"offer",sdp:h});case 18:return e.next=20,this.peerConnection.createAnswer();case 20:return v=e.sent,e.next=23,this.peerConnection.setLocalDescription(v);case 23:e.next=28;break;case 25:throw e.prev=25,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.t0.toString()));case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));function t(t,n,r,i,o,a){return e.apply(this,arguments)}return t}()},{key:"send",value:function(e,t,n){var r=this;return tA(c().mark((function i(){var o,a,s,u,l,f,d,p,h,v,m;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,nA(r.mutex.lock("From P2PConnection.send"));case 2:if(o=i.sent,i.prev=3,r.remoteSDP){i.next=6;break}throw new Error("Cannot call P2PConnection.send before remote SDP created");case 6:if(a=[],e.forEach((function(e){var t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});a.push(t)})),i.t0=dp()&&!0===lm("SIMULCAST"),!i.t0){i.next=12;break}return i.next=12,nA(r.applySimulcastForFirefox(a,e));case 12:return i.next=14,nA(r.peerConnection.createOffer());case 14:return s=i.sent,u=r.remoteSDP.predictReceivingMids(e.length),l=r.mungSendOfferSDP(s.sdp,e,u),f=aA.exports.parse(l),d=u.map((function(e){var t=f.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return fA(t,r.useRTX)})),i.prev=19,i.next=22,d;case 22:p=i.sent,i.next=36;break;case 25:return i.prev=25,i.t1=i.catch(19),p=[],r.remoteSDP.receive(e,t,n,p),h=r.remoteSDP.toString(),i.next=31,nA(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));case 31:return i.next=33,nA(r.peerConnection.setRemoteDescription({type:"answer",sdp:h}));case 33:return i.next=35,nA(r.stopSending(u,!0));case 35:throw i.t1;case 36:return r.remoteSDP.receive(e,t,n,p),v=r.remoteSDP.toString(),m=r.logSDPExchange(l,"offer","local","send"),i.next=40,nA(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));case 40:return i.next=42,nA(r.applySimulcastEncodings(a,e));case 42:return i.next=44,nA(r.applySendEncodings(a,e));case 44:return null==m||m(v),i.next=47,nA(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}));case 47:return i.abrupt("return",a.map((function(e,t){var n=u[t];return{localSSRC:d[t],id:n,transceiver:e}})));case 50:throw i.prev=50,i.t2=i.catch(3),i.t2 instanceof Bv?i.t2:new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(i.t2.toString()));case 53:return i.prev=53,o(),i.finish(53);case 56:case"end":return i.stop()}}),i,null,[[3,50,53,56],[19,25]])})))()}},{key:"stopSending",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.mutex.lock("From P2PConnection.stopSending");case 6:e.t0=e.sent;case 7:if(r=e.t0,e.prev=8,this.remoteSDP){e.next=11;break}throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");case 11:if(i=this.peerConnection.getTransceivers().filter((function(e){return-1!==t.indexOf(e.mid)})),i.length===t.length){e.next=14;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");case 14:return i.map((function(e){var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)})),e.next=17,this.peerConnection.createOffer();case 17:return o=e.sent,a=this.logSDPExchange(o.sdp||"","offer","local","stopSending"),e.next=21,this.peerConnection.setLocalDescription(o);case 21:return this.remoteSDP.stopReceiving(t),s=this.remoteSDP.toString(),null==a||a(s),e.next=26,this.peerConnection.setRemoteDescription({type:"answer",sdp:s});case 26:e.next=31;break;case 28:throw e.prev=28,e.t1=e.catch(8),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.t1.toString()));case 31:return e.prev=31,r&&r(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[8,28,31,34]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=u(c().mark((function e(t,n,r,i){var o,a,s,u,l,f,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));case 3:if(o=this.remoteSDP.send(t,n,r,i),a=o.mid,!o.needExchangeSDP){e.next=18;break}return s=this.remoteSDP.toString(),u=this.logSDPExchange(s,"offer","remote","receive"),e.next=8,this.peerConnection.setRemoteDescription({type:"offer",sdp:s});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return l=e.sent,f=this.mungReceiveAnswerSDP(l.sdp,a,t),null==u||u(f||""),e.next=15,this.peerConnection.setLocalDescription({type:"answer",sdp:f});case 15:Jv.debug("[P2PConnection] receive ".concat(t," by exchanging SDP.")),e.next=19;break;case 18:Jv.debug("[P2PConnection] receive ".concat(t," no need to exchange SDP."));case 19:if(d=this.peerConnection.getTransceivers().find((function(e){return e.mid===a}))){e.next=22;break}throw new Error("Cannot get transceiver after setLocalDescription.");case 22:return e.abrupt("return",{track:d.receiver.track,id:a});case 25:throw e.prev=25,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"batchReceive",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");case 3:if(n=this.remoteSDP.batchSend(t),r=n.mids,!n.needExchangeSDP){e.next=17;break}return i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","receive"),e.next=8,this.peerConnection.setRemoteDescription({type:"offer",sdp:i});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return a=e.sent,null==o||o(a.sdp||""),e.next=14,this.peerConnection.setLocalDescription(a);case 14:Jv.debug("[P2PConnection] batchReceive by exchanging SDP."),e.next=18;break;case 17:Jv.debug("[P2PConnection] batchReceive no need to exchange SDP.");case 18:return e.abrupt("return",r.map((function(e){var t=s.peerConnection.getTransceivers().find((function(t){return t.mid===e}));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e}})));case 21:throw e.prev=21,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");case 3:return this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.mute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.unmute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map((function(e){e.direction="inactive"})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.muteRemote(t),o=this.remoteSDP.toString(),null==i||i(o),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:o});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map(function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.direction="sendonly";case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.unmuteRemote(t),o=this.remoteSDP.toString(),null==i||i(o),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:o});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(){var e=this;return tA(c().mark((function t(){var n,r,i,o,a,s,u;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,nA(e.mutex.lock("From P2PConnection.restartICE"));case 2:return n=t.sent,t.prev=3,t.next=6,nA(e.peerConnection.createOffer({iceRestart:!0}));case 6:if((r=t.sent).sdp){t.next=9;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 9:return i=lA(r.sdp),t.next=12,i.iceParameters;case 12:if(o=t.sent,a=o.remoteIceParameters,e.remoteSDP){t.next=16;break}throw new Error("Cannot restartICE before remoteSDP created.");case 16:return e.remoteSDP.restartICE(a),s=e.remoteSDP.toString(),u=e.logSDPExchange(r.sdp||"","offer","local","restartICE"),t.next=20,nA(e.peerConnection.setLocalDescription(r));case 20:return null==u||u(s),t.next=23,nA(e.peerConnection.setRemoteDescription({type:"answer",sdp:s}));case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(3),Jv.warning("restart ICE failed, abort operation",t.t0);case 28:return t.prev=28,n(),t.finish(28);case 31:case"end":return t.stop()}}),t,null,[[3,25,28,31]])})))()}},{key:"close",value:function(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}},{key:"getStats",value:function(){return this.statsFilter.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this.statsFilter.getVideoIsReady(e)}},{key:"updateEncoderConfig",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n],[t]),this.remoteSDP.updateRecvMedia(t,n),o=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig"),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return null==a||a(o),e.next=14,this.peerConnection.setRemoteDescription({type:"answer",sdp:o});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,e.t0.toString());case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().filter((function(e){return e.mid===t})),e.t0=1===r.length,!e.t0){e.next=12;break}if(!this.isVP8Simulcast(n)){e.next=10;break}if(e.t1=dp(),e.t1){e.next=8;break}return e.next=8,this.applySimulcastEncodings(r,[n]);case 8:e.next=12;break;case 10:return e.next=12,this.applySendEncodings(r,[n]);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this.statsFilter.setVideoIsReady2(e,t)}},{key:"replaceTrack",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().find((function(e){return e.mid===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.sender.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"bindPCEvents",value:function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidate=function(t){t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,Jv.debug("[pc-".concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,Jv.debug("[pc-".concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),lm("CANDIDATE_TIMEOUT"))}},{key:"unbindPCEvents",value:function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}},{key:"tryBindTransportEvents",value:function(e){var t=this;e.transport&&(this.transportEventReceiver=e,e.transport.onstatechange=function(){var n,r;null!==(n=e.transport)&&void 0!==n&&n.state&&(null===(r=t.onDTLSTransportStateChange)||void 0===r||r.call(t,e.transport.state))},e.transport.onerror=function(e){var n;null===(n=t.onDTLSTransportError)||void 0===n||n.call(t,e.error)},e.transport.iceTransport&&(e.transport.iceTransport.onstatechange=function(){var n,r,i=null===(n=e.transport)||void 0===n?void 0:n.iceTransport.state;i&&(null===(r=t.onICETransportStateChange)||void 0===r||r.call(t,i))}))}},{key:"tryUnbindTransportEvents",value:function(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}},{key:"applySendEncodings",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s,u,l,f,d,p,h,v,m,g;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s_().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=32;break}if(i=t[r],!((o=n[r])&&o instanceof zR)){e.next=29;break}if(!this.isVP8Simulcast(o)){e.next=11;break}return e.abrupt("continue",29);case 11:u={},l={},e.t0=o._optimizationMode,e.next="motion"===e.t0?15:"detail"===e.t0?17:19;break;case 15:return u.degradationPreference="maintain-framerate",e.abrupt("break",20);case 17:return u.degradationPreference="maintain-resolution",e.abrupt("break",20);case 19:u.degradationPreference="balanced";case 20:return null!==(a=o._encoderConfig)&&void 0!==a&&a.bitrateMax&&(l.maxBitrate=1e3*(null===(f=o._encoderConfig)||void 0===f?void 0:f.bitrateMax)),o._hints.includes(CE.LOW_STREAM)&&(null!==(d=o._encoderConfig)&&void 0!==d&&d.frameRate&&(l.maxFramerate=eS(o._encoderConfig.frameRate)),null!==(p=o._encoderConfig)&&void 0!==p&&p.scaleResolutionDownBy&&(null===(h=o._encoderConfig)||void 0===h?void 0:h.scaleResolutionDownBy)>1&&(l.scaleResolutionDownBy=o._encoderConfig.scaleResolutionDownBy)),lm("DSCP_TYPE")&&Op()&&(v=lm("DSCP_TYPE"),["very-low","low","medium","high"].includes(v)&&(l.networkPriority=v)),m=i.sender.getParameters(),g=null===(s=m.encodings)||void 0===s?void 0:s[0],dp()&&!g&&(u.encodings=[l]),g&&Object.assign(g,l),Object.assign(m,u),e.next=29,i.sender.setParameters(m);case 29:r++,e.next=6;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(0),Jv.debug("Apply RTPSendEncodings failed.");case 37:case"end":return e.stop()}}),e,this,[[0,34]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"mungSendOfferSDP",value:function(e,t,n){var r=this,i=aA.exports.parse(e);return t.forEach((function(e,t){var o=n[t],a=i.mediaDescriptions.find((function(e){return e.attributes.mid===o}));a&&(hA(a,e),_A(a,e,r.store.codec))})),aA.exports.print(i)}},{key:"mungReceiveAnswerSDP",value:function(e,t,n){var r=aA.exports.parse(e),i=r.mediaDescriptions.find((function(e){return e.attributes.mid===t}));return i&&n===qE.AUDIO&&"audio"===i.media.mediaType&&wA(i),aA.exports.print(r)}},{key:"bindStatsEvents",value:function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=function(t){var n;null===(n=e.onFirstVideoDecodedTimeout)||void 0===n||n.call(e,t)}}},{key:"unbindStatsEvents",value:function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}},{key:"applySimulcastForFirefox",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s,u,l,f,d,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(u=t[r],!((l=n[r])instanceof zR&&!l._hints.includes(CE.LOW_STREAM)&&null!==(i=l._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(o=l._encoderConfig)||void 0===o?void 0:o.bitrateMax)>200&&null!==(a=l._scalabiltyMode)&&void 0!==a&&a.numSpatialLayers&&(null===(s=l._scalabiltyMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec)){e.next=10;break}return f={},d={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4},f.encodings=[{rid:"m",active:!0,maxBitrate:d.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:d.high}],p=u.sender.getParameters(),e.next=10,u.sender.setParameters(Object.assign(p,f));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"applySimulcastEncodings",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dp()||t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(!((i=n[r])instanceof zR&&this.isVP8Simulcast(i))){e.next=10;break}return o=t[r],a={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4},a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}],u=o.sender.getParameters(),e.next=10,o.sender.setParameters(Object.assign(u,a));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"isVP8Simulcast",value:function(e){var t,n,r,i;return!!(e instanceof zR&&lm("SIMULCAST")&&"vp8"===this.store.codec&&!e._hints.includes(CE.LOW_STREAM)&&null!==(t=e._encoderConfig)&&void 0!==t&&t.bitrateMax&&(null===(n=e._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(r=e._scalabiltyMode)&&void 0!==r&&r.numSpatialLayers&&(null===(i=e._scalabiltyMode)||void 0===i?void 0:i.numSpatialLayers)>1)}},{key:"logSDPExchange",value:function(e,t,n,r){var i=this;if(lm("SDP_LOGGING"))return Jv.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}},{key:"getRemoteSSRC",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP){e.next=2;break}return e.abrupt("return");case 2:return n=this.remoteSDP.getSSRC(t),e.abrupt("return",null==n?void 0:n[0].ssrcId);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setConfiguration",value:function(e){if(s_().supportPCSetConfiguration){var t=n.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[]};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(rE(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),lm("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),lm("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat($T(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!lm("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}}]),n}(i_)).prototype,"connect",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"connect"),QA.prototype),_b(QA.prototype,"receive",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"receive"),QA.prototype),_b(QA.prototype,"batchReceive",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"batchReceive"),QA.prototype),_b(QA.prototype,"stopReceiving",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"stopReceiving"),QA.prototype),_b(QA.prototype,"muteRemote",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"muteRemote"),QA.prototype),_b(QA.prototype,"unmuteRemote",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"unmuteRemote"),QA.prototype),_b(QA.prototype,"muteLocal",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"muteLocal"),QA.prototype),_b(QA.prototype,"unmuteLocal",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"unmuteLocal"),QA.prototype),_b(QA.prototype,"close",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"close"),QA.prototype),_b(QA.prototype,"updateEncoderConfig",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"updateEncoderConfig"),QA.prototype),_b(QA.prototype,"updateSendParameters",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"updateSendParameters"),QA.prototype),_b(QA.prototype,"replaceTrack",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"replaceTrack"),QA.prototype),_b(QA.prototype,"getRemoteSSRC",[mk],Object.getOwnPropertyDescriptor(QA.prototype,"getRemoteSSRC"),QA.prototype),QA);function mk(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=u(c().mark((function e(){var n,i,o,a,s,u=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From P2PConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,o=u.length,a=new Array(o),s=0;s<o;s++)a[s]=u[s];return e.next=8,r.apply(this,a);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function gk(e,t){var n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=eS(t.width),r.height=eS(t.height);var i=eS(t.framerate||15);document.body.append(n),document.body.append(r);var o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();var a=r.getContext("2d");if(!a)throw new Bv(Lv.UNEXPECTED_ERROR,"can not get canvas context");var s=s_(),c=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0],u=oy((function(){return function(){if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){var t=n.videoWidth,i=n.videoHeight/t,s=r.width*i;Math.abs(s-r.height)>=2&&(Jv.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(s)),r.height=s)}a.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))}()}),i),l=c.stop;return c.stop=function(){l.call(c),u(),n&&(n.remove(),n=null),r&&(r.width=0,r.remove(),r=null),Jv.debug("clean low stream renderer")},c}function Ek(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ek(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ek(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bk=function(e){d(n,e);var t=p(n);function n(e,r,i,o){var a;return h(this,n),a=t.call(this,e,"track-".concat(e.kind,"-").concat(r,"-").concat(o.clientId,"_").concat(hS(5,""))),Mp(l(a),"_userId",void 0),Mp(l(a),"_uintId",void 0),Mp(l(a),"_isDestroyed",!1),Mp(l(a),"store",void 0),Mp(l(a),"processor",void 0),Mp(l(a),"processorContext",void 0),a._userId=r,a._uintId=i,a.store=o,a}return v(n,[{key:"getUserId",value:function(){return this._userId}},{key:"_updateOriginMediaStreamTrack",value:function(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}},{key:"_destroy",value:function(){this._isDestroyed=!0,Jv.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),i(o(n.prototype),"close",this).call(this)}},{key:"getProcessorStats",value:function(){return this.processorContext.gatherStats()}},{key:"getProcessorUsage",value:function(){return this.processorContext.gatherUsage()}}]),n}(Hb),yk=(rk=Gb({argsMap:function(e,t,n){return[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}}),ik=Gb({argsMap:function(e){return[e.getTrackId()]}}),ok=Gb({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),ak=Gb({argsMap:function(e){return[e.getTrackId()]}}),_b((sk=function(e){d(n,e);var t=p(n);function n(e,r,i,o){var a;return h(this,n),a=t.call(this,e,r,i,o),Mp(l(a),"_videoVisibleTimer",null),Mp(l(a),"_previousVideoVisibleStatus",void 0),Mp(l(a),"_clearPreviousVideoVisibleStatus",(function(){return a._previousVideoVisibleStatus=void 0})),Mp(l(a),"trackMediaType","video"),Mp(l(a),"_videoWidth",void 0),Mp(l(a),"_videoHeight",void 0),Mp(l(a),"_player",void 0),Mp(l(a),"processorDestination",void 0),Mp(l(a),"processorContext",void 0),a.updateMediaStreamTrackResolution(),a.processorContext=new kT(a.getTrackId(),"remote"),a.processorDestination=new AT(a.processorContext),a.bindProcessorDestinationEvents(),a}return v(n,[{key:"isPlaying",get:function(){return!(!this._player||this._player.videoElementStatus!==lg.PLAYING)}},{key:"__className__",get:function(){return"RemoteVideoTrack"}},{key:"getStats",value:function(){return AS((function(){Jv.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),yS(this,kE.GET_STATS)||_k({},pE)}},{key:"play",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){var r=document.getElementById(e);r?e=r:(Jv.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Jv.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));var i=_k(_k({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new iR(i):this._player=new aR(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=function(){t.store.subscribe(t.getUserId(),"video",void 0,void 0,Date.now()),t.emit(PE.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((function(){try{var n=t.getVideoElementVisibleStatus();t.emit(PE.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch(e){}}),lm("CHECK_VIDEO_VISIBLE_INTERVAL"))}},{key:"stop",value:function(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Jv.debug("[".concat(this.getTrackId(),"] stop video playback")))}},{key:"getCurrentFrameData",value:function(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}},{key:"updateMediaStreamTrackResolution",value:function(){var e=this;gS(this._originMediaStreamTrack).then((function(t){var n=a(t,2),r=n[0],i=n[1];e._videoHeight=i,e._videoWidth=r})).catch(mS)}},{key:"_updatePlayerSource",value:function(){Jv.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}},{key:"getVideoElementVisibleStatus",value:function(){try{var e,t,n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},i=r.element,o=r.slot;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){var a=qR.checkOneElementVisible(i),s=Object.assign({},a);if(s.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=s.visible;var c=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});s.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(s.reason))}return s}return}catch(e){throw new Bv(Lv.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}},{key:"pipe",value:function(e){if(this.processor===e)return e;if(e._source)throw new Bv(Lv.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}},{key:"unpipe",value:function(){if(this.processor){var e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}}},{key:"bindProcessorDestinationEvents",value:function(){var e=this;this.processorDestination.on(XE.ON_TRACK,function(){var t=u(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n?n!==e._mediaStreamTrack&&(e._mediaStreamTrack=n,e._updatePlayerSource()):e._mediaStreamTrack!==e._originMediaStreamTrack&&(e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"unbindProcessorDestinationEvents",value:function(){this.processorDestination.removeAllListeners(XE.ON_TRACK)}},{key:"_destroy",value:function(){i(o(n.prototype),"_destroy",this).call(this),this.unbindProcessorDestinationEvents()}}]),n}(bk)).prototype,"play",[rk],Object.getOwnPropertyDescriptor(sk.prototype,"play"),sk.prototype),_b(sk.prototype,"stop",[ik],Object.getOwnPropertyDescriptor(sk.prototype,"stop"),sk.prototype),_b(sk.prototype,"pipe",[ok],Object.getOwnPropertyDescriptor(sk.prototype,"pipe"),sk.prototype),_b(sk.prototype,"unpipe",[ak],Object.getOwnPropertyDescriptor(sk.prototype,"unpipe"),sk.prototype),sk),Tk=(ck=Gb({argsMap:function(e,t){return[e.getTrackId(),t]},throttleTime:300}),uk=Gb({argsMap:function(e,t){return[e.getTrackId(),t]}}),lk=Gb({argsMap:function(e){return[e.getTrackId()]}}),fk=Gb({argsMap:function(e){return[e.getTrackId()]}}),dk=Gb({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),pk=Gb({argsMap:function(e){return[e.getTrackId()]}}),_b((hk=function(e){d(n,e);var t=p(n);function n(e,r,i,o){var a;return h(this,n),a=t.call(this,e,r,i,o),Mp(l(a),"trackMediaType","audio"),Mp(l(a),"_source",void 0),Mp(l(a),"_useAudioElement",!0),Mp(l(a),"_volume",100),Mp(l(a),"processorContext",void 0),Mp(l(a),"processorDestination",void 0),Mp(l(a),"_played",!1),Mp(l(a),"_bypassWebAudio",!1),lm("DISABLE_WEBAUDIO")?(a._source=new xT,a._bypassWebAudio=!0,a._useAudioElement=!0):(a._source=new cy(e,!0),lm("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(a._useAudioElement=!1)),a._source.once(Zg.RECEIVE_TRACK_BUFFER,(function(){a.emit(PE.FIRST_FRAME_DECODED)})),a.processorContext=new NT(a._source.context,a.getTrackId(),"remote"),a.processorDestination=new CT(a.processorContext),a.bindProcessorDestinationEvents(),a._source.on(Zg.UPDATE_SOURCE,(function(){a.processor&&a.processor.updateInput({node:a._source.processSourceNode,context:a.processorContext})})),a}return v(n,[{key:"isPlaying",get:function(){return this._useAudioElement?ky.isPlaying(this.getTrackId()):this._source.isPlayed}},{key:"__className__",get:function(){return"RemoteAudioTrack"}},{key:"setAudioFrameCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Zg.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Zg.ON_AUDIO_BUFFER),this._source.on(Zg.ON_AUDIO_BUFFER,(function(t){return e(t)}))}},{key:"setVolume",value:function(e){this._volume=e,this._useAudioElement?ky.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}},{key:"setPlaybackDevice",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._useAudioElement){e.next=2;break}throw new Bv(Lv.NOT_SUPPORTED,"your browser does not support setting the audio output device");case 2:return e.next=4,ky.setSinkID(this.getTrackId(),t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getVolumeLevel",value:function(){return this._source.getAccurateVolumeLevel()}},{key:"getStats",value:function(){return AS((function(){Jv.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),yS(this,kE.GET_STATS)||_k({},fE)}},{key:"play",value:function(){Jv.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Jv.debug("[".concat(this.getTrackId(),"] use audio element to play")),ky.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}},{key:"stop",value:function(){Jv.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ky.stop(this.getTrackId()):this._source.stop()}},{key:"_destroy",value:function(){i(o(n.prototype),"_destroy",this).call(this),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}},{key:"_isFreeze",value:function(){return this._source.isFreeze}},{key:"_updatePlayerSource",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Jv.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ky.updateTrack(this.getTrackId(),this._mediaStreamTrack)}},{key:"pipe",value:function(e){if(this._bypassWebAudio)throw new Bv(Lv.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Bv(Lv.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}},{key:"unpipe",value:function(){var e;if(this._bypassWebAudio)throw new Bv(Lv.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(this.processor){var t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}}},{key:"bindProcessorDestinationEvents",value:function(){var e=this;this.processorDestination.on(XE.ON_TRACK,function(){var t=u(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n?n!==e._mediaStreamTrack&&(e._mediaStreamTrack=n,e._updatePlayerSource(!1),e._source.processedNode=e._source.createMediaStreamSourceNode(n)):e._mediaStreamTrack!==e._originMediaStreamTrack&&(e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.processorDestination.on(XE.ON_NODE,(function(t){e._source.processedNode=t;var n=!t;e._useAudioElement!==n&&(e._played?(e.stop(),e._useAudioElement=n,e.play()):e._useAudioElement=n)}))}},{key:"unbindProcessorDestinationEvents",value:function(){this.processorDestination.removeAllListeners(XE.ON_TRACK),this.processorDestination.removeAllListeners(XE.ON_NODE)}}]),n}(bk)).prototype,"setVolume",[ck],Object.getOwnPropertyDescriptor(hk.prototype,"setVolume"),hk.prototype),_b(hk.prototype,"setPlaybackDevice",[uk],Object.getOwnPropertyDescriptor(hk.prototype,"setPlaybackDevice"),hk.prototype),_b(hk.prototype,"play",[lk],Object.getOwnPropertyDescriptor(hk.prototype,"play"),hk.prototype),_b(hk.prototype,"stop",[fk],Object.getOwnPropertyDescriptor(hk.prototype,"stop"),hk.prototype),_b(hk.prototype,"pipe",[dk],Object.getOwnPropertyDescriptor(hk.prototype,"pipe"),hk.prototype),_b(hk.prototype,"unpipe",[pk],Object.getOwnPropertyDescriptor(hk.prototype,"unpipe"),hk.prototype),hk);function Sk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sk(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rk,Ok=function(e){d(n,e);var t=p(n);function n(){var e;return h(this,n),e=t.call(this),Mp(l(e),"uplinkStatsUploadInterval",void 0),Mp(l(e),"uplinkStatsUploadSlowInterval",void 0),Mp(l(e),"uplinkRelatedStatsUploadInterval",void 0),Mp(l(e),"uplinkDenoiserStatsUploadInterval",void 0),Mp(l(e),"transportStatsUploadInterval",void 0),Mp(l(e),"uplinkExtensionStatsUploadInterval",void 0),Mp(l(e),"downlinkExtensionStatsUploadInterval",void 0),Mp(l(e),"extensionUsageStatsUploadInterval",void 0),Mp(l(e),"downlinkStatsUploadInterval",void 0),Mp(l(e),"downlinkStatsUploadSlowInterval",void 0),Mp(l(e),"downlinkRelatedStatsUploadInterval",void 0),Mp(l(e),"lastStats",void 0),Mp(l(e),"uploadUnplinkStarted",!1),Mp(l(e),"uploadDownlinkStarted",!1),Mp(l(e),"uploadTransportStarted",!1),Mp(l(e),"uploadExtensionUsageStarted",!1),Mp(l(e),"requestStats",void 0),Mp(l(e),"requestLocalMedia",void 0),Mp(l(e),"requestRemoteMedia",void 0),Mp(l(e),"requestAllTracks",void 0),Mp(l(e),"requestVideoIsReady",void 0),Mp(l(e),"requestUpload",void 0),e}return v(n,[{key:"startUploadTransportStats",value:function(){var e=this;this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e);n&&e.uploadTransportStats(n)}),1e3))}},{key:"startUploadExtensionUsageStats",value:function(){var e=this;if(!this.uploadExtensionUsageStarted){this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);var t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(u(c().mark((function n(){var r,i,o,u,l,f,d,p,h,v,m,g,E,_,b,y,T,S;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:u=Date.now(),l={connectionInterval:lm("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:u},f=[],d=(null===(r=e.requestAllTracks)||void 0===r?void 0:r.call(e))||[],p=s(d),n.prev=4,p.s();case 6:if((h=p.n()).done){n.next=17;break}if(v=h.value,n.t0=!v.muted&&v.enabled,!n.t0){n.next=15;break}return n.t1=f,n.next=13,v.getProcessorUsage();case 13:n.t2=n.sent,f=n.t1.concat.call(n.t1,n.t2);case 15:n.next=6;break;case 17:n.next=22;break;case 19:n.prev=19,n.t3=n.catch(4),p.e(n.t3);case 22:return n.prev=22,p.f(),n.finish(22);case 25:m=(null===(i=e.requestRemoteMedia)||void 0===i?void 0:i.call(e))||[],g=s(m),n.prev=27,g.s();case 29:if((E=g.n()).done){n.next=47;break}if(_=a(E.value,2),b=_[0],y=_[1],n.t4=y.has(qE.VIDEO)&&b.videoTrack,!n.t4){n.next=38;break}return n.t5=f,n.next=36,b.videoTrack.getProcessorUsage();case 36:n.t6=n.sent,f=n.t5.concat.call(n.t5,n.t6);case 38:if(n.t7=y.has(qE.AUDIO)&&b.audioTrack,!n.t7){n.next=45;break}return n.t8=f,n.next=43,b.audioTrack.getProcessorUsage();case 43:n.t9=n.sent,f=n.t8.concat.call(n.t8,n.t9);case 45:n.next=29;break;case 47:n.next=52;break;case 49:n.prev=49,n.t10=n.catch(27),g.e(n.t10);case 52:return n.prev=52,g.f(),n.finish(52);case 55:if(0!==f.length){n.next=57;break}return n.abrupt("return");case 57:l.details=function(e,t){var n,r={},i=s(e);try{for(i.s();!(n=i.n()).done;){var o,a,c,u=n.value,l=u.id,f=u.value,d=u.level,p=u.direction,h=null!==(o=t.get(l))&&void 0!==o?o:0,v=2===f?h+lm("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:h;t.set(l,v),r[l]?(2===f&&(r[l].value=f),d>r[l].level&&(r[l].level=d),"remote"===p&&(r[l].remoteUidCount+=1),r[l].totalTs=null!==(a=t.get(l))&&void 0!==a?a:0):r[l]={value:f,level:d,remoteUidCount:"local"===p?0:1,totalTs:null!==(c=t.get(l))&&void 0!==c?c:0}}}catch(m){i.e(m)}finally{i.f()}return Object.keys(r).map((function(e){var t=r[e];return{id:e,level:t.level,value:t.value,totalTs:t.totalTs}}))}(f,t),T=Date.now(),S=T>u?T:u+1,null===(o=e.requestUpload)||void 0===o||o.call(e,Xg.EXTENSION_USAGE_STATS,{usageStats:l,sendTs:S});case 60:case"end":return n.stop()}}),n,null,[[4,19,22,25],[27,49,52,55]])}))),lm("EXTENSION_USAGE_UPLOAD_INTERVAL"))}}},{key:"startUploadUplinkStats",value:function(){var e=this;this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e);n&&(e.uploadUplinkStats(n),e.lastStats=n)}),3e3),this.uplinkStatsUploadSlowInterval&&window.clearInterval(this.uplinkStatsUploadSlowInterval),this.uplinkStatsUploadSlowInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e);n&&e.uploadSlowUplinkStats(n)}),6e4),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e);n&&e.uploadRelatedUplinkStats(n,e.lastStats),e.lastStats=n}),1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestAllTracks)||void 0===t?void 0:t.call(e);n&&e.uploadDenoiserStats(n)}),2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestAllTracks)||void 0===t?void 0:t.call(e);n&&e.uploadExtensionStats(n)}),2e3))}},{key:"uploadTransportStats",value:function(e){var t=this;RS((function(){var n;null===(n=t.requestUpload)||void 0===n||n.call(t,Xg.TRANSPORT_STATS,function(e){var t={connectionType:100,googRtt:e.rtt};if("relay"===e.selectedCandidatePair.localCandidate.candidateType){var n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t.connectionType=101),"tcp"===n&&(t.connectionType=103),"tls"===n&&(t.connectionType=104)}return t}(e))}))}},{key:"uploadUplinkStats",value:function(e){var t,n=this;((null===(t=this.requestLocalMedia)||void 0===t?void 0:t.call(this))||[]).forEach((function(t){var r=a(t,2),i=r[0],o=r[1],s=o.track,c=o.ssrcs;switch(i){case HE.LocalVideoLowTrack:case HE.LocalVideoTrack:var u=function(e,t,n){var r,i=t.videoSend.find((function(t){return t.ssrc===e}));if(!i)return null;var o={id:hS(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:i.ssrc.toString()};switch(o.A_vstd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",i.sentFrame&&(o.A_fhs=i.sentFrame.height.toString(),o.A_frs=i.sentFrame.frameRate.toString(),o.A_fws=i.sentFrame.width.toString()),i.adaptionChangeReason){case"none":o.A_ac="0";break;case"cpu":o.A_ac="1";break;case"bandwidth":o.A_ac="2";break;case"other":o.A_ac="3"}return o.A_lvps=Ag[n._player?n._player.videoElementStatus:"uninit"].toString(),o.A_nr=null===(r=i.nacksCount)||void 0===r?void 0:r.toString(),i.avgEncodeMs&&(o.A_aem=i.avgEncodeMs.toFixed(0).toString()),o}(c[0].ssrcId,e,s),l=i===HE.LocalVideoTrack?nS(c[0].ssrcId,e,s):null;u&&RS((function(){var e;return null===(e=n.requestUpload)||void 0===e?void 0:e.call(n,Xg.PUBLISH_STATS,{stream_type:i===HE.LocalVideoLowTrack?"low":"high",stats:wk(wk({},u),l)})}));var f=function(e){var t={id:"bweforvideo",timestamp:new Date(e.timestamp).toISOString(),type:"VideoBwe"};return e.bitrate.retransmit&&(t.A_rb=e.bitrate.retransmit.toString()),e.bitrate.targetEncoded&&(t.A_teb=e.bitrate.targetEncoded.toString()),t.A_aeb=e.bitrate.actualEncoded.toString(),t.A_tb=e.bitrate.transmit.toString(),void 0!==e.sendBandwidth&&(t.A_asb=e.sendBandwidth.toString()),t}(e);f&&setTimeout((function(){var e;return null===(e=n.requestUpload)||void 0===e?void 0:e.call(n,Xg.PUBLISH_STATS,{stream_type:i===HE.LocalVideoLowTrack?"low":"high",stats:f})}),1e3);break;case HE.LocalAudioTrack:var d=function(e,t,n){var r=t.audioSend.find((function(t){return t.ssrc===e}));if(!r)return null;var i={id:hS(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:r.ssrc.toString()};return i.A_astd=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?"0":"1",r.inputLevel?i.A_ail=Math.round(100*r.inputLevel).toString():i.A_ail=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),i.A_apil=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),r.aecReturnLoss&&(i.A_ecrl=Math.round(r.aecReturnLoss).toString()),r.aecReturnLossEnhancement&&(i.A_ecrle=Math.round(r.aecReturnLossEnhancement).toString()),i}(c[0].ssrcId,e,s);d&&RS((function(){var e;return null===(e=n.requestUpload)||void 0===e?void 0:e.call(n,Xg.PUBLISH_STATS,{stream_type:"high",stats:d})}))}}))}},{key:"uploadSlowUplinkStats",value:function(e){var t,n=this;((null===(t=this.requestLocalMedia)||void 0===t?void 0:t.call(this))||[]).filter((function(e){var t=a(e,1)[0];return t===HE.LocalVideoLowTrack||t===HE.LocalVideoTrack})).forEach((function(t){var r=a(t,2),i=r[0],o=nS(r[1].ssrcs[0].ssrcId,e);o&&RS((function(){var e;return null===(e=n.requestUpload)||void 0===e?void 0:e.call(n,Xg.PUBLISH_STATS,{stream_type:i===HE.LocalVideoLowTrack?"low":"high",stats:o})}))}))}},{key:"uploadRelatedUplinkStats",value:function(e,t){var n,r=this;((null===(n=this.requestLocalMedia)||void 0===n?void 0:n.call(this))||[]).filter((function(e){var t=a(e,1)[0];return t===HE.LocalVideoLowTrack||t===HE.LocalVideoTrack})).forEach((function(t){var n=a(t,2),i=n[0],o=function(e,t){var n=t.videoSend.find((function(t){return t.ssrc===e}));return n?{mediaType:"video",isVideoMute:!1,frameRateInput:n.inputFrame&&n.inputFrame.frameRate.toString(),frameRateSent:n.sentFrame&&n.sentFrame.frameRate.toString(),googRtt:n.rttMs.toString(),qpSumPerFrame:Math.floor(n.qpSumPerFrame).toString()}:null}(n[1].ssrcs[0].ssrcId,e);o&&RS((function(){var e;null===(e=r.requestUpload)||void 0===e||e.call(r,Xg.PUBLISH_RELATED_STATS,{stream_type:i===HE.LocalVideoLowTrack?"low":"high",stats:o})}))}))}},{key:"uploadDenoiserStats",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof BT){var r,i,o,a=null===(r=(i=n._external).getDenoiserStats)||void 0===r?void 0:r.call(i);return void(a&&(null===(o=this.requestUpload)||void 0===o||o.call(this,Xg.DENOISER_STATS,a)))}}}},{key:"uploadExtensionStats",value:function(e){for(var t=this,n=0;n<e.length;n++)e[n].getProcessorStats().forEach((function(e){var n;null===(n=t.requestUpload)||void 0===n||n.call(t,e.type,e.stats)}))}},{key:"stopUploadUplinkStats",value:function(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}},{key:"startUploadDownlinkStats",value:function(){var e=this;if(!this.uploadDownlinkStarted){var t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);var n=!1;this.downlinkStatsUploadInterval=window.setInterval((function(){var r,i=null===(r=e.requestStats)||void 0===r?void 0:r.call(e);i&&(e.uploadDownlinkStats(i,n,t),t=i),n=!n}),3e3),this.downlinkStatsUploadSlowInterval&&window.clearInterval(this.downlinkStatsUploadSlowInterval),this.downlinkStatsUploadSlowInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e);n&&e.uploadSlowDownlinkStats(n)}),6e4),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e);n&&(e.uploadRelatedDownlinkStats(n,e.lastStats),e.lastStats=n)}),1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestRemoteMedia)||void 0===t?void 0:t.call(e);n&&e.uploadDownlinkExtensionStats(n)}),2e3)}}},{key:"uploadDownlinkStats",value:function(e,t,n){var r,i=this;((null===(r=this.requestRemoteMedia)||void 0===r?void 0:r.call(this))||[]).forEach((function(r){var o=a(r,2),s=o[0],c=o[1];if(c.has(qE.VIDEO)&&s.videoTrack){var u=s.videoTrack?function(e,t,n,r,i){var o=t.videoRecv.find((function(t){return t.ssrc===e}));if(!o)return null;var a,s,c={id:hS(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:o.ssrc.toString()};if(c.bytesReceived=o.bytes.toString(),c.packetsLost=o.packetsLost.toString(),c.packetsReceived=o.packets.toString(),o.framesRateFirefox&&(c.A_frr=o.framesRateFirefox.toString()),o.receivedFrame?(c.A_frr=o.receivedFrame.frameRate.toString(),c.A_fhr=o.receivedFrame.height.toString(),c.A_fwr=o.receivedFrame.width.toString()):(c.A_fhr=null===(a=r._videoHeight)||void 0===a?void 0:a.toString(),c.A_fwr=null===(s=r._videoWidth)||void 0===s?void 0:s.toString()),c.A_frd=o.decodeFrameRate.toString(),o.outputFrame&&(c.A_fro=o.outputFrame.frameRate.toString()),void 0!==o.jitterBufferMs&&(c.A_jbm=Math.floor(o.jitterBufferMs).toString()),void 0!==o.currentDelayMs&&(c.A_cdm=Math.floor(o.currentDelayMs).toString()),c.A_fs=o.firsCount.toString(),c.A_ns=o.nacksCount.toString(),c.A_ps=o.plisCount.toString(),r&&(c.A_vrtd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),r._player&&r._player.freezeTimeCounterList.length>0&&(c.A_vrft=Math.round(r._player.freezeTimeCounterList.splice(0,1)[0]).toString()),i&&r._player&&"visible"===JT.visibility){var u=Math.min(6e3,r._player.renderFreezeAccTime);c.A_vrrft=Math.round(u).toString(),r._player.renderFreezeAccTime=Math.max(0,r._player.renderFreezeAccTime-u)}if(c.A_rvps=Ag[r._player?r._player.videoElementStatus:"uninit"].toString(),n){var l=n.videoRecv.find((function(t){return t.ssrc===e}));if(l&&void 0!==o.totalInterFrameDelay&&void 0!==o.totalSquaredInterFrameDelay&&void 0!==l.totalInterFrameDelay&&void 0!==l.totalSquaredInterFrameDelay){var f=o.totalInterFrameDelay-l.totalInterFrameDelay,d=o.totalSquaredInterFrameDelay-l.totalSquaredInterFrameDelay,p=o.framesDecodeCount-l.framesDecodeCount,h=f/p*1e3,v=Math.round(1e3*Math.sqrt((d-Math.pow(f,2)/p)/p));!isNaN(v)&&h+v>Math.max(3*h,h+150)&&(c.A_ifdsd=v.toString())}}return c}(s._videoSSRC,e,n,s.videoTrack,t):void 0;u&&RS((function(){var e;return null===(e=i.requestUpload)||void 0===e?void 0:e.call(i,Xg.SUBSCRIBE_STATS,{stream_id:s.uid,stats:u})}))}if(c.has(qE.AUDIO)&&s.audioTrack){var l=s.audioTrack?function(e,t,n,r){var i=t.audioRecv.find((function(t){return t.ssrc===e}));if(!i)return null;var o={id:hS(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:i.ssrc.toString()};if(o.bytesReceived=i.bytes.toString(),o.packetsLost=i.packetsLost.toString(),o.packetsReceived=i.packets.toString(),i.outputLevel?o.A_aol=Math.round(100*i.outputLevel).toString():o.A_aol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),o.A_apol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),r&&(o.A_artd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),o.A_jr=i.jitterMs.toString(),o.A_jbm=Math.floor(i.jitterBufferMs).toString(),o.A_cdm=Math.floor(i.jitterBufferMs).toString(),o.A_raps=Ag[ky.getPlayerState(r.getTrackId())].toString(),n){var a=n.audioRecv.find((function(t){return t.ssrc===e}));if(a){var s=i.concealedSamples-a.concealedSamples;s>0&&(o.A_cs=Math.round(s).toString())}}return o}(s._audioSSRC,e,n,s.audioTrack):void 0;l&&RS((function(){var e;return null===(e=i.requestUpload)||void 0===e?void 0:e.call(i,Xg.SUBSCRIBE_STATS,{stream_id:s.uid,stats:l})}))}}))}},{key:"uploadSlowDownlinkStats",value:function(e){}},{key:"uploadRelatedDownlinkStats",value:function(e,t){var n,r=this;((null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[]).forEach((function(n){var i=a(n,2),o=i[0],s=i[1];if(s.has(qE.VIDEO)&&o.videoTrack){var c,u=!0===(o._videoSSRC&&(null===(c=r.requestVideoIsReady)||void 0===c?void 0:c.call(r,o._videoSSRC))||!1),l=function(e,t,n,r,i,o){var a=n.videoRecv.find((function(t){return t.ssrc===e})),s=i?i.videoRecv.find((function(t){return t.ssrc===e})):void 0;if(!a)return null;var c=YT.isRemoteVideoFreeze(o,a,s)&&t,u={mediaType:"video",isVideoMute:!1,peerId:r,frameRateReceived:a.receivedFrame&&a.receivedFrame.frameRate.toString(),frameRateDecoded:a.decodedFrame&&a.decodedFrame.frameRate.toString(),isFreeze:c,bytesReceived:a.bytes.toString(),packetsReceived:a.packets.toString(),packetsLost:a.packetsLost.toString(),qpSumPerFrame:Math.floor(a.qpSumPerFrame).toString()};return a.framesRateFirefox&&(u.frameRateDecoded=a.framesRateFirefox.toString(),u.frameRateReceived=a.framesRateFirefox.toString()),u}(o._videoSSRC,u,e,o.uid,t,o.videoTrack);l&&RS((function(){var e;null===(e=r.requestUpload)||void 0===e||e.call(r,Xg.SUBSCRIBE_RELATED_STATS,{stream_id:o.uid,stats:l})}))}if(s.has(qE.AUDIO)&&o.audioTrack){var f=function(e,t,n,r){var i=t.audioRecv.find((function(t){return t.ssrc===e}));if(!i)return null;var o=YT.isRemoteAudioFreeze(r);return{mediaType:"audio",isAudioMute:!1,peerId:n,googJitterReceived:i.jitterMs.toString(),isFreeze:o,bytesReceived:i.bytes.toString(),packetsReceived:i.packets.toString(),packetsLost:i.packetsLost.toString(),frameReceived:i.receivedFrames.toString(),frameDropped:i.droppedFrames.toString()}}(o._audioSSRC,e,o.uid,o.audioTrack);f&&RS((function(){var e;null===(e=r.requestUpload)||void 0===e||e.call(r,Xg.SUBSCRIBE_RELATED_STATS,{stream_id:o.uid,stats:f})}))}}))}},{key:"stopUploadDownlinkStats",value:function(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}},{key:"stopUploadTransportStats",value:function(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}},{key:"stopUploadExtensionUsageStats",value:function(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}},{key:"uploadDownlinkExtensionStats",value:function(e){var t=this;e.forEach((function(e){var n=a(e,2),r=n[0],i=n[1];i.has(qE.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach((function(e){var n;null===(n=t.requestUpload)||void 0===n||n.call(t,e.type,e.stats)})),i.has(qE.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach((function(e){var n;null===(n=t.requestUpload)||void 0===n||n.call(t,e.type,e.stats)}))}))}}]),n}(jv),Ik="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n",Ak="9",kk=2e4,Ck=4e4,Nk=function(){function e(t){h(this,e),Mp(this,"sessionDesc",void 0),Mp(this,"_localCapabilities",void 0),Mp(this,"_rtpCapabilities",void 0),Mp(this,"_candidates",void 0),Mp(this,"_iceParameters",void 0),Mp(this,"_dtlsParameters",void 0),Mp(this,"setup",void 0),Mp(this,"currentMidIndex",void 0),Mp(this,"cname",void 0),Mp(this,"firefoxSsrcMidMap",new Map);var n=t=OS(t),r=n.remoteIceParameters,i=n.remoteDtlsParameters,o=n.candidates,a=n.remoteRTPCapabilities,c=n.remoteSetup,u=n.localCapabilities,l=n.cname,f=aA.exports.parse(Ik);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u,this.setup=c,this.cname=l;var d,p=this.rtpCapabilities.send,v=s(f.mediaDescriptions);try{for(v.s();!(d=v.n()).done;){var m=d.value;if(m.attributes.iceUfrag=r.iceUfrag,m.attributes.icePwd=r.icePwd,m.attributes.fingerprints=i.fingerprints,m.attributes.candidates=o,m.attributes.setup=c,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType&&(m.media.fmts=p.videoCodecs.map((function(e){return e.payloadType.toString(10)})),m.attributes.payloads=p.videoCodecs,m.attributes.extmaps=p.videoExtensions,lm("PRELOAD_MEDIA_COUNT")>0)){var g=pA([{ssrcId:Ck,rtx:lm("USE_RTX")?40001:void 0}],this.cname),E=g.ssrcs,_=g.ssrcGroups;m.attributes.ssrcs=E,m.attributes.ssrcGroups=_}if("audio"===m.media.mediaType&&(m.media.fmts=p.audioCodecs.map((function(e){return e.payloadType.toString(10)})),m.attributes.payloads=p.audioCodecs,m.attributes.extmaps=p.audioExtensions,wA(m),lm("PRELOAD_MEDIA_COUNT")>0)){var b=pA([{ssrcId:kk}],this.cname),y=b.ssrcs,T=b.ssrcGroups;m.attributes.ssrcs=y,m.attributes.ssrcGroups=T}}}catch(S){v.e(S)}finally{v.f()}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}return v(e,[{key:"localCapabilities",get:function(){return OS(this._localCapabilities)}},{key:"rtpCapabilities",get:function(){return OS(this._rtpCapabilities)}},{key:"candidates",get:function(){return OS(this._candidates)}},{key:"iceParameters",get:function(){return OS(this._iceParameters)}},{key:"dtlsParameters",get:function(){return OS(this._dtlsParameters)}},{key:"updateRemoteRTPCapabilities",value:function(e){var t=aA.exports.parse(Ik);this._rtpCapabilities=e;var n,r=this.rtpCapabilities.send,i=s(t.mediaDescriptions);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,"application"===o.media.mediaType&&(o.attributes.sctpPort="5000"),"video"===o.media.mediaType&&(o.media.fmts=r.videoCodecs.map((function(e){return e.payloadType.toString(10)})),o.attributes.payloads=r.videoCodecs,o.attributes.extmaps=r.videoExtensions,lm("PRELOAD_MEDIA_COUNT")>0)){var a=pA([{ssrcId:Ck,rtx:lm("USE_RTX")?40001:void 0}],this.cname),c=a.ssrcs,u=a.ssrcGroups;o.attributes.ssrcs=c,o.attributes.ssrcGroups=u}if("audio"===o.media.mediaType&&(o.media.fmts=r.audioCodecs.map((function(e){return e.payloadType.toString(10)})),o.attributes.payloads=r.audioCodecs,o.attributes.extmaps=r.audioExtensions,lm("PRELOAD_MEDIA_COUNT")>0)){var l=pA([{ssrcId:kk}],this.cname),f=l.ssrcs,d=l.ssrcGroups;o.attributes.ssrcs=f,o.attributes.ssrcGroups=d}}}catch(p){i.e(p)}finally{i.f()}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}},{key:"preloadRemoteMedia",value:function(e){this.rtpCapabilities;for(var t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send,o=1;o<e;o++){var a=2*o+Ck,s=pA([{ssrcId:2*o+kk}],this.cname),c=s.ssrcs,u=s.ssrcGroups,l=pA([{ssrcId:a,rtx:lm("USE_RTX")?a+1:void 0}],this.cname),f=l.ssrcs,d=l.ssrcGroups;this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Ak,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Ak,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.currentMidIndex+=2}this.updateBundleMids()}},{key:"toString",value:function(){return aA.exports.print(this.sessionDesc)}},{key:"send",value:function(e,t,n,r){var i=pA(t,this.cname,lm("AV_SYNC")?n:void 0),o=i.ssrcs,a=i.ssrcGroups,s=this.findPreloadMediaDesc(o);if(s){if(dp()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){var c=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}var u,l=this.findAvailableMediaIndex(e,o);return-1===l||fp()||pp()||gp()?(u=this.createOrRecycleSendMedia(e,o,a,"sendonly",r),this.updateBundleMids()):((u=OS(this.sessionDesc.mediaDescriptions[l])).attributes.direction="sendonly",u.attributes.ssrcs=o,u.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(u,r)),dp()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}},{key:"batchSend",value:function(e){var t=this,n=e.map((function(e){var n=e.kind,r=e.ssrcMsg,i=e.mslabel;return t.send(n,r,i)})),r=[],i=!1;return n.forEach((function(e){var t=e.mid;e.needExchangeSDP&&(i=!0),r.push(t)})),{mids:r,needExchangeSDP:i}}},{key:"stopSending",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((function(e){"0"===e.attributes.mid||dp()||fp()||pp()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}},{key:"mute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}},{key:"unmute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}},{key:"muteRemote",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return e.includes(t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="inactive"}))}},{key:"unmuteRemote",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return e.includes(t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="recvonly"}))}},{key:"receive",value:function(e,t,n,r){var i=this;e.forEach((function(e,o){i.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[o])})),this.updateBundleMids()}},{key:"stopReceiving",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((function(e){e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}},{key:"restartICE",value:function(e){e=OS(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}},{key:"predictReceivingMids",value:function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}},{key:"findAvailableMediaIndex",value:function(e,t){var n=this;return this.sessionDesc.mediaDescriptions.findIndex((function(r){var i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(dp()){if(i){var o=n.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!o||o!==r.attributes.mid)}return!1}return i}))}},{key:"createOrRecycleRecvMedia",value:function(e,t,n,r,i,o){var a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=this.localCapabilities.send,u=[];if(a===qE.VIDEO){var l,f;if(lm("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(u=s.videoCodecs.filter((function(e){var t,n;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)&&(null==e||null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])===lm("H264_PROFILE_LEVEL_ID")}))),!u||0===(null===(l=u)||void 0===l?void 0:l.length)){var d=c.videoCodecs.filter((function(e){var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)}));0!==d.length&&(u=s.videoCodecs.filter((function(e){return d.some((function(t){return t.payloadType===e.payloadType}))})))}if(lm("USE_RTX")){var p=u.map((function(e){return e.payloadType.toString()})),h=s.videoCodecs.filter((function(e){var t,n;return"rtx"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)&&p.includes((null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)||"")}));u=[].concat(m(u),m(h))}0===u.length&&(Jv.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(f=s.videoCodecs[0].rtpMap)||void 0===f?void 0:f.encodingName)),u=s.videoCodecs)}else u=s.audioCodecs.filter((function(e){var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(i)})),0===u.length&&(Jv.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),u=s.audioCodecs.filter((function(e){var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes("opus")})));var v=a===qE.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;var g="".concat(this.currentMidIndex),E={media:{mediaType:a,port:Ak,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};E=this.mungRecvMediaDsec(E,e,o);var _=this.findFirstClosedMedia(a);if(_){var b=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[b]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}},{key:"createOrRecycleSendMedia",value:function(e,t,n,r,i){var o=this.rtpCapabilities.send,a=e===qE.VIDEO?o.videoCodecs:o.audioCodecs,s=e===qE.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;var c="".concat(this.currentMidIndex),u={media:{mediaType:e,port:Ak,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);var l=this.findFirstClosedMedia(e);if(l){var f=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[f]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}},{key:"updateBundleMids",value:function(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((function(e){return"0"!==e.media.port})).map((function(e){return e.attributes.mid}))}},{key:"mungRecvMediaDsec",value:function(e,t,n){var r=OS(e);return vA(r),hA(r,t),mA(r,t),gA(r),EA(r,n,this.localCapabilities.send),r}},{key:"mungSendMediaDesc",value:function(e,t){var n=OS(e);return EA(n,t,this.localCapabilities.recv),wA(n),n}},{key:"updateRecvMedia",value:function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}},{key:"bumpMid",value:function(e){this.currentMidIndex+=e}},{key:"findFirstClosedMedia",value:function(e){return this.sessionDesc.mediaDescriptions.find((function(t){return dp()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port}))}},{key:"findPreloadMediaDesc",value:function(e){return this.sessionDesc.mediaDescriptions.find((function(t){var n,r;return(null===(n=t.attributes)||void 0===n||null===(r=n.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId}))}},{key:"getSSRC",value:function(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e})))||void 0===t?void 0:t.attributes.ssrcs}}]),e}();function xk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xk(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pk,Lk=(_b((Rk=function(e){d(n,e);var t=p(n);function n(e,r,i){var o;return h(this,n),o=t.call(this,e,r),Mp(l(o),"store",void 0),Mp(l(o),"peerConnection",void 0),Mp(l(o),"remoteSDP",void 0),Mp(l(o),"initialOffer",void 0),Mp(l(o),"transportEventReceiver",void 0),Mp(l(o),"statsFilter",void 0),Mp(l(o),"useRTX",lm("USE_RTX")),Mp(l(o),"localCapabilities",void 0),Mp(l(o),"localCandidateCount",0),Mp(l(o),"allCandidatesReceived",!1),Mp(l(o),"establishPromise",void 0),Mp(l(o),"mutex",new zb("NVExtentionsConnection-mutex")),Mp(l(o),"rtcMedia",void 0),o.store=r,o.peerConnection=i,o.statsFilter=KA(o.peerConnection,void 0,void 0,dp()?1200:void 0),o.bindPCEvents(),o.bindStatsEvents(),o.store.p2pId=o.store.p2pId+1,o.establishPromise=o.establish(),o}return v(n,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"establish",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.createOffer();case 3:if((n=e.sent).sdp){e.next=6;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 6:return r=lA(n.sdp),e.next=9,bA(!this.useRTX,lm("FILTER_VIDEO_FEC"),lm("FILTER_AUDIO_FEC"));case 9:return i=e.sent,e.abrupt("return",(this.localCapabilities=i,this.initialOffer=n,Dk(Dk({},r),{},{rtpCapabilities:i,offerSDP:n.sdp})));case 13:throw e.prev=13,e.t0=e.catch(0),new Bv(Lv.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 16:case"end":return e.stop()}}),e,this,[[0,13]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=u(c().mark((function e(t,n,r,i,o,a){var s,u,l,f,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish NVConnection without initial offer.");case 3:return this.remoteSDP=new Nk({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:SA(this.localCapabilities),cname:a}),s=this.remoteSDP.toString(),u=aA.exports.parse(this.initialOffer.sdp),(l=u.mediaDescriptions.find((function(e){return"audio"===e.media.mediaType})))&&wA(l),f=aA.exports.print(u),d=this.logSDPExchange(f||"","offer","local","connect"),e.next=9,this.peerConnection.setLocalDescription({type:"offer",sdp:f});case 9:return null==d||d(s),e.next=12,this.peerConnection.setRemoteDescription({type:"answer",sdp:s});case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(e.t0.toString()));case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));function t(t,n,r,i,o,a){return e.apply(this,arguments)}return t}()},{key:"updateRemoteConnect",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=this.remoteSDP)||void 0===n||n.updateRemoteRTPCapabilities(t),null===(r=this.remoteSDP)||void 0===r||r.preloadRemoteMedia(2),o=null===(i=this.remoteSDP)||void 0===i?void 0:i.toString(),e.next=4,this.peerConnection.setRemoteDescription({type:"offer",sdp:o});case 4:return e.next=6,this.peerConnection.createAnswer();case 6:return a=e.sent,e.next=9,this.peerConnection.setLocalDescription(a);case 9:Jv.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.");case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"send",value:function(e,t,n){var r=this;return tA(c().mark((function i(){var o,a,s,u,l,f,d,p,h,v,m;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,nA(r.mutex.lock("From NVExtentionsConnection.send"));case 2:if(o=i.sent,i.prev=3,r.remoteSDP){i.next=6;break}throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");case 6:if(a=[],e.forEach((function(e){var t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});a.push(t)})),i.t0=dp()&&!0===lm("SIMULCAST"),!i.t0){i.next=12;break}return i.next=12,nA(r.applySimulcastForFirefox(a,e));case 12:return i.next=14,nA(r.peerConnection.createOffer());case 14:return s=i.sent,u=r.remoteSDP.predictReceivingMids(e.length),l=r.mungSendOfferSDP(s.sdp,e,u),f=aA.exports.parse(l),d=u.map((function(e){var t=f.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return fA(t,r.useRTX)})),i.prev=19,i.next=22,d;case 22:p=i.sent,i.next=36;break;case 25:return i.prev=25,i.t1=i.catch(19),p=[],r.remoteSDP.receive(e,t,n,p),h=r.remoteSDP.toString(),i.next=31,nA(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));case 31:return i.next=33,nA(r.peerConnection.setRemoteDescription({type:"answer",sdp:h}));case 33:return i.next=35,nA(r.stopSending(u,!0));case 35:throw i.t1;case 36:return r.remoteSDP.receive(e,t,n,p),v=r.remoteSDP.toString(),m=r.logSDPExchange(l,"offer","local","send"),i.next=40,nA(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));case 40:return i.next=42,nA(r.applySimulcastEncodings(a,e));case 42:return i.next=44,nA(r.applySendEncodings(a,e));case 44:return null==m||m(v),i.next=47,nA(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}));case 47:return i.abrupt("return",a.map((function(e,t){var n=u[t];return{localSSRC:d[t],id:n,transceiver:e}})));case 50:throw i.prev=50,i.t2=i.catch(3),i.t2 instanceof Bv?i.t2:new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(i.t2.toString()));case 53:return i.prev=53,o(),i.finish(53);case 56:case"end":return i.stop()}}),i,null,[[3,50,53,56],[19,25]])})))()}},{key:"stopSending",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.mutex.lock("From NVExtentionsConnection.stopSending");case 6:e.t0=e.sent;case 7:if(r=e.t0,e.prev=8,this.remoteSDP){e.next=11;break}throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");case 11:if(i=this.peerConnection.getTransceivers().filter((function(e){return-1!==t.indexOf(e.mid)})),i.length===t.length){e.next=14;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");case 14:return i.map((function(e){var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)})),e.next=17,this.peerConnection.createOffer();case 17:return o=e.sent,a=this.logSDPExchange(o.sdp||"","offer","local","stopSending"),e.next=21,this.peerConnection.setLocalDescription(o);case 21:return this.remoteSDP.stopReceiving(t),s=this.remoteSDP.toString(),null==a||a(s),e.next=26,this.peerConnection.setRemoteDescription({type:"answer",sdp:s});case 26:e.next=31;break;case 28:throw e.prev=28,e.t1=e.catch(8),new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(e.t1.toString()));case 31:return e.prev=31,r&&r(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[8,28,31,34]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=u(c().mark((function e(t,n,r,i){var o,a,s,u,l,f,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));case 3:if(o=this.remoteSDP.send(t,n,r,i),a=o.mid,!o.needExchangeSDP){e.next=18;break}return s=this.remoteSDP.toString(),u=this.logSDPExchange(s,"offer","remote","receive"),e.next=8,this.peerConnection.setRemoteDescription({type:"offer",sdp:s});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return l=e.sent,f=this.mungReceiveAnswerSDP(l.sdp,a,t),null==u||u(f||""),e.next=15,this.peerConnection.setLocalDescription({type:"answer",sdp:f});case 15:Jv.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP.")),e.next=19;break;case 18:Jv.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));case 19:if(d=this.peerConnection.getTransceivers().find((function(e){return e.mid===a}))){e.next=22;break}throw new Error("Cannot get transceiver after setLocalDescription.");case 22:return e.abrupt("return",{track:d.receiver.track,id:a});case 25:throw e.prev=25,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.t0.toString()));case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"batchReceive",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");case 3:if(n=this.remoteSDP.batchSend(t),r=n.mids,!n.needExchangeSDP){e.next=17;break}return i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","receive"),e.next=8,this.peerConnection.setRemoteDescription({type:"offer",sdp:i});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return a=e.sent,null==o||o(a.sdp||""),e.next=14,this.peerConnection.setLocalDescription(a);case 14:Jv.debug("[NVExtentionsConnection] batchReceive by exchanging SDP."),e.next=18;break;case 17:Jv.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");case 18:return e.abrupt("return",r.map((function(e){var t=s.peerConnection.getTransceivers().find((function(t){return t.mid===e}));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e}})));case 21:throw e.prev=21,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.t0.toString()));case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");case 3:return this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.mute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.unmute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map((function(e){e.direction="inactive"})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.muteRemote(t),o=this.remoteSDP.toString(),null==i||i(o),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:o});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map(function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.direction="sendonly";case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.unmuteRemote(t),o=this.remoteSDP.toString(),null==i||i(o),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:o});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(){var e=this;return tA(c().mark((function t(){var n,r,i,o,a,s,u;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,nA(e.mutex.lock("From NVExtentionsConnection.restartICE"));case 2:return n=t.sent,t.prev=3,t.next=6,nA(e.peerConnection.createOffer({iceRestart:!0}));case 6:if((r=t.sent).sdp){t.next=9;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 9:return i=lA(r.sdp),t.next=12,i.iceParameters;case 12:if(o=t.sent,a=o.remoteIceParameters,e.remoteSDP){t.next=16;break}throw new Error("Cannot restartICE before remoteSDP created.");case 16:return e.remoteSDP.restartICE(a),s=e.remoteSDP.toString(),u=e.logSDPExchange(r.sdp||"","offer","local","restartICE"),t.next=20,nA(e.peerConnection.setLocalDescription(r));case 20:return null==u||u(s),t.next=23,nA(e.peerConnection.setRemoteDescription({type:"answer",sdp:s}));case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(3),Jv.warning("restart ICE failed, abort operation",t.t0);case 28:return t.prev=28,n(),t.finish(28);case 31:case"end":return t.stop()}}),t,null,[[3,25,28,31]])})))()}},{key:"close",value:function(){var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}},{key:"getStats",value:function(){return this.statsFilter.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this.statsFilter.getVideoIsReady(e)}},{key:"updateEncoderConfig",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n],[t]),this.remoteSDP.updateRecvMedia(t,n),o=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig"),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return null==a||a(o),e.next=14,this.peerConnection.setRemoteDescription({type:"answer",sdp:o});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(0),new Bv(Lv.EXCHANGE_SDP_FAILED,e.t0.toString());case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().filter((function(e){return e.mid===t})),e.t0=1===r.length,!e.t0){e.next=12;break}if(!this.isVP8Simulcast(n)){e.next=10;break}if(e.t1=dp(),e.t1){e.next=8;break}return e.next=8,this.applySimulcastEncodings(r,[n]);case 8:e.next=12;break;case 10:return e.next=12,this.applySendEncodings(r,[n]);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this.statsFilter.setVideoIsReady2(e,t)}},{key:"replaceTrack",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().find((function(e){return e.mid===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.sender.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getP2PConnectionParams",value:function(){var e;if(null===(e=this.peerConnection.currentLocalDescription)||void 0===e||!e.sdp||!this.localCapabilities)throw new Error;return Dk(Dk({},lA(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}},{key:"bindPCEvents",value:function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidate=function(t){t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,Jv.debug("[pc-".concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,Jv.debug("[pc-".concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),lm("CANDIDATE_TIMEOUT"))}},{key:"unbindPCEvents",value:function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}},{key:"applySendEncodings",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s,u,l,f,d,p,h,v,m,g;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s_().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=32;break}if(i=t[r],!((o=n[r])&&o instanceof zR)){e.next=29;break}if(!this.isVP8Simulcast(o)){e.next=11;break}return e.abrupt("continue",29);case 11:u={},l={},e.t0=o._optimizationMode,e.next="motion"===e.t0?15:"detail"===e.t0?17:19;break;case 15:return u.degradationPreference="maintain-framerate",e.abrupt("break",20);case 17:return u.degradationPreference="maintain-resolution",e.abrupt("break",20);case 19:u.degradationPreference="balanced";case 20:return null!==(a=o._encoderConfig)&&void 0!==a&&a.bitrateMax&&(l.maxBitrate=1e3*(null===(f=o._encoderConfig)||void 0===f?void 0:f.bitrateMax)),o._hints.includes(CE.LOW_STREAM)&&(null!==(d=o._encoderConfig)&&void 0!==d&&d.frameRate&&(l.maxFramerate=eS(o._encoderConfig.frameRate)),null!==(p=o._encoderConfig)&&void 0!==p&&p.scaleResolutionDownBy&&(null===(h=o._encoderConfig)||void 0===h?void 0:h.scaleResolutionDownBy)>1&&(l.scaleResolutionDownBy=o._encoderConfig.scaleResolutionDownBy)),lm("DSCP_TYPE")&&Op()&&(v=lm("DSCP_TYPE"),["very-low","low","medium","high"].includes(v)&&(l.networkPriority=v)),m=i.sender.getParameters(),g=null===(s=m.encodings)||void 0===s?void 0:s[0],dp()&&!g&&(u.encodings=[l]),g&&Object.assign(g,l),Object.assign(m,u),e.next=29,i.sender.setParameters(m);case 29:r++,e.next=6;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(0),Jv.debug("Apply RTPSendEncodings failed.");case 37:case"end":return e.stop()}}),e,this,[[0,34]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"mungSendOfferSDP",value:function(e,t,n){var r=this,i=aA.exports.parse(e);return t.forEach((function(e,t){var o=n[t],a=i.mediaDescriptions.find((function(e){return e.attributes.mid===o}));a&&(hA(a,e),_A(a,e,r.store.codec))})),aA.exports.print(i)}},{key:"mungReceiveAnswerSDP",value:function(e,t,n){var r=aA.exports.parse(e),i=r.mediaDescriptions.find((function(e){return e.attributes.mid===t}));return i&&n===qE.AUDIO&&"audio"===i.media.mediaType&&wA(i),aA.exports.print(r)}},{key:"bindStatsEvents",value:function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=function(t){var n;null===(n=e.onFirstVideoDecodedTimeout)||void 0===n||n.call(e,t)}}},{key:"unbindStatsEvents",value:function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}},{key:"applySimulcastForFirefox",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s,u,l,f,d,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(u=t[r],!((l=n[r])instanceof zR&&!l._hints.includes(CE.LOW_STREAM)&&null!==(i=l._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(o=l._encoderConfig)||void 0===o?void 0:o.bitrateMax)>200&&null!==(a=l._scalabiltyMode)&&void 0!==a&&a.numSpatialLayers&&(null===(s=l._scalabiltyMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec)){e.next=10;break}return f={},d={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4},f.encodings=[{rid:"m",active:!0,maxBitrate:d.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:d.high}],p=u.sender.getParameters(),e.next=10,u.sender.setParameters(Object.assign(p,f));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"applySimulcastEncodings",value:function(){var e=u(c().mark((function e(t,n){var r,i,o,a,s,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dp()||t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(!((i=n[r])instanceof zR&&this.isVP8Simulcast(i))){e.next=10;break}return o=t[r],a={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4},a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}],u=o.sender.getParameters(),e.next=10,o.sender.setParameters(Object.assign(u,a));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"isVP8Simulcast",value:function(e){var t,n,r,i;return!!(e instanceof zR&&lm("SIMULCAST")&&"vp8"===this.store.codec&&!e._hints.includes(CE.LOW_STREAM)&&null!==(t=e._encoderConfig)&&void 0!==t&&t.bitrateMax&&(null===(n=e._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(r=e._scalabiltyMode)&&void 0!==r&&r.numSpatialLayers&&(null===(i=e._scalabiltyMode)||void 0===i?void 0:i.numSpatialLayers)>1)}},{key:"logSDPExchange",value:function(e,t,n,r){var i=this;if(lm("SDP_LOGGING"))return Jv.upload("exchanging ".concat(n," ").concat(t," SDP during NVExtentionsConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}},{key:"getRemoteSSRC",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP){e.next=2;break}return e.abrupt("return");case 2:return n=this.remoteSDP.getSSRC(t),e.abrupt("return",null==n?void 0:n[0].ssrcId);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setConfiguration",value:function(e){if(s_().supportPCSetConfiguration){var t=n.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[]};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(rE(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),lm("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),lm("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat($T(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!lm("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}}]),n}(i_)).prototype,"connect",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"connect"),Rk.prototype),_b(Rk.prototype,"updateRemoteConnect",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"updateRemoteConnect"),Rk.prototype),_b(Rk.prototype,"receive",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"receive"),Rk.prototype),_b(Rk.prototype,"batchReceive",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"batchReceive"),Rk.prototype),_b(Rk.prototype,"stopReceiving",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"stopReceiving"),Rk.prototype),_b(Rk.prototype,"muteRemote",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"muteRemote"),Rk.prototype),_b(Rk.prototype,"unmuteRemote",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"unmuteRemote"),Rk.prototype),_b(Rk.prototype,"muteLocal",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"muteLocal"),Rk.prototype),_b(Rk.prototype,"unmuteLocal",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"unmuteLocal"),Rk.prototype),_b(Rk.prototype,"close",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"close"),Rk.prototype),_b(Rk.prototype,"updateEncoderConfig",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"updateEncoderConfig"),Rk.prototype),_b(Rk.prototype,"updateSendParameters",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"updateSendParameters"),Rk.prototype),_b(Rk.prototype,"replaceTrack",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"replaceTrack"),Rk.prototype),_b(Rk.prototype,"getRemoteSSRC",[Mk],Object.getOwnPropertyDescriptor(Rk.prototype,"getRemoteSSRC"),Rk.prototype),Rk);function Mk(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=u(c().mark((function e(){var n,i,o,a,s,u=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From NVExtentionsConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,o=u.length,a=new Array(o),s=0;s<o;s++)a[s]=u[s];return e.next=8,r.apply(this,a);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function Uk(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=oA,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new jk(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function jk(e){function t(e){if(Object(e)!==e)return Bf.reject(new TypeError(e+" is not an object."));var t=e.done;return Bf.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(jk=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Bf.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Bf.reject(e):t(n.apply(this.s,arguments))}},new jk(e)}var Fk,Bk=(_b((Pk=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this,e,r),Mp(l(i),"store",void 0),Mp(l(i),"peerConnection",void 0),Mp(l(i),"cname",void 0),Mp(l(i),"mutex",new zb("DataChannelConnection-mutex")),Mp(l(i),"dataChannel",void 0),Mp(l(i),"_p2pConnection",void 0),Mp(l(i),"establishPromise",void 0),Mp(l(i),"_nvMedia",void 0),i.store=r,i.store.dcId=i.store.dcId+1,i.peerConnection=new RTCPeerConnection(n.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),i.dataChannel=i.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),i.dataChannel.binaryType="arraybuffer",i._p2pConnection=new Lk(e,r,i.peerConnection),i.bindPCEvents(),i.establishPromise=i._p2pConnection.establishPromise,i}return v(n,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"establish",value:function(){var e=u(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===(t=this._nvMedia)||void 0===t?void 0:t.getLocalRtpCapabilities(),e.next=3,this._p2pConnection.establish(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getP2PConnectionParams",value:function(){return this._p2pConnection.getP2PConnectionParams()}},{key:"connect",value:function(){var e=u(c().mark((function e(t,n,r,i,o,a){var s=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cname=a,e.next=3,this._p2pConnection.connect(t,n,r,i,o,a);case 3:return e.next=5,new Bf((function(e,t){var n=setTimeout((function(){s.closeSignal(),t(new Bv(Lv.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r))))}),2e3);s.dataChannel.onopen=function(){if("open"===s.dataChannel.readyState)return clearTimeout(n),void e()},s.dataChannel.onerror=function(e){s.closeSignal(),t(e)}}));case 5:return e.abrupt("return",{transmitter:this.dataChannel,close:this.closeSignal.bind(this)});case 6:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,o,a){return e.apply(this,arguments)}return t}()},{key:"send",value:function(e,t,n){var r=this;return tA(c().mark((function i(){var o;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,nA(r.mutex.lock("From DataChannelConnection.send"));case 2:return o=i.sent,i.prev=3,i.delegateYield(iA(Uk(r._p2pConnection.send(e,t,n)),nA),"t0",5);case 5:return i.abrupt("return",i.t0);case 6:return i.prev=6,o(),i.finish(6);case 9:case"end":return i.stop()}}),i,null,[[3,,6,9]])})))()}},{key:"stopSending",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._p2pConnection.stopSending(t,n));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=u(c().mark((function e(t,n,r,i){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._nvMedia){e.next=7;break}return Jv.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),e.next=4,this._nvMedia.reveiveByRTCMedia(t,n,this.cname);case 4:e.t0=e.sent,e.next=11;break;case 7:return Jv.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),e.next=10,this._p2pConnection.receive(t,n,r,i);case 10:e.t0=e.sent;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"batchReceive",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=m,e.next=3,this._p2pConnection.batchReceive(t);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.stopReceiving(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.muteRemote(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.unmuteRemote(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.muteLocal(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.unmuteLocal(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(){var e=this;return tA(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(iA(Uk(e._p2pConnection.restartICE()),nA),"t0",1);case 1:return t.abrupt("return",t.t0);case 2:case"end":return t.stop()}}),t)})))()}},{key:"close",value:function(){var e;null===(e=this._nvMedia)||void 0===e||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}},{key:"getStats",value:function(){return this._p2pConnection.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this._p2pConnection.getRemoteVideoIsReady(e)}},{key:"updateRemoteConnect",value:function(e){var t;null===(t=this._nvMedia)||void 0===t||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}},{key:"updateEncoderConfig",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.updateEncoderConfig(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.updateSendParameters(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}},{key:"replaceTrack",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.replaceTrack(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getRemoteSSRC",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._p2pConnection.getRemoteSSRC(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"logSDPExchange",value:function(e,t,n,r){var i=this;if(lm("SDP_LOGGING"))return Jv.upload("exchanging ".concat(n," ").concat(t," SDP during DataChannelConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}},{key:"bindPCEvents",value:function(){var e=this;this._p2pConnection.onICEConnectionStateChange=function(t){var n;return null===(n=e.onICEConnectionStateChange)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onConnectionStateChange=function(t){var n;return null===(n=e.onConnectionStateChange)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onDTLSTransportStateChange=function(t){var n;return null===(n=e.onDTLSTransportStateChange)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onDTLSTransportError=function(t){var n;return null===(n=e.onDTLSTransportError)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onICETransportStateChange=function(t){var n;return null===(n=e.onICETransportStateChange)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onFirstAudioReceived=function(t){var n;return null===(n=e.onFirstAudioReceived)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onFirstVideoReceived=function(t){var n;return null===(n=e.onFirstVideoReceived)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onFirstAudioDecoded=function(t){var n;return null===(n=e.onFirstAudioDecoded)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onFirstVideoDecoded=function(t,n,r){var i;return null===(i=e.onFirstVideoDecoded)||void 0===i?void 0:i.call(e,t,n,r)},this._p2pConnection.onFirstVideoDecodedTimeout=function(t){var n;return null===(n=e.onFirstVideoDecodedTimeout)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onSelectedLocalCandidateChanged=function(t,n){var r;return null===(r=e.onSelectedLocalCandidateChanged)||void 0===r?void 0:r.call(e,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=function(t,n){var r;return null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r?void 0:r.call(e,t,n)}}},{key:"closeSignal",value:function(){this.dataChannel.close(),this.peerConnection.close()}},{key:"unbindConnectionEvents",value:function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}},{key:"setConfiguration",value:function(e){this._p2pConnection.setConfiguration(e)}}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[]};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(rE(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),lm("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),lm("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat($T(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!lm("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}}]),n}(i_)).prototype,"connect",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"connect"),Pk.prototype),_b(Pk.prototype,"receive",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"receive"),Pk.prototype),_b(Pk.prototype,"stopReceiving",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"stopReceiving"),Pk.prototype),_b(Pk.prototype,"muteRemote",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"muteRemote"),Pk.prototype),_b(Pk.prototype,"unmuteRemote",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"unmuteRemote"),Pk.prototype),_b(Pk.prototype,"muteLocal",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"muteLocal"),Pk.prototype),_b(Pk.prototype,"unmuteLocal",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"unmuteLocal"),Pk.prototype),_b(Pk.prototype,"close",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"close"),Pk.prototype),_b(Pk.prototype,"updateEncoderConfig",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"updateEncoderConfig"),Pk.prototype),_b(Pk.prototype,"updateSendParameters",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"updateSendParameters"),Pk.prototype),_b(Pk.prototype,"replaceTrack",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"replaceTrack"),Pk.prototype),_b(Pk.prototype,"getRemoteSSRC",[Vk],Object.getOwnPropertyDescriptor(Pk.prototype,"getRemoteSSRC"),Pk.prototype),Pk);function Vk(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=u(c().mark((function e(){var n,i,o,a,s,u=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From DataChannelConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,o=u.length,a=new Array(o),s=0;s<o;s++)a[s]=u[s];return e.next=8,r.apply(this,a);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function Gk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gk(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qk(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=oA,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Hk(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Hk(e){function t(e){if(Object(e)!==e)return Bf.reject(new TypeError(e+" is not an object."));var t=e.done;return Bf.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(Hk=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Bf.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Bf.reject(e):t(n.apply(this.s,arguments))}},new Hk(e)}var Kk,zk=(_b((Fk=function(e){d(n,e);var t=p(n);function n(e,r){var i;return h(this,n),i=t.call(this),Mp(l(i),"store",void 0),Mp(l(i),"statsUploader",void 0),Mp(l(i),"connection",void 0),Mp(l(i),"localTrackMap",new Map),Mp(l(i),"remoteUserMap",new Map),Mp(l(i),"pendingLocalTracks",[]),Mp(l(i),"pendingRemoteTracks",[]),Mp(l(i),"statsCollector",void 0),Mp(l(i),"isPlanB",!1),Mp(l(i),"shouldForwardP2PCreation",void 0),Mp(l(i),"iceFailedCount",0),Mp(l(i),"dtlsFailedCount",0),Mp(l(i),"mutex",new zb("P2PChannel-mutex")),Mp(l(i),"_state",KE.Disconnected),Mp(l(i),"handleMuteLocalTrack",function(){var e=u(c().mark((function e(t,n,r){var o,s,u,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");case 2:if(o=e.sent,e.prev=3,i.connection&&i.state===KE.Connected){e.next=6;break}return e.abrupt("return",void r(new Bv(Lv.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established.")));case 6:if(0!==(s=i.filterTobeMutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:return u=s.find((function(e){return"videoLowTrack"===e[0]})),u&&u[1].track._originMediaStreamTrack.stop(),e.next=13,i.connection.muteLocal(s.map((function(e){return a(e,2)[1].id})));case 13:return f=i.createMuteMessage(s),e.next=16,bS(l(i),zE.RequestMuteLocal,f);case 16:n(),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(3),r(e.t0);case 22:return e.prev=22,o(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[3,19,22,25]])})));return function(t,n,r){return e.apply(this,arguments)}}()),Mp(l(i),"handleUnmuteLocalTrack",function(){var e=u(c().mark((function e(t,n,r){var o,s,u,f,d,p,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");case 2:if(o=e.sent,e.prev=3,i.connection&&i.state===KE.Connected){e.next=6;break}return e.abrupt("return",void r(new Bv(Lv.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established.")));case 6:if(0!==(s=i.filterTobeUnmutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:if(u=s.find((function(e){return"videoLowTrack"===e[0]})),!u){e.next=15;break}return(f=u[1]).track._originMediaStreamTrack.stop(),s_().supportDualStreamEncoding?(d=t._mediaStreamTrack.clone(),f.track._mediaStreamTrack=d,f.track._originMediaStreamTrack=d):(p=gk(t,TS(l(i),zE.RequestLowStreamParameter)),f.track._mediaStreamTrack=p,f.track._originMediaStreamTrack=p),e.next=15,new Bf((function(e,t){i.handleReplaceTrack(f.track,e,t,!0)}));case 15:return e.next=17,i.connection.unmuteLocal(s.map((function(e){return a(e,2)[1].id})));case 17:return h=i.createUnmuteMessage(s),e.next=20,bS(l(i),zE.RequestUnmuteLocal,h);case 20:n(),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),r(e.t0);case 26:return e.prev=26,o(),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[3,23,26,29]])})));return function(t,n,r){return e.apply(this,arguments)}}()),Mp(l(i),"handleUpdateVideoEncoder",function(){var e=u(c().mark((function e(t,n,r){var o,a,s,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");case 2:if(o=e.sent,e.prev=3,a=i.localTrackMap.get(HE.LocalVideoTrack),i.connection&&a&&a.track===t&&i.state===KE.Connected){e.next=7;break}return e.abrupt("return",void n());case 7:return s=a.id,u=a.track,e.next=10,i.connection.updateSendParameters(s,u);case 10:return e.next=12,i.connection.updateEncoderConfig(s,u);case 12:i.emit(zE.UpdateVideoEncoder,u),n(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),r(e.t0);case 19:return e.prev=19,o(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[3,16,19,22]])})));return function(t,n,r){return e.apply(this,arguments)}}()),Mp(l(i),"handleSetOptimizationMode",function(){var e=u(c().mark((function e(t,n,r){var o,a,s,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");case 2:if(o=e.sent,e.prev=3,a=i.localTrackMap.get(HE.LocalVideoTrack),i.connection&&a&&a.track===t&&i.state===KE.Connected){e.next=7;break}return e.abrupt("return");case 7:return s=a.id,u=a.track,e.next=10,i.connection.updateSendParameters(s,u);case 10:n(),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),r(e.t0);case 16:return e.prev=16,o(),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t,n,r){return e.apply(this,arguments)}}()),Mp(l(i),"handleReplaceTrack",function(){var e=u(c().mark((function e(t,n,r,o){var s,u,l,f,d,p,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jv.debug("P2PChannel handleReplaceTrack for [track-id-".concat(t.getTrackId(),"]")),e.t0="boolean"==typeof o&&o,e.t0){e.next=6;break}return e.next=5,i.mutex.lock("From P2PChannel.handleReplaceTrack");case 5:s=e.sent;case 6:if(e.prev=6,l=Array.from(i.localTrackMap.entries()).find((function(e){var n=a(e,2)[1].track;return t===n})),i.connection&&l&&i.state===KE.Connected){e.next=10;break}return e.abrupt("return",void n());case 10:return e.next=12,null===(u=i.connection)||void 0===u?void 0:u.replaceTrack(t,l[1].id);case 12:if(!i.isPlanB){e.next=15;break}(f=l[1]).id=t._mediaStreamTrack.id,i.localTrackMap.set(l[0],f);case 15:if(l[0]!==HE.LocalVideoTrack||!s_().supportDualStreamEncoding){e.next=24;break}if(!(d=i.localTrackMap.get(HE.LocalVideoLowTrack))){e.next=24;break}return p=t._mediaStreamTrack.clone(),d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=p,d.track._originMediaStreamTrack=p,e.next=24,new Bf((function(e,t){i.handleReplaceTrack(d.track,e,t,!0)}));case 24:n(),e.next=30;break;case 27:e.prev=27,e.t1=e.catch(6),r(e.t1);case 30:return e.prev=30,null===(h=s)||void 0===h||h(),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[6,27,30,33]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()),Mp(l(i),"handleGetLocalVideoStats",(function(e){e(i.statsCollector.getLocalVideoTrackStats())})),Mp(l(i),"handleGetLocalAudioStats",(function(e){e(i.statsCollector.getLocalAudioTrackStats())})),Mp(l(i),"handleGetRemoteVideoStats",(function(e){return i.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]})),Mp(l(i),"handleGetRemoteAudioStats",(function(e){return i.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]})),i.store=e,i.statsCollector=r,i.statsCollector.addP2PChannel(l(i)),i.statsUploader=new Ok,i.bindStatsUploaderEvents(),i.isPlanB=!s_().supportUnifiedPlan||lm("CHROME_FORCE_PLAN_B")&&Op(),i.shouldForwardP2PCreation=lm("FORWARD_P2P_CREATION")&&s_().supportPCSetConfiguration,i.shouldForwardP2PCreation&&(i.connection=i.store.useDataChannel?new Bk({},i.store):i.isPlanB?new JA({},i.store):new vk({},i.store),i.bindConnectionEvents(i.connection)),i}return v(n,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;this._state=e,this.emit(zE.StateChange,t,this._state)}},{key:"startP2PConnection",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state=KE.New,this.shouldForwardP2PCreation||(this.connection=this.store.useDataChannel?new Bk(t,this.store):this.isPlanB?new JA(t,this.store):new vk(t,this.store),this.bindConnectionEvents(this.connection)),this.connection){e.next=2;break}throw new Bv(Lv.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");case 2:return e.abrupt("return",(this.connection.setConfiguration(t),this.connection.establishPromise));case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=u(c().mark((function e(t,n,r,i,o,a){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}throw new Bv(Lv.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");case 2:if(!(this.connection instanceof Bk)){e.next=6;break}this.connection.updateRemoteConnect(i),e.next=12;break;case 6:return this.store.peerConnectionStart(),e.next=9,this.connection.connect(t,n,r,i,o,a);case 9:this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=KE.Connected;case 12:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,o,a){return e.apply(this,arguments)}return t}()},{key:"preConnect",value:function(){var e=u(c().mark((function e(t,n,r,i,o,a){var s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}throw new Bv(Lv.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");case 2:return this.store.peerConnectionStart(),e.next=5,this.connection.connect(t,n,r,i,o,a);case 5:return s=e.sent,e.abrupt("return",(this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=KE.Connected,s));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,o,a){return e.apply(this,arguments)}return t}()},{key:"getEstablishParams",value:function(){if(this.connection instanceof Bk)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}},{key:"publish",value:function(e,t,n){var r=this;return tA(c().mark((function i(){var o,a,s;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,nA(r.mutex.lock("From P2PChannel.publish"));case 2:if(o=i.sent,i.prev=3,r.connection&&r.state===KE.Connected){i.next=10;break}if(r.state!==KE.Disconnected){i.next=7;break}throw new Bv(Lv.UNEXPECTED_ERROR,"PeerConnection already disconnected.");case 7:return r.throwIfTrackTypeNotMatch(e),a=e.filter((function(e){return-1===r.pendingLocalTracks.indexOf(e)})),i.abrupt("return",void(r.pendingLocalTracks=r.pendingLocalTracks.concat(a)));case 10:if(r.store.pubId=r.store.pubId+1,HT.markPublishStart(r.store.clientId,r.store.pubId),0!==(s=r.filterTobePublishedTracks(e,t,n)).length){i.next=16;break}return i.next=15,nA(r.tryToUnmuteAudio(e));case 15:return i.abrupt("return",void i.sent);case 16:return i.delegateYield(iA(qk(r.doPublish(r.connection,s)),nA),"t0",17);case 17:return i.prev=17,o(),i.finish(17);case 20:case"end":return i.stop()}}),i,null,[[3,,17,20]])})))()}},{key:"doPublish",value:function(e,t){var n=this;return tA(c().mark((function r(){var i,o,a,s,u,l;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.forEach((function(e){var t=e.track,r=e.type,i=Date.now();n.store.publish(t.getTrackId(),r===HE.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t),r.next=3,nA(e.send(t.map((function(e){return e.track})),n.store.codec,n.store.audioCodec));case 3:return i=r.sent,r.next=6,nA(i.next());case 6:return o=r.sent.value,a=n.createGatewayPublishMessage(t,o),r.prev=8,r.next=11,a;case 11:s=r.sent,r.next=17;break;case 14:throw r.prev=14,r.t0=r.catch(8),i.throw(r.t0),(null==r.t0?void 0:r.t0.code)===Lv.WS_ABORT&&t.forEach((function(e){var t=e.track;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),r.t0;case 17:return u=n.mapPubResToRemoteConfig(a,s),r.next=20,nA(i.next(u));case 20:l=r.sent.value,t.forEach((function(e){var t=e.type;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,l),n.statsUploader.startUploadUplinkStats(),t.forEach((function(e){var t=e.track,r=e.type,i=Date.now();n.store.publish(t.getTrackId(),r===HE.LocalAudioTrack?"audio":"video",void 0,i)}));case 22:case"end":return r.stop()}}),r,null,[[8,14]])})))()}},{key:"publishLowStream",value:function(e){var t=this;return tA(c().mark((function n(){var r,i,o,a,s;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.connection&&t.state===KE.Connected){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,nA(t.mutex.lock("Locking from P2PChannel.publishLowStream"));case 4:if(r=n.sent,n.prev=5,i=t.localTrackMap.get(HE.LocalVideoTrack)){n.next=9;break}throw new Bv(Lv.UNEXPECTED_ERROR,"Could not find high stream");case 9:if(!t.localTrackMap.has(HE.LocalVideoLowTrack)){n.next=11;break}throw new Bv(Lv.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));case 11:return o=[{track:t.getLowVideoTrack(i.track,e),type:HE.LocalVideoLowTrack}],n.delegateYield(iA(qk(t.doPublish(t.connection,o)),nA),"t0",13);case 13:if(!i.track.muted&&i.track.enabled){n.next=19;break}if(s=null===(a=t.localTrackMap.get(HE.LocalVideoLowTrack))||void 0===a?void 0:a.id,n.t1=void 0!==s,!n.t1){n.next=19;break}return n.next=19,nA(t.connection.muteLocal([s]));case 19:return n.prev=19,r(),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[5,,19,22]])})))()}},{key:"republish",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.pendingLocalTracks.length>0,!e.t0){e.next=7;break}return Jv.debug("Emit P2PChannelEvents.RequestRePublish to republish tracks."),e.next=5,_S(this,zE.RequestRePublish,this.pendingLocalTracks);case 5:this.emit(zE.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[];case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reSubscribe",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,u,l,f,d,p=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.pendingRemoteTracks.length-1;n>=0;n--)r=this.pendingRemoteTracks[n],i=r.user,((o=r.kind)!==qE.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==qE.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1);if(!t){e.next=6;break}return e.next=4,_S(this,zE.RequestReSubscribe,this.pendingRemoteTracks);case 4:e.next=23;break;case 6:a=s(this.pendingRemoteTracks),e.prev=7,a.s();case 9:if((u=a.n()).done){e.next=15;break}return l=u.value,f=l.user,d=l.kind,e.next=13,this.subscribe(f,d,d===qE.VIDEO?f._videoSSRC:f._audioSSRC);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),a.e(e.t0);case 20:return e.prev=20,a.f(),e.finish(20);case 23:this.pendingRemoteTracks.forEach((function(e){var t=e.user;p.emit(zE.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[];case 24:case"end":return e.stop()}}),e,this,[[7,17,20,23]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublish",value:function(){var e=u(c().mark((function e(t){var n,r,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===KE.Connected){e.next=2;break}return e.abrupt("return",void t.forEach((function(e){var t=i.pendingLocalTracks.indexOf(e);-1!==t&&i.pendingLocalTracks.splice(t,1)})));case 2:if(0!==(n=this.filterTobeUnpublishedTracks(t)).length){e.next=5;break}return e.abrupt("return");case 5:return r=n.find((function(e){return"videoLowTrack"===e[0]})),r&&r[1].track.close(),e.abrupt("return",this.doUnpublish(this.connection,n));case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublishLowStream",value:function(){var e=u(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===KE.Connected){e.next=2;break}return e.abrupt("return");case 2:if(t=this.localTrackMap.get(HE.LocalVideoLowTrack)){e.next=5;break}return e.abrupt("return");case 5:return t.track.close(),n=[[HE.LocalVideoLowTrack,t]],e.abrupt("return",this.doUnpublish(this.connection,n));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"doUnpublish",value:function(){var e=u(c().mark((function e(t,n){var r,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createGatewayUnpublishMessage(n),e.next=3,t.stopSending(n.map((function(e){return a(e,2)[1].id})));case 3:return this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map((function(e){var t=a(e,2);return{type:t[0],track:t[1].track}}))),n.forEach((function(e){var t=a(e,1)[0];i.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats(),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(){var e=u(c().mark((function e(t,n,r,i,o){var a,s,u,l,f,d,p,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===KE.Connected){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");case 2:if(null===(a=this.remoteUserMap.get(t))||void 0===a||!a.has(n)){e.next=4;break}return e.abrupt("return");case 4:if(!o){e.next=14;break}if(l=o.find((function(e){return e.stream_type===n})),l){e.next=8;break}throw new Bv(Lv.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));case 8:return e.next=10,this.connection.receive(n,l.ssrcs,String(t._uintid),l.attributes);case 10:f=e.sent,s=f.track,u=f.id,e.next=18;break;case 14:return e.next=16,this.connection.receive(n,[{ssrcId:r,rtx:i}],String(t._uintid),void 0);case 16:d=e.sent,s=d.track,u=d.id;case 18:n===qE.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new Tk(s,t.uid,t._uintid,this.store),Jv.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new yk(s,t.uid,t._uintid,this.store),Jv.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._videoTrack)),(p=this.remoteUserMap.get(t))?p.set(n,u):this.remoteUserMap.set(t,new Map([[n,u]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats(),h=this.pendingRemoteTracks.findIndex((function(e){var r=e.user,i=e.kind;return r.uid===t.uid&&n===i})),-1!==h&&(this.pendingRemoteTracks.splice(h,1),this.emit(zE.MediaReconnectEnd,t.uid));case 23:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,o){return e.apply(this,arguments)}return t}()},{key:"massSubscribe",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.massSubscribeNoLock(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"massSubscribeNoLock",value:function(){var e=u(c().mark((function e(t){var n,r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===KE.Connected){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");case 2:return t=t.filter((function(e){var t,n=e.user,i=e.mediaType;return!(null!==(t=r.remoteUserMap.get(n))&&void 0!==t&&t.has(i))})),e.next=5,this.connection.batchReceive(t.map((function(e){var t=e.user;return{kind:e.mediaType,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtxSsrcId}],mslabel:String(t._uintid)}})));case 5:n=e.sent,t.forEach((function(e,t){var i=e.user,o=e.mediaType,a=n[t],s=a.track,c=a.id;o===qE.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(s):(i._audioTrack=new Tk(s,i.uid,i._uintid,r.store),Jv.info("[".concat(r.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),r.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(s):(i._videoTrack=new yk(s,i.uid,i._uintid,r.store),Jv.info("[".concat(r.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),r.bindRemoteTrackEvents(i,i._videoTrack));var u=r.remoteUserMap.get(i);u?u.set(o,c):r.remoteUserMap.set(i,new Map([[o,c]])),r.statsCollector.addRemoteStats(i.uid),r.statsUploader.startUploadDownlinkStats();var l=r.pendingRemoteTracks.findIndex((function(e){var t=e.user,n=e.kind;return t.uid===i.uid&&o===n}));-1!==l&&(r.pendingRemoteTracks.splice(l,1),r.emit(zE.MediaReconnectEnd,i.uid))}));case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unsubscribe",value:function(){var e=u(c().mark((function e(t,n,r){var i,o,s,u=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.pendingRemoteTracks.filter((function(e){var r=e.user,i=e.kind;return void 0!==n?r.uid===t.uid&&n===i:r.uid===t.uid})),i.forEach((function(e){var t=u.pendingRemoteTracks.indexOf(e);u.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===KE.Connected||r||i.forEach((function(e){var n,r=e.kind;if(r===qE.AUDIO)null===(n=t._audioTrack)||void 0===n||n._destroy(),t._audioTrack=void 0;else if(r===qE.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}})),this.connection&&this.state===KE.Connected){e.next=3;break}return e.abrupt("return");case 3:if(0!==(o=this.filterTobeUnSubscribedTracks(t,n)).length){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this.connection.stopReceiving(o.map((function(e){return a(e,2)[1].id})));case 8:return s=this.createUnsubscribeMessage(o),e.abrupt("return",(this.withdrawRemoteTracks(o),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),o.forEach((function(e){var t,n,i=a(e,2),o=i[0],s=i[1].kind;if(s===qE.VIDEO&&o._videoSSRC&&(null===(t=u.connection)||void 0===t||t.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),s===qE.VIDEO)u.unbindRemoteTrackEvents(o._videoTrack),r||(null===(n=o._videoTrack)||void 0===n||n._destroy(),o._videoTrack=void 0);else if(s===qE.AUDIO){var c;u.unbindRemoteTrackEvents(o._audioTrack),r||(null===(c=o._audioTrack)||void 0===c||c._destroy(),o._audioTrack=void 0)}})),s));case 10:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribe",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.massUnsubscribeNoLock(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribeNoLock",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,u,l,f=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=s(t),e.prev=2,o=c().mark((function e(){var t,r,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.value,r=t.user,o=t.mediaType,a=f.pendingRemoteTracks.filter((function(e){var t=e.user,n=e.kind;return void 0!==o?t.uid===r.uid&&o===n:t.uid===r.uid})),a.forEach((function(e){var t=f.pendingRemoteTracks.indexOf(e);f.pendingRemoteTracks.splice(t,1)})),n=n.concat(a);case 3:case"end":return e.stop()}}),e)})),r.s();case 5:if((i=r.n()).done){e.next=9;break}return e.delegateYield(o(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),r.e(e.t1);case 14:return e.prev=14,r.f(),e.finish(14);case 17:if(this.connection&&this.state===KE.Connected){e.next=19;break}return e.abrupt("return",void n.forEach((function(e){var t,n=e.user,r=e.kind;if(r===qE.AUDIO)null===(t=n._audioTrack)||void 0===t||t._destroy(),n._audioTrack=void 0;else if(r===qE.VIDEO){var i;null===(i=n._videoTrack)||void 0===i||i._destroy(),n._videoTrack=void 0}})));case 19:if(u=Er(t).call(t,(function(e,t){var n=t.user,r=t.mediaType,i=f.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]),0!==u.length){e.next=22;break}return e.abrupt("return");case 22:return e.next=24,this.connection.stopReceiving(u.map((function(e){return a(e,2)[1].id})));case 24:return l=this.createUnsubscribeAllMessage(u),e.abrupt("return",(this.withdrawRemoteTracks(u),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),u.forEach((function(e){var t,n,r=a(e,2),i=r[0],o=r[1].kind;if(o===qE.VIDEO&&i._videoSSRC&&(null===(t=f.connection)||void 0===t||t.setStatsRemoteVideoIsReady(i._videoSSRC,!1)),o===qE.VIDEO)f.unbindRemoteTrackEvents(i._videoTrack),null===(n=i._videoTrack)||void 0===n||n._destroy(),i._videoTrack=void 0;else if(o===qE.AUDIO){var s;f.unbindRemoteTrackEvents(i._audioTrack),null===(s=i._audioTrack)||void 0===s||s._destroy(),i._audioTrack=void 0}})),l));case 26:case"end":return e.stop()}}),e,this,[[2,11,14,17]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=u(c().mark((function e(t,n){var r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void Jv.warning("P2PChannel.muteRemote has no remote user ".concat(t.uid,".")));case 5:if(r.get(n)){e.next=7;break}return e.abrupt("return",void Jv.warning("P2PChannel.muteRemote has no remote user ".concat(t.uid," media type ").concat(n,".")));case 7:void 0!==(i=n===qE.VIDEO?t._videoSSRC:t._audioSSRC)&&this.connection.setStatsRemoteVideoIsReady(i,!1);case 9:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.unmuteRemoteNoLock(t,n));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteRemoteNoLock",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void Jv.warning("P2PChannel.unmuteRemote has no remote user ".concat(t.uid,".")));case 5:r.get(n)||Jv.warning("P2PChannel.unmuteRemote has no remote user ".concat(t.uid," media type ").concat(n,"."));case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getAllTracks",value:function(e){var t=this.localTrackMap.get(HE.LocalAudioTrack);if((null==t?void 0:t.track)instanceof GT){var n=t.track;return Array.from(this.localTrackMap.entries()).filter((function(e){return a(e,1)[0]!==HE.LocalAudioTrack})).filter((function(t){var n=a(t,1)[0];return!(e&&n===HE.LocalVideoLowTrack)})).map((function(e){return a(e,2)[1].track})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((function(t){var n=a(t,1)[0];return!(e&&n===HE.LocalVideoLowTrack)})).map((function(e){return a(e,2)[1].track}))}},{key:"reportPublishEvent",value:function(e,t,n,r,i){if(e){var o=this.localTrackMap.get(HE.LocalAudioTrack),a=r?this.localTrackMap.get(HE.LocalVideoLowTrack):this.localTrackMap.get(HE.LocalVideoTrack);Wb.publish(this.store.sessionId,{eventElapse:HT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==o?void 0:o.track.getTrackLabel(),videoName:null==a?void 0:a.track.getTrackLabel(),screenshare:-1!==(null==a?void 0:a.track._hints.indexOf(CE.SCREEN_TRACK)),audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);var c=n.find((function(e){return e instanceof FT})),u=r?null===(s=this.localTrackMap.get(HE.LocalVideoTrack))||void 0===s?void 0:s.track:n.find((function(e){return e instanceof zR}));Wb.publish(this.store.sessionId,{eventElapse:HT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==c?void 0:c.getTrackLabel(),videoName:null==u?void 0:u.getTrackLabel(),screenshare:-1!==(null==u?void 0:u._hints.indexOf(CE.SCREEN_TRACK)),audio:!!c,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}},{key:"reportSubscribeEvent",value:function(e,t,n,r){var i=r===qE.VIDEO?n._videoSSRC:n._audioSSRC;i&&Wb.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===qE.VIDEO,audio:r===qE.AUDIO,peerid:n.uid,subscribeRequestid:r===qE.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:HT.measureFromSubscribeStart(this.store.clientId,i)})}},{key:"reset",value:function(){Jv.debug("P2PChannel.reset"),this.mutex=new zb("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Bk({},this.store):this.isPlanB?new JA({},this.store):new vk({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=KE.Disconnected}},{key:"getStats",value:function(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}},{key:"getLocalAudioVolume",value:function(){var e=this.localTrackMap.get(HE.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}},{key:"getLocalVideoSize",value:function(){var e=this.localTrackMap.get(HE.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}},{key:"getEncoderConfig",value:function(e){var t=this.localTrackMap.get(e);return t&&t.track instanceof zR||t&&t.track instanceof FT?t.track._encoderConfig:void 0}},{key:"getLocalMedia",value:function(e){return this.localTrackMap.get(e)}},{key:"hasLocalMedia",value:function(){return this.localTrackMap.size>0}},{key:"hasRemoteMedia",value:function(e,t){if(!e)return this.remoteUserMap.size>0;var n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}},{key:"hasRemoteMediaWithLock",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",this.remoteUserMap.size>0);case 2:return r=this.remoteUserMap.get(t),e.abrupt("return",!!r&&(!n||r.has(n)));case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getRemoteMedia",value:function(e){var t,n=Array.from(Ib(t=this.remoteUserMap).call(t)).find((function(t){return t.uid===e}));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}},{key:"getAudioLevels",value:function(){var e=Array.from(this.remoteUserMap.entries()).map((function(e){var t=a(e,1)[0];return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(HE.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=vg(e).call(e,(function(e,t){return e.level-t.level})),e}},{key:"disconnectForReconnect",value:function(){var e=u(c().mark((function e(){var t=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.connection&&(Jv.debug("P2PChannel.disconnectForReconnect closing P2PConnection"),this.state=KE.Reconnecting,lm("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var t,n,r,i,o=a(e,1)[0];null===(t=o._videoTrack)||void 0===t||null===(n=t._player)||void 0===n||null===(r=n.getVideoElement())||void 0===r||r.pause(),null===(i=o._videoTrack)||void 0===i||i._originMediaStreamTrack.stop()})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Bk({},this.store):this.isPlanB?new JA({},this.store):new vk({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((function(e){var n=a(e,2),r=n[0],i=n[1].track;switch(r){case HE.LocalVideoTrack:i._hints.includes(CE.LOW_STREAM)?i.close():t.pendingLocalTracks.push(i);break;case HE.LocalAudioTrack:i instanceof GT?t.pendingLocalTracks=t.pendingLocalTracks.concat(i.trackList):t.pendingLocalTracks.push(i);case HE.LocalVideoLowTrack:}})),this.emit(zE.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var n=a(e,2),r=n[0],i=n[1];Array.from(Ib(i).call(i)).forEach((function(e){t.setPendingRemoteMedia(r,e)})),t.emit(zE.MediaReconnectStart,r.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),Jv.debug("P2PChannel disconnected, waiting to reconnect."));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"hasPendingRemoteMedia",value:function(e,t){var n,r=s(this.pendingRemoteTracks);try{for(r.s();!(n=r.n()).done;){var i=n.value,o=i.user,a=i.kind;if((e instanceof JR?e.uid:e)===o.uid&&t===a)return!0}}catch(c){r.e(c)}finally{r.f()}return!1}},{key:"setPendingRemoteMedia",value:function(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}},{key:"restartICE",value:function(){var e=this;return tA(c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.connection&&e.state===KE.Connected&&!(e.connection instanceof Bk)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,nA(e.mutex.lock("From P2PChannel.restartICE"));case 4:return n=t.sent,t.prev=5,t.delegateYield(iA(qk(e.connection.restartICE()),nA),"t0",7);case 7:return t.prev=7,n(),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[5,,7,10]])})))()}},{key:"getUplinkNetworkQuality",value:function(){if(!this.connection)return 0;var e=this.connection.getStats(),t=this.localTrackMap.get(HE.LocalVideoTrack),n=this.localTrackMap.get(HE.LocalAudioTrack),r=e.videoSend.find((function(e){return e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)})),i=e.audioSend.find((function(e){return e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)}));if(!r||!i)return 1;var o=yS(this,zE.NeedSignalRTT),a=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=a&&s?(a+s)/2:a||s,u=(c&&o?(c+o)/2:c||o)||0,l=100*e.sendPacketLossRate*.7/50+.3*u/1500,f=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,d=null==t?void 0:t.track;if(d&&d._encoderConfig&&-1===d._hints.indexOf(CE.SCREEN_TRACK)){var p=d._encoderConfig.bitrateMax,h=e.bitrate.actualEncoded;if(p&&h){var v=(1e3*p-h)/(1e3*p);return gm[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][f]}}return f}},{key:"getDownlinkNetworkQuality",value:function(){var e=this;if(!this.connection)return 0;var t=this.connection.getStats(),n=0;return Array.from(this.remoteUserMap.entries()).forEach((function(r){var i=a(r,1)[0],o=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find((function(e){return e.ssrc===o})),u=t.videoRecv.find((function(e){return e.ssrc===s}));if(c||u){var l=yS(e,zE.NeedSignalRTT),f=t.rtt,d=(f&&l?(f+l)/2:f||l)||0,p=c?c.jitterMs:void 0,h=t.recvPacketLossRate,v=.7*h*100/50+.3*d/1500;p&&(v=.6*h*100/50+.2*d/1500+.2*p/400),n+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5}else n+=1})),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}},{key:"muteLocalTrack",value:function(){var e=u(c().mark((function e(t){var n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Bf((function(e,r){n.handleMuteLocalTrack(t,e,r)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"filterTobePublishedTracks",value:function(e,t,n){var r=[],i=s_(),o=this.getAllTracks();e=wS(e=e.filter((function(e){return-1===o.indexOf(e)})));var a,c=!1,u=!1,l=s(e);try{for(l.s();!(a=l.n()).done;){var f=a.value;if(f instanceof zR&&(this.localTrackMap.has(HE.LocalVideoTrack)||c?new Bv(Lv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:f,type:HE.LocalVideoTrack}),c=!0),t)){var d=this.getLowVideoTrack(f,n);r.push({track:d,type:HE.LocalVideoLowTrack})}if(f instanceof FT){var p=this.localTrackMap.get(HE.LocalAudioTrack);if(p){if(!(p.track instanceof GT))throw new Bv(Lv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new Bv(Lv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0)}else if(u){var h=r.find((function(e){return e.type===HE.LocalAudioTrack}));if(!(h.track instanceof GT))throw new Bv(Lv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new Bv(Lv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(f)}else{if(!i.webAudioMediaStreamDest||f instanceof GT||f._bypassWebAudio)r.push({track:f,type:HE.LocalAudioTrack});else{var v=new GT;v.addAudioTrack(f),r.push({track:v,type:HE.LocalAudioTrack})}u=!0}}}}catch(m){l.e(m)}finally{l.f()}return r}},{key:"filterTobeUnpublishedTracks",value:function(e){var t=[],n=this.getAllTracks();e=wS(e=e.filter((function(e){return-1!==n.indexOf(e)})));var r,i=s(e);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o instanceof FT){var a=this.localTrackMap.get(HE.LocalAudioTrack);if(!a)continue;a.track instanceof GT?(a.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),0===a.track.trackList.length&&(t.push([HE.LocalAudioTrack,a]),a.track.close())):t.push([HE.LocalAudioTrack,a])}if(o instanceof zR){var c=this.localTrackMap.get(HE.LocalVideoTrack);if(!c)continue;t.push([HE.LocalVideoTrack,c]);var u=this.localTrackMap.get(HE.LocalVideoLowTrack);u&&t.push([HE.LocalVideoLowTrack,u])}}}catch(l){i.e(l)}finally{i.f()}return t}},{key:"bindLocalTrackEvents",value:function(e){var t=this;e.forEach((function(e){var n=e.track;switch(e.type){case HE.LocalVideoTrack:n.addListener(kE.GET_STATS,t.handleGetLocalVideoStats),n.addListener(kE.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.addListener(kE.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.addListener(kE.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.addListener(kE.SET_OPTIMIZATION_MODE,t.handleSetOptimizationMode),n.addListener(kE.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.addListener(kE.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.addListener(kE.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case HE.LocalAudioTrack:t.bindLocalAudioTrackEvents(n);case HE.LocalVideoLowTrack:}}))}},{key:"bindLocalAudioTrackEvents",value:function(e,t){var n=this;e instanceof GT?e.trackList.forEach((function(e){e.addListener(kE.NEED_DISABLE_TRACK,n.handleMuteLocalTrack),e.addListener(kE.NEED_ENABLE_TRACK,n.handleUnmuteLocalTrack),e.addListener(kE.GET_STATS,n.handleGetLocalAudioStats),e.addListener(kE.NEED_MUTE_TRACK,n.handleMuteLocalTrack),e.addListener(kE.NEED_UNMUTE_TRACK,n.handleUnmuteLocalTrack)})):(e.addListener(kE.GET_STATS,this.handleGetLocalAudioStats),e.addListener(kE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(kE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(kE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(kE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(kE.NEED_REPLACE_TRACK,this.handleReplaceTrack))}},{key:"unbindLocalTrackEvents",value:function(e){var t=this;e||(e=Array.from(this.localTrackMap.entries()).map((function(e){var t=a(e,2),n=t[0];return{track:t[1].track,type:n}}))),e.forEach((function(e){var n=e.track;switch(e.type){case HE.LocalVideoTrack:n.off(kE.GET_STATS,t.handleGetLocalVideoStats),n.off(kE.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.off(kE.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.off(kE.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.off(kE.SET_OPTIMIZATION_MODE,t.handleSetOptimizationMode),n.off(kE.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.off(kE.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.off(kE.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case HE.LocalAudioTrack:t.unbindLocalAudioTrackEvents(n);case HE.LocalVideoLowTrack:}}))}},{key:"unbindLocalAudioTrackEvents",value:function(e){var t=this;e instanceof GT?e.trackList.forEach((function(e){e.off(kE.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),e.off(kE.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),e.off(kE.GET_STATS,t.handleGetLocalAudioStats),e.off(kE.NEED_MUTE_TRACK,t.handleMuteLocalTrack),e.off(kE.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack)})):(e.off(kE.GET_STATS,this.handleGetLocalAudioStats),e.off(kE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(kE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(kE.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(kE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(kE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}},{key:"bindRemoteTrackEvents",value:function(e,t){var n=this;t instanceof yk&&t.addListener(kE.GET_STATS,(function(t){t(n.handleGetRemoteVideoStats(e))})),t instanceof Tk&&t.addListener(kE.GET_STATS,(function(t){t(n.handleGetRemoteAudioStats(e))}))}},{key:"unbindRemoteTrackEvents",value:function(e){e&&e.removeAllListeners(kE.GET_STATS)}},{key:"unbindAllRemoteTrackEvents",value:function(){var e=this;Array.from(this.remoteUserMap.entries()).forEach((function(t){var n=a(t,2),r=n[0],i=n[1];i.has(qE.AUDIO)&&e.unbindRemoteTrackEvents(r._audioTrack),i.has(qE.VIDEO)&&e.unbindRemoteTrackEvents(r._videoTrack)}))}},{key:"createGatewayPublishMessage",value:function(e,t){var n=this;return e.map((function(e,r){var i,o,a=e.track;switch(e.type){case HE.LocalAudioTrack:i=RE.Audio,o={dtx:a instanceof BT&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case HE.LocalVideoTrack:i=a._hints.includes(CE.SCREEN_TRACK)?RE.Screen:RE.High,o=Wk(Wk({},tS(a)),{},{codec:n.store.codec});break;case HE.LocalVideoLowTrack:i=RE.Low,o=Wk(Wk({},tS(a)),{},{codec:n.store.codec})}return{stream_type:i,attributes:o,ssrcs:t[r]}}))}},{key:"createGatewayUnpublishMessage",value:function(e){return e.map((function(e){var t,n=a(e,2),r=n[0],i=n[1],o=i.track,s=i.ssrcs,c=i.id;switch(r){case HE.LocalVideoTrack:t=o._hints.includes(CE.SCREEN_TRACK)?RE.Screen:RE.High;break;case HE.LocalAudioTrack:t=RE.Audio;break;case HE.LocalVideoLowTrack:t=RE.Low}return{stream_type:t,ssrcs:s,mid:c}}))}},{key:"assignLocalTracks",value:function(e,t){var n=this;e.forEach((function(e,r){var i=e.track,o=e.type;n.localTrackMap.set(o,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})}))}},{key:"withdrawLocalTracks",value:function(e){var t=this;e.forEach((function(e){var n=a(e,1)[0];t.localTrackMap.delete(n)}))}},{key:"bindConnectionEvents",value:function(e){var t=this;e.onConnectionStateChange=function(){var n=u(c().mark((function n(r){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Jv.info("[p2pId: ".concat(t.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),t.emit(zE.PeerConnectionStateChange,r),"connected"!==r||t.store.keyMetrics.peerConnectionEnd||t.store.peerConnectionEnd(),"disconnected"!==r||"disconnected"!==e.iceConnectionState){n.next=2;break}return n.abrupt("return",(setTimeout((function(){"disconnected"===e.iceConnectionState&&lm("ICE_RESTART")&&"CONNECTED"===yS(t,zE.QueryClientConnectionState)&&t.emit(zE.RequestRestartICE)}),800),void setTimeout((function(){"disconnected"===e.peerConnectionState&&(Jv.debug("P2PConnection disconnected timeout 4000ms, force reconnect"),setTimeout((function(){return t.emit(zE.P2PLost)}),0),t.iceFailedCount+=1,t.requestReconnect())}),4e3)));case 2:if(n.t0="failed"===r,!n.t0){n.next=9;break}return Jv.debug("P2PConnection state failed, force reconnect"),setTimeout((function(){return t.emit(zE.P2PLost)}),0),t.iceFailedCount+=1,n.next=9,t.requestReconnect();case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.onICEConnectionStateChange=function(e){"connected"!==e||t.store.keyMetrics.iceConnectionEnd||t.store.iceConnectionEnd(),Jv.info("[p2pId: ".concat(t.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Wb.reportApiInvoke(t.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Lg.TRACER}).onSuccess(),t.emit(zE.IceConnectionStateChange,e)},e.onICETransportStateChange=function(e){Jv.info("[p2pId: ".concat(t.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=function(e){Jv.info("[p2pId: ".concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=function(e){Jv.info("[p2pId: ".concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=function(e){var n,r,i=Array.from(Ib(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));i&&(t.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=i.audioTrack)||void 0===r||r.emit(PE.FIRST_FRAME_DECODED),Wb.firstRemoteFrame(t.store.sessionId,Cg.FIRST_AUDIO_DECODE,Ng.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:HT.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId}))},e.onFirstAudioReceived=function(e){var n,r=Array.from(Ib(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));r&&Wb.firstRemoteFrame(t.store.sessionId,Cg.FIRST_AUDIO_RECEIVED,Ng.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:HT.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onFirstVideoDecoded=function(e,n,r){t.reportVideoFirstFrameDecoded(e,n,r)},e.onFirstVideoReceived=function(e){var n,r=Array.from(Ib(n=t.remoteUserMap).call(n)).find((function(t){return t._videoSSRC===e}));r&&Wb.firstRemoteFrame(t.store.sessionId,Cg.FIRST_VIDEO_RECEIVED,Ng.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:HT.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onSelectedLocalCandidateChanged=function(e,n){var r="relay"===e.candidateType,i="relay"===n.candidateType;"unknown"!==n.candidateType&&r===i||t.emit(zE.ConnectionTypeChange,r),Jv.info("[p2pId: ".concat(t.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(cS(n))," -> ").concat(JSON.stringify(cS(e)),")"))},e.onSelectedRemoteCandidateChanged=function(e,n){Jv.info("[p2pId: ".concat(t.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(cS(n))," -> ").concat(JSON.stringify(cS(e)),")"))},e.onFirstVideoDecodedTimeout=function(e){t.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)}}},{key:"unbindConnectionEvents",value:function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}},{key:"filterTobeMutedTracks",value:function(e){var t=[];if(-1===this.getAllTracks().indexOf(e))return t;var n=this.localTrackMap.get(HE.LocalAudioTrack);if(e instanceof FT&&(null==n?void 0:n.track)instanceof GT)return n.track.isActive||t.push([HE.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=a(t,2)[1].track;return e===n}));if(r&&(t.push(r),r[0]===HE.LocalVideoTrack)){var i=this.localTrackMap.get(HE.LocalVideoLowTrack);i&&t.push([HE.LocalVideoLowTrack,i])}return t}},{key:"filterTobeUnmutedTracks",value:function(e){var t=[],n=this.localTrackMap.get(HE.LocalAudioTrack);if(e instanceof FT&&(null==n?void 0:n.track)instanceof GT)return n.track.isActive&&t.push([HE.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=a(t,2)[1].track;return e===n}));if(r)if(r[0]===HE.LocalVideoTrack){t.push(r);var i=this.localTrackMap.get(HE.LocalVideoLowTrack);i&&t.push([HE.LocalVideoLowTrack,i])}else t.push(r);return t}},{key:"createMuteMessage",value:function(e){return e.map((function(e){var t,n=a(e,2),r=n[0],i=n[1],o=i.track,s=i.ssrcs,c=i.id;switch(r){case HE.LocalAudioTrack:t=RE.Audio;break;case HE.LocalVideoTrack:t=o._hints.includes(CE.SCREEN_TRACK)?RE.Screen:RE.High;break;case HE.LocalVideoLowTrack:t=RE.Low}return{stream_type:t,ssrcs:s,mid:c}}))}},{key:"createUnmuteMessage",value:function(e){return e.map((function(e){var t,n=a(e,2),r=n[0],i=n[1],o=i.track,s=i.ssrcs,c=i.id;switch(r){case HE.LocalAudioTrack:t=RE.Audio;break;case HE.LocalVideoTrack:t=o._hints.includes(CE.SCREEN_TRACK)?RE.Screen:RE.High;break;case HE.LocalVideoLowTrack:t=RE.Low}return{stream_type:t,ssrcs:s,mid:c}}))}},{key:"filterTobeUnSubscribedTracks",value:function(e,t){var n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){var i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((function(t){var r=a(t,2),i=r[0],o=r[1];n.push([e,{kind:i,id:o}])}));return n}},{key:"createUnsubscribeMessage",value:function(e){var t=[];return e.forEach((function(e){var n=a(e,2),r=n[0],i=n[1],o=i.kind;switch(i.id,o){case qE.VIDEO:return void(r._videoSSRC&&t.push({stream_type:qE.VIDEO,ssrcId:r._videoSSRC}));case qE.AUDIO:return void(r._audioSSRC&&t.push({stream_type:qE.AUDIO,ssrcId:r._audioSSRC}))}})),t}},{key:"createUnsubscribeAllMessage",value:function(e){var t=new Map;return e.forEach((function(e){var n=a(e,2),r=n[0],i=n[1].kind;if(t.has(r)){var o=t.get(r);i===qE.VIDEO?o|=IE.Video:o|=IE.Audio,t.set(r,o)}else i===qE.VIDEO?t.set(r,IE.Video):t.set(r,IE.Audio)})),{users:Array.from(t.entries()).map((function(e){var t=a(e,2),n=t[0],r=t[1];return{stream_id:n.uid,stream_type:r}}))}}},{key:"withdrawRemoteTracks",value:function(e){var t=this;e.forEach((function(e){var n=a(e,2),r=n[0],i=n[1].kind,o=t.remoteUserMap.get(r);o&&(o.delete(i),0===Array.from(o.entries()).length&&t.remoteUserMap.delete(r))}))}},{key:"updateBitrateLimit",value:function(){var e=u(c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.localTrackMap.get(HE.LocalVideoTrack),r=this.localTrackMap.get(HE.LocalVideoLowTrack),e.t0=n,!e.t0){e.next=5;break}return e.next=5,n.track.setBitrateLimit(t.uplink);case 5:if(e.t1=r&&t.low_stream_uplink,!e.t1){e.next=9;break}return e.next=9,r.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0});case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isP2PDisconnected",value:function(){return!this.connection||"connected"!==this.connection.peerConnectionState}},{key:"mapPubResToRemoteConfig",value:function(e,t){return e.map((function(e,n){var r,i=e.stream_type;return null===(r=t.find((function(e){var t=e.stream_type;return i===t})))||void 0===r?void 0:r.attributes}))}},{key:"tryToUnmuteAudio",value:function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=15;break}if(!(t[n]instanceof FT)){e.next=12;break}if(0!==(i=this.filterTobeUnmutedTracks(t[n])).length){e.next=6;break}return e.abrupt("continue",12);case 6:return e.next=8,null===(r=this.connection)||void 0===r?void 0:r.unmuteLocal(i.map((function(e){return a(e,2)[1].id})));case 8:return o=this.createUnmuteMessage(i),e.next=11,bS(this,zE.RequestUnmuteLocal,o);case 11:return e.abrupt("return",void e.sent);case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"bindStatsUploaderEvents",value:function(){var e=this;this.statsUploader.requestStats=function(){return e.getStats()},this.statsUploader.requestLocalMedia=function(){return Array.from(e.localTrackMap.entries())},this.statsUploader.requestRemoteMedia=function(){return Array.from(e.remoteUserMap.entries())},this.statsUploader.requestVideoIsReady=function(t){var n;return!(null===(n=e.connection)||void 0===n||!n.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=function(t,n){return e.emit(zE.RequestUploadStats,t,n)},this.statsUploader.requestAllTracks=function(){return e.getAllTracks()}}},{key:"unbindStatsUploaderEvents",value:function(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}},{key:"requestReconnect",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dtlsFailedCount+=1,e.next=3,dS(Gv(this.dtlsFailedCount,Vv));case 3:this.emit(zE.RequestReconnect);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reconnectP2P",value:function(){var e=u(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(t),Array.from(this.remoteUserMap.entries()),e.t0=n.length>0,!e.t0){e.next=6;break}return e.next=6,_S(this,zE.RequestUnpublishForReconnectPC,n);case 6:this.disconnectForReconnect(),this.emit(zE.RequestReconnectPC);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"canPublishLowStream",value:function(){return this.localTrackMap.has(HE.LocalVideoTrack)||this.pendingLocalTracks.some((function(e){return e instanceof zR}))}},{key:"throwIfTrackTypeNotMatch",value:function(e){if(e.filter((function(e){return e instanceof zR})).length>1)throw new Bv(Lv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((function(e){return e instanceof FT})).length>1&&(e.some((function(e){return e instanceof FT&&e._bypassWebAudio}))||!s_().webAudioMediaStreamDest))throw new Bv(Lv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");var t,n=s(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r instanceof zR&&this.pendingLocalTracks.some((function(e){return e instanceof zR})))throw new Bv(Lv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof FT&&this.pendingLocalTracks.some((function(e){return e instanceof FT}))&&(!s_().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((function(e){return e instanceof FT&&e._bypassWebAudio}))))throw new Bv(Lv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}catch(i){n.e(i)}finally{n.f()}}},{key:"getLowVideoTrack",value:function(e,t){var n,r=s_().supportDualStreamEncoding,i=Wk(Wk({},{width:160,height:120,framerate:15,bitrate:50}),t);n=r?e._mediaStreamTrack.clone():gk(e,i);var o=hS(8,"track-low-"),a=new zR(n,Wk(Wk({},r&&{scaleResolutionDownBy:sS(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return a._hints.push(CE.LOW_STREAM),e.addListener(kE.NEED_CLOSE,(function(){a.close()})),a}},{key:"globalLock",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutex.lock("From P2PChannel.globalLock"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reportVideoFirstFrameDecoded",value:function(e,t,n,r){var i,o=Array.from(Ib(i=this.remoteUserMap).call(i)).find((function(t){return t._videoSSRC===e}));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());var a=this.store.keyMetrics,s=a.subscribe.find((function(e){return e.userId===o.uid&&"video"===e.type}));Wb.firstRemoteVideoDecode(this.store.sessionId,Cg.FIRST_VIDEO_DECODE,Ng.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:HT.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}},{key:"remoteMediaSsrcChanged",value:function(){var e=u(c().mark((function e(t,n,r){var i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return",!1);case 2:if(i=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",!1);case 5:if(o=i.get(n)){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,this.connection.getRemoteSSRC(o);case 10:return a=e.sent,e.abrupt("return",void 0!==a&&a!==r);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"resetConnection",value:function(e){Jv.debug("[P2PChannel] reset connection to ".concat(e)),this.state===KE.Connected?(Jv.debug("[P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first"),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===AE.datachannel?new Bk({},this.store):this.isPlanB?new JA({},this.store):new vk({},this.store),this.bindConnectionEvents(this.connection)))}}]),n}(jv)).prototype,"startP2PConnection",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"startP2PConnection"),Fk.prototype),_b(Fk.prototype,"connect",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"connect"),Fk.prototype),_b(Fk.prototype,"preConnect",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"preConnect"),Fk.prototype),_b(Fk.prototype,"unpublish",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"unpublish"),Fk.prototype),_b(Fk.prototype,"unpublishLowStream",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"unpublishLowStream"),Fk.prototype),_b(Fk.prototype,"subscribe",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"subscribe"),Fk.prototype),_b(Fk.prototype,"massSubscribe",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"massSubscribe"),Fk.prototype),_b(Fk.prototype,"unsubscribe",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"unsubscribe"),Fk.prototype),_b(Fk.prototype,"massUnsubscribe",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"massUnsubscribe"),Fk.prototype),_b(Fk.prototype,"muteRemote",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"muteRemote"),Fk.prototype),_b(Fk.prototype,"unmuteRemote",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"unmuteRemote"),Fk.prototype),_b(Fk.prototype,"hasRemoteMediaWithLock",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"hasRemoteMediaWithLock"),Fk.prototype),_b(Fk.prototype,"disconnectForReconnect",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"disconnectForReconnect"),Fk.prototype),_b(Fk.prototype,"updateBitrateLimit",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"updateBitrateLimit"),Fk.prototype),_b(Fk.prototype,"remoteMediaSsrcChanged",[Yk],Object.getOwnPropertyDescriptor(Fk.prototype,"remoteMediaSsrcChanged"),Fk.prototype),Fk);function Yk(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=u(c().mark((function e(){var n,i,o,a,s,u=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From P2PChannel.".concat(t));case 3:for(i=e.sent,e.prev=4,o=u.length,a=new Array(o),s=0;s<o;s++)a[s]=u[s];return e.next=8,r.apply(this,a);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function Jk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jk(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"}(Kk||(Kk={}));var Qk,$k=function(){function e(t,n,r,i){h(this,e),Mp(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}return v(e,[{key:"dispatch",value:function(e){this.state=function(e,t){switch(t.type){case Kk.SET_SESSION_ID:return Xk(Xk({},e),{},{sessionId:t.sessionId});case Kk.SET_P2P_ID:return Xk(Xk({},e),{},{p2pId:t.p2pId});case Kk.SET_UID:return Xk(Xk({},e),{},{uid:t.uid});case Kk.SET_PUB_ID:return Xk(Xk({},e),{},{pubId:t.pubId});case Kk.KEY_METRIC_CLIENT_CREATED:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{clientCreated:t.metric})});case Kk.KEY_METRIC_JOIN_START:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{joinStart:t.metric})});case Kk.AVOID_JOIN_START:return Xk(Xk({},e),{},{avoidJoinStart:t.avoidJoinStart});case Kk.KEY_METRIC_JOIN_END:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{joinEnd:t.metric})});case Kk.KEY_METRIC_REQUEST_AP_START:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{requestAPStart:t.metric})});case Kk.KEY_METRIC_REQUEST_AP_END:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{requestAPEnd:t.metric})});case Kk.KEY_METRIC_JOIN_GATEWAY_START:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case Kk.KEY_METRIC_JOIN_GATEWAY_END:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case Kk.KEY_METRIC_PEER_CONNECTION_START:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case Kk.KEY_METRIC_PEER_CONNECTION_END:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case Kk.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case Kk.KEY_METRIC_ICE_CONNECTION_END:return Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case Kk.KEY_METRIC_PUBLISH:var n=e.keyMetrics.publish,r=n.findIndex((function(e){return e.trackId===t.metric.trackId}));return-1!==r?(n[r]=Xk(Xk({},n[r]),t.metric),Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{publish:m(n)})})):Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{publish:[].concat(m(e.keyMetrics.publish),[t.metric])})});case Kk.KEY_METRIC_SUBSCRIBE:var i=e.keyMetrics.subscribe,o=i.findIndex((function(e){return e.userId===t.metric.userId&&e.type===t.metric.type}));return-1!==o?(i[o]=Xk(Xk({},i[o]),t.metric),Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{subscribe:m(i)})})):Xk(Xk({},e),{},{keyMetrics:Xk(Xk({},e.keyMetrics),{},{subscribe:[].concat(m(e.keyMetrics.subscribe),[t.metric])})});case Kk.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case Kk.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[].concat(m(e.joinChannelServiceRecords),[t.record]):(e.joinChannelServiceRecords[t.index]=Xk(Xk({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=m(e.joinChannelServiceRecords)),e;case Kk.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case Kk.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case Kk.SET_USE_DATACHANNEL:return Xk(Xk({},e),{},{useDataChannel:t.val});default:return e}}(this.state,e)}},{key:"sessionId",get:function(){return this.state.sessionId},set:function(e){this.dispatch({type:Kk.SET_SESSION_ID,sessionId:e})}},{key:"codec",get:function(){return this.state.codec}},{key:"audioCodec",get:function(){return this.state.audioCodec}},{key:"clientId",get:function(){return this.state.clientId}},{key:"p2pId",get:function(){return this.state.p2pId},set:function(e){this.dispatch({type:Kk.SET_P2P_ID,p2pId:e})}},{key:"dcId",get:function(){return this.state.dcId},set:function(e){this.dispatch({type:Kk.SET_DC_ID,dcId:e})}},{key:"uid",get:function(){return this.state.uid},set:function(e){this.dispatch({type:Kk.SET_UID,uid:e})}},{key:"pubId",get:function(){return this.state.pubId},set:function(e){this.dispatch({type:Kk.SET_PUB_ID,pubId:e})}},{key:"cloudProxyServerMode",get:function(){return this.state.cloudProxyServerMode},set:function(e){this.dispatch({type:Kk.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}},{key:"useDataChannel",get:function(){return this.state.useDataChannel},set:function(e){this.dispatch({type:Kk.SET_USE_DATACHANNEL,val:e})}},{key:"clientCreated",value:function(){this.dispatch({type:Kk.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}},{key:"joinStart",value:function(){this.dispatch({type:Kk.KEY_METRIC_JOIN_START,metric:Date.now()})}},{key:"joinEnd",value:function(){this.dispatch({type:Kk.KEY_METRIC_JOIN_END,metric:Date.now()})}},{key:"requestAPStart",value:function(){this.dispatch({type:Kk.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}},{key:"requestAPEnd",value:function(){this.dispatch({type:Kk.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}},{key:"joinGatewayStart",value:function(){this.dispatch({type:Kk.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}},{key:"joinGatewayEnd",value:function(){this.dispatch({type:Kk.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}},{key:"peerConnectionStart",value:function(){this.dispatch({type:Kk.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}},{key:"peerConnectionEnd",value:function(){this.dispatch({type:Kk.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}},{key:"signalChannelOpen",value:function(){this.dispatch({type:Kk.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}},{key:"iceConnectionEnd",value:function(){this.dispatch({type:Kk.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}},{key:"publish",value:function(e,t,n,r){this.dispatch({type:Kk.KEY_METRIC_PUBLISH,metric:Xk(Xk({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}},{key:"subscribe",value:function(e,t,n,r,i,o,a){this.dispatch({type:Kk.KEY_METRIC_SUBSCRIBE,metric:Xk(Xk(Xk(Xk(Xk({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}},{key:"massSubscribe",value:function(e,t,n,r){var i=this;e.forEach((function(e){i.dispatch({type:Kk.KEY_METRIC_SUBSCRIBE,metric:Xk(Xk(Xk({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}},{key:"keyMetrics",get:function(){return this.state.keyMetrics}},{key:"recordJoinChannelService",value:function(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((function(e){return e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")})));try{return"number"!=typeof t?(this.dispatch({type:Kk.RECORD_JOIN_CHANNEL_SERVICE,record:Xk(Xk({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Kk.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}},{key:"resetJoinChannelServiceRecords",value:function(){this.dispatch({type:Kk.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}},{key:"resetKeyMetrics",value:function(){this.dispatch({type:Kk.RESET_KEY_METRICS})}},{key:"joinChannelServiceRecords",get:function(){try{return this.state.joinChannelServiceRecords}catch(y){return[]}}},{key:"avoidJoinStart",get:function(){return this.state.avoidJoinStart},set:function(e){this.dispatch({type:Kk.AVOID_JOIN_START,avoidJoinStart:e})}}]),e}(),Zk=function(){return"HTTPS"===(Qk||Qk||(Qk=(window.location.protocol.split(":")[0]||"").toUpperCase()))},eC=function(){return void 0!==window.isSecureContext};function tC(e){var t=dC();return function(e,t){var n=e.appId;void 0!==n&&(OC(t,10),_C(t,n));var r=e.cid;void 0!==r&&(OC(t,16),OC(t,r));var i=e.cname;void 0!==i&&(OC(t,26),_C(t,i));var o=e.deviceId;void 0!==o&&(OC(t,34),_C(t,o));var a=e.elapse;void 0!==a&&(OC(t,40),IC(t,a));var c=e.fileSize;void 0!==c&&(OC(t,48),IC(t,lC(c)));var u=e.height;void 0!==u&&(OC(t,56),IC(t,lC(u)));var l=e.jpg;void 0!==l&&(OC(t,66),OC(t,l.length),function(e,t){var n=mC(e,t.length);e.bytes.set(t,n)}(t,l));var f=e.networkType;void 0!==f&&(OC(t,72),IC(t,lC(f)));var d=e.osType;void 0!==d&&(OC(t,80),IC(t,lC(d)));var p=e.requestId;void 0!==p&&(OC(t,90),_C(t,p));var h=e.sdkVersion;void 0!==h&&(OC(t,98),_C(t,h));var v=e.sequence;void 0!==v&&(OC(t,104),IC(t,lC(v)));var m=e.sid;void 0!==m&&(OC(t,114),_C(t,m));var g=e.timestamp;void 0!==g&&(OC(t,120),IC(t,g));var E=e.uid;void 0!==E&&(OC(t,128),OC(t,E));var _=e.vid;void 0!==_&&(OC(t,136),OC(t,_));var b=e.width;void 0!==b&&(OC(t,144),IC(t,lC(b)));var y=e.service;void 0!==y&&(OC(t,152),OC(t,y));var T=e.callbackData;void 0!==T&&(OC(t,162),_C(t,T));var S=e.jpgEncryption;void 0!==S&&(OC(t,168),OC(t,S));var w=e.requestType;void 0!==w&&(OC(t,176),OC(t,w));var R=e.scorePorn;void 0!==R&&(OC(t,185),wC(t,R));var O=e.scoreSexy;void 0!==O&&(OC(t,193),wC(t,O));var I=e.scoreNeutral;void 0!==I&&(OC(t,201),wC(t,I));var A=e.scene;void 0!==A&&(OC(t,208),OC(t,A));var k=e.ossFilePrefix;void 0!==k&&(OC(t,218),_C(t,k));var C=e.serviceVendor;if(void 0!==C){var N,x=s(C);try{for(x.s();!(N=x.n()).done;){var D=N.value;OC(t,226);var P=dC();iC(D,P),OC(t,P.limit),bC(t,P),pC(P)}}catch(L){x.e(L)}finally{x.f()}}}(e,t),function(e){var t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function nC(e){return function(e){var t={};e:for(;!vC(e);){var n=RC(e);switch(n>>>3){case 0:break e;case 1:t.code=RC(e);break;case 2:t.msg=EC(e,RC(e));break;case 3:var r=oC(e);t.data=rC(e),e.limit=r;break;default:aC(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function rC(e){var t={};e:for(;!vC(e);){var n=RC(e);switch(n>>>3){case 0:break e;case 1:t.requestId=EC(e,RC(e));break;case 2:t.requestType=RC(e)>>>0;break;case 3:t.scorePorn=SC(e);break;case 4:t.scoreSexy=SC(e);break;case 5:t.scoreNeutral=SC(e);break;case 6:t.requestScene=RC(e)>>>0;break;case 7:t.scene=RC(e)>>>0;break;default:aC(e,7&n)}}return t}function iC(e,t){var n=e.service;void 0!==n&&(OC(t,8),OC(t,n));var r=e.vendor;void 0!==r&&(OC(t,16),OC(t,r));var i=e.token;void 0!==i&&(OC(t,26),_C(t,i));var o=e.callbackUrl;void 0!==o&&(OC(t,34),_C(t,o))}function oC(e){var t=RC(e),n=e.limit;return e.limit=e.offset+t,n}function aC(e,t){switch(t){case 0:for(;128&yC(e););break;case 2:hC(e,RC(e));break;case 5:hC(e,4);break;case 1:hC(e,8);break;default:throw new Error("Unimplemented type: "+t)}}var sC=new Float32Array(1);new Uint8Array(sC.buffer);var cC=new Float64Array(1),uC=new Uint8Array(cC.buffer);function lC(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var fC=[];function dC(){var e=fC.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function pC(e){fC.push(e)}function hC(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function vC(e){return e.offset>=e.limit}function mC(e,t){var n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){var a=new Uint8Array(2*o);a.set(n),e.bytes=a}return e.offset=o,o>i&&(e.limit=o),r}function gC(e,t){var n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function EC(e,t){for(var n=gC(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",a="",s=0;s<t;s++){var c=void 0,u=void 0,l=void 0,f=void 0,d=i[s+n];0==(128&d)?a+=r(d):192==(224&d)?s+1>=t||128!=(192&(c=i[s+n+1]))||(f=(31&d)<<6|63&c)<128?a+=o:(a+=r(f),s++):224==(240&d)?s+2>=t||32896!=(49344&((c=i[s+n+1])|(u=i[s+n+2])<<8))||(f=(15&d)<<12|(63&c)<<6|63&u)<2048||f>=55296&&f<=57343?a+=o:(a+=r(f),s+=2):240==(248&d)?s+3>=t||8421504!=(12632256&((c=i[s+n+1])|(u=i[s+n+2])<<8|(l=i[s+n+3])<<16))||(f=(7&d)<<18|(63&c)<<12|(63&u)<<6|63&l)<65536||f>1114111?a+=o:(a+=r(55296+((f-=65536)>>10),56320+(1023&f)),s+=3):a+=o}return a}function _C(e,t){for(var n=t.length,r=0,i=0;i<n;i++){var o=t.charCodeAt(i);o>=55296&&o<=56319&&i+1<n&&(o=(o<<10)+t.charCodeAt(++i)-56613888),r+=o<128?1:o<2048?2:o<65536?3:4}OC(e,r);for(var a=mC(e,r),s=e.bytes,c=0;c<n;c++){var u=t.charCodeAt(c);u>=55296&&u<=56319&&c+1<n&&(u=(u<<10)+t.charCodeAt(++c)-56613888),u<128?s[a++]=u:(u<2048?s[a++]=u>>6&31|192:(u<65536?s[a++]=u>>12&15|224:(s[a++]=u>>18&7|240,s[a++]=u>>12&63|128),s[a++]=u>>6&63|128),s[a++]=63&u|128)}}function bC(e,t){for(var n=mC(e,t.limit),r=e.bytes,i=t.bytes,o=0,a=t.limit;o<a;o++)r[o+n]=i[o]}function yC(e){return e.bytes[gC(e,1)]}function TC(e,t){var n=mC(e,1);e.bytes[n]=t}function SC(e){var t=gC(e,8),n=e.bytes;return uC[0]=n[t++],uC[1]=n[t++],uC[2]=n[t++],uC[3]=n[t++],uC[4]=n[t++],uC[5]=n[t++],uC[6]=n[t++],uC[7]=n[t++],cC[0]}function wC(e,t){var n=mC(e,8),r=e.bytes;cC[0]=t,r[n++]=uC[0],r[n++]=uC[1],r[n++]=uC[2],r[n++]=uC[3],r[n++]=uC[4],r[n++]=uC[5],r[n++]=uC[6],r[n++]=uC[7]}function RC(e){var t,n=0,r=0;do{t=yC(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function OC(e,t){for(t>>>=0;t>=128;)TC(e,127&t|128),t>>>=7;TC(e,t)}function IC(e,t){var n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=mC(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}var AC=function(){var e=u(c().mark((function e(t,n,r){var i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(function(e){var t="0123456789abcdef";function n(e){var n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,a){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,a)),o),n)}function o(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function c(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}var u,l,f,d,p,h=function(e){var t,n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e),v=1732584193,m=-271733879,g=-1732584194,E=271733878;for(u=0;u<h.length;u+=16)l=v,f=m,d=g,p=E,v=o(v,m,g,E,h[u+0],7,-680876936),E=o(E,v,m,g,h[u+1],12,-389564586),g=o(g,E,v,m,h[u+2],17,606105819),m=o(m,g,E,v,h[u+3],22,-1044525330),v=o(v,m,g,E,h[u+4],7,-176418897),E=o(E,v,m,g,h[u+5],12,1200080426),g=o(g,E,v,m,h[u+6],17,-1473231341),m=o(m,g,E,v,h[u+7],22,-45705983),v=o(v,m,g,E,h[u+8],7,1770035416),E=o(E,v,m,g,h[u+9],12,-1958414417),g=o(g,E,v,m,h[u+10],17,-42063),m=o(m,g,E,v,h[u+11],22,-1990404162),v=o(v,m,g,E,h[u+12],7,1804603682),E=o(E,v,m,g,h[u+13],12,-40341101),g=o(g,E,v,m,h[u+14],17,-1502002290),v=a(v,m=o(m,g,E,v,h[u+15],22,1236535329),g,E,h[u+1],5,-165796510),E=a(E,v,m,g,h[u+6],9,-1069501632),g=a(g,E,v,m,h[u+11],14,643717713),m=a(m,g,E,v,h[u+0],20,-373897302),v=a(v,m,g,E,h[u+5],5,-701558691),E=a(E,v,m,g,h[u+10],9,38016083),g=a(g,E,v,m,h[u+15],14,-660478335),m=a(m,g,E,v,h[u+4],20,-405537848),v=a(v,m,g,E,h[u+9],5,568446438),E=a(E,v,m,g,h[u+14],9,-1019803690),g=a(g,E,v,m,h[u+3],14,-187363961),m=a(m,g,E,v,h[u+8],20,1163531501),v=a(v,m,g,E,h[u+13],5,-1444681467),E=a(E,v,m,g,h[u+2],9,-51403784),g=a(g,E,v,m,h[u+7],14,1735328473),v=s(v,m=a(m,g,E,v,h[u+12],20,-1926607734),g,E,h[u+5],4,-378558),E=s(E,v,m,g,h[u+8],11,-2022574463),g=s(g,E,v,m,h[u+11],16,1839030562),m=s(m,g,E,v,h[u+14],23,-35309556),v=s(v,m,g,E,h[u+1],4,-1530992060),E=s(E,v,m,g,h[u+4],11,1272893353),g=s(g,E,v,m,h[u+7],16,-155497632),m=s(m,g,E,v,h[u+10],23,-1094730640),v=s(v,m,g,E,h[u+13],4,681279174),E=s(E,v,m,g,h[u+0],11,-358537222),g=s(g,E,v,m,h[u+3],16,-722521979),m=s(m,g,E,v,h[u+6],23,76029189),v=s(v,m,g,E,h[u+9],4,-640364487),E=s(E,v,m,g,h[u+12],11,-421815835),g=s(g,E,v,m,h[u+15],16,530742520),v=c(v,m=s(m,g,E,v,h[u+2],23,-995338651),g,E,h[u+0],6,-198630844),E=c(E,v,m,g,h[u+7],10,1126891415),g=c(g,E,v,m,h[u+14],15,-1416354905),m=c(m,g,E,v,h[u+5],21,-57434055),v=c(v,m,g,E,h[u+12],6,1700485571),E=c(E,v,m,g,h[u+3],10,-1894986606),g=c(g,E,v,m,h[u+10],15,-1051523),m=c(m,g,E,v,h[u+1],21,-2054922799),v=c(v,m,g,E,h[u+8],6,1873313359),E=c(E,v,m,g,h[u+15],10,-30611744),g=c(g,E,v,m,h[u+6],15,-1560198380),m=c(m,g,E,v,h[u+13],21,1309151649),v=c(v,m,g,E,h[u+4],6,-145523070),E=c(E,v,m,g,h[u+11],10,-1120210379),g=c(g,E,v,m,h[u+2],15,718787259),m=c(m,g,E,v,h[u+9],21,-343485551),v=r(v,l),m=r(m,f),g=r(g,d),E=r(E,p);return n(v)+n(m)+n(g)+n(E)}(""+n+r)).slice(0,16),o=i.slice(0,12),e.next=4,window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);case 4:return a=e.sent,e.t0=Uint8Array,e.next=8,window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},a,t);case 8:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function kC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var CC,NC,xC,DC,PC,LC,MC,UC,jC,FC,BC,VC,GC,WC,qC,HC,KC,zC,YC,JC,XC,QC,$C,ZC,eN,tN,nN,rN,iN,oN,aN,sN,cN,uN,lN,fN,dN,pN,hN,vN=new Map([["moderation",1],["supervise",2]]),mN=function(e){d(n,e);var t=p(n);function n(e){var r;return h(this,n),r=t.call(this),Mp(l(r),"name","AgoraRTCVideoContentInspect"),Mp(l(r),"_connectionState",$E.CONNECTING),Mp(l(r),"_innerConnectionState",void 0),Mp(l(r),"sequence",0),Mp(l(r),"inspectStartTime",void 0),Mp(l(r),"workerManagerConnection",void 0),Mp(l(r),"workerConnection",void 0),Mp(l(r),"workerMessageLengthLimit",void 0),Mp(l(r),"inspectIntervalMinimum",void 0),Mp(l(r),"qualityRatio",void 0),Mp(l(r),"_connectInfo",void 0),Mp(l(r),"_cancelTokenSource",Mv.CancelToken.source()),Mp(l(r),"_retryConfig",void 0),Mp(l(r),"wmSequence",0),Mp(l(r),"inspectInterval",void 0),Mp(l(r),"inspectTimer",null),Mp(l(r),"ossFilePrefix",void 0),Mp(l(r),"extraInfo",void 0),Mp(l(r),"_inspectType",void 0),Mp(l(r),"_inspectMode",void 0),Mp(l(r),"_quality",1),Mp(l(r),"qualityTimer",null),Mp(l(r),"_inspectId",void 0),Mp(l(r),"_needWorkUrlOnly",!1),Mp(l(r),"inspectImage",(function(){if(r.connectionState!==$E.CONNECTED)throw new Bv(Lv.OPERATION_ABORTED,"content inspect service connection status is ".concat(r.connectionState));r.inspectTimer&&(window.clearInterval(r.inspectTimer),r.inspectTimer=null),r.inspectTimer=window.setInterval((function(){r.connectionState===$E.CONNECTED?r.requestToInspectImage():Jv.debug("[".concat(r._inspectId,"] Inspect State is not connected , "),r.connectionState)}),r.inspectInterval<r.inspectIntervalMinimum?r.inspectIntervalMinimum:r.inspectInterval),r.requestToInspectImage()})),r._inspectId=hS(5,"inspect-"),r.workerMessageLengthLimit=lm("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),r.inspectIntervalMinimum=lm("VIDEO_INSPECT_INTERVAL_MINIMUM"),r.qualityRatio=lm("VIDEO_INSPECT_QUALITY_RATIO"),r.inspectInterval=e.interval,r.ossFilePrefix=e.ossFilePrefix,r.extraInfo=e.extraInfo,r.inspectType=e.inspectType,r.inspectStartTime=Number(Date.now()),r.workerManagerConnection=new BS("worker-manager-"+r._inspectId,Vv),r.on(e_.STATE_CHANGE,(function(e,t){r._innerConnectionState=e,Jv.debug("[".concat(r._inspectId,"] Inspect operation :").concat(ZE[e]," ").concat(t||""))})),r.handleWorkerManagerEvents(),r.workerConnection=new BS("worker-"+r._inspectId,Vv),r.handleWorkerEvents(),r}return v(n,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){if(this._connectionState!==e){var t=this._connectionState;this._connectionState=e,this.emit(e_.CONNECTION_STATE_CHANGE,t,e)}}},{key:"inspectType",get:function(){return this._inspectType},set:function(e){var t;this._inspectMode=Er(t=e.map((function(e){return vN.get(e)||0}))).call(t,(function(e,t){return e+t})),this._inspectType=e}},{key:"quality",get:function(){return this._quality},set:function(e){var t=this;this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((function(){t.quality=t._quality/t.qualityRatio}),6e4))}},{key:"init",value:function(){var e=u(c().mark((function e(t,n){var r,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit(e_.STATE_CHANGE,ZE.CONNECT_AP),this._connectInfo=t,r=this._cancelTokenSource.token,e.abrupt("return",(this._retryConfig=n,new Bf((function(e,o){i.on(e_.CONNECTION_STATE_CHANGE,(function(t,n){n===$E.CONNECTED&&e()})),i.requestAP(t,r,n).then((function(e){i.connectWorkerManager(e)})).catch((function(e){o(e)}))}))));case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"requestAP",value:function(){var e=u(c().mark((function e(t,n,r){var i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=lm("WEBCS_DOMAIN").map((function(e){return"https://".concat(e,"/api/v1")})),e.next=3,function(e,t,n,r){var i=t.appId,o=t.areaCode,a=t.cname,s=t.sid,l=t.token,f=t.uid;Tw++;var d,p,h="image_moderation_api",v={service_name:h,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:Tw,seq:Tw,sid:s,token:l,ts:Date.now(),uid:f+""})},m=e[0];return Wv(u(c().mark((function e(){var t,r,i,o,a,s,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=Date.now(),e.next=3,Cb(m,{data:v,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});case 3:if(t=e.sent,p=Date.now()-d,0===t.code){e.next=7;break}throw r=new Bv(Lv.UNEXPECTED_RESPONSE,"image inspect ap error, code"+t.code,{retry:!0,responseTime:p}),Jv.error(r.toString()),r;case 7:if(200===(i=JSON.parse(t.json_body)).code){e.next=11;break}throw o=new Bv(Lv.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(i.code,", reason: ").concat(i.reason),{code:i.code,responseTime:p}),Jv.error(o.toString()),o;case 11:if(i.servers&&Array.isArray(i.servers)&&0!==i.servers.length){e.next=14;break}throw a=new Bv(Lv.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:i.code,responseTime:p}),Jv.error(a.toString()),a;case 14:return s=lm("VIDEO_INSPECT_WORKER_MANAGER_HOST"),u=lm("VIDEO_INSPECT_WORKER_MANAGER_PORT"),e.abrupt("return",{addressList:i.servers.map((function(e){var t=e.address,n=e.wss;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(s,":").concat(u||n)})).filter((function(e){return!!e})),workerToken:i.workerToken,vid:i.vid,responseTime:p});case 16:case"end":return e.stop()}}),e)}))),(function(t,n){return Wb.apworkerEvent(s,{success:!0,sc:200,serviceName:h,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1}),(function(t,n){return Wb.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:h,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==Lv.OPERATION_ABORTED&&t.code!==Lv.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)}),r)}(i,t,n,r);case 3:return o=e.sent,this.emit(e_.STATE_CHANGE,ZE.AP_CONNECTED),a=o.addressList,e.abrupt("return",(this.wmSequence++,a));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"connectWorkerManager",value:function(){var e=u(c().mark((function e(t){var n,r=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],this._needWorkUrlOnly=n,this.emit(e_.STATE_CHANGE,ZE.CONNECT_WORKER_MANAGER),e.next=5,this.workerManagerConnection.init(t,1e4);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"connectWorker",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.workerConnection.init([t]);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleWorkerManagerEvents",value:function(){var e=this;this.workerManagerConnection.on(aE.CONNECTED,u(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.emit(e_.STATE_CHANGE,ZE.WORKER_MANAGER_CONNECTED,e.workerManagerConnection.url),e.workerManagerConnection.sendMessage({appId:e._connectInfo.appId,cname:e._connectInfo.cname,uid:e._connectInfo.uid+"",sdkVersion:"4.17.1",sid:e._connectInfo.sid,seq:e.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0);case 1:case"end":return t.stop()}}),t)})))),this.workerManagerConnection.on(aE.CLOSED,(function(){e._innerConnectionState<ZE.GET_WORKER_MANAGER_RESPONSE&&Jv.debug("[".concat(e._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(aE.FAILED,(function(){e._innerConnectionState<ZE.GET_WORKER_MANAGER_RESPONSE&&Jv.debug("[".concat(e._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(aE.RECONNECTING,(function(){e._innerConnectionState<ZE.GET_WORKER_MANAGER_RESPONSE&&Jv.debug("[".concat(e._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(aE.ON_MESSAGE,function(){var t=u(c().mark((function t(n){var r,i,o,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.emit(e_.STATE_CHANGE,ZE.GET_WORKER_MANAGER_RESPONSE),r=e.workerManagerConnection.url,e.workerManagerConnection.close(),200===(i=JSON.parse(n.data)).code){t.next=6;break}throw Jv.error("[".concat(e._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new Bv(Lv.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);case 6:if(i.serverResponse&&i.serverResponse.portWss&&r){t.next=8;break}throw Jv.error("[".concat(e._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new Bv(Lv.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);case 8:if(o=lm("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=r.replace(/:\d+\/?$/,":".concat(o)),e.emit(e_.STATE_CHANGE,ZE.CONNECT_WORKER,a),!e._needWorkUrlOnly){t.next=14;break}e.emit(e_.REQUEST_NEW_WORKER_URL,a),t.next=16;break;case 14:return t.next=16,e.connectWorker(a);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.workerManagerConnection.on(aE.WILL_RECONNECT,(function(e,t){t(e)})),this.workerManagerConnection.on(aE.REQUEST_NEW_URLS,(function(t,n){e.requestAP(e._connectInfo,e._cancelTokenSource.token,e._retryConfig).then(t).catch(n)}))}},{key:"handleWorkerEvents",value:function(){var e=this;this.workerConnection.on(aE.CONNECTED,u(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.emit(e_.STATE_CHANGE,ZE.WORKER_CONNECTED,e.workerConnection.url),e.connectionState=$E.CONNECTED;case 1:case"end":return t.stop()}}),t)})))),this.workerConnection.on(aE.ON_MESSAGE,function(){var t=u(c().mark((function t(n){var r,i,o,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.data instanceof ArrayBuffer)){t.next=11;break}if(r=nC(new Uint8Array(n.data)),lm("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Jv.debug("[".concat(e._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),200!==r.code){t.next=8;break}if(!Array.isArray(e.inspectType)||1!==e.inspectType.length||"supervise"!==e.inspectType[0]){t.next=5;break}return t.abrupt("return",void e.emit(e_.INSPECT_RESULT,void 0,void 0));case 5:r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral?(o={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},a=Er(i=Object.keys(o)).call(i,(function(e,t){return o[e]>o[t]?e:t}),"porn"),s=Object.keys(o).find((function(e){return e===a})),e.emit(e_.INSPECT_RESULT,s)):e.emit(e_.INSPECT_RESULT,void 0,new Bv(Lv.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message")),t.next=9;break;case 8:e.emit(e_.INSPECT_RESULT,void 0,new Bv(Lv.UNEXPECTED_RESPONSE,r.code+"",r.msg));case 9:t.next=12;break;case 11:Jv.error("[".concat(e._inspectId,"] Unexpected message type from worker")),e.emit(e_.INSPECT_RESULT,void 0,new Bv(Lv.UNEXPECTED_RESPONSE,"invalid worker message type"));case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.workerConnection.on(aE.CLOSED,(function(){e.connectionState=$E.CLOSED})),this.workerConnection.on(aE.FAILED,(function(){e.connectionState=$E.CLOSED})),this.workerConnection.on(aE.RECONNECTING,(function(){e.connectionState=e.connectionState===$E.CONNECTED?$E.RECONNECTING:$E.CONNECTING})),this.workerConnection.on(aE.WILL_RECONNECT,(function(e,t){"recover"===e&&t(e),t("tryNext")})),this.workerConnection.on(aE.REQUEST_NEW_URLS,(function(t,n){e.workerManagerConnection.close(),e.once(e_.REQUEST_NEW_WORKER_URL,(function(e){t([e])})),e.requestAP(e._connectInfo,e._cancelTokenSource.token,e._retryConfig).then((function(t){e.connectWorkerManager(t,!0)})).catch((function(e){n(e)}))}))}},{key:"requestToInspectImage",value:function(){var e=u(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sequence++,t=yS(this,e_.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid},!t){e.next=11;break}if(t.isPlaying){e.next=5;break}return e.abrupt("return",void this.emit(e_.INSPECT_RESULT,void 0,new Bv(Lv.INVALID_OPERATION,"Only the track being played can be inspected")));case 5:return e.next=7,this.generateRequestData(t,n);case 7:r=e.sent,this.workerConnection.sendMessage(r,!0,!0),e.next=12;break;case 11:this.emit(e_.INSPECT_RESULT,void 0,new Bv(Lv.INVALID_OPERATION,"Only the track being published can be inspected"));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"generateRequestData",value:function(){var e=u(c().mark((function e(t,r){var i,o,a,s,l,f,d,p,h,v,m,g,E,_;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.appId,o=r.cname,a=r.cid,s=r.vid,l=r.sid,f=r.uid,d=Date.now(),e.next=4,t.getCurrentFrameImage("image/jpeg",this.quality);case 4:return p=e.sent,e.next=7,function(){var e=u(c().mark((function e(t,n,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,AC(t.buffer,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(p,i,o);case 7:if(h=e.sent,v=this.sequence+"-"+a+"-"+f+"-"+d+"-"+hS(12,""),m={appId:i,cid:a,cname:o,deviceId:"",elapse:n.intToLong(Number(d-this.inspectStartTime)),fileSize:h.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:h,networkType:6,osType:7,requestId:v,sdkVersion:"4.17.1",sequence:this.sequence,sid:l,timestamp:n.intToLong(d),uid:f,vid:s,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix},void 0===this.extraInfo&&delete m.callbackData,void 0===this.ossFilePrefix&&delete m.ossFilePrefix,!((g=tC(m)).byteLength<this.workerMessageLengthLimit)){e.next=15;break}return lm("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&(E=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kC(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},m),delete E.jpg,Jv.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(E))),e.abrupt("return",g);case 15:return _=this.quality*this.qualityRatio,this.quality=_,e.next=19,this.generateRequestData(t,{appId:i,cname:o,cid:a,vid:s,sid:l,uid:f});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mv.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=$E.CLOSED,this.emit(e_.STATE_CHANGE,ZE.CLOSED)}}],[{key:"intToLong",value:function(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}}]),n}(jv);function gN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function EN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gN(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _N=(CC=Gb(),NC=Gb({argsMap:function(e,t){return Array.isArray(t)||(t=[t]),t.map((function(e){return e?Object(e).toString():"null"}))}}),xC=Gb({argsMap:function(e,t){return t||(t=[]),Array.isArray(t)||(t=[t]),t.map((function(e){return e.getTrackId()}))}}),DC=Gb({argsMap:function(e,t,n){return[t.uid,n]}}),PC=Gb({argsMap:function(e,t){return t.map((function(e){var t=e.user,n=e.mediaType;return[null==t?void 0:t.uid,n]}))}}),LC=Gb({argsMap:function(e,t,n){return[t.uid,n]}}),MC=Gb({argsMap:function(e,t){return t.map((function(e){var t=e.user,n=e.mediaType;return{uid:null==t?void 0:t.uid,mediaType:n}}))}}),UC=Gb(),jC=Gb(),FC=Gb(),BC=Gb(),VC=Gb(),GC=Gb(),WC=Gb(),qC=Gb(),HC=Gb(),KC=Gb(),zC=Gb(),YC=Gb(),JC=Gb(),XC=Gb(),QC=Gb({argsMap:function(e,t){return[t]}}),$C=Gb(),ZC=Gb(),eN=Gb(),tN=Gb(),nN=Gb(),rN=Gb(),iN=Gb(),oN=Gb(),aN=Gb(),sN=Gb(),cN=Gb({argsMap:function(e,t){return Array.isArray(t)||(t=[t]),[JSON.stringify(t)]}}),uN=Gb(),lN=Gb(),fN=Gb(),dN=Gb({reportResult:!0}),pN=Gb(),_b((hN=function(e){d(n,e);var t=p(n);function n(e){var i,o;if(h(this,n),i=t.call(this),Mp(l(i),"store",void 0),Mp(l(i),"_uid",void 0),Mp(l(i),"_channelName",void 0),Mp(l(i),"_uintUid",void 0),Mp(l(i),"_users",[]),Mp(l(i),"_codec",void 0),Mp(l(i),"_mode",void 0),Mp(l(i),"_config",void 0),Mp(l(i),"_clientId",void 0),Mp(l(i),"_appId",void 0),Mp(l(i),"_sessionId",null),Mp(l(i),"_key",void 0),Mp(l(i),"_joinInfo",void 0),Mp(l(i),"_gateway",void 0),Mp(l(i),"_statsCollector",void 0),Mp(l(i),"_configDistribute",void 0),Mp(l(i),"_leaveMutex",new zb("client-leave")),Mp(l(i),"_publishMutex",new zb("client-publish")),Mp(l(i),"_renewTokenMutex",new zb("client-renewtoken")),Mp(l(i),"_subscribeMutex",new zb("client-subscribe")),Mp(l(i),"_encryptionMode","none"),Mp(l(i),"_encryptionSecret",null),Mp(l(i),"_encryptionSalt",null),Mp(l(i),"_proxyServer",void 0),Mp(l(i),"_turnServer",{servers:[],mode:"auto"}),Mp(l(i),"_cloudProxyServerMode","disabled"),Mp(l(i),"_isDualStreamEnabled",!1),Mp(l(i),"_defaultStreamFallbackType",void 0),Mp(l(i),"_lowStreamParameter",void 0),Mp(l(i),"_streamFallbackTypeCacheMap",new Map),Mp(l(i),"_remoteStreamTypeCacheMap",new Map),Mp(l(i),"_axiosCancelSource",Mv.CancelToken.source()),Mp(l(i),"_audioVolumeIndicationInterval",void 0),Mp(l(i),"_networkQualityInterval",void 0),Mp(l(i),"_userOfflineTimeout",void 0),Mp(l(i),"_streamRemovedTimeout",void 0),Mp(l(i),"_injectStreamingClient",void 0),Mp(l(i),"_liveTranscodeStreamingClient",void 0),Mp(l(i),"_liveRawStreamingClient",void 0),Mp(l(i),"_channelMediaRelayClient",void 0),Mp(l(i),"_networkQualitySensitivity","normal"),Mp(l(i),"_p2pChannel",void 0),Mp(l(i),"_useLocalAccessPoint",!1),Mp(l(i),"_setLocalAPVersion",void 0),Mp(l(i),"_joinAndNotLeaveYet",!1),Mp(l(i),"_numberOfJoinCount",0),Mp(l(i),"_remoteDefaultVideoStreamType",void 0),Mp(l(i),"_inspect",void 0),Mp(l(i),"_license",void 0),Mp(l(i),"_handleLocalTrackEnable",(function(e,t,n){i.publish(e,!1).then(t).catch(n)})),Mp(l(i),"_handleLocalTrackDisable",(function(e,t,n){i.unpublish(e).then(t).catch(n)})),Mp(l(i),"_handleUserOnline",(function(e){if(lm("BLOCK_LOCAL_CLIENT")&&bm(e.uid,i.channelName))Jv.debug("[".concat(e.uid,"] will be ignored in local"));else{i.isStringUID&&"string"!=typeof e.uid&&Jv.error("[".concat(i._clientId,"] StringUID is Mixed with UintUID"));var t=i._users.find((function(t){return t.uid===e.uid}));if(t)t._trust_in_room_=!0;else{var n=new JR(e.uid,e.uint_id||e.uid);i._users.push(n),Jv.debug("[".concat(i._clientId,"] user online"),e.uid),i.emit(Hg.USER_JOINED,n)}}})),Mp(l(i),"_handleUserOffline",(function(e){if(!lm("BLOCK_LOCAL_CLIENT")||!bm(e.uid,i.channelName)){var t=i._users.find((function(t){return t.uid===e.uid}));t&&(i._handleRemoveStream(e),SS(i._users,t),i._remoteStreamTypeCacheMap.delete(t.uid),i._streamFallbackTypeCacheMap.delete(t.uid),Jv.debug("[".concat(i._clientId,"] user offline"),e.uid,"reason:",e.reason),i.emit(Hg.USER_LEAVED,t,e.reason))}})),Mp(l(i),"_handleAddAudioOrVideoStream",(function(e,t,n,r,o,a,s){if(!lm("BLOCK_LOCAL_CLIENT")||!bm(t,i.channelName)){var c=i._users.find((function(e){return e.uid===t}));if(c){Jv.debug("[".concat(i._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),i.store.subscribe(c.uid,e,void 0,void 0,void 0,Date.now());var u="audio"===e?c.hasAudio:c.hasVideo;c._uintid||(c._uintid=o||t),"audio"===e?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,"audio"===e?(c._audio_added_=!0,void 0!==n&&(c._audioSSRC=n),void 0!==r&&(c._cname=r),a&&(c._audioOrtc=a)):(c._video_added_=!0,void 0!==n&&(c._videoSSRC=n),void 0!==r&&(c._cname=r),void 0!==s&&(c._rtxSsrcId=s),a&&(c._videoOrtc=a)),("audio"===e?c.hasAudio:c.hasVideo)&&!u&&(Jv.info("[".concat(i._clientId,"] remote user ").concat(c.uid," published ").concat(e)),i.emit(Hg.USER_PUBLISHED,c,e)),"video"===e?Wb.onGatewayStream(i._sessionId,Cg.ON_ADD_VIDEO_STREAM,Ng.ON_ADD_VIDEO_STREAM,{peer:o||t}):Wb.onGatewayStream(i._sessionId,Cg.ON_ADD_AUDIO_STREAM,Ng.ON_ADD_AUDIO_STREAM,{peer:o||t}),i._p2pChannel.remoteMediaSsrcChanged(c,e,n).then((function(t){if(t)return Jv.debug("[".concat(i._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after rejoin because SSRC id changed.")),i._p2pChannel.unsubscribe(c,e,!0).then((function(){return i._subscribe(c,e,!0).catch((function(e){Jv.error("[".concat(i._clientId,"] resubscribe error"),e.toString())}))}))})),i._p2pChannel.hasPendingRemoteMedia(c,e)&&(Jv.debug("[".concat(i._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after reconnect.")),i._subscribe(c,e,!0).catch((function(e){Jv.error("[".concat(i._clientId,"] resubscribe error"),e.toString())})))}else Jv.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)"))}})),Mp(l(i),"_handleRemoveStream",(function(e){if(!lm("BLOCK_LOCAL_CLIENT")||!bm(e.uid,i.channelName)){var t=i._users.find((function(t){return t.uid===e.uid}));if(t){Jv.debug("[".concat(i._clientId,"] stream removed with uid ").concat(e.uid));var n=function(){};t.hasAudio&&t.hasVideo?n=function(){Jv.info("[".concat(i._clientId,"] remote user ").concat(t.uid," unpublished audio track")),i.emit(Hg.USER_UNPUBLISHED,t,"audio"),Jv.info("[".concat(i._clientId,"] remote user ").concat(t.uid," unpublished video track")),i.emit(Hg.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=function(){Jv.info("[".concat(i._clientId,"] remote user ").concat(t.uid," unpublished video track")),i.emit(Hg.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=function(){Jv.info("[".concat(i._clientId,"] remote user ").concat(t.uid," unpublished audio track")),i.emit(Hg.USER_UNPUBLISHED,t,"audio")}),t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,i._p2pChannel.unsubscribe(t).then((function(e){if(e)return i._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0,Wb.onGatewayStream(i._sessionId,Cg.ON_REMOVE_STREAM,Ng.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()}else Jv.warning("[".concat(i._clientId,"] can not find target user!(on_remove_stream)"))}})),Mp(l(i),"_handleSetStreamLocalEnable",(function(e,t,n){if(!lm("BLOCK_LOCAL_CLIENT")||!bm(t,i.channelName)){var r=i._users.find((function(e){return e.uid===t}));if(r){Jv.debug("[".concat(i._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));var o="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;var a=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===a)return;var s=r._audio_enabled_?"enable-local-audio":"disable-local-audio";Jv.debug("[".concat(i._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(s)),i.emit(Hg.USER_INFO_UPDATED,t,s)}else{r._trust_video_enabled_state_=!0;var c=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===c)return;var u=r._video_enabled_?"enable-local-video":"disable-local-video";Jv.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(u)),i.emit(Hg.USER_INFO_UPDATED,t,u)}var l="audio"===e?r.hasAudio:r.hasVideo;return o!==l?!o&&l?(Jv.info("[".concat(i._clientId,"] remote user ").concat(t," published ").concat(e)),void i.emit(Hg.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,i._p2pChannel.muteRemote(r,e),Jv.info("[".concat(i._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void i.emit(Hg.USER_UNPUBLISHED,r,e)):void 0}Jv.error("[".concat(i._clientId,"] can not find target user!(disable_local)"))}})),Mp(l(i),"_handleMuteStream",(function(e,t,n){if(!lm("BLOCK_LOCAL_CLIENT")||!bm(e,i.channelName)){Jv.debug("[".concat(i._clientId,"] receive mute message"),e,t,n);var r=i._users.find((function(t){return t.uid===e}));if(r){var o="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;var a=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===a)return;var s=r._audio_muted_?"mute-audio":"unmute-audio";Jv.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(s)),i.emit(Hg.USER_INFO_UPDATED,e,s)}else{r._trust_video_mute_state_=!0;var c=r._video_muted_;if(r._video_muted_=n,r._video_muted_===c)return;var u=r._video_muted_?"mute-video":"unmute-video";Jv.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(u)),i.emit(Hg.USER_INFO_UPDATED,e,u)}var l="audio"===t?r.hasAudio:r.hasVideo;if(o!==l){if(!o&&l)return("audio"===t?r._audioSSRC:r._videoSSRC)?(Jv.info("[".concat(i._clientId,"] remote user ").concat(e," published ").concat(t)),void i.emit(Hg.USER_PUBLISHED,r,t)):void Jv.warning("[".concat(i._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,i._p2pChannel.muteRemote(r,t),Jv.info("[".concat(i._clientId,"] remote user ").concat(e," unpublished ").concat(t)),i.emit(Hg.USER_UNPUBLISHED,r,t)}}else Jv.warning("[".concat(i._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e))}})),Mp(l(i),"_handleP2PLost",function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jv.debug("[".concat(i._clientId,"] receive p2p lost"),t),parseInt(t.p2pid,10)!==i.store.p2pId){e.next=6;break}return e.next=4,i._p2pChannel.requestReconnect();case 4:e.next=7;break;case 6:Jv.warning("P2PLost stream not found",t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Mp(l(i),"_handleTokenWillExpire",(function(){Jv.debug("[".concat(i._clientId,"] received message onTokenPrivilegeWillExpire")),i.emit(Hg.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),Mp(l(i),"_handleBeforeUnload",(function(e){"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(i.leave(),Jv.info("[".concat(i._clientId,"] auto leave onbeforeunload or pagehide")))})),Mp(l(i),"_handleUpdateNetworkQuality",(function(){if("normal"!==i._networkQualitySensitivity)if(!navigator||void 0===navigator.onLine||navigator.onLine){var e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=i._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=i._p2pChannel.getDownlinkNetworkQuality(),i.emit(Hg.NETWORK_QUALITY,e)}else i.emit(Hg.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6})})),i._codec=e.codec,i._mode=e.mode,i._clientId=hS(5,"client-"),i.store=new $k(e.codec,e.audioCodec,e.mode,i._clientId),i.store.clientCreated(),e.proxyServer&&i.setProxyServer(e.proxyServer,!0),e.turnServer&&i.setTurnServer(e.turnServer,!0),Jv.info("[".concat(i._clientId,"] Initializing AgoraRTC client v").concat(Qv," build: ").concat(Xv,", mode: ").concat(i._mode,", codec: ").concat(i._codec)),e.clientRoleOptions)try{oE(e.clientRoleOptions),o=Object.assign({},e.clientRoleOptions)}catch(e){Jv.warning("[".concat(i._clientId,"] ").concat(e.toString()))}return i._statsCollector=new YT(i.store),i._statsCollector.onStatsException=function(e,t,n){Jv.debug("[".concat(i._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),i.emit(Hg.EXCEPTION,{code:e,msg:t,uid:n})},i._statsCollector.onUploadPublishDuration=function(e,t,n,r){var o=i._users.find((function(t){return t.uid===e}));o&&Wb.peerPublishStatus(i._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:o._uintid})},i.store.useDataChannel=s_().supportDataChannel&&lm("SIGNAL_CHANNEL"),i._gateway=new ew(i.store,{clientId:i._clientId,mode:i._mode,codec:i._codec,websocketRetryConfig:e.websocketRetryConfig||Vv,httpRetryConfig:e.httpRetryConfig||Vv,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:i._statsCollector,role:e.role,clientRoleOptions:o}),i._config=e,i._configDistribute=new Vw,i._p2pChannel=new zk(i.store,i._statsCollector),i._handleP2PChannelEvents(),i._handleGatewayEvents(),i._handleGatewaySignalEvents(),r(i)}return v(n,[{key:"connectionState",get:function(){return this._gateway.state}},{key:"remoteUsers",get:function(){return this._users}},{key:"localTracks",get:function(){return this._p2pChannel.getAllTracks(!0)}},{key:"uid",get:function(){return this._uid}},{key:"channelName",get:function(){return this._channelName}},{key:"isStringUID",get:function(){return!!this._joinInfo&&!!this._joinInfo.stringUid}},{key:"__className__",get:function(){return"Client"}},{key:"join",value:function(){var e=u(c().mark((function e(t,n,r,i,o){var a,s,l,f,d,p,h,v,m,g,E,_,b,y,T,S,w,R,O=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=++this._numberOfJoinCount,this.store.joinStart(),i&&(this.store.uid=i),s=Zk(),l=eC()?window.isSecureContext:"Browser Not Support",(eC()||s)&&window.isSecureContext||(f="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser",Jv.warning(f)),d=vS(),"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),Jv.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),p=Wb.reportApiInvoke(d,{name:Pg.JOIN,options:[t,n,r,i],states:{isHttps:s,isSecureContext:l},tag:Lg.TRACER}),Wb.setAppId(t),e.prev=8,r||null===r){e.next=11;break}throw new Bv(Lv.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));case 11:r&&bg(r,"token",1,2047),bg(t,"appid",1,2047),Tg(n),i&&Sg(i),o&&bg(o,"optionalInfo",1,2047),e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(8),p.onError(e.t0),e.t0;case 17:if(Jv.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(a)),!this._leaveMutex.isLocked){e.next=24;break}return Jv.debug("[".concat(this._clientId,"] join: waiting leave operation")),e.next=21,this._leaveMutex.lock();case 21:e.t1=e.sent,(0,e.t1)(),Jv.debug("[".concat(this._clientId,"] join: continue"));case 24:if(this._joinAndNotLeaveYet=!0,"DISCONNECTED"===this.connectionState){e.next=27;break}throw h=new Bv(Lv.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state")),p.onError(h),h;case 27:if(this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING",v=EN({clientId:this._clientId,appId:t,sid:this._sessionId,cname:n,uid:"string"!=typeof i?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:o,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),this._useLocalAccessPoint&&(v.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof i&&(v.stringUid=i,this._uintUid?(v.uid=this._uintUid,this._uintUid=void 0):v.uid=0),"none"===this._encryptionMode||!this._encryptionSecret){e.next=37;break}return v.aesmode=this._encryptionMode,e.next=33,function(){var e=u(c().mark((function e(t){var n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=kS("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),e.next=3,window.crypto.subtle.importKey("spki",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]);case 3:return r=e.sent,i=Ub(t),e.next=7,window.crypto.subtle.encrypt({name:"RSA-OAEP"},r,i);case 7:return o=e.sent,e.abrupt("return",CS(new Uint8Array(o)));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this._encryptionSecret);case 33:if(v.aespassword=e.sent,this._joinAndNotLeaveYet){e.next=36;break}throw new Bv(Lv.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 36:this._encryptionSalt&&(v.aessalt=this._encryptionSalt);case 37:if(this._startSession(this._sessionId,{channel:n,appId:t}),m=this._sessionId,setTimeout((function(){"CONNECTING"===O.connectionState&&m===O._sessionId&&Wb.joinChannelTimeout(O._sessionId,5)}),5e3),e.prev=40,E=v.cloudProxyServer,["proxy3","proxy4","proxy5"].includes(E)&&(_=lm("PROXY_SERVER_TYPE3"),Array.isArray(_)?v.proxyServer=_[0]:v.proxyServer=_),Wb.setProxyServer(v.proxyServer),Jv.setProxyServer(v.proxyServer),this.store.requestAPStart(),!v.stringUid||v.uid){e.next=54;break}return e.next=46,Iw(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||Vv,this.store);case 46:return b=e.sent,Jv.debug("getUserAccount Success ".concat(v.stringUid," => ").concat(b)),v.uid=b,e.next=51,Rw(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Vv,!0,this.store);case 51:g=e.sent,e.next=57;break;case 54:return e.next=56,Rw(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Vv,!0,this.store);case 56:g=e.sent;case 57:if(this._joinAndNotLeaveYet){e.next=59;break}throw new Bv(Lv.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 59:return this.store.requestAPEnd(),setTimeout((function(){O._configDistribute.startGetConfigDistribute(v,O._axiosCancelSource.token),O._configDistribute.on(GE.UPDATE_BITRATE_LIMIT,(function(e){O._p2pChannel.updateBitrateLimit(e)}))}),0),this._key=r||t,y=g.gatewayInfo,this._joinInfo=EN(EN({},v),{},{cid:y.cid,uid:v.uid?v.uid:y.uid,vid:y.vid,apResponse:y.res,uni_lbs_ip:y.uni_lbs_ip,gatewayAddrs:y.gatewayAddrs}),e.next=64,this._joinGateway();case 64:if(T=e.sent,this._joinAndNotLeaveYet){e.next=67;break}throw new Bv(Lv.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 67:return p.onSuccess(T),this._appId=t,this._channelName=v.cname,this._uid=T,this.store.uid=T,setTimeout((function(){O._networkQualityInterval&&window.clearInterval(O._networkQualityInterval),O._networkQualityInterval=window.setInterval(O._handleUpdateNetworkQuality,2e3),window.addEventListener(fp()?"beforeunload":"pagehide",O._handleBeforeUnload)}),0),S=v.stringUid?"string uid: ".concat(v.stringUid,",uid: ").concat(v.uid):"uid: ".concat(this._uid),e.abrupt("return",(Jv.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(S)),setTimeout((function(){Jv.startUpload()}),5e3),this.store.joinEnd(),R=this,Em.includes(R)||Em.push(R),T));case 72:throw e.prev=72,e.t2=e.catch(40),w=Array.isArray(e.t2)?e.t2[0]:e.t2,Jv.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),w),w.code!==Lv.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(w),w;case 76:case"end":return e.stop()}}),e,this,[[8,14],[40,72]])})));function t(t,n,r,i,o){return e.apply(this,arguments)}return t}()},{key:"_joinGateway",value:function(){var e=this;if(!this._joinInfo||!this._key)throw new Bv(Lv.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!lm("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then((function(e){return e})).catch((function(t){if(t.code===Lv.INIT_WEBSOCKET_TIMEOUT)return e._gateway.leave(!0,qg.FALLBACK),t;if(t.code===Lv.INIT_DATACHANNEL_TIMEOUT)return e._gateway.leave(!0,qg.FALLBACK),t;throw t})).then((function(t){if(t instanceof Bv){if(t.code===Lv.INIT_WEBSOCKET_TIMEOUT){if(Jv.info("[".concat(e._clientId,"] join timeout, fallback to proxy")),!e._joinInfo||!e._key)throw new Bv(Lv.INVALID_OPERATION);e._joinInfo.cloudProxyServer="fallback",e._cloudProxyServerMode="fallback",e.store.cloudProxyServerMode="fallback";var n=lm("PROXY_SERVER_TYPE3");if(Array.isArray(n))if(e._joinInfo.apUrl){var r=/^https?:\/\/(.+?)(\/.*)?$/.exec(e._joinInfo.apUrl)[1].split("."),i=r.slice(r.length-2).join(".");n.forEach((function(t){e._joinInfo&&t.includes(i)&&(e._joinInfo.proxyServer=t)})),e._joinInfo.proxyServer||(e._joinInfo.proxyServer=n[0])}else e._joinInfo.proxyServer=n[0];else e._joinInfo.proxyServer=n;var o=lm("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return o&&o[1]&&"443"!==o[1]&&Jv.setProxyServer(e._joinInfo.proxyServer),"443"!==lm("STATS_COLLECTOR_PORT").toString()&&Wb.setProxyServer(e._joinInfo.proxyServer),Wb.reportApiInvoke(e._sessionId,{name:Pg.JOIN_FALLBACK_TO_PROXY,options:[e._joinInfo.proxyServer],tag:Lg.TRACER}).onSuccess(),e.emit(Hg.JOIN_FALLBACK_TO_PROXY,e._joinInfo.proxyServer),lm("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&e._joinInfo.turnServer.servers.forEach((function(e){"forceturn"in e&&(e.forceturn=!0)})),e._gateway.join(e._joinInfo,e._key)}if(Jv.info("[".concat(e._clientId,"] join by datachannel timeout, fallback to websocket")),!e._joinInfo||!e._key)throw new Bv(Lv.INVALID_OPERATION);return Wb.reportApiInvoke(e._sessionId,{name:Pg.DATACHANNEL_FAILBACK,options:[e.store.clientId],tag:Lg.TRACER}).onSuccess(),e._joinGateway()}return t})).then((function(e){return e}))}},{key:"leave",value:function(){var e=u(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Jv.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(fp()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){var t=Em.indexOf(e);-1!==t&&Em.splice(t,1)}(this),e.next=3,this._leaveMutex.lock();case 3:if(t=e.sent,"DISCONNECTED"!==this.connectionState){e.next=6;break}return e.abrupt("return",(Jv.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t()));case 6:return e.next=8,this._gateway.leave("CONNECTED"!==this.connectionState);case 8:Jv.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t();case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"publish",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,u=this,l=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(l.length>1&&void 0!==l[1])||l[1],Array.isArray(t)||(t=[t]),0!==t.length){e.next=3;break}throw new Bv(Lv.INVALID_PARAMS,"track list is empty");case 3:if("audience"!==this._gateway.role){e.next=5;break}throw new Bv(Lv.INVALID_OPERATION,"audience can not publish stream");case 5:r=s(t),e.prev=6,r.s();case 8:if((i=r.n()).done){e.next=16;break}if((o=i.value)instanceof Jb){e.next=12;break}throw new Bv(Lv.INVALID_PARAMS,"parameter is not local track");case 12:if(o._enabled||!n){e.next=14;break}throw new Bv(Lv.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()));case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:return Jv.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(t.map((function(e){return"".concat(e.getTrackId()," ")})))),e.next=27,this._configDistribute.awaitConfigDistributeComplete();case 27:return n&&t.forEach((function(e){var t=u._configDistribute.getBitrateLimit();e instanceof zR&&t&&e.setBitrateLimit(t.uplink)})),e.next=30,this._publishMutex.lock();case 30:return a=e.sent,e.prev=31,e.next=34,this._publishHighStream(t);case 34:Jv.info("[".concat(this._clientId,"] Publish success, id ").concat(t.map((function(e){return"".concat(e.getTrackId()," ")})))),e.next=40;break;case 37:throw e.prev=37,e.t1=e.catch(31),Jv.error("[".concat(this._clientId,"] publish error"),e.t1.toString()),e.t1;case 40:return e.prev=40,a(),e.finish(40);case 43:case"end":return e.stop()}}),e,this,[[6,18,21,24],[31,37,40,43]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublish",value:function(){var e=u(c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");case 2:return t?Array.isArray(t)||(t=[t]):t=this._p2pChannel.getAllTracks(!0),Jv.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((function(e){return"".concat(e.getTrackId()," ")}))," ")),e.next=5,this._publishMutex.lock();case 5:return n=e.sent,e.prev=6,e.next=9,this._p2pChannel.unpublish(t);case 9:if(r=e.sent,e.t0=r,!e.t0){e.next=14;break}return e.next=14,this._gateway.unpublish(r,this._uid);case 14:Jv.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((function(e){return"".concat(e.getTrackId())})))),e.next=20;break;case 17:throw e.prev=17,e.t1=e.catch(6),Jv.error("[".concat(this._clientId,"] unpublish error"),e.t1.toString()),e.t1;case 20:return e.prev=20,n&&n(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[6,17,20,23]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._subscribe(t,n));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"_subscribe",value:function(){var e=u(c().mark((function e(t,n,r){var i,o,a,s,u,l,f,d,p,h=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(gg(n,"mediaType",["audio","video"]),this._joinInfo){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Can't subscribe stream, not joined");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bv(Lv.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));case 4:if(this._users.find((function(e){return e===t}))){e.next=7;break}throw i=new Bv(Lv.INVALID_REMOTE_USER,"user is not in the channel"),Jv.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),i;case 7:if(t.hasAudio||t.hasVideo){e.next=10;break}throw o=new Bv(Lv.INVALID_REMOTE_USER,"user is not published"),Jv.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),o;case 10:if(r||("audio"!==n||t.hasAudio&&void 0!==t._audioSSRC)&&("video"!==n||t.hasVideo&&void 0!==t._videoSSRC)){e.next=13;break}throw a=new Bv(Lv.REMOTE_USER_IS_NOT_PUBLISHED),Jv.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(n,", remote track is not published")),a;case 13:return s="audio"===n?t._audioSSRC:t._videoSSRC,u="audio"===n?t._audioOrtc:t._videoOrtc,l="video"===n?t._rtxSsrcId:void 0,f={stream_type:"audio"===n?qE.AUDIO:qE.VIDEO,ssrcId:s},e.next=19,this._subscribeMutex.lock();case 19:return d=e.sent,Jv.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(n)),e.prev=21,e.next=24,this._p2pChannel.hasRemoteMediaWithLock(t,n);case 24:if(!e.sent){e.next=29;break}return e.next=27,this._p2pChannel.unmuteRemote(t,n);case 27:e.next=54;break;case 29:return e.prev=29,HT.markSubscribeStart(this.store.clientId,s),this.store.subscribe(t.uid,n,Date.now()),e.next=34,this._p2pChannel.subscribe(t,n,s,l,u);case 34:return e.prev=34,e.next=37,this._gateway.subscribe(t.uid,f,!0);case 37:e.next=48;break;case 39:if(e.prev=39,e.t0=e.catch(34),(null==e.t0?void 0:e.t0.code)===Lv.WS_ABORT){e.next=45;break}return e.next=44,this._p2pChannel.unsubscribe(t,n);case 44:throw e.t0;case 45:return e.next=47,this._p2pChannel.unsubscribe(t,n,!0);case 47:this._p2pChannel.setPendingRemoteMedia(t,n);case 48:this.store.subscribe(t.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,n),e.next=54;break;case 51:throw e.prev=51,e.t1=e.catch(29),this._p2pChannel.reportSubscribeEvent(!1,null==e.t1?void 0:e.t1.code,t,n),e.t1;case 54:if(Jv.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((function(e){Jv.warning("[".concat(h._clientId,"] auto set fallback failed"),e)})),p="audio"===n?t._audioTrack:t._videoTrack){e.next=58;break}throw new Bv(Lv.UNEXPECTED_ERROR,"can not find remote track in user object");case 58:return e.abrupt("return",p);case 61:throw e.prev=61,e.t2=e.catch(21),Jv.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),e.t2),e.t2;case 64:return e.prev=64,d(),e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[21,61,64,67],[29,51],[34,39]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"massSubscribe",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,u,l,f,d,p,h,v,g,E,_,b,y,T,S,w,R,O,I,A,k,C=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yg(t,"subscribeList"),this._joinInfo){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Can't subscribe stream, not joined");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bv(Lv.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));case 4:return n=Date.now(),r=new Map,e.next=8,this._subscribeMutex.lock();case 8:return i=e.sent,Jv.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),o=(t=m(t)).map((function(e){return{user:e.user,mediaType:e.mediaType}})),e.next=13,this._p2pChannel.globalLock();case 13:u=e.sent,e.prev=14,f=c().mark((function e(){var n,i,a,s,u,l,f,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t[d],i=n.user,gg(a=n.mediaType,"mediaType",["audio","video"]),i){e.next=4;break}throw s=new Bv(Lv.INVALID_PARAMS,"user property does not exist in subscribeList item"),Jv.error("[".concat(C._clientId,"] user property does not exist in subscribeList item")),s;case 4:if(C._users.find((function(e){return e===i}))){e.next=8;break}return u=new Bv(Lv.INVALID_REMOTE_USER,"user is not in the channel"),Jv.error("[".concat(C._clientId,"] can not massSubscribe ").concat(i.uid,", this user is not in the channel")),o[d].error=u,t.splice(d,1),e.abrupt("return","continue");case 8:if(("audio"!==a||i.hasAudio&&void 0!==i._audioSSRC)&&("video"!==a||i.hasVideo&&void 0!==i._videoSSRC)){e.next=12;break}return l=new Bv(Lv.REMOTE_USER_IS_NOT_PUBLISHED),Jv.error("[".concat(C._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(a,", remote user is not published")),o[d].error=l,t.splice(d,1),e.abrupt("return","continue");case 12:if(f=IE.Video|IE.LwoVideo,!(p=r.get(i))){e.next=20;break}if(!("video"===a?p&f:p&IE.Audio)){e.next=17;break}return t.splice(d,1),Jv.warning("repeat massSubscribe user:".concat(i.uid,", mediaType:").concat(a," twice")),e.abrupt("return","continue");case 17:r.set(i,p|("video"===a?f:IE.Audio)),e.next=21;break;case 20:r.set(i,"video"===a?f:IE.Audio);case 21:case"end":return e.stop()}}),e)})),d=t.length-1;case 17:if(!(d>=0)){e.next=25;break}return e.delegateYield(f(),"t0",19);case 19:if("continue"!==e.t0){e.next=22;break}return e.abrupt("continue",22);case 22:d--,e.next=17;break;case 25:p=t.length-1;case 26:if(!(p>=0)){e.next=36;break}if(h=t[p],v=h.user,g=h.mediaType,E=IE.Video|IE.LwoVideo,!this._p2pChannel.hasRemoteMedia(v,g)){e.next=33;break}return e.next=31,this._p2pChannel.unmuteRemoteNoLock(v,g);case 31:_=r.get(v),r.set(v,"video"===g?_^E:_^IE.Audio),t.splice(p,1);case 33:p--,e.next=26;break;case 36:if(this.store.massSubscribe(t.map((function(e){return{userId:e.user.uid,type:e.mediaType}})),n),b=Er(l=Array.from(r.entries())).call(l,(function(e,t){var n=a(t,2),r=n[0],i=n[1];if(0===i)return e;var o={stream_id:r.uid,stream_type:i};return i&IE.Audio&&(o.audio_ssrc=r._audioSSRC),i&IE.Video&&(o.video_ssrc=r._videoSSRC),e.push(o),e}),[]),e.prev=38,e.t1=t.length>0,!e.t1){e.next=43;break}return e.next=43,this._p2pChannel.massSubscribeNoLock(t.map((function(e){var t=e.user,n=e.mediaType;return{user:t,mediaType:n,ssrcId:n===qE.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:t._rtxSsrcId}})));case 43:if(y=new Map,!(b.length>0)){e.next=49;break}return e.next=47,this._gateway.subscribeAll(b,!0);case 47:((null==(T=e.sent)?void 0:T.users)||[]).forEach((function(e){var t=e.stream_id,n=e.video_error_code,r=e.audio_error_code,i=e.error_code;(n||r||i)&&y.set(t,{video_error_code:n,audio_error_code:r,error_code:i})}));case 49:if(!(Array.from(y.entries()).length>0)){e.next=53;break}return S=Array.from(y.entries()).map((function(e){var t,n=a(e,2),r=n[0],i=n[1];return i.error_code||i.video_error_code&&i.audio_error_code?t=void 0:i.video_error_code?t=qE.VIDEO:i.audio_error_code&&(t=qE.AUDIO),{user:C.remoteUsers.find((function(e){return e.uid===r})),mediaType:t}})),e.next=53,this._p2pChannel.massUnsubscribeNoLock(S);case 53:w=s(o);try{for(w.s();!(R=w.n()).done;)O=R.value,(I=y.get(O.user.uid))&&(A=I.error_code||"audio"===O.mediaType&&I.audio_error_code||"video"===O.mediaType&&I.video_error_code)&&(k=jS(A),Jv.error("user:".concat(O.user.uid," mediaType:").concat(O.mediaType," has massSubscribe error ").concat(k.desc)),O.error=new Bv(Lv.SUBSCRIBE_FAILED,"code ".concat(A,": ").concat(k.desc))),O.error||("video"===O.mediaType?O.track=O.user.videoTrack:O.track=O.user.audioTrack)}catch(N){w.e(N)}finally{w.f()}return e.abrupt("return",(this.store.massSubscribe(o.filter((function(e){return!e.error})).map((function(e){return{userId:e.user.uid,type:e.mediaType}})),void 0,Date.now()),o.forEach((function(e){var t;Wb.subscribe(C.store.sessionId,{succ:!!e.error,ec:(null===(t=e.error)||void 0===t?void 0:t.code)||null,video:e.mediaType===qE.VIDEO,audio:e.mediaType===qE.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===qE.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:C.store.p2pId,eventElapse:Math.floor(performance.now()-n)},!0)})),Jv.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),o));case 58:return e.prev=58,e.t2=e.catch(38),e.next=62,this._p2pChannel.massUnsubscribeNoLock(t);case 62:throw e.t2;case 63:return e.prev=63,u(),i(),e.finish(63);case 66:case"end":return e.stop()}}),e,this,[[14,,63,66],[38,58]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unsubscribe",value:function(){var e=u(c().mark((function e(t,n){var r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&gg(n,"mediaType",["audio","video"]),this._joinInfo){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");case 2:if(this._users.find((function(e){return e===t}))){e.next=5;break}throw r=new Bv(Lv.INVALID_REMOTE_USER,"user is not in the channel"),Jv.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r;case 5:return Jv.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(n)),e.prev=6,e.next=9,this._p2pChannel.unsubscribe(t,n);case 9:if(i=e.sent,e.t0=i,!e.t0){e.next=14;break}return e.next=14,this._gateway.unsubscribe(i,t.uid);case 14:Jv.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(n)),e.next=22;break;case 17:if(e.prev=17,e.t1=e.catch(6),e.t1.code!==Lv.DISCONNECT_P2P){e.next=21;break}return e.abrupt("return",void Jv.warning("disconnecting p2p, abort unsubscribe request."));case 21:throw Jv.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),e.t1.toString()),e.t1;case 22:case"end":return e.stop()}}),e,this,[[6,17]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribe",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yg(t,"unsubscribeList"),this._joinInfo){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");case 2:Jv.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),t=m(t),n=new Map,r=c().mark((function e(){var r,o,s,u,l,f,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t[i],o=r.user,s=r.mediaType,o){e.next=4;break}throw u=new Bv(Lv.INVALID_PARAMS,"user property does not exist in unsubscribeList item"),Jv.error("[".concat(a._clientId,"] user property does not exist in unsubscribeList item")),u;case 4:if(gg(s,"mediaType",["video","audio",void 0]),a._users.find((function(e){return e===o}))){e.next=8;break}return Jv.warning("[".concat(a._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),t.splice(i,1),e.abrupt("return","continue");case 8:if(l=IE.Video|IE.LwoVideo,!n.has(o)){e.next=25;break}f=n.get(o),e.t0=s,e.next="video"===e.t0?14:"audio"===e.t0?16:18;break;case 14:return d=f&l,e.abrupt("break",19);case 16:return d=f&IE.Audio,e.abrupt("break",19);case 18:d=f&(IE.Audio|l);case 19:if(!d){e.next=22;break}return Jv.warning("repeat massUnsubscribe user:".concat(o.uid,",mediaType:").concat(s," twice.")),t.splice(i,1),e.abrupt("return","continue");case 22:s?"audio"===s?n.set(o,f|IE.Audio):"video"===s&&n.set(o,f|l):n.set(o,f|IE.Audio|l),e.next=26;break;case 25:s?"audio"===s?n.set(o,IE.Audio):"video"===s&&n.set(o,l):n.set(o,IE.Audio|l);case 26:case"end":return e.stop()}}),e)})),i=t.length-1;case 6:if(!(i>=0)){e.next=14;break}return e.delegateYield(r(),"t0",8);case 8:if("continue"!==e.t0){e.next=11;break}return e.abrupt("continue",11);case 11:i--,e.next=6;break;case 14:return e.prev=14,e.next=17,this._p2pChannel.massUnsubscribe(t);case 17:if(o=e.sent,e.t1=o,!e.t1){e.next=22;break}return e.next=22,this._gateway.massUnsubscribe(o);case 22:Jv.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e.next=30;break;case 25:if(e.prev=25,e.t2=e.catch(14),e.t2.code!==Lv.DISCONNECT_P2P){e.next=29;break}return e.abrupt("return",void Jv.warning("disconnecting p2p, abort unsubscribe request."));case 29:throw Jv.error("[".concat(this._clientId,"] massUnsubscribe error"),e.t2.toString()),e.t2;case 30:case"end":return e.stop()}}),e,this,[[14,25]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setLowStreamParameter",value:function(e){!function(e){if(!e)throw new Bv(Lv.INVALID_PARAMS);wg(e.width)||_g(e.width,"streamParameter.width"),wg(e.height)||_g(e.height,"streamParameter.height"),wg(e.framerate)||_g(e.framerate,"streamParameter.framerate"),wg(e.bitrate)||Eg(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&Jv.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Jv.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));var t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e}},{key:"enableDualStream",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s_().supportDualStream){e.next=2;break}throw Wb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Bv(Lv.NOT_SUPPORTED,"Your browser is not support dual stream");case 2:if(!this._isDualStreamEnabled){e.next=4;break}throw new Bv(Lv.INVALID_OPERATION,"Dual stream is already enabled");case 4:if(!this._p2pChannel.canPublishLowStream()){e.next=13;break}return e.prev=5,e.next=8,this._publishLowStream();case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(5),Wb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e.t0;case 13:this._isDualStreamEnabled=!0,Wb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Jv.info("[".concat(this._clientId,"] enable dual stream"));case 14:case"end":return e.stop()}}),e,this,[[5,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"disableDualStream",value:function(){var e=u(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isDualStreamEnabled){e.next=18;break}if(this._joinInfo){e.next=3;break}throw new Bv(Lv.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 3:if(!this._p2pChannel.getLocalMedia(HE.LocalVideoLowTrack)){e.next=17;break}return e.prev=4,e.next=7,this._p2pChannel.unpublishLowStream();case 7:if(t=e.sent,e.t0=t,!e.t0){e.next=12;break}return e.next=12,this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid);case 12:e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(4),Wb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e.t1;case 17:this._isDualStreamEnabled=!1,Wb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Jv.info("[".concat(this._clientId,"] disable dual stream"));case 18:case"end":return e.stop()}}),e,this,[[4,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"setClientRole",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(function(e){gg(e,"role",["audience","host"])}(t),n&&oE(n),"rtc"!==this._mode){e.next=2;break}throw Jv.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new Bv(Lv.INVALID_OPERATION,"rtc mode can not use setClientRole");case 2:if(!n||!n.level||"host"!==t){e.next=4;break}throw new Bv(Lv.INVALID_OPERATION,"host mode can not set audience latency level");case 4:if("audience"!==t||!this._p2pChannel.hasLocalMedia()){e.next=6;break}throw new Bv(Lv.INVALID_OPERATION,"can not set client role to audience when publishing stream");case 6:return e.next=8,this._gateway.setClientRole(t,n);case 8:Jv.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(n&&n.level));case 9:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setProxyServer",value:function(e,t){if(bg(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new Bv(Lv.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new Bv(Lv.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Wb.setProxyServer(this._proxyServer),Jv.setProxyServer(this._proxyServer),Jv.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}},{key:"setTurnServer",value:function(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new Bv(Lv.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new Bv(Lv.INVALID_OPERATION,"You have already set the proxy")}if(rE(e))return this._turnServer={servers:e,mode:"original-manual"},void Jv.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((function(e){return e.urls})).join(","),"."));e.forEach((function(e){return iE(e)})),this._turnServer={servers:e,mode:"manual"},Jv.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}},{key:"setLicense",value:function(e){if("DISCONNECTED"!==this.connectionState)throw new Bv(Lv.INVALID_OPERATION,"you should set license before join channel");if(bg(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Bv(Lv.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,Jv.info("[".concat(this._clientId,"] set license success"),e)}},{key:"startProxyServer",value:function(e){if("DISCONNECTED"!==this.connectionState)throw new Bv(Lv.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new Bv(Lv.INVALID_OPERATION,"You have already set the proxy");var t,n=[3,4,5];switch(void 0===e&&(e=3),e){case 1:case 2:throw new Bv(Lv.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new Bv(Lv.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,Jv.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}},{key:"stopProxyServer",value:function(){if("DISCONNECTED"!==this.connectionState)throw new Bv(Lv.INVALID_OPERATION,"Stop proxy server after leave channel");Wb.setProxyServer(),Jv.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Jv.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}},{key:"setLocalAccessPointsV2",value:function(e){if(!e.accessPoints)throw new Bv(Lv.INVALID_PARAMS,"accessPoints is required.");yg(e.accessPoints.serverList,"accessPoints.serverList"),bg(e.accessPoints.domain,"accessPoints.domain");var t=function(e,t){Eg(e,t,0,65535,!0)},n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new Bv(Lv.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");lm("CLOSE_AFB_FOR_LOCAL_AP")&&(um("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),um("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));var r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map((function(e){return r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e})),a=o.map((function(e){return"".concat(e,":").concat(n)}));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,um("WEBCS_DOMAIN",a),um("WEBCS_DOMAIN_BACKUP_LIST",a),um("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(yg(e.report.hostname,"report.hostname"),um("EVENT_REPORT_DOMAIN",e.report.hostname[0]),um("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(um("EVENT_REPORT_DOMAIN",o[0]),um("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));var s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),um("STATS_COLLECTOR_PORT",s),e.report?um("ENABLE_EVENT_REPORT",!0):um("ENABLE_EVENT_REPORT",!1);var c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(yg(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];var u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),um("LOG_UPLOAD_SERVER","".concat(c,":").concat(u));var l=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(yg(e.cds.hostname,"cds.hostname"),l=e.cds.hostname):l=o;var f=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),f=e.cds.port),um("CDS_AP",l.map((function(e){return"".concat(e,":").concat(f)}))),e.cds?um("ENABLE_CONFIG_DISTRIBUTE",!0):um("ENABLE_CONFIG_DISTRIBUTE",!1),Jv.info("set local access point v2 success")}},{key:"setLocalAccessPoints",value:function(e,t){if(yg(e,"serverList"),bg(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new Bv(Lv.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");var n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((function(e){return n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e})),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,um("WEBCS_DOMAIN",e),um("WEBCS_DOMAIN_BACKUP_LIST",e),um("GATEWAY_DOMAINS",[t]),um("EVENT_REPORT_DOMAIN",e[0]),um("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),um("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),Jv.info("set local access point success")}},{key:"setRemoteDefaultVideoStreamType",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(gg(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,!this._joinInfo){e.next=12;break}return e.prev=1,e.next=4,this._gateway.setDefaultRemoteVideoStreamType(t);case 4:this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),Jv.error("[".concat(this._clientId,"] set default remote video stream type error"),e.t0.toString()),e.t0;case 10:e.next=13;break;case 12:Jv.debug("haven't joined yet, cache remoteDefaultVideoStreamType ".concat(t));case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setRemoteVideoStreamType",value:function(){var e=u(c().mark((function e(t,n){var r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return gg(n,"streamType",[0,1]),e.prev=1,e.next=4,this._gateway.setRemoteVideoStreamType(t,n);case 4:setTimeout((function(){var e=r._users.find((function(e){return e.uid===t}));e&&e.videoTrack&&e.videoTrack.updateMediaStreamTrackResolution()}),2e3),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),Jv.error("[".concat(this._clientId,"] set remote video stream type error"),e.t0.toString()),e.t0;case 10:Jv.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(t,n);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStreamFallbackOption",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return gg(n,"fallbackType",[0,1,2]),e.prev=1,e.next=4,this._gateway.setStreamFallbackOption(t,n);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Jv.error("[".concat(this._clientId,"] set stream fallback option"),e.t0.toString()),e.t0;case 9:Jv.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(t,n);case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setEncryptionConfig",value:function(e,t,n){if(function(e){gg(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),bg(t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new Bv(Lv.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Bv(Lv.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||Jv.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=CS(n))}},{key:"renewToken",value:function(){var e=u(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(bg(t,"token",1,2047),this._key&&this._joinInfo){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"renewToken should not be called before user join");case 2:return n=this._key,this._key=t,this._joinInfo&&(this._joinInfo.token=t),e.next=6,this._renewTokenMutex.lock();case 6:if(r=e.sent,e.prev=7,!lm("USE_NEW_TOKEN")){e.next=18;break}return Jv.debug("start renew token with ticket from unilbs"),e.next=12,Uw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Vv);case 12:return i=e.sent,Jv.debug("[".concat(this._clientId,"] get ticket from unilbs success")),e.next=16,this._gateway.renewToken({token:t,ticket:i});case 16:e.next=21;break;case 18:return Jv.debug("start renew token without ticket"),e.next=21,this._gateway.renewToken({token:t});case 21:Jv.debug("[".concat(this._clientId,"] renewToken success")),e.next=27;break;case 24:throw e.prev=24,e.t0=e.catch(7),this._key=n,this._joinInfo.token=n,Jv.error("[".concat(this._clientId,"] renewToken failed"),e.t0.toString()),e.t0;case 27:return e.prev=27,r(),e.finish(27);case 30:case"end":return e.stop()}}),e,this,[[7,24,27,30]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"enableAudioVolumeIndicator",value:function(){var e=this;this._audioVolumeIndicationInterval?Jv.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((function(){var t=e._p2pChannel.getAudioLevels();e.emit(Hg.VOLUME_INDICATOR,t)}),lm("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}},{key:"getRTCStats",value:function(){var e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}},{key:"startLiveStreaming",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=5;break}if("h264"===this._codec){e.next=3;break}throw new Bv(Lv.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");case 3:if(this._p2pChannel.hasLocalMedia()){e.next=5;break}throw new Bv(Lv.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming");case 5:if(!(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))){e.next=7;break}throw new Bv(Lv.LIVE_STREAMING_TASK_CONFLICT);case 7:return r=n?sE.TRANSCODE:sE.RAW,e.abrupt("return",this._createLiveStreamingClient(r).startLiveStreamingTask(t,r));case 9:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setLiveTranscoding",value:function(e){return this._createLiveStreamingClient(sE.TRANSCODE).setTranscodingConfig(e)}},{key:"stopLiveStreaming",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((function(e){return e&&e.hasUrl(t)}))).length){e.next=3;break}throw new Bv(Lv.INVALID_PARAMS,"can not find live streaming url to stop");case 3:return e.next=5,Bf.all(n.map((function(e){return e&&e.stopLiveStreamingTask(t)})));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addInjectStreamUrl",value:function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");case 2:return(r=this._createLiveStreamingClient(sE.INJECT)).setInjectStreamConfig(n,0),e.next=6,r.startLiveStreamingTask(t,sE.INJECT);case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"removeInjectStreamUrl",value:function(){var e=u(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._createLiveStreamingClient(sE.INJECT),r=Array.from(jy(t=n.streamingTasks).call(t)).find((function(e){return e.mode===sE.INJECT})),this._joinInfo&&r){e.next=3;break}throw new Bv(Lv.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");case 3:return e.next=5,n.stopLiveStreamingTask(r.url);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"startChannelMediaRelay",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Jw(t),n=this._createChannelMediaRelayClient(),e.next=4,n.startChannelMediaRelay(t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateChannelMediaRelay",value:function(){var e=u(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Jw(t),n=this._createChannelMediaRelayClient(),e.next=4,n.updateChannelMediaRelay(t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopChannelMediaRelay",value:function(){var e=u(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._createChannelMediaRelayClient(),e.next=3,t.stopChannelMediaRelay();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"sendStreamMessage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new Bv(Lv.INVALID_OPERATION,"can not send data stream, not joined");if("string"==typeof e&&(e=(new TextEncoder).encode(e)),new Blob([e]).size>1024)throw new Bv(Lv.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Jg.DATA_STREAM,{payload:CS(e)},!t)}},{key:"sendMetadata",value:function(e){if(!this._joinInfo)throw new Bv(Lv.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Bv(Lv.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Jg.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:CS(e)})}},{key:"sendCustomReportMessage",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)||(t=[t]),t.forEach(kg),this._joinInfo){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"can not send custom report, not joined");case 2:return e.next=4,Wb.sendCustomReportMessage(this._joinInfo.sid,t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getLocalAudioStats",value:function(){return this._statsCollector.getLocalAudioTrackStats()}},{key:"getRemoteAudioStats",value:function(){return this._statsCollector.getRemoteAudioTrackStats()}},{key:"getLocalVideoStats",value:function(){return this._statsCollector.getLocalVideoTrackStats()}},{key:"getRemoteVideoStats",value:function(){return this._statsCollector.getRemoteVideoTrackStats()}},{key:"getRemoteNetworkQuality",value:function(){return this._statsCollector.getRemoteNetworkQualityStats()}},{key:"pickSVCLayer",value:function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return gg(n.spatialLayer,"spatialLayer",[0,1,2,3]),gg(n.temporalLayer,"temporalLayer",[0,1,2,3]),e.prev=1,e.next=4,this._gateway.pickSVCLayer(t,n);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Jv.error("[".concat(this._clientId,"] pick SVC layer failed"),e.t0.toString()),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"_reset",value:function(){if(Jv.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Mv.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach((function(e){e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new zb("client-publish"),this._subscribeMutex=new zb("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(y){}}},{key:"_startSession",value:function(e,t){var n=e||vS();e?Jv.debug("[".concat(this._clientId,"] new Session ").concat(n)):Jv.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?Wb.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:t.channel,appid:t.appId,mode:this._mode}):this._joinInfo?Wb.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&Wb.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}},{key:"_publishHighStream",value:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bv(Lv.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));case 4:if("auto"!==this._turnServer.mode||!lm("FORCE_TURN")||lm("TURN_ENABLE_TCP")||lm("TURN_ENABLE_UDP")){e.next=6;break}throw new Bv(Lv.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");case 6:return Jv.debug("[".concat(this._clientId,"] publish high stream")),e.prev=7,e.next=10,this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);case 10:return n=e.sent,e.next=13,n.next();case 13:if(!(r=e.sent.value)){e.next=27;break}return e.prev=15,e.next=18,this._gateway.publish(this._uid,r,!0);case 18:o=e.sent,e.next=25;break;case 21:if(e.prev=21,e.t0=e.catch(15),e.t0.code===Lv.DISCONNECT_P2P){e.next=25;break}throw n.throw(e.t0),e.t0;case 25:return e.next=27,n.next((null===(i=o)||void 0===i?void 0:i.ortc)||[]);case 27:this._p2pChannel.reportPublishEvent(!0,null),a=s(t),e.prev=29,a.s();case 31:if((u=a.n()).done){e.next=40;break}if((l=u.value)instanceof zR&&l._encoderConfig&&this._gateway.setVideoProfile(l._encoderConfig),e.t1=!l.muted&&l.enabled,e.t1){e.next=38;break}return e.next=38,this._p2pChannel.muteLocalTrack(l);case 38:e.next=31;break;case 40:e.next=45;break;case 42:e.prev=42,e.t2=e.catch(29),a.e(e.t2);case 45:return e.prev=45,a.f(),e.finish(45);case 48:e.next=55;break;case 50:if(e.prev=50,e.t3=e.catch(7),this._p2pChannel.reportPublishEvent(!1,null==e.t3?void 0:e.t3.code,t),(null==e.t3?void 0:e.t3.code)!==Lv.WS_ABORT){e.next=54;break}return e.abrupt("return");case 54:throw e.t3;case 55:case"end":return e.stop()}}),e,this,[[7,50],[15,21],[29,42,45,48]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_publishLowStream",value:function(){var e=u(c().mark((function e(){var t,n,r,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bv(Lv.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));case 4:return Jv.debug("[".concat(this._clientId,"] publish low stream")),(t=this._configDistribute.getLowStreamConfigDistribute())&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate)),e.prev=7,e.next=10,this._p2pChannel.publishLowStream(this._lowStreamParameter);case 10:return n=e.sent,e.next=13,n.next();case 13:if(!(r=e.sent.value)){e.next=26;break}return e.prev=15,e.next=18,this._gateway.publish(this._uid,r,!0);case 18:o=e.sent,e.next=25;break;case 21:if(e.prev=21,e.t0=e.catch(15),e.t0.code===Lv.DISCONNECT_P2P){e.next=25;break}throw n.throw(e.t0),e.t0;case 25:n.next((null===(i=o)||void 0===i?void 0:i.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0);case 26:e.next=33;break;case 28:if(e.prev=28,e.t1=e.catch(7),this._p2pChannel.reportPublishEvent(!1,null==e.t1?void 0:e.t1.code,void 0,!0),(null==e.t1?void 0:e.t1.code)!==Lv.WS_ABORT){e.next=32;break}return e.abrupt("return");case 32:throw e.t1;case 33:case"end":return e.stop()}}),e,this,[[7,28],[15,21]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_createLiveStreamingClient",value:function(e){var t=this;if(!this._joinInfo||!this._appId)return new Bv(Lv.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();var n=function(){return new zw(t._joinInfo,t._config.websocketRetryConfig||Vv,t._config.httpRetryConfig||Vv)},r=function(e){e.onLiveStreamError=function(e,n){Wb.reportApiInvoke(t._sessionId,{name:Pg.ON_LIVE_STREAM_ERROR,options:[e,n],tag:Lg.TRACER}).onSuccess(),t.emit(Hg.LIVE_STREAMING_ERROR,e,n)},e.onLiveStreamWarning=function(e,n){Wb.reportApiInvoke(t._sessionId,{name:Pg.ON_LIVE_STREAM_WARNING,options:[e,n],tag:Lg.TRACER}).onSuccess(),t.emit(Hg.LIVE_STREAMING_WARNING,e,n)},e.on(EE.REQUEST_WORKER_MANAGER_LIST,(function(e,n,r){if(!t._joinInfo)return r(new Bv(Lv.INVALID_OPERATION,"can not find join info to get worker manager"));Dw(e,t._joinInfo,t._axiosCancelSource.token,Vv).then(n).catch(r)}))};switch(e){case sE.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=n(),r(this._liveRawStreamingClient)),this._liveRawStreamingClient;case sE.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=n(),r(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case sE.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=n(),this._injectStreamingClient.on(EE.REQUEST_WORKER_MANAGER_LIST,(function(e,n,r){if(!t._joinInfo)return r(new Bv(Lv.INVALID_OPERATION,"can not find join info to get worker manager"));Dw(e,t._joinInfo,t._axiosCancelSource.token,Vv).then(n).catch(r)})),this._injectStreamingClient.onInjectStatusChange=function(e,n,r){t.emit(Hg.INJECT_STREAM_STATUS,e,n,r)}),this._injectStreamingClient}}},{key:"_createChannelMediaRelayClient",value:function(){var e=this;return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new Qw(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Vv,this._config.httpRetryConfig||Vv),this._channelMediaRelayClient.on("state",(function(t){t===SE.RELAY_STATE_FAILURE&&e._channelMediaRelayClient&&e._channelMediaRelayClient.dispose(),e.emit(Hg.CHANNEL_MEDIA_RELAY_STATE,t)})),this._channelMediaRelayClient.on("event",(function(t){e.emit(Hg.CHANNEL_MEDIA_RELAY_EVENT,t)}))),this._channelMediaRelayClient):new Bv(Lv.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}},{key:"_handleGatewayEvents",value:function(){var e=this;this._gateway.on(OE.DISCONNECT_P2P,u(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.disconnectForReconnect();case 2:case"end":return t.stop()}}),t)})))),this._gateway.on(OE.CONNECTION_STATE_CHANGE,(function(t,n,r){var i;if(r!==qg.FALLBACK){var o=function(){e.emit(Hg.CONNECTION_STATE_CHANGE,t,n,r)};if(Wb.reportApiInvoke(e._sessionId||(null===(i=e._gateway.joinInfo)||void 0===i?void 0:i.sid)||null,{name:Pg.CONNECTION_STATE_CHANGE,options:[t,n,r],tag:Lg.TRACER}).onSuccess(JSON.stringify({cur:t,prev:n,reason:r})),Jv.info("[".concat(e._clientId,"] connection state change: ").concat(n," -> ").concat(t)),"DISCONNECTED"===t)return e._reset(),void o();if("RECONNECTING"===t)e._users.forEach((function(e){e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._audioSSRC=void 0,e._videoSSRC=void 0,e._videoOrtc=void 0,e._audioOrtc=void 0,e._cname=void 0,e._rtxSsrcId=void 0})),e._userOfflineTimeout&&window.clearTimeout(e._userOfflineTimeout),e._streamRemovedTimeout&&window.clearTimeout(e._streamRemovedTimeout),e._userOfflineTimeout=void 0,e._streamRemovedTimeout=void 0;else if("CONNECTED"===t){var a;e._streamFallbackTypeCacheMap.forEach((function(t,n){e._gateway.setStreamFallbackOption(n,t).catch((function(t){Jv.warning("[".concat(e._clientId,"] auto set stream fallback option failed"),t)}))})),e._remoteStreamTypeCacheMap.forEach((function(t,n){e._gateway.setRemoteVideoStreamType(n,t).catch((function(t){Jv.warning("[".concat(e._clientId,"] auto set remote stream type failed"),t)}))})),void 0!==e._remoteDefaultVideoStreamType&&void 0===(null===(a=e._joinInfo)||void 0===a?void 0:a.defaultVideoStream)&&e.setRemoteDefaultVideoStreamType(e._remoteDefaultVideoStreamType).then((function(){Jv.debug("[".concat(e._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((function(t){Jv.error("[".concat(e._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(t))})),e._p2pChannel.republish(),e._userOfflineTimeout=window.setTimeout((function(){"CONNECTED"===e.connectionState&&(e._userOfflineTimeout=void 0,e._users.filter((function(e){return!e._trust_in_room_})).forEach((function(t){Jv.debug("[".concat(e._clientId,"] user offline timeout, emit user offline ").concat(t.uid)),e._handleUserOffline({uid:t.uid})})))}),3e3),e._streamRemovedTimeout=window.setTimeout((function(){"CONNECTED"===e.connectionState&&(e._streamRemovedTimeout=void 0,e._users.forEach((function(t){t._trust_audio_mute_state_||(Jv.debug("[".concat(e._clientId,"] auto dispatch audio unmute event ").concat(t.uid)),e._handleMuteStream(t.uid,"audio",!1)),t._trust_video_mute_state_||(Jv.debug("[".concat(e._clientId,"] auto dispatch video unmute event ").concat(t.uid)),e._handleMuteStream(t.uid,"video",!1)),t._trust_audio_enabled_state_||(Jv.debug("[".concat(e._clientId,"] auto dispatch enable local audio ").concat(t.uid)),e._handleSetStreamLocalEnable("audio",t.uid,!0)),t._trust_video_enabled_state_||(Jv.debug("[".concat(e._clientId,"] auto dispatch enable local video ").concat(t.uid)),e._handleSetStreamLocalEnable("video",t.uid,!0)),t._trust_video_stream_added_state_||(Jv.debug("[".concat(e._clientId,"] auto dispatch reset video stream added ").concat(t.uid)),e._handleResetAddStream(t,"video")),t._trust_audio_stream_added_state_||(Jv.debug("[".concat(e._clientId,"] auto dispatch reset audio stream added ").concat(t.uid)),e._handleResetAddStream(t,"audio")),t._video_added_||t._audio_added_||(Jv.debug("[".concat(e._clientId,"] auto dispatch stream remove ").concat(t.uid)),e._handleRemoveStream({uid:t.uid,uint_id:t._uintid}))})))}),1e3)}o()}})),this._gateway.on(OE.REQUEST_NEW_GATEWAY_LIST,(function(t,n){if(!e._joinInfo)return n(new Bv(Lv.UNEXPECTED_ERROR,"can not recover, no join info"));Sw(e._joinInfo,e._axiosCancelSource.token,e._config.httpRetryConfig||Vv,e.store).then((function(n){e._joinInfo&&(e._joinInfo.apResponse=n.gatewayInfo.res,e._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,e._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip),t(n.gatewayInfo.gatewayAddrs.map((function(t){if(e._joinInfo&&e._joinInfo.proxyServer){var n=t.address.split(":");return"wss://".concat(e._joinInfo.proxyServer,"/ws/?h=").concat(n[0],"&p=").concat(n[1])}return"wss://".concat(t.address)})))})).catch(n)})),this._gateway.on(OE.NETWORK_QUALITY,(function(t){"normal"===e._networkQualitySensitivity&&e.emit(Hg.NETWORK_QUALITY,t)})),this._gateway.on(OE.STREAM_TYPE_CHANGE,(function(t,n){e.emit(Hg.STREAM_TYPE_CHANGED,t,n),Wb.reportApiInvoke(e._sessionId,{name:Pg.STREAM_TYPE_CHANGE,options:[t,n],tag:Lg.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:n}))})),this._gateway.on(OE.IS_P2P_DISCONNECTED,(function(t){e._p2pChannel.isP2PDisconnected()?t(!0):e._p2pChannel.hasLocalMedia()||e._p2pChannel.hasRemoteMedia()?t(!1):t(!0)})),this._gateway.on(OE.NEED_RENEW_SESSION,(function(){e._startSession()})),this._gateway.on(OE.REQUEST_P2P_CONNECTION_PARAMS,function(){var t=u(c().mark((function t(n,r,i){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=r,t.next=4,e._p2pChannel.startP2PConnection(n);case 4:t.t1=t.sent,(0,t.t0)(t.t1),t.next=11;break;case 8:t.prev=8,t.t2=t.catch(0),i(t.t2);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.on(OE.JOIN_RESPONSE,(function(t,n){var r=dA(t.ortc,n),i=r.dtlsParameters,o=r.iceParameters,a=r.candidates,s=r.rtpCapabilities,c=r.setup,u=r.cname;e._p2pChannel.connect(o,i,a,s,c,u)})),this._gateway.on(OE.REQUEST_DC_CONNECTION_PARAMS,(function(t){t(e._p2pChannel.getEstablishParams())})),this._gateway.on(OE.RESET_SIGNAL,(function(t){e._p2pChannel.resetConnection(t),e._handleGatewaySignalEvents()})),this._gateway.on(OE.DATACHANNEL_FAILBACK,(function(){e._joinGateway()})),this._gateway.on(OE.DATACHANNEL_PRECONNECT,function(){var t=u(c().mark((function t(n,r,i,o){var a,s,u,l,f,d,p;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.startP2PConnection({turnServer:null===(a=e._joinInfo)||void 0===a?void 0:a.turnServer},!0);case 2:return p=function(e,t){var n;return t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],Jv.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),Jv.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],n}(n,r),t.abrupt("return",e._p2pChannel.preConnect({iceUfrag:"".concat(null===(s=e._joinInfo)||void 0===s?void 0:s.apResponse.cid,"_").concat(null===(u=e._joinInfo)||void 0===u?void 0:u.apResponse.cert),icePwd:"".concat(null===(l=e._joinInfo)||void 0===l?void 0:l.apResponse.cid,"_").concat(null===(f=e._joinInfo)||void 0===f?void 0:f.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(d=lm("FINGERPRINT"))&&void 0!==d?d:n.fingerprint}]},p,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(o));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}())}},{key:"_handleGatewaySignalEvents",value:function(){var e=this;this._gateway.signal.on(Qg.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Qg.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Qg.ON_ADD_AUDIO_STREAM,(function(t){return e._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)})),this._gateway.signal.on(Qg.ON_ADD_VIDEO_STREAM,(function(t){return e._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)})),this._gateway.signal.on(Qg.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Qg.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Qg.MUTE_AUDIO,(function(t){return e._handleMuteStream(t.uid,"audio",!0)})),this._gateway.signal.on(Qg.UNMUTE_AUDIO,(function(t){return e._handleMuteStream(t.uid,"audio",!1)})),this._gateway.signal.on(Qg.MUTE_VIDEO,(function(t){return e._handleMuteStream(t.uid,"video",!0)})),this._gateway.signal.on(Qg.UNMUTE_VIDEO,(function(t){return e._handleMuteStream(t.uid,"video",!1)})),this._gateway.signal.on(Qg.RECEIVE_METADATA,(function(t){var n=kS(t.metadata);e.emit(Hg.RECEIVE_METADATA,t.uid,n)})),this._gateway.signal.on(Qg.ON_DATA_STREAM,(function(t){t.seq&&delete t.seq,t.payload=kS(t.payload),e.emit(Hg.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)})),this._gateway.signal.on(Qg.ON_CRYPT_ERROR,(function(){AS((function(){Jv.warning("[".concat(e._clientId,"] on crypt error")),e.emit(Hg.CRYPT_ERROR)}),e._sessionId)})),this._gateway.signal.on(Qg.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Qg.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){Jv.warning("[".concat(e._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),e._gateway.leave(!0),e.emit(Hg.ON_TOKEN_PRIVILEGE_DID_EXPIRE),e._reset()})),this._gateway.signal.on(Qg.ON_STREAM_FALLBACK_UPDATE,(function(t){Jv.debug("[".concat(e._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),e.emit(Hg.STREAM_FALLBACK,t.stream_id,1===t.stream_type?"fallback":"recover")})),this._gateway.signal.on(Qg.ON_PUBLISH_STREAM,(function(t){e.uid===e._uid&&(e._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),Jv.info("[".concat(e._clientId,"] on publish stream, ").concat(JSON.stringify(t))))})),this._gateway.signal.on(Qg.ENABLE_LOCAL_VIDEO,(function(t){e._handleSetStreamLocalEnable("video",t.uid,!0)})),this._gateway.signal.on(Qg.DISABLE_LOCAL_VIDEO,(function(t){e._handleSetStreamLocalEnable("video",t.uid,!1)})),this._gateway.signal.on(Yg.REQUEST_TIMEOUT,(function(t,n){if(e._joinInfo)switch(t){case Jg.PUBLISH:if(!n)return;var r=n.ortc;if(r){var i,o,a,s,c=r.some((function(e){return e.stream_type===RE.Audio})),u=r.some((function(e){return e.stream_type!==RE.Audio})),l=r.some((function(e){var t=e.stream_type;return t===RE.Screen||t===RE.ScreenLow}));"offer"===n.state&&Wb.publish(e._joinInfo.sid,{eventElapse:HT.measureFromPublishStart(e.store.clientId,e.store.pubId),succ:!1,ec:Lv.TIMEOUT,audio:c,video:u,p2pid:n.p2p_id,publishRequestid:e.store.pubId,screenshare:l,audioName:c?null===(i=r.find((function(e){return e.stream_type===RE.Audio})))||void 0===i||null===(o=i.ssrcs[0])||void 0===o?void 0:o.ssrcId.toString():void 0,videoName:u?null===(a=r.find((function(e){return e.stream_type!==RE.Audio})))||void 0===a||null===(s=a.ssrcs[0])||void 0===s?void 0:s.ssrcId.toString():void 0})}break;case Jg.SUBSCRIBE:n&&Wb.subscribe(e._joinInfo.sid,{succ:!1,ec:Lv.TIMEOUT,audio:n.stream_type===qE.AUDIO,video:n.stream_type===qE.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:e.store.p2pId,eventElapse:HT.measureFromSubscribeStart(e.store.clientId,n.ssrcId)})}})),this._gateway.signal.on(Qg.ON_P2P_OK,(function(t){e.uid,e._uid})),this._gateway.signal.on(Qg.ON_PUBLISHED_USER_LIST,(function(t){if(null!=t&&t.users){lm("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter((function(t){return!bm(t.audio_ssrc,e.channelName)})));var n,r=[],i=[],o=s(t.users);try{var a=function(){var t=n.value,o=e._users.find((function(e){return e.uid===t.stream_id}));o?o._trust_in_room_=!0:(o=new JR(t.stream_id,t.stream_id),e._users.push(o),0===e.getListeners(Hg.PUBLISHED_USER_LIST).length&&(Jv.debug("[".concat(e._clientId,"] user online"),t.stream_id),e.emit(Hg.USER_JOINED,o)));var a=IE.Audio&t.stream_type,s=(IE.Video|IE.LwoVideo)&t.stream_type,c=a&&o.hasAudio,u=s&&o.hasVideo;s&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=t.video_ssrc),a&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=t.audio_ssrc),a&&!c&&0===e.getListeners(Hg.PUBLISHED_USER_LIST).length&&(Jv.info("[".concat(e._clientId,"] remote user ").concat(o.uid," published audio")),e.emit(Hg.USER_PUBLISHED,o,"audio")),s&&!u&&0===e.getListeners(Hg.PUBLISHED_USER_LIST).length&&(Jv.info("[".concat(e._clientId,"] remote user ").concat(o.uid," published video")),e.emit(Hg.USER_PUBLISHED,o,"video")),(a&&!c||s&&!u)&&r.push(o),s&&e._p2pChannel.hasPendingRemoteMedia(o,"video")&&i.push({user:o,mediaType:"video"}),a&&e._p2pChannel.hasPendingRemoteMedia(o,"audio")&&i.push({user:o,mediaType:"audio"})};for(o.s();!(n=o.n()).done;)a()}catch(c){o.e(c)}finally{o.f()}i.length>0&&(Jv.debug("[".concat(e._clientId,"] RE massSubscribe after reconnect ").concat(i.map((function(e){return"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)})).join("; ")," ")),e.massSubscribe(i).catch((function(t){Jv.error("[".concat(e._clientId,"] mass resubscribe error"),t.toString())}))),e.getListeners(Hg.PUBLISHED_USER_LIST).length>0?(Jv.info("[".concat(e._clientId,"] client emit user-list event, users: ").concat(r.map((function(e){return e.uid})).join(", "))),e.emit(Hg.PUBLISHED_USER_LIST,r)):Jv.info("[".concat(e._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map((function(e){return e.uid})).join(", ")))}}))}},{key:"_handleP2PChannelEvents",value:function(){var e=this;this._p2pChannel.on(zE.RequestMuteLocal,function(){var t=u(c().mark((function t(n,r,i){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.muteLocal(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===Lv.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(zE.RequestUnmuteLocal,function(){var t=u(c().mark((function t(n,r,i){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.unmuteLocal(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===Lv.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(zE.RequestRePublish,(function(t,n,r){e.publish(t,!1).then(n).catch(r)})),this._p2pChannel.on(zE.RequestReSubscribe,function(){var t=u(c().mark((function t(n,r,i){var o,a,u,l;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,o=s(n),t.prev=2,o.s();case 4:if((a=o.n()).done){t.next=15;break}if(u=a.value,l=u.user,u.kind!==qE.VIDEO){t.next=11;break}return t.next=9,e.subscribe(l,"video");case 9:t.next=13;break;case 11:return t.next=13,e.subscribe(l,"audio");case 13:t.next=4;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(2),o.e(t.t0);case 20:return t.prev=20,o.f(),t.finish(20);case 23:r(),t.next=29;break;case 26:t.prev=26,t.t1=t.catch(0),i(t.t1);case 29:case"end":return t.stop()}}),t,null,[[0,26],[2,17,20,23]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(zE.RequestUploadStats,(function(t,n){e._gateway.uploadStats(t,n)})),this._p2pChannel.on(zE.MediaReconnectStart,(function(t){e.emit(Hg.MEDIA_RECONNECT_START,t)})),this._p2pChannel.on(zE.MediaReconnectEnd,(function(t){e.emit(Hg.MEDIA_RECONNECT_END,t)})),this._p2pChannel.on(zE.NeedSignalRTT,(function(t){t(e._gateway.getSignalRTT())})),this._p2pChannel.on(zE.RequestRestartICE,u(c().mark((function t(){var n,r,i,o,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.restartICE();case 2:return n=t.sent,t.next=5,n.next();case 5:if(!(r=t.sent).done){t.next=8;break}return t.abrupt("return");case 8:return i=r.value,t.prev=9,t.next=12,e._gateway.restartICE({iceParameters:i});case 12:o=t.sent,t.next=18;break;case 15:return t.prev=15,t.t0=t.catch(9),t.abrupt("return",void n.throw(t.t0));case 18:return a=function(e){var t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(o),s=a.iceParameters,t.next=21,n.next({remoteIceParameters:s});case 21:case"end":return t.stop()}}),t,null,[[9,15]])})))),this._p2pChannel.on(zE.RequestReconnect,u(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._gateway.reconnect();case 1:case"end":return t.stop()}}),t)})))),this._p2pChannel.on(zE.RequestReconnectPC,u(c().mark((function t(){var n,r,i,o,a,s,u,l,f,d,p,h,v,m,g;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.startP2PConnection({turnServer:null===(n=e._joinInfo)||void 0===n?void 0:n.turnServer});case 2:return r=t.sent,i=r.iceParameters,o=r.dtlsParameters,a=r.rtpCapabilities,t.next=8,e._gateway.reconnectPC({iceParameters:i,dtlsParameters:o,rtpCapabilities:a});case 8:return s=t.sent,u=s.gatewayEstablishParams,l=s.gatewayAddress,f=dA(u,l),d=f.dtlsParameters,p=f.iceParameters,h=f.candidates,v=f.rtpCapabilities,m=f.setup,g=f.cname,t.next=20,e._p2pChannel.connect(p,d,h,v,m,g);case 20:return t.next=22,e._p2pChannel.republish();case 22:return t.next=24,e._p2pChannel.reSubscribe();case 24:case"end":return t.stop()}}),t)})))),this._p2pChannel.on(zE.RequestUnpublishForReconnectPC,function(){var t=u(c().mark((function t(n,r,i){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo||void 0===e._uid){t.next=6;break}return t.next=3,e._gateway.unpublish(n,e._uid);case 3:r(),t.next=7;break;case 6:i();case 7:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(zE.P2PLost,(function(){e.emit(Hg.P2P_LOST,e.store.uid)})),this._p2pChannel.on(zE.UpdateVideoEncoder,(function(t){t._encoderConfig&&e._gateway.setVideoProfile(t._encoderConfig)})),this._p2pChannel.on(zE.ConnectionTypeChange,(function(t){e.emit(Hg.IS_USING_CLOUD_PROXY,t)})),this._p2pChannel.on(zE.RequestLowStreamParameter,(function(t){t(e._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(zE.QueryClientConnectionState,(function(t){t(e.connectionState)}))}},{key:"getKeyMetrics",value:function(){return this.store.keyMetrics}},{key:"enableContentInspect",value:function(){var e=u(c().mark((function e(t){var n,r,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.connectionState&&this._joinInfo){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));case 2:if(!this._inspect){e.next=4;break}throw new Bv(Lv.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));case 4:if(t){e.next=6;break}throw new Bv(Lv.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));case 6:if(t.inspectType&&Array.isArray(t.inspectType)){e.next=8;break}throw new Bv(Lv.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));case 8:if((n=m(new Set(t.inspectType))).forEach((function(e){if(!["supervise","moderation"].includes(e))throw new Bv(Lv.INVALID_PARAMS,"[".concat(i._clientId,"] ").concat(e," is not a valid inspect type."))})),t.inspectType=n,!(t&&t.extraInfo&&t.extraInfo.length>1024)){e.next=12;break}throw new Bv(Lv.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));case 12:return e.prev=12,r=new mN(t),this._inspect=r,this.handleVideoInspectEvents(this._inspect),e.next=18,r.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Vv);case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(12),Array.isArray(e.t0)?e.t0[0]:e.t0;case 23:case"end":return e.stop()}}),e,this,[[12,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"disableContentInspect",value:function(){var e=u(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._inspect){e.next=2;break}throw new Bv(Lv.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));case 2:e.prev=2,this._inspect.close(),this._inspect=void 0,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),Array.isArray(e.t0)?e.t0[0]:e.t0;case 9:case"end":return e.stop()}}),e,this,[[2,6]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleVideoInspectEvents",value:function(e){var t=this;e.on(e_.CONNECTION_STATE_CHANGE,(function(n,r){if(t.emit(Hg.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,r),r===$E.CONNECTED){if("CONNECTED"!==t.connectionState)return void t.emit(Hg.CONTENT_INSPECT_ERROR,new Bv(Lv.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(e_.INSPECT_RESULT,(function(e,n){var r;if((null==n?void 0:n.code)===Lv.INVALID_OPERATION&&"DISCONNECTED"===t.connectionState)return Jv.debug("Stop inspect content because that has left channel"),null==t||null===(r=t._inspect)||void 0===r||r.close(),void(t._inspect=void 0);t.emit(Hg.CONTENT_INSPECT_RESULT,e,n)})),e.on(e_.CLIENT_LOCAL_VIDEO_TRACK,(function(e){e(t.localTracks.filter((function(e){return"video"===e.trackMediaType}))[0])}))}},{key:"getJoinChannelServiceRecords",value:function(){return Jv.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}},{key:"setPublishAudioFilterEnabled",value:function(){var e=u(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mg(t,"enabled"),um("ENABLE_PUBLISH_AUDIO_FILTER",t),e.t0=this._joinInfo,!e.t0){e.next=6;break}return e.next=6,this._gateway.setPublishAudioFilterEnabled(t);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_handleResetAddStream",value:function(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}]),n}(jv)).prototype,"leave",[CC],Object.getOwnPropertyDescriptor(hN.prototype,"leave"),hN.prototype),_b(hN.prototype,"publish",[NC],Object.getOwnPropertyDescriptor(hN.prototype,"publish"),hN.prototype),_b(hN.prototype,"unpublish",[xC],Object.getOwnPropertyDescriptor(hN.prototype,"unpublish"),hN.prototype),_b(hN.prototype,"subscribe",[DC],Object.getOwnPropertyDescriptor(hN.prototype,"subscribe"),hN.prototype),_b(hN.prototype,"massSubscribe",[PC],Object.getOwnPropertyDescriptor(hN.prototype,"massSubscribe"),hN.prototype),_b(hN.prototype,"unsubscribe",[LC],Object.getOwnPropertyDescriptor(hN.prototype,"unsubscribe"),hN.prototype),_b(hN.prototype,"massUnsubscribe",[MC],Object.getOwnPropertyDescriptor(hN.prototype,"massUnsubscribe"),hN.prototype),_b(hN.prototype,"setLowStreamParameter",[UC],Object.getOwnPropertyDescriptor(hN.prototype,"setLowStreamParameter"),hN.prototype),_b(hN.prototype,"enableDualStream",[jC],Object.getOwnPropertyDescriptor(hN.prototype,"enableDualStream"),hN.prototype),_b(hN.prototype,"disableDualStream",[FC],Object.getOwnPropertyDescriptor(hN.prototype,"disableDualStream"),hN.prototype),_b(hN.prototype,"setClientRole",[BC],Object.getOwnPropertyDescriptor(hN.prototype,"setClientRole"),hN.prototype),_b(hN.prototype,"setProxyServer",[VC],Object.getOwnPropertyDescriptor(hN.prototype,"setProxyServer"),hN.prototype),_b(hN.prototype,"setTurnServer",[GC],Object.getOwnPropertyDescriptor(hN.prototype,"setTurnServer"),hN.prototype),_b(hN.prototype,"setLicense",[WC],Object.getOwnPropertyDescriptor(hN.prototype,"setLicense"),hN.prototype),_b(hN.prototype,"startProxyServer",[qC],Object.getOwnPropertyDescriptor(hN.prototype,"startProxyServer"),hN.prototype),_b(hN.prototype,"stopProxyServer",[HC],Object.getOwnPropertyDescriptor(hN.prototype,"stopProxyServer"),hN.prototype),_b(hN.prototype,"setLocalAccessPointsV2",[KC],Object.getOwnPropertyDescriptor(hN.prototype,"setLocalAccessPointsV2"),hN.prototype),_b(hN.prototype,"setLocalAccessPoints",[zC],Object.getOwnPropertyDescriptor(hN.prototype,"setLocalAccessPoints"),hN.prototype),_b(hN.prototype,"setRemoteDefaultVideoStreamType",[YC],Object.getOwnPropertyDescriptor(hN.prototype,"setRemoteDefaultVideoStreamType"),hN.prototype),_b(hN.prototype,"setRemoteVideoStreamType",[JC],Object.getOwnPropertyDescriptor(hN.prototype,"setRemoteVideoStreamType"),hN.prototype),_b(hN.prototype,"setStreamFallbackOption",[XC],Object.getOwnPropertyDescriptor(hN.prototype,"setStreamFallbackOption"),hN.prototype),_b(hN.prototype,"setEncryptionConfig",[QC],Object.getOwnPropertyDescriptor(hN.prototype,"setEncryptionConfig"),hN.prototype),_b(hN.prototype,"renewToken",[$C],Object.getOwnPropertyDescriptor(hN.prototype,"renewToken"),hN.prototype),_b(hN.prototype,"enableAudioVolumeIndicator",[ZC],Object.getOwnPropertyDescriptor(hN.prototype,"enableAudioVolumeIndicator"),hN.prototype),_b(hN.prototype,"startLiveStreaming",[eN],Object.getOwnPropertyDescriptor(hN.prototype,"startLiveStreaming"),hN.prototype),_b(hN.prototype,"setLiveTranscoding",[tN],Object.getOwnPropertyDescriptor(hN.prototype,"setLiveTranscoding"),hN.prototype),_b(hN.prototype,"stopLiveStreaming",[nN],Object.getOwnPropertyDescriptor(hN.prototype,"stopLiveStreaming"),hN.prototype),_b(hN.prototype,"addInjectStreamUrl",[rN],Object.getOwnPropertyDescriptor(hN.prototype,"addInjectStreamUrl"),hN.prototype),_b(hN.prototype,"removeInjectStreamUrl",[iN],Object.getOwnPropertyDescriptor(hN.prototype,"removeInjectStreamUrl"),hN.prototype),_b(hN.prototype,"startChannelMediaRelay",[oN],Object.getOwnPropertyDescriptor(hN.prototype,"startChannelMediaRelay"),hN.prototype),_b(hN.prototype,"updateChannelMediaRelay",[aN],Object.getOwnPropertyDescriptor(hN.prototype,"updateChannelMediaRelay"),hN.prototype),_b(hN.prototype,"stopChannelMediaRelay",[sN],Object.getOwnPropertyDescriptor(hN.prototype,"stopChannelMediaRelay"),hN.prototype),_b(hN.prototype,"sendCustomReportMessage",[cN],Object.getOwnPropertyDescriptor(hN.prototype,"sendCustomReportMessage"),hN.prototype),_b(hN.prototype,"pickSVCLayer",[uN],Object.getOwnPropertyDescriptor(hN.prototype,"pickSVCLayer"),hN.prototype),_b(hN.prototype,"enableContentInspect",[lN],Object.getOwnPropertyDescriptor(hN.prototype,"enableContentInspect"),hN.prototype),_b(hN.prototype,"disableContentInspect",[fN],Object.getOwnPropertyDescriptor(hN.prototype,"disableContentInspect"),hN.prototype),_b(hN.prototype,"getJoinChannelServiceRecords",[dN],Object.getOwnPropertyDescriptor(hN.prototype,"getJoinChannelServiceRecords"),hN.prototype),_b(hN.prototype,"setPublishAudioFilterEnabled",[pN],Object.getOwnPropertyDescriptor(hN.prototype,"setPublishAudioFilterEnabled"),hN.prototype),hN),bN=function(e){d(n,e);var t=p(n);function n(e){var r;h(this,n);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=t.call(this),Mp(l(r),"audioBuffer",void 0),Mp(l(r),"sourceNode",void 0),Mp(l(r),"startPlayTime",0),Mp(l(r),"startPlayOffset",0),Mp(l(r),"pausePlayTime",0),Mp(l(r),"options",void 0),Mp(l(r),"currentLoopCount",0),Mp(l(r),"_currentState","stopped"),r.audioBuffer=e,r.options=i,r.startPlayOffset=r.options.startPlayTime||0,r}return v(n,[{key:"currentState",get:function(){return this._currentState},set:function(e){e!==this._currentState&&(this._currentState=e,this.emit(Zg.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}},{key:"createWebAudioDiagram",value:function(){return this.context.createGain()}},{key:"duration",get:function(){return this.audioBuffer.duration}},{key:"currentTime",get:function(){return"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}},{key:"updateOptions",value:function(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):Jv.warning("can not set audio source options")}},{key:"startProcessAudioBuffer",value:function(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}},{key:"pauseProcessAudioBuffer",value:function(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}},{key:"seekAudioBuffer",value:function(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}},{key:"resumeProcessAudioBuffer",value:function(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}},{key:"stopProcessAudioBuffer",value:function(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(y){}this.reset()}}},{key:"startSourceNode",value:function(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}},{key:"createSourceNode",value:function(){var e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e}},{key:"handleSourceNodeEnded",value:function(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}},{key:"reset",value:function(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}]),n}(sy),yN=new Map;function TN(e,t){return SN.apply(this,arguments)}function SN(){return SN=u(c().mark((function e(t,n){var r,i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,"string"!=typeof t){e.next=16;break}if(!(i=yN.get(t))){e.next=5;break}return e.abrupt("return",(Jv.debug("use cached audio resource: ",t),i));case 5:return e.prev=5,e.next=8,Wv((function(){return Mv.get(t,{responseType:"arraybuffer"})}),void 0,void 0,{maxRetryCount:3});case 8:r=e.sent.data,e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),new Bv(Lv.FETCH_AUDIO_FILE_FAILED,e.t0.toString());case 14:e.next=20;break;case 16:return o=new Bf((function(e,n){var r=new FileReader;r.onload=function(t){t.target?e(t.target.result):n(new Bv(Lv.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=function(){n(new Bv(Lv.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(t)})),e.next=19,o;case 19:r=e.sent;case 20:return e.next=22,function(e){var t=ty();return new Bf((function(n,r){t.decodeAudioData(e,(function(e){n(e)}),(function(e){r(new Bv(Lv.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(r);case 22:return a=e.sent,e.abrupt("return",("string"==typeof t&&n&&yN.set(t,a),a));case 24:case"end":return e.stop()}}),e,null,[[5,11]])}))),SN.apply(this,arguments)}function wN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wN(Object(n),!0).forEach((function(t){Mp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ON(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=RN(RN({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?Jv.debug("[".concat(e,"] set content hint to"),n.optimizationMode):Jv.debug("[".concat(e,"] set content hint failed")))):Jv.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var IN=rp().name;function AN(e,t,n,r){var i,o=0,a=null;return new Bf((function(s,c){setTimeout((function(){i&&(i(),s(o))}),t),i=oy((function(){!function(){o>r&&i&&(i(),s(o));var t=n.getContext("2d");if(!t){var u=new Bv(Lv.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Jv.error(u.toString()),void c(u)}t.drawImage(e,0,0,160,120);var l=t.getImageData(0,0,n.width,n.height),f=Math.floor(l.data.length/3);if(a){for(var d=0;d<f;d+=3)if(l.data[d]!==a[d])return o+=1,void(a=l.data);a=l.data}else a=l.data}()}),30)}))}var kN,CN,NN=function(){function e(t,n){h(this,e),Mp(this,"id",0),Mp(this,"element",void 0),Mp(this,"peerPair",void 0),Mp(this,"context",void 0),Mp(this,"audioPlayerElement",void 0),Mp(this,"audioTrack",void 0),e.count+=1,this.id=e.count,this.element=t,this.context=n}return v(e,[{key:"initPeers",value:function(){var e=this;this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=function(t){var n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),e.audioPlayerElement=n}}},{key:"switchSdp",value:function(){var e=u(c().mark((function e(){var t,n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerPair){e.next=2;break}return e.abrupt("return");case 2:return t=function(){var e=u(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("offer"!==n){e.next=6;break}return e.next=3,t.createOffer();case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,t.createAnswer();case 8:e.t0=e.sent;case 9:return r=e.t0,e.next=12,t.setLocalDescription(r);case 12:return e.abrupt("return","complete"===t.iceGatheringState?t.localDescription:new Bf((function(e){t.onicegatheringstatechange=function(){"complete"===t.iceGatheringState&&e(t.localDescription)}})));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n=function(){var e=u(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setRemoteDescription(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,t(this.peerPair[0],"offer");case 6:return r=e.sent,e.next=9,n(this.peerPair[1],r);case 9:return e.next=11,t(this.peerPair[1],"answer");case 11:return i=e.sent,e.next=14,n(this.peerPair[0],i);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(3),new Bv(Lv.LOCAL_AEC_ERROR,e.t0.toString()).print();case 19:case"end":return e.stop()}}),e,this,[[3,16]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTracksFromMediaElement",value:function(){var e=u(c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioTrack){e.next=2;break}return e.abrupt("return",this.audioTrack);case 2:e.prev=2,t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),new Bv(Lv.LOCAL_AEC_ERROR,e.t0.toString()).print();case 10:if(n){e.next=12;break}throw new Bv(Lv.LOCAL_AEC_ERROR,"no dest node when local aec").print();case 12:return r=n.stream.getAudioTracks()[0],e.abrupt("return",(this.audioTrack=r,r));case 14:case"end":return e.stop()}}),e,this,[[2,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getElement",value:function(){return this.element}},{key:"startEchoCancellation",value:function(){var e=u(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.context.resume(),this.peerPair&&this.close(),this.initPeers(),t=this.element,e.next=4,this.getTracksFromMediaElement(t);case 4:return n=e.sent,this.peerPair&&this.peerPair[0].addTrack(n),e.next=8,this.switchSdp();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){Jv.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((function(e){e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}]),e}();Mp(NN,"count",0);var xN=window.AudioContext||window.webkitAudioContext,DN=new(kN=Gb({report:Wb}),_b((CN=function(){function e(){h(this,e),Mp(this,"units",[]),Mp(this,"context",void 0)}return v(e,[{key:"processExternalMediaAEC",value:function(e){if(!this._doesEnvironmentNeedAEC())return Jv.debug("the system does not need to process local aec"),-1;this.context||(this.context=new xN);var t=this.units.find((function(t){return t&&t.getElement()===e}));return t||(t=new NN(e,this.context),this.units.push(t)),t.startEchoCancellation(),Jv.debug("start processing local audio echo cancellation, id is",t.id),t.id}},{key:"_doesEnvironmentNeedAEC",value:function(){return rp().name!==Qd.SAFARI}}]),e}()).prototype,"processExternalMediaAEC",[kN],Object.getOwnPropertyDescriptor(CN.prototype,"processExternalMediaAEC"),CN.prototype),CN);um("PROCESS_ID","process-".concat(hS(8,""),"-").concat(hS(4,""),"-").concat(hS(4,""),"-").concat(hS(4,""),"-").concat(hS(12,""))),function(){var e=rp();a_.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),a_.getStreamFromExtension=e.name===Qd.CHROME&&Number(e.version)>34,a_.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),a_.supportMinBitrate=e.name===Qd.CHROME||e.name===Qd.EDGE,a_.supportSetRtpSenderParameters=function(){var e=rp();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Op()||!(!fp()&&!sp())||e.name===Qd.FIREFOX&&Number(e.version)>=64)}(),e.name===Qd.SAFARI&&(Number(e.version)>=14?a_.supportDualStream=!0:a_.supportDualStream=!1),a_.webAudioMediaStreamDest=function(){var e=rp();return!(e.name===Qd.SAFARI&&Number(e.version)<12)}(),a_.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,a_.supportWebGL="undefined"!=typeof WebGLRenderingContext,a_.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Op()||(a_.webAudioWithAEC=!0),a_.supportShareAudio=function(){var e=rp();return(e.os===Xd.WIN_10||e.os===Xd.WIN_81||e.os===Xd.WIN_7||e.os===Xd.LINUX||e.os===Xd.MAC_OS)&&e.name===Qd.CHROME&&Number(e.version)>=74}(),a_.supportDualStreamEncoding=function(){var e=rp();return!!lm("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&lm("CHROME_DUAL_STREAM_USE_ENCODING"))}(),a_.supportDataChannel=!!(hp(76)||function(e){var t=rp();return!(t.name!==Qd.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||function(e){var t=rp();return!(t.name!==Qd.SAFARI||!t.osVersion)&&Number(t.version)>=e}(14)),a_.supportPCSetConfiguration=!dp()&&!!RTCPeerConnection.prototype.setConfiguration,Jv.info("browser compatibility",JSON.stringify(a_),JSON.stringify(e))}(),function(){var e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void Jv.error("Error loading sdk config",e.message)}if(e)try{var t=JSON.parse(window.atob(e)),n=Date.now();Jv.debug("Loading global parameters from cache",t),Object.keys(t).forEach((function(e){if(Object.prototype.hasOwnProperty.call(fm,e)){var r=t[e],i=r.value,o=r.expires;if(o&&o<=n)return;dm[e]=i,fm[e]=i}}))}catch(t){Jv.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(dm.AREAS)&&dm.AREAS.length>0&&uw(dm.AREAS,!0);var PN={__CLIENT_LIST__:Em,__TRACK_LIST__:_m,VERSION:Qv,BUILD:Xv,setParameter:function(e,t,n){Jv.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),um(e,t,n)},getParameter:lm,getSupportedCodec:function(){var e=u(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={audio:[],video:[]},e.prev=1,(n=new RTCPeerConnection).addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}),e.next=6,n.createOffer();case 6:if(r=e.sent.sdp){e.next=9;break}return e.abrupt("return",t);case 9:n.close(),n=null,t=function(e){var t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(r),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),new Bv(Lv.CREATE_OFFER_FAILED,e.t0.toString&&e.t0.toString()).print();case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}(),checkSystemRequirements:function(){var e=Wb.reportApiInvoke(null,{name:Pg.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Lg.TRACER}),t=!1;try{var n=window.RTCPeerConnection,r=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,i=window.WebSocket;t=!!(n&&r&&i)}catch(e){return Jv.error("check system requirement failed: ",e),!1}var o=!1,a=rp();a.name===Qd.CHROME&&Number(a.version)>=58&&(!up()||cp())&&(o=!0),a.name===Qd.FIREFOX&&Number(a.version)>=56&&(o=!0),a.name===Qd.OPERA&&Number(a.version)>=45&&(o=!0),a.name===Qd.SAFARI&&Number(a.version)>=11&&(o=!0),(wp()||rp().name===Qd.QQ)&&(o=!0),Jv.debug("checkSystemRequirements, api:",t,"browser",o);var s=t&&o;return e.onSuccess(s),s},getDevices:function(e){return Iy.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Iy.getRecordingDevices(e)},getCameras:function(e){return Iy.getCamerasDevices(e)},getElectronScreenSources:py,getPlaybackDevices:function(e){return Iy.getSpeakers(e)},createClient:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},t=Wb.reportApiInvoke(null,{name:Pg.CREATE_CLIENT,options:[e],tag:Lg.TRACER});try{nE(e)}catch(e){throw t.onError(e),e}return void 0===e.audioCodec&&(e.audioCodec="opus"),t.onSuccess(),new _N(EN(EN({forceWaitGatewayResponse:!0},e),{},{role:"rtc"===e.mode?"host":e.role}))},createCameraVideoTrack:function(){var e=u(c().mark((function e(){var t,n,r,i,o,a,s,u=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CREATE_CAM_VIDEO_TRACK,options:[RN({},t)]}),r=sR(t),i=hS(8,"track-cam-"),o=null,Jv.info("start create camera video track with config",JSON.stringify(t),"trackId",i),e.prev=4,e.next=7,yy({video:r},i);case 7:if(e.t0=e.sent.getVideoTracks()[0],e.t0){e.next=10;break}e.t0=null;case 10:o=e.t0,e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(4),n.onError(e.t1),e.t1;case 16:if(o){e.next=19;break}return a=new Bv(Lv.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(n.onError(a),a.throw()));case 19:return t.optimizationMode&&ON(i,o,t,im(t.encoderConfig)),s=new YR(o,t,r,t.scalabiltyMode?am(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i),e.abrupt("return",(n.onSuccess(s.getTrackId()),Jv.info("create camera video success, trackId:",i),s));case 22:case"end":return e.stop()}}),e,null,[[4,13]])})));function t(){return e.apply(this,arguments)}return t}(),createCustomVideoTrack:function(e){var t=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new zR(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?am(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,hS(8,"track-cus-"),[CE.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),Jv.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:function(){var e=u(c().mark((function e(){var t,n,r,i,o,a,s,u,l,f,d,p,h,v,m=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.length>0&&void 0!==m[0]?m[0]:{},n=m.length>1&&void 0!==m[1]?m[1]:"disable",r=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CREATE_SCREEN_VIDEO_TRACK,options:[RN({},t),n]}),t.encoderConfig?"string"==typeof t.encoderConfig||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2",i=cR(t),o=hS(8,"track-scr-v-"),a=null,s=null,(u=s_()).supportShareAudio||"enable"!==n){e.next=9;break}return l=new Bv(Lv.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio"),e.abrupt("return",(r.onError(l),l.throw()));case 9:return Jv.info("start create screen video track with config",t,"withAudio",n,"trackId",o),e.prev=10,e.next=13,yy({screen:i,screenAudio:"auto"===n?u.supportShareAudio:"enable"===n},o);case 13:f=e.sent,a=f.getVideoTracks()[0]||null,s=f.getAudioTracks()[0]||null,e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(10),r.onError(e.t0),e.t0;case 20:if(a){e.next=23;break}return d=new Bv(Lv.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(r.onError(d),d.throw()));case 23:if(s||"enable"!==n){e.next=27;break}return a&&a.stop(),p=new Bv(Lv.SHARE_AUDIO_NOT_ALLOWED),e.abrupt("return",(r.onError(p),p.throw()));case 27:if(t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(ON(o,a,t,t.encoderConfig&&om(t.encoderConfig)),t.encoderConfig&&"string"!=typeof t.encoderConfig&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax)),h=new zR(a,t.encoderConfig?om(t.encoderConfig):{},t.scalabiltyMode?am(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o,[CE.SCREEN_TRACK]),s){e.next=31;break}return e.abrupt("return",(r.onSuccess(h.getTrackId()),Jv.info("create screen video track success","video:",h.getTrackId()),h));case 31:return v=new FT(s,void 0,hS(8,"track-scr-a-"),!1,!0),e.abrupt("return",(r.onSuccess([h.getTrackId(),v.getTrackId()]),Jv.info("create screen video track success","video:",h.getTrackId(),"audio:",v.getTrackId()),[h,v]));case 33:case"end":return e.stop()}}),e,null,[[10,17]])})));function t(){return e.apply(this,arguments)}return t}(),createMicrophoneAndCameraTracks:function(){var e=u(c().mark((function e(){var t,n,r,i,o,a,s,u,l,f,d,p,h,v=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:{},n=v.length>1&&void 0!==v[1]?v[1]:{},r=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CREATE_MIC_AND_CAM_TRACKS,options:[t,n]}),i=sR(n),o=uR(t),a=hS(8,"track-mic-"),s=hS(8,"track-cam-"),u=null,l=null,Jv.info("start create camera video track(".concat(s,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(n))),e.prev=4,e.next=7,yy({audio:o,video:i},"".concat(a,"-").concat(s));case 7:f=e.sent,u=f.getAudioTracks()[0],l=f.getVideoTracks()[0],e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(4),r.onError(e.t0),e.t0;case 14:if(u&&l){e.next=17;break}return d=new Bv(Lv.UNEXPECTED_ERROR,"can not find tracks in media stream"),e.abrupt("return",(r.onError(d),d.throw()));case 17:return n.optimizationMode&&ON(s,l,n,im(n.encoderConfig)),p=new BT(u,t,o,a),h=new YR(l,n,i,n.scalabiltyMode?am(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,s),e.abrupt("return",(r.onSuccess([p.getTrackId(),h.getTrackId()]),Jv.info("create camera video track(".concat(s,") and microphone audio track(").concat(a,") success")),[p,h]));case 20:case"end":return e.stop()}}),e,null,[[4,11]])})));function t(){return e.apply(this,arguments)}return t}(),createMicrophoneAudioTrack:function(){var e=u(c().mark((function e(){var t,n,r,i,o,a,s,u=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CREATE_MIC_AUDIO_TRACK,options:[t]}),r=uR(t),i=hS(8,"track-mic-"),o=null,Jv.info("start create microphone audio track with config",JSON.stringify(t),"trackId",i),e.prev=4,e.next=7,yy({audio:r},i);case 7:if(e.t0=e.sent.getAudioTracks()[0],e.t0){e.next=10;break}e.t0=null;case 10:o=e.t0,e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(4),n.onError(e.t1),e.t1;case 16:if(o){e.next=19;break}return a=new Bv(Lv.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(n.onError(a),a.throw()));case 19:return s=new BT(o,t,r,i),e.abrupt("return",(n.onSuccess(s.getTrackId()),Jv.info("create microphone audio track success, trackId:",i),s));case 21:case"end":return e.stop()}}),e,null,[[4,13]])})));function t(){return e.apply(this,arguments)}return t}(),createCustomAudioTrack:function(e){var t=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new FT(e.mediaStreamTrack,e.encoderConfig?cm(e.encoderConfig):{},hS(8,"track-cus-"),!1,!0);return Jv.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:function(){var e=u(c().mark((function e(t){var n,r,i,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CREATE_BUFFER_AUDIO_TRACK,options:[t]}),!lm("DISABLE_WEBAUDIO")){e.next=3;break}throw new Bv(Lv.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");case 3:if(r=hS(8,"track-buf-"),Jv.info("start create buffer source audio track with config",JSON.stringify(t),"trackId",r),i=t.source,t.source instanceof AudioBuffer){e.next=16;break}return e.prev=7,e.next=10,TN(t.source,t.cacheOnlineFile);case 10:t.source=e.sent,e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(7),e.abrupt("return",(n.onError(e.t0),e.t0.throw()));case 16:return o=new bN(t.source),a=new VT(i,o,t.encoderConfig?cm(t.encoderConfig):{},r),e.abrupt("return",(Jv.info("create buffer source audio track success, trackId:",r),n.onSuccess(a.getTrackId()),a));case 18:case"end":return e.stop()}}),e,null,[[7,13]])})));function t(t){return e.apply(this,arguments)}return t}(),setAppType:function(e){if(Jv.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw Jv.debug("Invalid appType"),new Bv(Lv.INVALID_PARAMS,"invalid app type",e);um("APP_TYPE",Math.floor(e))},setLogLevel:function(e){Jv.setLogLevel(e)},enableLogUpload:function(){lm("USE_NEW_LOG")?um("UPLOAD_LOG",!0):Jv.enableLogUpload()},disableLogUpload:function(){lm("USE_NEW_LOG")?um("UPLOAD_LOG",!1):Jv.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Yw},checkAudioTrackIsActive:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s,u,l,f=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]?f[1]:5e3,r=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]}),t instanceof FT||t instanceof Tk){e.next=5;break}return i=new Bv(Lv.INVALID_TRACK,"the parameter is not a audio track"),e.abrupt("return",(r.onError(i),i.throw()));case 5:return n&&n<1e3&&(n=1e3),o=t instanceof FT?t.getTrackLabel():"remote_track",a=t.getVolumeLevel(),s=a,u=a,l=Date.now(),e.abrupt("return",new Bf((function(e){var i=setInterval((function(){var a=t.getVolumeLevel(),c=(s=a>s?a:s)-(u=a<u?a:u)>1e-4,f=Date.now()-l;if(c||f>n){clearInterval(i);var d=c,p={duration:f,deviceLabel:o,maxVolumeLevel:s,result:d};Jv.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(p))),r.onSuccess(p),e(d)}}),200)})));case 10:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),checkVideoTrackIsActive:function(){var e=u(c().mark((function e(t){var n,r,i,o,a,s,u,l,f,d,p,h,v,m=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.length>1&&void 0!==m[1]?m[1]:5e3,r=Wb.reportApiInvoke(null,{tag:Lg.TRACER,name:Pg.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]}),t instanceof zR||t instanceof yk){e.next=5;break}return i=new Bv(Lv.INVALID_TRACK,"the parameter is not a video track"),e.abrupt("return",(r.onError(i),i.throw()));case 5:return o=4,n&&n<1e3&&(n=1e3),a=t instanceof zR?t.getTrackLabel():"remote_track",s=t.getMediaStreamTrack(!0),(u=document.createElement("video")).style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(fp()||sp())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([s]),u.play(),(l=document.createElement("canvas")).width=160,l.height=120,f=0,d=0,e.prev=12,p=Date.now(),e.next=16,AN(u,n,l,o);case 16:f=e.sent,d=Date.now()-p,e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(12),r.onError(e.t0),e.t0;case 23:return IN===Qd.SAFARI&&(u.pause(),u.remove()),u.srcObject=null,v={duration:d,changedPicNum:f,deviceLabel:a,result:h=f>o},e.abrupt("return",(Jv.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),r.onSuccess(v),h));case 26:case"end":return e.stop()}}),e,null,[[12,20]])})));function t(t){return e.apply(this,arguments)}return t}(),setArea:uw,audioElementPlayCenter:ky,processExternalMediaAEC:function(e){DN.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach((function(e){var t=e;t.__registered__=!0,t.logger.hookLog=Jv.extLog,t.reporter.hookApiInvoke=Wb.extApiInvoke,t.parameters&&Object.keys(t.parameters).forEach((function(e){t.parameters[e]=lm(e)}))}))},ChannelMediaRelayError:wE,ChannelMediaRelayEvent:TE,ChannelMediaRelayState:SE,RemoteStreamFallbackType:xE,RemoteStreamType:NE,ConnectionDisconnectedReason:qg,AudienceLatencyLevelType:Wg,AREAS:LE},LN=window||document;return Object.defineProperties(PN,{onAudioAutoplayFailed:{get:function(){return Lb.onAudioAutoplayFailed},set:function(e){Lb.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:function(){return Lb.onAutoplayFailed},set:function(e){Lb.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:function(){return PN._onSecurityPolicyViolation},set:function(e){if(PN._onSecurityPolicyViolation=e,LN){var t=function(e){if(e&&e.blockedURI&&PN.onSecurityPolicyViolation){var t=e.blockedURI;lm("CSP_DETECTED_HOSTNAME_LIST").some((function(e){return t.includes(e)}))&&PN.onSecurityPolicyViolation&&"function"==typeof PN.onSecurityPolicyViolation&&PN.onSecurityPolicyViolation(e)}},n=PN._cspEventHandlerPointer;n&&LN.removeEventListener("securitypolicyviolation",n),e&&"function"==typeof e&&LN.addEventListener("securitypolicyviolation",t),PN._cspEventHandlerPointer=t}}}}),Iy.on(Ug.CAMERA_DEVICE_CHANGED,(function(e){Jv.info("camera device changed",JSON.stringify(e)),PN.onCameraChanged&&PN.onCameraChanged(e)})),Iy.on(Ug.RECORDING_DEVICE_CHANGED,(function(e){Jv.info("microphone device changed",JSON.stringify(e)),PN.onMicrophoneChanged&&PN.onMicrophoneChanged(e)})),Iy.on(Ug.PLAYOUT_DEVICE_CHANGED,(function(e){Jv.debug("playout device changed",JSON.stringify(e)),PN.onPlaybackDeviceChanged&&PN.onPlaybackDeviceChanged(e)})),ky.onAutoplayFailed=function(){Jv.info("detect audio element autoplay failed"),Lb.onAudioAutoplayFailed&&Lb.onAudioAutoplayFailed()},Zb.on("autoplay-failed",(function(){Jv.info("detect webaudio autoplay failed"),Lb.onAudioAutoplayFailed&&Lb.onAudioAutoplayFailed()})),window&&(window.__ARTC__=PN),PN}()},1197:function(module,__unused_webpack_exports,__webpack_require__){"use strict";var t;module=__webpack_require__.nmd(module),t=function(){function Jg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jg(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jg(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ia(e){return(Ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zq(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function za(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){function o(e){Zq(s,r,i,o,a,"next",e)}function a(e){Zq(s,r,i,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)}))}}function ab(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qb(e,t,n){return t&&$q(e.prototype,t),n&&$q(e,n),e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nb(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ci(e,t)}function Tf(e){return(Tf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ci(e,t){return(ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ar(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function dm(e,t,n){return(dm=ar()?Reflect.construct:function(e,t,n){var r=[null];return r.push.apply(r,t),e=new(Function.bind.apply(e,r)),n&&ci(e,n.prototype),e}).apply(null,arguments)}function di(e){var t="function"==typeof Map?new Map:void 0;return(di=function(e){function n(){return dm(e,arguments,Tf(this).constructor)}if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ci(n,e)})(e)}function em(e,t){if(null==e)return{};if(null==e)var n={};else{n={};var r,i=Object.keys(e);for(r=0;r<i.length;r++){var o=i[r];0<=t.indexOf(o)||(n[o]=e[o])}}if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(e),o=0;o<r.length;o++)i=r[o],0<=t.indexOf(i)||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);return n}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ob(e){var t=ar();return function(){var n=Tf(e);if(t){var r=Tf(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!=typeof n&&"function"!=typeof n?L(this):n}}function fm(e,t,n){return(fm="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Tf(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}function Lb(e,t){var n=Array.isArray(e)?e:void 0;if(!n)if(null==(n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"])))n=void 0;else{var r,i=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){a=!0;var s=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw s}}n=i}if(!(e=n||br(e,t)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function ra(e){var t=Array.isArray(e)?gm(e):void 0;if(t||(t="undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0),!(e=t||br(e)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function br(e,t){if(e){if("string"==typeof e)return gm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gm(e,t)}}function gm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Na(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function kc(e){var t={exports:{}};return e(t,t.exports),t.exports}function Kg(e){e||(e={});var t=e.ua;if(t||"undefined"==typeof navigator||(t=navigator.userAgent),t&&t.headers&&"string"==typeof t.headers["user-agent"]&&(t=t.headers["user-agent"]),"string"!=typeof t)return!1;var n=JA.test(t)&&!KA.test(t)||!!e.tablet&&LA.test(t);return!n&&e.tablet&&e.featureDetect&&navigator&&1<navigator.maxTouchPoints&&-1!==t.indexOf("Macintosh")&&-1!==t.indexOf("Safari")&&(n=!0),n}function cr(e,t){var n,r=3>arguments.length?e:arguments[2];return ub(e)===r?e[t]:(n=pd.f(e,t))?Fa(n,"value")?n.value:void 0===n.get?void 0:n.get.call(r):fb(n=Md(e))?cr(n,t,r):void 0}function MA(e){var t=e.charCodeAt(0)<<24,n=0|NA(~t),r=0,i=0|e.length,o="";if(5>n&&i>=n){for(t=t<<n>>>24+n,r=1;r<n;r=r+1|0)t=t<<6|63&e.charCodeAt(r);65535>=t?o+=Uf(t):1114111>=t?o+=Uf(55296+((t=t-65536|0)>>10)|0,56320+(1023&t)|0):r=0}for(;r<i;r=r+1|0)o+="\ufffd";return o}function dr(){}function OA(e){var t=0|e.charCodeAt(0);if(55296<=t&&56319>=t){var n=0|e.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return Uf(239,191,189);if(65535<(t=(t-55296<<10)+n-56320+65536|0))return Uf(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return 127>=t?e:2047>=t?Uf(192|t>>>6,128|63&t):Uf(224|t>>>12,128|t>>>6&63,128|63&t)}function er(){}function kb(){kb.init.call(this)}function Cj(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+Ia(e))}function fr(e,t,n,r){Cj(n);var i=e._events;if(void 0===i)i=e._events=Object.create(null),e._eventsCount=0;else{void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events);var o=i[t]}return void 0===o?(i[t]=n,++e._eventsCount):("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(n=void 0===e._maxListeners?kb.defaultMaxListeners:e._maxListeners)&&o.length>n&&!o.warned&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,console&&console.warn&&console.warn(n))),e}function PA(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function gr(e,t,n){return e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},(t=PA.bind(e)).listener=n,e.wrapFn=t}function hr(e,t,n){if(void 0===(e=e._events))return[];if(void 0===(t=e[t]))return[];if("function"==typeof t)return n?[t.listener||t]:[t];if(n)for(n=Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];else n=ir(t,t.length);return n}function jr(e){var t=this._events;if(void 0!==t){if("function"==typeof(e=t[e]))return 1;if(void 0!==e)return e.length}return 0}function ir(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function QA(e,t,n){"function"==typeof e.on&&kr(e,"error",t,n)}function kr(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+Ia(e));e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}function RA(e){return e?ra(e):SA((function(){return[]}),(function(e,t){return e.push(t),e}))}function lr(e,t){var n,r,i,o;return W.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=mr(e)([nr,nr,function(e,t){return t}])[2],r=0;case 2:if(!(r<t.length)){a.next=17;break}if(i=t[r],!((o=n(hm,i))instanceof Dj)){a.next=11;break}if((o=im(o.deref()))===hm){a.next=10;break}return a.next=10,o;case 10:return a.abrupt("return");case 11:if(o===hm){a.next=14;break}return a.next=14,o;case 14:r++,a.next=2;break;case 17:case"end":return a.stop()}}),TA)}function Ej(e,t){return null!=t&&"function"==typeof t[Symbol.iterator]?lr(Ej(e),t):function(t){var n=t[2];return UA(t,(function(t,r){return n(t,e(r))}))}}function Be(e){return Object.prototype.toString.call(e).slice(8,-1)}function Lg(e){return"Object"===Be(e)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function or(e){var t;return(t="Boolean"===Be(e)||"Null"===Be(e)||"Undefined"===Be(e))||(t="Number"===Be(e)&&!isNaN(e)),t||"String"===Be(e)||"Symbol"===Be(e)}function Vf(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Mg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ng(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ei(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Fj;++t<n;)this.add(e[t])}function Og(e){this.size=(this.__data__=new Gj(e)).size}function Pg(e,t,n,r,i,o){var a,s=1&t,c=2&t,u=4&t;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!Kc(e))return e;if(r=lc(e)){if(a=VA(e),!s)return jm(e,a)}else{var l=fi(e),f="[object Function]"==l||"[object GeneratorFunction]"==l;if(gi(e))return pr(e,s);if("[object Object]"==l||"[object Arguments]"==l||f&&!i){if(a=c||f?{}:qr(e),!s)return c?WA(e,XA(a,e)):YA(e,ZA(a,e))}else{if(!zb[l])return i?e:{};a=$A(e,l,s)}}if(o||(o=new Qg),i=o.get(e))return i;o.set(e,a),aB(e)?e.forEach((function(r){a.add(Pg(r,t,n,r,e,o))})):bB(e)&&e.forEach((function(r,i){a.set(i,Pg(r,t,n,i,e,o))})),c=u?c?rr:km:c?hi:Wf;var d=r?void 0:c(e);return cB(d||e,(function(r,i){d&&(r=e[i=r]),sr(a,i,Pg(r,t,n,i,e,o))})),a}function lm(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;return o.has(i)?o.get(i):(r=e.apply(this,r),n.cache=o.set(i,r)||o,r)};return n.cache=new(lm.Cache||Fj),n}function tr(e){if("string"==typeof e)return e;if(lc(e))return Rg(e,tr)+"";if(Sg(e))return ur?ur.call(e):"";var t=e+"";return"0"==t&&1/e==-dB?"-0":t}function mm(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=eB),i||(i=[]);++o<a;){var s=e[o];0<t&&n(s)?1<t?mm(s,t-1,n,r,i):nm(i,s):r||(i[i.length]=s)}return i}function Tg(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!ee(e)&&!ee(t))t=e!=e&&t!=t;else e:{var o=lc(e),a=lc(t),s=o?"[object Array]":fi(e),c=a?"[object Array]":fi(t),u="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s);if(a="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=s==c)&&gi(e)){if(!gi(t)){t=!1;break e}o=!0,u=!1}if(c&&!u)i||(i=new Qg),t=o||om(e)?vr(e,t,n,r,Tg,i):fB(e,t,s,n,r,Tg,i);else{if(!(1&n)&&(o=u&&wr.call(e,"__wrapped__"),s=a&&wr.call(t,"__wrapped__"),o||s)){e=o?e.value():e,t=s?t.value():t,i||(i=new Qg),t=Tg(e,t,n,r,i);break e}if(c)t:if(i||(i=new Qg),o=1&n,s=km(e),a=s.length,c=km(t).length,a==c||o){for(c=a;c--;){var l=s[c];if(!(o?l in t:gB.call(t,l))){t=!1;break t}}if(u=i.get(e),l=i.get(t),u&&l)t=u==t&&l==e;else{u=!0,i.set(e,t),i.set(t,e);for(var f=o;++c<a;){var d=e[l=s[c]],p=t[l];if(r)var h=o?r(p,d,l,t,e,i):r(d,p,l,e,t,i);if(void 0===h?d!==p&&!Tg(d,p,n,r,i):!h){u=!1;break}f||(f="constructor"==l)}u&&!f&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(u=!1),i.delete(e),i.delete(t),t=u}}else t=!1;else t=!1}}return t}function Ab(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function Lc(e){return!0===(e&&e.__isLong__)}function Xf(e,t){var n;if(t){if((t=0<=(e>>>=0)&&256>e)&&(n=xr[e]))return n;n=Bb(e,0>(0|e)?-1:0,!0),t&&(xr[e]=n)}else{if((t=-128<=(e|=0)&&128>e)&&(n=yr[e]))return n;n=Bb(e,0>e?-1:0,!1),t&&(yr[e]=n)}return n}function qd(e,t){if(isNaN(e))return t?Yf:rd;if(t){if(0>e)return Yf;if(e>=zr)return Ar}else{if(e<=-Br)return Mc;if(e+1>=Br)return Cr}return 0>e?qd(-e,t).neg():Bb(e%Ug|0,e/Ug|0,t)}function Bb(e,t,n){return new Ab(e,t,n)}function pm(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return rd;if("number"==typeof t?(n=t,t=!1):t=!!t,2>(n=n||10)||36<n)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return pm(e.substring(1),t,n).neg();r=qd(Hj(n,8));for(var i=rd,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),s=parseInt(e.substring(o,o+a),n);8>a?(a=qd(Hj(n,a)),i=i.mul(a).add(qd(s))):i=(i=i.mul(r)).add(qd(s))}return i.unsigned=t,i}function Nd(e,t){return"number"==typeof e?qd(e,t):"string"==typeof e?pm(e,t):Bb(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}function Ca(e,t){function n(){this.constructor=e}_qm(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Vg(e){return"function"==typeof e}function Wg(e){setTimeout((function(){throw e}),0)}function rm(e){return null!==e&&"object"===Ia(e)}function Dr(e){return e.reduce((function(e,t){return e.concat(t instanceof ii?t.errors:t)}),[])}function sm(e){for(;e;){var t=e.destination,n=e.isStopped;if(e.closed||n)return!1;e=t&&t instanceof hb?t:null}return!0}function jf(e){return e}function tm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Er(e)}function Er(e){return 0===e.length?jf:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}function Fr(e){if(e||(e=sd.Promise||Promise),!e)throw Error("no Promise impl found");return e}function Gr(){return function(e){return e.lift(new hB(e))}}function ji(e){return e?iB(e):$c}function iB(e){return new Za((function(t){return e.schedule((function(){return t.complete()}))}))}function Ce(e){return e&&"function"==typeof e.schedule}function um(e,t){return new Za((function(n){var r=new dc,i=0;return r.add(t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||r.add(this.schedule()))}))),r}))}function ki(e,t){return t?um(e,t):new Za(Hr(e))}function Wb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ce(t=e[e.length-1])?(e.pop(),um(e,t)):ki(e)}function Va(e,t){return new Za(t?function(n){return t.schedule(jB,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function jB(e){e.subscriber.error(e.error)}function kB(e,t){return void 0===t&&(t=0),function(n){return n.lift(new lB(e,t))}}function Ir(e){return e in vm&&(delete vm[e],!0)}function fe(){}function Wa(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new mB(e,t))}}function Jr(e,t,n){if(t){if(!Ce(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return Jr(e,n).apply(void 0,r).pipe(Wa((function(e){return td(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i,o=this,a={context:o,subject:i,callbackFunc:e,scheduler:n};return new Za((function(r){if(n)return n.schedule(nB,0,{args:t,subscriber:r,params:a});if(!i){i=new li;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(1>=e.length?e[0]:e),i.complete()}]))}catch(e){sm(i)?i.error(e):console.warn(e)}}return i.subscribe(r)}))}}function nB(e){var t=this,n=e.args,r=e.subscriber,i=e.params;e=i.callbackFunc;var o=i.context,a=i.scheduler,s=i.subject;if(!s){s=i.subject=new li,i=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.add(a.schedule(oB,0,{value:1>=e.length?e[0]:e,subject:s}))};try{e.apply(o,n.concat([i]))}catch(e){s.error(e)}}this.add(s.subscribe(r))}function oB(e){var t=e.subject;t.next(e.value),t.complete()}function Kr(e,t,n){if(t){if(!Ce(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return Kr(e,n).apply(void 0,r).pipe(Wa((function(e){return td(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new Za((function(r){var o=i.context,a=i.subject;if(n)return n.schedule(pB,0,{params:i,subscriber:r,context:o});if(!a){a=i.subject=new li;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(t=e.shift())?a.error(t):(a.next(1>=e.length?e[0]:e),a.complete())}]))}catch(e){sm(a)?a.error(e):console.warn(e)}}return a.subscribe(r)}))}}function pB(e){var t=this,n=e.params,r=e.subscriber;e=e.context;var i=n.callbackFunc,o=n.args,a=n.scheduler,s=n.subject;if(!s){s=n.subject=new li,n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(n=e.shift())?t.add(a.schedule(Lr,0,{err:n,subject:s})):t.add(a.schedule(qB,0,{value:1>=e.length?e[0]:e,subject:s}))};try{i.apply(e,o.concat([n]))}catch(e){this.add(a.schedule(Lr,0,{err:e,subject:s}))}}this.add(s.subscribe(r))}function qB(e){var t=e.subject;t.next(e.value),t.complete()}function Lr(e){e.subject.error(e.err)}function Mr(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function wm(e,t,n,r,i){if(void 0===i&&(i=new rB(e,n,r)),!i.closed)return t instanceof Za?t.subscribe(i):mi(t)(i)}function sB(e,t){return new Za((function(n){var r=new dc;return r.add(t.schedule((function(){var i=e[Xg]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}function tB(e,t){return new Za((function(n){var r=new dc;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}function uB(e,t){if(!e)throw Error("Iterable cannot be null");return new Za((function(n){var r,i=new dc;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[kf](),i.add(t.schedule((function(){if(!n.closed){try{var e=r.next(),t=e.value,i=e.done}catch(e){return void n.error(e)}i?n.complete():(n.next(t),this.schedule())}})))}))),i}))}function Nr(e,t){if(null!=e){if(e&&"function"==typeof e[Xg])return sB(e,t);if(Mr(e))return tB(e,t);if(Or(e))return um(e,t);if(e&&"function"==typeof e[kf]||"string"==typeof e)return uB(e,t)}throw new TypeError((null!==e&&Ia(e)||e)+" is not observable")}function ge(e,t){return t?Nr(e,t):e instanceof Za?e:new Za(mi(e))}function De(e,t){if(!t.closed){if(e instanceof Za)return e.subscribe(t);try{var n=mi(e)(t)}catch(e){t.error(e)}return n}}function Ac(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(Ac((function(n,r){return ge(e(n,r)).pipe(Wa((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new vB(e,n))})}function Ij(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),Ac(jf,e)}function Pr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ij(1)(Wb.apply(void 0,e))}function lf(e){return new Za((function(t){try{var n=e()}catch(e){return void t.error(e)}return(n?ge(n):ji()).subscribe(t)}))}function Jj(e,t){return new Za((function(n){var r=e.length;if(0===r)n.complete();else for(var i=Array(r),o=0,a=0,s=function(s){var c=ge(e[s]),u=!1;n.add(c.subscribe({next:function(e){u||(u=!0,a++),i[s]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&u||(a===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)s(c)}))}function Bc(e,t,n,r){return Vg(n)&&(r=n,n=void 0),r?Bc(e,t,n).pipe(Wa((function(e){return td(e)?r.apply(void 0,e):r(e)}))):new Za((function(r){Qr(e,t,(function(e){1<arguments.length?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function Qr(e,t,n,r,i){if(e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){e.addEventListener(t,n,i);var o=function(){return e.removeEventListener(t,n,i)}}else if(e&&"function"==typeof e.on&&"function"==typeof e.off)e.on(t,n),o=function(){return e.off(t,n)};else if(e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener)e.addListener(t,n),o=function(){return e.removeListener(t,n)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var a=0,s=e.length;a<s;a++)Qr(e[a],t,n,r,i)}r.add(o)}function Rr(e,t,n){return n?Rr(e,t).pipe(Wa((function(e){return td(e)?n.apply(void 0,e):n(e)}))):new Za((function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{var i=e(r)}catch(e){return void n.error(e)}if(Vg(t))return function(){return t(r,i)}}))}function wB(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}try{var i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function xm(e){return!td(e)&&0<=e-parseFloat(e)+1}function Yg(e,t){return void 0===e&&(e=0),void 0===t&&(t=Ee),(!xm(e)||0>e)&&(e=0),t&&"function"==typeof t.schedule||(t=Ee),new Za((function(n){return n.add(t.schedule(xB,e,{subscriber:n,counter:0,period:e})),n}))}function xB(e){var t=e.subscriber,n=e.counter;e=e.period,t.next(n),this.schedule({subscriber:t,counter:n+1,period:e},e)}function Nc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];t=Number.POSITIVE_INFINITY;var n=null,r=e[e.length-1];return Ce(r)?(n=e.pop(),1<e.length&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof Za?e[0]:Ij(t)(ki(e,n))}function ym(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return $c;var n=e[0],r=e.slice(1);return 1===e.length&&td(n)?ym.apply(void 0,n):new Za((function(e){var t=function(){return e.add(ym.apply(void 0,r).subscribe(e))};return ge(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function yB(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription;if(e=e.obj,!r.closed)if(n<t.length){var o=t[n];r.next([o,e[o]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:e}))}else r.complete()}function zB(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function sc(e,t){return function(n){return n.lift(new AB(e,t))}}function bb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!td(e[0]))return e[0];e=e[0]}return ki(e,void 0).lift(new BB)}function CB(e){var t=e.start,n=e.index,r=e.subscriber;n>=e.count?r.complete():(r.next(t),r.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function Fe(e,t,n){void 0===e&&(e=0);var r=-1;return xm(t)?r=1>Number(t)?1:Number(t):Ce(t)&&(n=t),Ce(n)||(n=Ee),new Za((function(t){var i=xm(e)?e:+e-n.now();return n.schedule(DB,i,{index:0,period:r,subscriber:t})}))}function DB(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function zm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"function"==typeof(t=e[e.length-1])&&e.pop(),ki(e,void 0).lift(new EB(t))}function Kj(e){var t=arguments.length,n=Ee;Ce(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;2<=t&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return 3<=t&&(i=arguments[2]),function(t){return t.lift(new FB(e,r,i,n))}}function Sr(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function GB(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(Tr,n,{subscriber:r,context:o})),this.schedule(e,t))}function Tr(e){e.subscriber.closeContext(e.context)}function Rb(e){return function(t){var n=new HB(e);return t=t.lift(n),n.caught=t}}function Am(e,t){return Ac(e,t,1)}function Ur(e){return void 0===e&&(e=null),function(t){return t.lift(new IB(e))}}function mf(e,t){void 0===t&&(t=Ee);var n=e instanceof Date&&!isNaN(+e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new JB(n,t))}}function Vr(e,t){return function(n){return n.lift(new KB(e,t))}}function Zf(e){return void 0===e&&(e=LB),function(t){return t.lift(new MB(e))}}function LB(){return new Lj}function Xb(e){return function(t){return 0===e?ji():t.lift(new NB(e))}}function Mj(e){return function(t){return t.lift(new OB(e))}}function La(e,t){var n=2<=arguments.length;return function(r){return r.pipe(e?sc((function(t,n){return e(t,n,r)})):jf,Xb(1),n?Ur(t):Zf((function(){return new Lj})))}}function PB(){return function(e){return e.lift(new QB)}}function Wr(e){return function(t){return 0===e?ji():t.lift(new RB(e))}}function ni(e){return function(t){return t.lift(new SB(e))}}function Nj(e,t){var n=!1;return 2<=arguments.length&&(n=!0),function(r){return r.lift(new TB(e,t,n))}}function Xr(e,t){return 2<=arguments.length?function(n){return tm(Nj(e,t),Wr(1),Ur(t))(n)}:function(t){return tm(Nj((function(t,n,r){return e(t,n,r+1)})),Wr(1))(t)}}function UB(e,t){return function(n){var r="function"==typeof e?e:function(){return e};if("function"==typeof t)return n.lift(new VB(r,t));var i=Object.create(n,WB);return i.source=n,i.subjectFactory=r,i}}function Zg(e){return function(t){return t.lift(new XB(e,t))}}function YB(){return new ec}function $g(){return function(e){return Gr()(UB(YB)(e))}}function Yr(e,t,n){var r=e&&"object"===Ia(e)?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n};return function(e){return e.lift(ZB(r))}}function ZB(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=void 0===(r=e.windowTime)?Number.POSITIVE_INFINITY:r,a=e.refCount,s=e.scheduler,c=0,u=!1,l=!1;return function(e){if(c++,!t||u){u=!1;var r=(t=new ah(i,o,s)).subscribe(this);n=e.subscribe({next:function(e){t.next(e)},error:function(e){u=!0,t.error(e)},complete:function(){l=!0,n=void 0,t.complete()}}),l&&(n=void 0)}else r=t.subscribe(this);this.add((function(){c--,r.unsubscribe(),r=void 0,n&&!l&&a&&0===c&&(n.unsubscribe(),t=n=void 0)}))}}function Cc(e,t){return"function"==typeof t?function(n){return n.pipe(Cc((function(n,r){return ge(e(n,r)).pipe(Wa((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new $B(e))}}function he(e){return function(t){return t.lift(new aC(e))}}function Ka(e,t,n){return function(r){return r.lift(new bC(e,t,n))}}function cC(e,t,n){return void 0===t&&(t=Ee),void 0===n&&(n=dC),function(r){return r.lift(new eC(e,t,n.leading,n.trailing))}}function fC(e){e.subscriber.clearThrottle()}function gC(e,t,n){return void 0===n&&(n=Ee),function(r){var i=e instanceof Date&&!isNaN(+e),o=i?+e-n.now():Math.abs(e);return r.lift(new hC(o,i,t,n))}}function Oc(e,t){return void 0===t&&(t=Ee),gC(e,Va(new ad),t)}function iC(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new jC(e,n))}}function Zr(e){(Bm||e)&&($r.abort(),e&&($r=new AbortController),Bm=e)}function as(e,t,n,r,i){e!==t&&bs(t,(function(o,a){if(i||(i=new Qg),Kc(o)){o=i;var s=Cm(e,a),c=Cm(t,a),u=o.get(c);if(u)Dm(e,a,u);else{var l=void 0===(u=r?r(s,c,a+"",e,t,o):void 0);if(l){var f=lc(c),d=!f&&gi(c),p=!f&&!d&&om(c);u=c,f||d||p?lc(s)?u=s:ee(s)&&$f(s)?u=jm(s):d?(l=!1,u=pr(c,!0)):p?(l=!1,u=cs(c,!0)):u=[]:ds(c)||oi(c)?(u=s,oi(s)?u=bh(s,hi(s)):Kc(s)&&!Em(s)||(u=qr(c))):l=!1}l&&(o.set(c,u),as(u,c,n,r,o),o.delete(c)),Dm(e,a,u)}}else void 0===(s=r?r(Cm(e,a),o,a+"",e,t,i):void 0)&&(s=o),Dm(e,a,s)}),hi)}function kC(e){var t=1,n=Fm;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?t=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(t=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var r=t||1;return function(t){return t.pipe(Nj((function(t,i){var o=n.now(),a=o-e;if((t=t.filter((function(e){return e.until>a}))).length>=r){var s=t[t.length-1],c=t[0].until+e*Math.floor(t.length/r);t.push({delay:s.until<o?c-o:c-s.until,until:c,value:i})}else t.push({delay:0,until:o,value:i});return t}),[]),Wa((function(e){return e[e.length-1]})),Am((function(e){var t=Wb(e.value);return e.delay?t.pipe(mf(e.delay,n)):t})))}}function lC(e,t){var n=(t=void 0===t?{protocols:es,makeWebSocket:fs}:t).protocols,r=void 0===n?es:n,i=void 0===(t=t.makeWebSocket)?fs:t;return new Za((function(t){var n,o=new ec,a=i(e,r),s=!1,c=!1,u=!1,l=function(e){if(n)throw s=!0,e=Error("Web socket message factory function called more than once"),t.error(e),e;return n=e.subscribe((function(e){a.send(e)})),o};return a.onopen=function(){u=!0,c?(s=!0,a.close()):t.next(l)},a.onmessage=function(e){o.next(e.data)},a.onerror=function(e){s=!0,t.error(Error(e.message))},a.onclose=function(e){s||(s=!0,c?(t.complete(),o.complete()):t.error(Error(1e3===e.code?"Normal closure":e.reason)))},function(){c=!0,n&&n.unsubscribe(),s||(s=!0,u&&a.close())}}))}function Oj(){this._listeners={}}function gs(e){return"undefined"!=typeof Float32Array?function(){function t(e,t,n){o[0]=e,t[n]=a[0],t[n+1]=a[1],t[n+2]=a[2],t[n+3]=a[3]}function n(e,t,n){o[0]=e,t[n]=a[3],t[n+1]=a[2],t[n+2]=a[1],t[n+3]=a[0]}function r(e,t){return a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],a[3]=e[t+3],o[0]}function i(e,t){return a[3]=e[t],a[2]=e[t+1],a[1]=e[t+2],a[0]=e[t+3],o[0]}var o=new Float32Array([-0]),a=new Uint8Array(o.buffer),s=128===a[3];e.writeFloatLE=s?t:n,e.writeFloatBE=s?n:t,e.readFloatLE=s?r:i,e.readFloatBE=s?i:r}():function(){function t(e,t,n,r){var i=0>t?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>t)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){return n=e(t,n),e=2*(n>>31)+1,t=n>>>23&255,n&=8388607,255===t?n?NaN:1/0*e:0===t?1401298464324817e-60*e*n:e*Math.pow(2,t-150)*(n+8388608)}e.writeFloatLE=t.bind(null,hs),e.writeFloatBE=t.bind(null,is),e.readFloatLE=n.bind(null,js),e.readFloatBE=n.bind(null,ks)}(),"undefined"!=typeof Float64Array?function(){function t(e,t,n){o[0]=e,t[n]=a[0],t[n+1]=a[1],t[n+2]=a[2],t[n+3]=a[3],t[n+4]=a[4],t[n+5]=a[5],t[n+6]=a[6],t[n+7]=a[7]}function n(e,t,n){o[0]=e,t[n]=a[7],t[n+1]=a[6],t[n+2]=a[5],t[n+3]=a[4],t[n+4]=a[3],t[n+5]=a[2],t[n+6]=a[1],t[n+7]=a[0]}function r(e,t){return a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],a[3]=e[t+3],a[4]=e[t+4],a[5]=e[t+5],a[6]=e[t+6],a[7]=e[t+7],o[0]}function i(e,t){return a[7]=e[t],a[6]=e[t+1],a[5]=e[t+2],a[4]=e[t+3],a[3]=e[t+4],a[2]=e[t+5],a[1]=e[t+6],a[0]=e[t+7],o[0]}var o=new Float64Array([-0]),a=new Uint8Array(o.buffer),s=128===a[7];e.writeDoubleLE=s?t:n,e.writeDoubleBE=s?n:t,e.readDoubleLE=s?r:i,e.readDoubleBE=s?i:r}():function(){function t(e,t,n,r,i,o){var a=0>r?1:0;if(a&&(r=-r),0===r)e(0,i,o+t),e(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(17976931348623157e292<r)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+n);else if(22250738585072014e-324>r)e((r/=5e-324)>>>0,i,o+t),e((a<<31|r/4294967296)>>>0,i,o+n);else{var s=Math.floor(Math.log(r)/Math.LN2);1024===s&&(s=1023),e(4503599627370496*(r*=Math.pow(2,-s))>>>0,i,o+t),e((a<<31|s+1023<<20|1048576*r&1048575)>>>0,i,o+n)}}function n(e,t,n,r,i){return t=e(r,i+t),r=e(r,i+n),e=2*(r>>31)+1,t=4294967296*(1048575&r)+t,2047===(n=r>>>20&2047)?t?NaN:1/0*e:0===n?5e-324*e*t:e*Math.pow(2,n-1075)*(t+4503599627370496)}e.writeDoubleLE=t.bind(null,hs,0,4),e.writeDoubleBE=t.bind(null,is,4,0),e.readDoubleLE=n.bind(null,js,0,4),e.readDoubleBE=n.bind(null,ks,4,0)}(),e}function hs(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function is(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function js(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function ks(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function mc(e,t){this.lo=e>>>0,this.hi=t>>>0}function pi(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function Gm(){}function mC(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ib(){this.len=0,this.tail=this.head=new pi(Gm,0,0),this.states=null}function Hm(e,t,n){t[n]=255&e}function Im(e,t){this.len=e,this.next=void 0,this.val=t}function Jm(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo>>>=7;t[n++]=e.lo}function Km(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function ie(){Lm.call(this)}function nC(e,t,n){40>e.length?Ra.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}function Od(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Yb(e){this.buf=e,this.pos=0,this.len=e.length}function Mm(){var e=new ls(0,0),t=0;if(!(4<this.len-this.pos)){for(;3>t;++t){if(this.pos>=this.len)throw Od(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(t=0,4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>t;++t){if(this.pos>=this.len)throw Od(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function Pj(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function ms(){if(this.pos+8>this.len)throw Od(this,8);return new ls(Pj(this.buf,this.pos+=4),Pj(this.buf,this.pos+=4))}function ag(e){Nm.call(this,e)}function qi(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");Ra.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}function yb(e){return"string"==typeof e&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&"null"!==e}function ns(e){try{var t=e.split(".").map((function(e){return Number(e)}))}catch(e){return!1}if(4!==t.length||0===t[0])return!1;for(e=0;e<t.length;e++){var n=t[e];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function os(e,t){if(!Array.isArray(t)||0===t.length||32<t.length||t.some((function(e){return 0===e.length||32<e.length})))throw new ja("arguments is not valid",Ub);if(!yb(e))throw new ja("ID is invalid",Ub)}function ri(e){var t=e.attributes,n=e.attrSizeMap,r=e.maxAttrsCount,i=e.maxAttrValueSize;if(e=e.maxTotalSize,!Lg(t))throw new ja("attributes must be an object",Ub);if(Object.keys(t).length>r)throw new Dc("Exceed the limit of ".concat(r," attributes"),ch);if(0===Object.keys(t).length)throw new ja("The attributes is an empty object",Ub);var o=0,a=0;for(t=Object.entries(t);a<t.length;a++){var s=Lb(t[a],2),c=s[1];s=new Blob([s[0]]).size;var u=new Blob([c]).size;if(0===s||32<s)throw new ja("Invalid attribute key",Ub);if(u>i)throw new Dc("Invalid attribute value, over the limit of ".concat(i," bytes"),ch);if("string"!=typeof c||0===c.length)throw new ja("Invalid attribute value",Ub);o+=s,o+=u}if(o>e)throw new Dc("The attributes size overflow",ch);if(void 0!==n){if(Object.keys(n).length>r)throw new Dc("Exceed the limit of ".concat(r," attributes"),ch);for(o=r=0,n=Object.entries(n);o<n.length;o++){if(a=(t=Lb(n[o],2))[1],0===(t=new Blob([t[0]]).size))throw new ja("Invalid attribute key",Ub);if(a>i)throw new Dc("Invalid attribute value, over the limit of ".concat(i," bytes"),ch);r+=t,r+=a}if(r>e)throw new Dc("The attributes size overflow",ch)}}function nf(e){var t=e.items,n=e.maxMetaDataCount,r=e.maxMetaValueSize;if(e=e.type,!Array.isArray(t))throw new ja("params must be an MetadataItem array",Mb);var i=t.map((function(e){return[e.getKey(),e.getValue()]}));if(i.length>n)throw new Dc("Exceed the limit of ".concat(n," metadata items"),Om);if(0===i.length)throw new ja("The metadata is empty ",Mb);if(("Update"===e||"Delete"===e)&&t.map((function(e){return e.getRevision()})).includes(0))throw new ja("The operation limit metadata revision can not set 0 ",of);for(n=0;n<i.length;n++){var o=Lb(i[n],2),a=o[0];o=o[1];var s=new Blob([null!=a?a:""]).size,c=new Blob([null!=o?o:""]).size;if("_"===(null==a?void 0:a[0]))throw new ja("Invalid metaData key",Mb);if(0===s||32<s)throw new ja("Invalid metaData key",Om);if("string"!=typeof o)throw new ja("Invalid metadata value",Mb);if("Delete"!==e&&c>r)throw new Dc("Invalid metadata value, over the limit of ".concat(r," bytes"),Om)}if(new Set(t.map((function(e){return e.getKey()}))).size!==t.map((function(e){return e.getKey()})).length)throw new ja("meta data params key must be key must be unique",oC)}function Qj(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)+1))+e}function Rj(){var e=Qj(0,4294967295),t=Qj(1,4294967295);return new D(e,t,!0)}function fc(e){return e.toString().padEnd(32,"0")}function ps(e,t){return new TypeError("Unexpected ".concat(e,": ").concat(t))}function qs(e,t){return e=e.split(".").map((function(e){return Number(e)})),t=t.split(".").map((function(e){return Number(e)})),Math.sqrt(1e3*Math.pow(e[0]-t[0],2)+100*Math.pow(e[1]-t[1],2)+10*Math.pow(e[2]-t[2],2)+1*Math.pow(e[3]-t[3],2))}function rs(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Pm(e,t){t="".concat(e).concat(t||"");var n=ss.get(t)||1;return ss.set(t,n+1),"".concat(e).concat(n)}function ts(e,t){var n="number"==typeof t?t:void 0!==t&&"string"!=typeof t?t.code:void 0;return t="number"!=typeof t&&"string"!=typeof t&&void 0!==t&&void 0!==t.serverCode?t.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==t?", server Code ".concat(t):""),e="string"==typeof e&&e?Sj(e):Array.isArray(e)&&"string"==typeof e[0]&&e[0]?Sj(us.apply(void 0,[e[0]].concat(ra(e.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(e)}function pC(e,t){return Qm.apply(this,arguments)}function Qm(){return(Qm=za(W.mark((function e(t,n){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!n.aborted){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){setTimeout(e,t),null==n||n.addEventListener("abort",e)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tj(e,t,n){return Rm.apply(this,arguments)}function Rm(){return(Rm=za(W.mark((function e(t,n,r){var i,o,a,s,c,u,l,f,d,p,h,v,m,g,E,_,b,y,T,S,w,R,O,I,A,k;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.body,o=n.headers,a=void 0===o?{}:o,s=n.timeout,c=void 0===s?1e4:s,u=n.signal,l=n.withCredentials,f=void 0!==l&&l,d=(r||{}).useBinaryResponse,p=void 0!==d&&d,(h=new XMLHttpRequest).open("POST",t,!0),h.responseType=p?"arraybuffer":"text",h.withCredentials=f,h.timeout=c,v=i instanceof FormData,m=i instanceof Uint8Array,!(1<(g=Object.keys(a).filter((function(e){return"content-type"===e.toLowerCase()}))).length)){e.next=14;break}throw new RangeError("multiple content-type");case 14:0===g.length&&(m?a["Content-Type"]="application/octet-stream":v||(a["Content-Type"]="application/json"));case 15:if("setRequestHeader"in h){e.next=46;break}return h.abort(),e.next=19,fetch(t,{body:v||m?i:JSON.stringify(i),cache:"no-cache",credentials:f?"include":"same-origin",headers:a,method:"POST",mode:"cors",referrer:"no-referrer",signal:u});case 19:if(E=e.sent,!(200<=(_=E.status)&&300>_||304===_)){e.next=31;break}if(!p){e.next=27;break}return e.next=25,E.arrayBuffer();case 25:return b=e.sent,e.abrupt("return",{status:_,responseData:b});case 27:return e.next=29,E.text();case 29:return y=e.sent,e.abrupt("return",{status:_,responseText:y});case 31:return T=new Pa(["Post XHR failure, status %d",_]),e.prev=32,e.next=35,E.text();case 35:throw S=e.sent,T.statusCode=_,T.message=S||"Request failed, status ".concat(_),T;case 41:throw e.prev=41,e.t0=e.catch(32),T.statusCode=_,T.message="Request failed, status ".concat(_),T;case 46:if(0!==Object.keys(a).length)for(w=0,R=Object.entries(a);w<R.length;w++)O=Lb(R[w],2),I=O[0],A=O[1],h.setRequestHeader(I,A);return void 0!==u&&(k=function e(){h.abort(),u.removeEventListener("abort",e)},u.addEventListener("abort",k)),v||m?h.send(i):h.send(JSON.stringify(i)),e.abrupt("return",new Promise((function(e,t){h.onload=function(){var n=h.status;if(200<=n&&300>n||304===n)e(p?{status:n,responseData:h.response}:{status:n,responseText:h.responseText});else{var r=new Pa(["Post XHR failure, status %d",n]);r.statusCode=n,r.message=h.response||"Request failed, status ".concat(h.status),t(r)}},h.ontimeout=function(e){t(new Pc(["XHR request timed out after %d ms",c],{originalError:e}))},h.onerror=function(){var e=new Pa(["Post XHR failure, status %d",h.status]);e.statusCode=h.status,e.message=h.response||"Request failed, status ".concat(h.status),t(e)},h.onabort=function(){try{t(new DOMException("The request aborted.","AbortError"))}catch(n){var e=Error("The request aborted.");e.name="AbortError",t(e)}}})));case 50:case"end":return e.stop()}}),e,null,[[32,41]])})))).apply(this,arguments)}function vs(e,t){if(!Lg(e))throw new ja("message object is not a plain object",t);if(void 0===e.messageType)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",void 0!==e.text)throw new ja("Raw messages cannot have text property. Use description instead",t)}else{if("string"!=typeof e.text)throw new ja("messageType is undefined",t);if(e.messageType="TEXT",void 0!==e.rawMessage)throw new ja("Text messages cannot have rawMessage property",t)}}function Uj(e){return Sm.apply(this,arguments)}function Sm(){return(Sm=za(W.mark((function e(t){var n,r,i,o,a,s,c,u,l,f,d,p,h,v,m,g,E,_,b,y,T;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message,r=t.peerId,i=t.toPeer,o=t.session,a=t.errorCodes,s=t.diff,c=t.logger,void 0!==o){e.next=3;break}throw new ia("The client is not logged in. Cannot do the operation",a.NOT_LOGGED_IN);case 3:if(u=!1,l=i?"TEXT"===n.messageType?vb.P2pSMsgNoOfflineFlag:vb.P2pRMsgNoOfflineFlag:"TEXT"===n.messageType?vb.ChannelSMsg:vb.ChannelRMsg,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i){e.next=14;break}if(f=n.text.split("_"),d=Lb(f,3),p=d[0],h=d[1],void 0!==d[2]&&yb(h)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===p){e.next=13;break}throw o.emit("messageCount",{messageCategory:l,type:"common",key:"sentcount"}),o.emit("messageCount",{messageCategory:l,type:"common",key:"invalidmessagecount"}),new ja("Message is not valid",si);case 13:u=!0;case 14:if(v=Date.now(),m=o.messageSentTimes.length-1,!((g=o.messageSentTimes[m])&&g+3e3<v)){e.next=21;break}o.messageSentTimes=[v],e.next=34;break;case 21:E=m;case 22:if(!(0<=E)){e.next=33;break}if(!(o.messageSentTimes[E]+3e3<v)){e.next=26;break}return o.messageSentTimes=o.messageSentTimes.slice(E+1,m+1),e.abrupt("break",33);case 26:if(!(180<=m-E+1)){e.next=30;break}throw o.emit("messageCount",{messageCategory:l,type:"common",key:"sentcount"}),o.emit("messageCount",{messageCategory:l,type:"common",key:"toooftencount"}),new Dc("Message sent failed, exceeded the 180 message in 3 seconds",a.TOO_OFTEN);case 30:E--,e.next=22;break;case 33:o.messageSentTimes.push(v);case 34:e.t0=n.messageType,e.next="TEXT"===e.t0?37:"RAW"===e.t0?42:44;break;case 37:if(!u){e.next=41;break}return _=n.text.split("_"),b=Lb(_,3),y=b[1],T=b[2],c.info("[rtm-API] EndCall message send api is called"),e.abrupt("return",o.sendInvitationMessage({peerId:r,type:"CallCancel",extra:T,channelId:y,callId:"0"}));case 41:return e.abrupt("return",o.sendTextMessage(n.text,r,i,1e4-s));case 42:return void 0===n.description&&(n.description=""),e.abrupt("return",o.sendRawMessage(n.rawMessage,n.description,r,i,1e4-s));case 44:throw o.emit("messageCount",{messageCategory:l,type:"common",key:"sentcount"}),o.emit("messageCount",{messageCategory:l,type:"common",key:"invalidmessagecount"}),new ja("Invalid message type",si);case 47:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qC(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e.replace(/(https?:\/\/)?(www.)?/i,"");return t||(n=n.split(".").slice(e.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function wb(e){if("string"!=typeof e)return"[Sensitive Info]";var t=Math.floor(.7*e.length),n=e.length;return ws(e,t,n,"*".repeat(n-t))}function xs(e,t,n){function r(i){if(void 0===e)return e;if(or(i))return i;if(Array.isArray(i))return i.map(r);var o={},a=0;for(i=Vj(i);a<i.length;a++){var s=Lb(i[a],2),c=s[0];if("string"==typeof(s=s[1])&&n.includes(c)){o[c]="string"==typeof s?wb(s):"[Sensitive Info]";break}t.includes(c)?o[c]="[Hidden Info]":o[c]=null==s?s:n.includes(c)?"[Sensitive Info]":r(s)}return o}return Array.isArray(e)?e.map(r):r(e)}function ys(e){return Object.getOwnPropertyNames(e).forEach((function(t){"object"==Ia(t=e[t])&&null!==t&&ys(t)})),Object.freeze(e)}function ti(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Wj(e){return(new TextEncoder).encode(e).length}function zs(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e+=n[t].length;for(e=new Uint8Array(e),r=t=0;r<n.length;r++){var i=n[r];e.set(i,t),t+=i.length}return e}function dh(e,t,n){var r=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=null==r?void 0:r[1],r=null==r?void 0:r[2]){var i;for(r=r.substr(1).split("&"),i=0;i<r.length;i++)if(r[i].split("=")[0]==t){r[i]=t+"="+encodeURIComponent(n);break}return i==r.length&&r.push(t+"="+encodeURIComponent(n)),e+"?"+r.join("&")}return e+"?"+t+"="+encodeURIComponent(n)}function ws(e,t,n,r){return"string"!=typeof e?"[Sensitive Info]":e.substring(0,t)+r+e.substring(n)}function ui(e){return"string"==typeof e&&0!==e.length&&"false"!==e&&"null"!==e&&"undefined"!==e}function As(e){var t=[];return function e(n){if(null===n||"object"!==Ia(n))return n;if(-1!==t.indexOf(n))return"[Circular]";if(t.push(n),"function"==typeof n.toJSON)try{var r=e(n.toJSON());return t.pop(),r}catch(e){return"[Throws: "+(e?e.message:"?")+"]"}return Array.isArray(n)?(r=n.map(e),t.pop(),r):(r=Object.keys(n).reduce((function(t,r){e:{if(rC.call(n,r))try{var i=n[r];break e}catch(e){i="[Throws: "+(e?e.message:"?")+"]";break e}i=n[r]}return t[r]=e(i),t}),{}),t.pop(),r)}(e)}function sC(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var t=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*t;case"weeks":case"week":case"w":return 6048e5*t;case"days":case"day":case"d":return 864e5*t;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*t;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}function Xj(e,t,n,r){return Math.round(e/n)+" "+r+(t>=1.5*n?"s":"")}function tC(e){var t=e.areas,n=e.excludedArea;if(1===t.length&&t[0]===oa.GLOBAL&&n===oa.CHINA)return eh([oa.OVERSEA]);if(t.includes(oa.GLOBAL)){if(e=vi(Yj).filter((function(e){return e!==oa.GLOBAL&&e!==oa.OVERSEA})),n in wi){t=wi[n];var r=[].concat(ra(null!=t?t:[]),[n]);return eh(e.filter((function(e){return!r.includes(e)})))}if(Bs(n)){var i=uC(n);return eh(e.filter((function(e){return e!==n&&e!==i})))}}if(Bs(n)||n in wi)return eh(t);throw new ja("Invalid excludedArea area config")}function gb(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(ra(i.map(fh))));try{var a=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(ra(i.map(fh)))),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var s=Date.now();return za(W.mark((function n(){var r,o;return W.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(ra(i.map(fh)))),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==a?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-s):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-s,fh(r)):"Object"!==Be(r)||Lg(r)?e.resultTracker("%s result is %o",t,fh(r)):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),a},n}function je(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(i));try{var a=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var s=Date.now();return za(W.mark((function n(){var r,o;return W.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==a?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-s):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-s,r):"Object"!==Be(r)||Lg(r)?e.resultTracker("%s result is %o",t,r):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),a},n}function vC(e,t){var n="".concat(e,"Uri");if("number"!=typeof(n=Tm[n])||0===n)throw new TypeError("Got Unknown URI Name");return t=new(e=Cs[e])(t),t=e.encode(t).finish(),new wC({uri:n,data:t})}function Ds(e,t){var n=ui(null);return"".concat(e.split(".").join("-"),".edge.").concat(n?null:t?"sd-rtn.com":"agora.io")}function $a(e,t,n){return Um.apply(this,arguments)}function Um(){return(Um=za(W.mark((function e(t,n,r){var i,o,a,s=arguments;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=3<s.length&&void 0!==s[3]&&s[3],o=xC[t].encode(n).finish(),a=function(){var e=za(W.mark((function e(n){var s,c,u,l=arguments;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3<(c=1<l.length&&void 0!==l[1]?l[1]:0))){e.next=3;break}return e.abrupt("return");case 3:if(u=dh(u=r?"https://".concat(null!==(s=null==Ba?void 0:Ba.PROXY_NGINX[0])&&void 0!==s?s:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(n,"&p=443&d=events/proto-raw"):"https://".concat(n,"/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),u=dh(u,"id",yC[t].toString()),!i){e.next=9;break}return e.next=9,pC(1e4);case 9:return e.next=11,Tj(u,{body:o,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch((function(e){return a(n,c+1)}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,a((null==Ba?void 0:Ba.EVENT_REPORT_DOMAIN[0])||ui(null)&&null||"webcollector-rtm.agora.io");case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),e.next=12,a(Ba&&Es(1<(null==Ba?void 0:Ba.EVENT_REPORT_DOMAIN.length)?null==Ba?void 0:Ba.EVENT_REPORT_DOMAIN.slice(1):null==Ba?void 0:Ba.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 12:case"end":return e.stop()}}),e,null,[[3,8]])})))).apply(this,arguments)}function Nb(e){return void 0===e?D.fromNumber(0):D.fromNumber(Date.now()-e)}function Zj(e,t){return D.fromValue(e).eq(t)}function ak(e,t){var n=void 0===t?e.val:t,r=e.isBoolean;t=e.isNumber;var i=e.oneof,o=e.len;if(2!==[r,t,i].filter((function(e){return!e})).length)throw new TypeError("invalid field type");if(void 0!==n&&(e=!1,void 0!==i&&(i=Vm(i),zC(i,Zj).length===i.length&&void 0!==AC(i,(function(e){return Zj(n,e)}))&&(e=!0)),r=void 0!==r&&(0===n||1===n)&&1===o,t=void 0!==t&&n.toString(2).length<=o,!(e||r||t)))throw Error("invalid field value")}function pf(e,t){t=E({},Ge.STATE_REVISION,void 0!==t&&0<=t?t:void 0);for(var n=0;n<e.length;n++){var r=e[n];t[r.getKey()]=r.getValue(),t["".concat(Ge.STATE_REVISION_KEY_PREFIX).concat(r.getKey())]=0<=r.getRevision()||-2===r.getRevision()?r.getRevision():void 0}return Pd.omitBy(t,Pd.isUndefined)}function Wm(e){var t=JSON.parse(e);e={majorRevision:t[Ge.STATE_REVISION],items:[]};var n=Pd.omit(t,Ge.STATE_REVISION);return t=Object.keys(n).filter((function(e){return"_"!==e[0]})),e.items=t.map((function(e){return new Fs({key:e,value:n[e],revision:n["".concat(Ge.STATE_REVISION_KEY_PREFIX).concat(e)],updateTs:n["".concat(Ge.STATE_TIMESTAMP_PREFIX).concat(e)],authorUserId:n["".concat(Ge.STATE_AUTHOR_PREFIX).concat(e)]})})),e}function ud(e){var t=bd;return e!==bg.StateOk&&e!==bg.DuplicatedOperation&&(t=e===bg.OutdateRevision?of:e===bg.TimeOutError?cd:e===bg.ArgumentError?Mb:He),t}function Gs(e){return e.reduce((function(e,t){return e.concat(t instanceof bk.UnsubscriptionError?t.errors:t)}),[])}function BC(e,t){do{2147483647==xi?xi=0:xi++}while(gh.hasOwnProperty(xi));var n=xi;return gh[n]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},Xm.postMessage({name:"setInterval",fakeId:n,time:t}),n}function Hs(e){return function(){var t=e();if(!t)throw new ia("Client is not logged in. Cannot do the operation");return t}}var qb="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof __webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},ck=function(e){return e&&e.Math==Math&&e},na=ck("object"==typeof globalThis&&globalThis)||ck("object"==typeof window&&window)||ck("object"==typeof self&&self)||ck("object"==typeof qb&&qb)||function(){return this}()||Function("return this")(),Ga=function(e){try{return!!e()}catch(e){return!0}},cb=!Ga((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Is={}.propertyIsEnumerable,Js=Object.getOwnPropertyDescriptor,yi=Js&&!Is.call({1:2},1)?function(e){return!!(e=Js(this,e))&&e.enumerable}:Is,ke=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},CC={}.toString,Qd=function(e){return CC.call(e).slice(8,-1)},DC="".split,zi=Ga((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==Qd(e)?DC.call(e,""):Object(e)}:Object,Ec=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},Qc=function(e){return zi(Ec(e))},fb=function(e){return"object"==typeof e?null!==e:"function"==typeof e},le=function(e,t){if(!fb(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!fb(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!fb(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!fb(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Zb=function(e){return Object(Ec(e))},EC={}.hasOwnProperty,Fa=function(e,t){return EC.call(Zb(e),t)},hh=na.document,dk=fb(hh)&&fb(hh.createElement),Ks=!cb&&!Ga((function(){return 7!=Object.defineProperty(dk?hh.createElement("div"):{},"a",{get:function(){return 7}}).a})),Ls=Object.getOwnPropertyDescriptor,pd={f:cb?Ls:function(e,t){if(e=Qc(e),t=le(t,!0),Ks)try{return Ls(e,t)}catch(e){}if(Fa(e,t))return ke(!yi.call(e,t),e[t])}},ub=function(e){if(!fb(e))throw TypeError(String(e)+" is not an object");return e},Ms=Object.defineProperty,$b={f:cb?Ms:function(e,t,n){if(ub(e),t=le(t,!0),ub(n),Ks)try{return Ms(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},ac=cb?function(e,t,n){return $b.f(e,t,ke(1,n))}:function(e,t,n){return e[t]=n,e},Ym=function(e,t){try{ac(na,e,t)}catch(n){na[e]=t}return t},qf=na["__core-js_shared__"]||Ym("__core-js_shared__",{}),FC=Function.toString;"function"!=typeof qf.inspectSource&&(qf.inspectSource=function(e){return FC.call(e)});var Zm=qf.inspectSource,Ns=na.WeakMap,GC="function"==typeof Ns&&/native code/.test(Zm(Ns)),rf=kc((function(e){(e.exports=function(e,t){return qf[e]||(qf[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"\xa9 2021 Denis Pushkarev (zloirock.ru)"})})),HC=0,IC=Math.random(),ih=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++HC+IC).toString(36)},Os=rf("keys"),ek=function(e){return Os[e]||(Os[e]=ih(e))},jh={},JC=na.WeakMap;if(GC||qf.state)var cg=qf.state||(qf.state=new JC),KC=cg.get,Ps=cg.has,LC=cg.set,$m=function(e,t){if(Ps.call(cg,e))throw new TypeError("Object already initialized");return t.facade=e,LC.call(cg,e,t),t},fk=function(e){return KC.call(cg,e)||{}},an=function(e){return Ps.call(cg,e)};else{var kh=ek("state");jh[kh]=!0,$m=function(e,t){if(Fa(e,kh))throw new TypeError("Object already initialized");return t.facade=e,ac(e,kh,t),t},fk=function(e){return Fa(e,kh)?e[kh]:{}},an=function(e){return Fa(e,kh)}}var Sb={set:$m,get:fk,has:an,enforce:function(e){return an(e)?fk(e):$m(e,{})},getterFor:function(e){return function(t){var n;if(!fb(t)||(n=fk(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Ob=kc((function(e){var t=Sb.get,n=Sb.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable;if(o=!!o&&!!o.noTargetGet,"function"==typeof i){"string"!=typeof t||Fa(i,"name")||ac(i,"name",t);var c=n(i);c.source||(c.source=r.join("string"==typeof t?t:""))}e===na?s?e[t]=i:Ym(t,i):(a?!o&&e[t]&&(s=!0):delete e[t],s?e[t]=i:ac(e,t,i))})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||Zm(this)}))})),Qs=function(e){return"function"==typeof e?e:void 0},me=function(e,t){return 2>arguments.length?Qs(na[e])||Qs(na[e]):na[e]&&na[e][t]||na[e]&&na[e][t]},MC=Math.ceil,NC=Math.floor,Rd=function(e){return isNaN(e=+e)?0:(0<e?NC:MC)(e)},OC=Math.min,xb=function(e){return 0<e?OC(Rd(e),9007199254740991):0},PC=Math.max,QC=Math.min,dd=function(e,t){return 0>(e=Rd(e))?PC(e+t,0):QC(e,t)},Rs=function(e){return function(t,n,r){t=Qc(t);var i=xb(t.length);if(r=dd(r,i),e&&n!=n){for(;i>r;)if((n=t[r++])!=n)return!0}else for(;i>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},Ss=Rs(!0),bn=Rs(!1),Ts=function(e,t){e=Qc(e);var n,r=0,i=[];for(n in e)!Fa(jh,n)&&Fa(e,n)&&i.push(n);for(;t.length>r;)Fa(e,n=t[r++])&&(~bn(i,n)||i.push(n));return i},gk="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),RC=gk.concat("length","prototype"),dg={f:Object.getOwnPropertyNames||function(e){return Ts(e,RC)}},Ai={f:Object.getOwnPropertySymbols},Us=me("Reflect","ownKeys")||function(e){var t=dg.f(ub(e)),n=Ai.f;return n?t.concat(n(e)):t},Vs=function(e,t){for(var n=Us(t),r=$b.f,i=pd.f,o=0;o<n.length;o++){var a=n[o];Fa(e,a)||r(e,a,i(t,a))}},SC=/#|\.prototype\./,ne=function(e,t){return(e=TC[UC(e)])==VC||e!=WC&&("function"==typeof t?Ga(t):!!t)},UC=ne.normalize=function(e){return String(e).replace(SC,".").toLowerCase()},TC=ne.data={},WC=ne.NATIVE="N",VC=ne.POLYFILL="P",XC=pd.f,wa=function(e,t){var n,r,i,o=e.target,a=e.global,s=e.stat;if(r=a?na:s?na[o]||Ym(o,{}):(na[o]||{}).prototype)for(i in t){var c=t[i],u=e.noTargetGet?(n=XC(r,i))&&n.value:r[i];if(!(n=ne(a?i:o+(s?".":"#")+i,e.forced))&&void 0!==u){if(typeof c==typeof u)continue;Vs(c,u)}(e.sham||u&&u.sham)&&ac(c,"sham",!0);try{Ob(r,i,c,e)}catch(e){}}},hk=function(){var e=ub(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},Sd=Ga((function(){var e=new RegExp("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),YC=Ga((function(){var e=new RegExp("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),ik=RegExp.prototype.exec,ZC=rf("native-string-replace",String.prototype.replace),Ws=ik,cn=(d=/a/,b=/b*/g,ik.call(d,"a"),ik.call(b,"a"),0!==d.lastIndex||0!==b.lastIndex),Xs=Sd||YC,dn=void 0!==/()??/.exec("")[1],d,b;(cn||dn||Xs)&&(Ws=function(e){var t,n=Xs&&this.sticky,r=hk.call(this),i=this.source,o=0,a=e;if(n){-1===(r=r.replace("y","")).indexOf("g")&&(r+="g"),a=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==e[this.lastIndex-1])&&(i="(?: "+i+")",a=" "+a,o++);var s=new RegExp("^(?:"+i+")",r)}if(dn&&(s=new RegExp("^"+i+"$(?!\\s)",r)),cn)var c=this.lastIndex;var u=ik.call(n?s:this,a);return n?u?(u.input=u.input.slice(o),u[0]=u[0].slice(o),u.index=this.lastIndex,this.lastIndex+=u[0].length):this.lastIndex=0:cn&&u&&(this.lastIndex=this.global?u.index+u[0].length:c),dn&&u&&1<u.length&&ZC.call(u[0],s,(function(){for(t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(u[t]=void 0)})),u});var Bi=Ws;wa({target:"RegExp",proto:!0,forced:/./.exec!==Bi},{exec:Bi});var lh=me("navigator","userAgent")||"",Ys=na.process,Zs=Ys&&Ys.versions,$s=Zs&&Zs.v8;if($s)var sf=$s.split("."),en=4>sf[0]?1:sf[0]+sf[1];else lh&&(sf=lh.match(/Edge\/(\d+)/),(!sf||74<=sf[1])&&(sf=lh.match(/Chrome\/(\d+)/))&&(en=sf[1]));var oe=en&&+en,pe=!!Object.getOwnPropertySymbols&&!Ga((function(){return!String(Symbol())||!Symbol.sham&&oe&&41>oe})),at=pe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ci=rf("wks"),Di=na.Symbol,$C=at?Di:Di&&Di.withoutSetter||ih,mb=function(e){return Fa(Ci,e)&&(pe||"string"==typeof Ci[e])||(pe&&Fa(Di,e)?Ci[e]=Di[e]:Ci[e]=$C("Symbol."+e)),Ci[e]},aD=mb("species"),fn=RegExp.prototype,bD=!Ga((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),bt="$0"==="a".replace(/./,"$0"),ct=mb("replace"),dt=!!/./[ct]&&""===/./[ct]("a","$0"),cD=!Ga((function(){var e=/(?:)/,t=e.exec;return e.exec=function(){return t.apply(this,arguments)},2!==(e="ab".split(e)).length||"a"!==e[0]||"b"!==e[1]})),jk=function(e,t,n,r){var i=mb(e),o=!Ga((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!Ga((function(){var t=!1,n=/a/;return"split"===e&&((n={constructor:{}}).constructor[aD]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||"replace"===e&&(!bD||!bt||dt)||"split"===e&&!cD){var s=/./[i],c=(n=n(i,""[e],(function(e,t,n,r,i){var a=t.exec;return a===Bi||a===fn.exec?o&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:bt,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:dt}))[1];Ob(String.prototype,e,n[0]),Ob(fn,i,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}r&&ac(fn[i],"sham",!0)},dD=mb("match"),gn=function(e){var t;return fb(e)&&(void 0!==(t=e[dD])?!!t:"RegExp"==Qd(e))},Rc=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},eD=mb("species"),eg=function(e,t){var n;return void 0===(e=ub(e).constructor)||null==(n=ub(e)[eD])?t:Rc(n)},et=function(e){return function(t,n){t=String(Ec(t)),n=Rd(n);var r,i=t.length;if(0>n||n>=i)return e?"":void 0;var o=t.charCodeAt(n);return 55296>o||56319<o||n+1===i||56320>(r=t.charCodeAt(n+1))||57343<r?e?t.charAt(n):o:e?t.slice(n,n+2):r-56320+(o-55296<<10)+65536}},fD=et(!1),ft=et(!0),hn=function(e,t,n){return t+(n?ft(e,t).length:1)},mh=function(e,t){var n=e.exec;if("function"==typeof n){if("object"!=typeof(e=n.call(e,t)))throw TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==Qd(e))throw TypeError("RegExp#exec called on incompatible receiver");return Bi.call(e,t)},gD=[].push,hD=Math.min;jk("split",2,(function(e,t,n){var r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(Ec(this));if(0===(n=void 0===n?4294967295:n>>>0))return[];if(void 0===e)return[r];if(!gn(e))return t.call(r,e,n);var i,o,a,s=[],c=0;for(e=new RegExp(e.source,(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":"")+"g");(i=Bi.call(e,r))&&!((o=e.lastIndex)>c&&(s.push(r.slice(c,i.index)),1<i.length&&i.index<r.length&&gD.apply(s,i.slice(1)),a=i[0].length,c=o,s.length>=n));)e.lastIndex===i.index&&e.lastIndex++;return c===r.length?(a||!e.test(""))&&s.push(""):s.push(r.slice(c)),s.length>n?s.slice(0,n):s}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t;return[function(t,n){var i=Ec(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var a=ub(e);e=String(this);var s=eg(a,RegExp);if(o=a.unicode,a=new s(Sd?"^(?:"+a.source+")":a,(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Sd?"g":"y")),0===(i=void 0===i?4294967295:i>>>0))return[];if(0===e.length)return null===mh(a,e)?[e]:[];var c=0,u=0;for(s=[];u<e.length;){a.lastIndex=Sd?0:u;var l,f=mh(a,Sd?e.slice(u):e);if(null===f||(l=hD(xb(a.lastIndex+(Sd?u:0)),e.length))===c)u=hn(e,u,o);else{if(s.push(e.slice(c,u)),s.length===i)return s;for(c=1;c<=f.length-1;c++)if(s.push(f[c]),s.length===i)return s;u=c=l}}return s.push(e.slice(c)),s}]}),Sd);var iD=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,jD=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,jn=function(e){return function(t){return t=String(Ec(t)),1&e&&(t=t.replace(iD,"")),2&e&&(t=t.replace(jD,"")),t}},kD=jn(1),lD=jn(2),kk=jn(3),lk=na.parseInt,mD=/^[+-]?0[Xx]/,gt=8!==lk("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff08")||22!==lk("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff0x16")?function(e,t){return e=kk(String(e)),lk(e,t>>>0||(mD.test(e)?16:10))}:lk;wa({global:!0,forced:parseInt!=gt},{parseInt:gt});var tf=function(e,t,n){if(Rc(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},uf=Array.isArray||function(e){return"Array"==Qd(e)},nD=mb("species"),Ei=function(e,t){if(uf(e)){var n=e.constructor;"function"!=typeof n||n!==Array&&!uf(n.prototype)?fb(n)&&null===(n=n[nD])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===t?0:t)},ht=[].push,vf=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,f){var d=Zb(c),p=zi(d);u=tf(u,l,3),l=xb(p.length);var h,v=0;for(f=f||Ei,c=t?f(c,l):n||a?f(c,0):void 0;l>v;v++)if((s||v in p)&&(h=u(f=p[v],v,d),e))if(t)c[v]=h;else if(h)switch(e){case 3:return!0;case 5:return f;case 6:return v;case 2:ht.call(c,f)}else switch(e){case 4:return!1;case 7:ht.call(c,f)}return o?-1:r||i?i:c}},fg=vf(0),it=vf(1),jt=vf(2),oD=vf(3),pD=vf(4),kt=vf(5),lt=vf(6);vf(7);var qD=mb("species"),Fi=function(e){return 51<=oe||!Ga((function(){var t=[];return(t.constructor={})[qD]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},rD=Fi("filter");wa({target:"Array",proto:!0,forced:!rD},{filter:function(e){return jt(this,e,1<arguments.length?arguments[1]:void 0)}});var Ie=Object.keys||function(e){return Ts(e,gk)},sD=Ga((function(){Ie(1)}));wa({target:"Object",stat:!0,forced:sD},{keys:function(e){return Ie(Zb(e))}});var gg=function(e,t){var n=[][e];return!!n&&Ga((function(){n.call(null,t||function(){throw 1},1)}))},tD=[].join,uD=zi!=Object,vD=gg("join",",");wa({target:"Array",proto:!0,forced:uD||!vD},{join:function(e){return tD.call(Qc(this),void 0===e?",":e)}});var wD=Fi("map");wa({target:"Array",proto:!0,forced:!wD},{map:function(e){return it(this,e,1<arguments.length?arguments[1]:void 0)}});var kn=function(e){var t=e.return;if(void 0!==t)return ub(t.call(e)).value},nh={},xD=mb("iterator"),yD=Array.prototype,ln=function(e){return void 0!==e&&(nh.Array===e||yD[xD]===e)},oh=function(e,t,n){(t=le(t))in e?$b.f(e,t,ke(0,n)):e[t]=n},zD=mb("toStringTag"),mt={};mt[zD]="z";var mn="[object z]"===String(mt),AD=mb("toStringTag"),BD="Arguments"==Qd(function(){return arguments}()),ph=mn?Qd:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[AD];break e}catch(e){}r=void 0}r="string"==typeof(n=r)?n:BD?Qd(e):"Object"==(t=Qd(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},CD=mb("iterator"),Gi=function(e){if(null!=e)return e[CD]||e["@@iterator"]||nh[ph(e)]},hg=function(e){var t,n=Zb(e),r="function"==typeof this?this:Array,i=arguments.length,o=1<i?arguments[1]:void 0,a=void 0!==o,s=Gi(n),c=0;if(a&&(o=tf(o,2<i?arguments[2]:void 0,2)),null==s||r==Array&&ln(s)){var u=xb(n.length);for(r=new r(u);u>c;c++)s=a?o(n[c],c):n[c],oh(r,c,s)}else for(i=(n=s.call(n)).next,r=new r;!(t=i.call(n)).done;c++){if(a){s=n;var l=o;t=[t.value,c];try{u=l(ub(t)[0],t[1])}catch(e){throw kn(s),e}}else u=t.value;oh(r,c,s=u)}return r.length=c,r},nt=mb("iterator"),ot=!1;try{var DD=0,pt={next:function(){return{done:!!DD++}},return:function(){ot=!0}};pt[nt]=function(){return this},Array.from(pt,(function(){throw 2}))}catch(d){}var mk=function(e,t){if(!t&&!ot)return!1;var n=!1;try{(t={})[nt]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(e){}return n},ED=!mk((function(e){Array.from(e)}));wa({target:"Array",stat:!0,forced:ED},{from:hg});var qt=!Ga((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),rt=ek("IE_PROTO"),FD=Object.prototype,Md=qt?Object.getPrototypeOf:function(e){return e=Zb(e),Fa(e,rt)?e[rt]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?FD:null},nn=mb("iterator"),st=!1,GD=function(){return this},ig;if([].keys){var tt=[].keys();if("next"in tt){var ut=Md(Md(tt));ut!==Object.prototype&&(ig=ut)}else st=!0}(null==ig||Ga((function(){var e={};return ig[nn].call(e)!==e})))&&(ig={}),Fa(ig,nn)||ac(ig,nn,GD);var nk=ig,ok=st,vt=cb?Object.defineProperties:function(e,t){ub(e);for(var n,r=Ie(t),i=r.length,o=0;i>o;)$b.f(e,n=r[o++],t[n]);return e},on=me("document","documentElement"),wt=ek("IE_PROTO"),pn=function(){},qn,_pk=function(){try{qn=document.domain&&new ActiveXObject("htmlfile")}catch(e){}if(qn){var e=qn;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=dk?hh.createElement("iframe"):{}).style.display="none",on.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(_pk=e,e=gk.length;e--;)delete _pk.prototype[gk[e]];return _pk()};jh[wt]=!0;var vd=Object.create||function(e,t){if(null!==e){pn.prototype=ub(e);var n=new pn;pn.prototype=null,n[wt]=e}else n=_pk();return void 0===t?n:vt(n,t)},HD=$b.f,xt=mb("toStringTag"),Td=function(e,t,n){e&&!Fa(e=n?e:e.prototype,xt)&&HD(e,xt,{configurable:!0,value:t})},ID=function(){return this},yt=function(e,t,n){return t+=" Iterator",e.prototype=vd(nk,{next:ke(1,n)}),Td(e,t,!1),nh[t]=ID,e},gc=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,t={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(t,[]),e=t instanceof Array}catch(e){}return function(t,r){if(ub(t),!fb(r)&&null!==r)throw TypeError("Can't set "+String(r)+" as a prototype");return e?n.call(t,r):t.__proto__=r,t}}():void 0),Hi=mb("iterator"),JD=function(){return this},rn=function(e,t,n,r,i,o,a){yt(n,t,r),r=function(e){if(e===i&&d)return d;if(!ok&&e in l)return l[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var s,c=t+" Iterator",u=!1,l=e.prototype,f=l[Hi]||l["@@iterator"]||i&&l[i],d=!ok&&f||r(i),p="Array"==t&&l.entries||f;if(p&&(e=Md(p.call(new e)),nk!==Object.prototype&&e.next&&(Md(e)!==nk&&(gc?gc(e,nk):"function"!=typeof e[Hi]&&ac(e,Hi,JD)),Td(e,c,!0))),"values"==i&&f&&"values"!==f.name&&(u=!0,d=function(){return f.call(this)}),l[Hi]!==d&&ac(l,Hi,d),nh[t]=d,i){var h={values:r("values"),keys:o?d:r("keys"),entries:r("entries")};if(a)for(s in h)!ok&&!u&&s in l||Ob(l,s,h[s]);else wa({target:t,proto:!0,forced:ok||u},h)}return h},KD=Sb.set,LD=Sb.getterFor("String Iterator");rn(String,"String",(function(e){KD(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e=LD(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=ft(t,n),e.index+=t.length,{value:t,done:!1})}));var sn=mb("unscopables"),tn=Array.prototype;null==tn[sn]&&$b.f(tn,sn,{configurable:!0,value:vd(null)});var wf=function(e){tn[sn][e]=!0},zt=!0;"find"in[]&&Array(1).find((function(){zt=!1})),wa({target:"Array",proto:!0,forced:zt},{find:function(e){return kt(this,e,1<arguments.length?arguments[1]:void 0)}}),wf("find");var At=function(e){var t=String(Ec(this)),n="";if(0>(e=Rd(e))||1/0==e)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(t+=t))1&e&&(n+=t);return n};wa({target:"String",proto:!0},{repeat:At});var Bt=[].indexOf,Ct=!!Bt&&0>1/[1].indexOf(1,-0),MD=gg("indexOf");wa({target:"Array",proto:!0,forced:Ct||!MD},{indexOf:function(e){return Ct?Bt.apply(this,arguments)||0:bn(this,e,1<arguments.length?arguments[1]:void 0)}});var JA=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,KA=/CrOS/,LA=/android|ipad|playbook|silk/i;Kg.isMobile=Kg,Kg.default=Kg,wa({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),wa({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),na.Number.isNaN;var ND=mn?{}.toString:function(){return"[object "+ph(this)+"]"};mn||Ob(Object.prototype,"toString",ND,{unsafe:!0});var qk=na.Promise,qh=function(e,t,n){for(var r in t)Ob(e,r,t[r],n);return e},Dt=mb("species"),Ii=function(e){e=me(e);var t=$b.f;cb&&e&&!e[Dt]&&t(e,Dt,{configurable:!0,get:function(){return this}})},Ud=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Ji=function(e,t){this.stopped=e,this.result=t},rk=function(e,t,n){var r,i=!(!n||!n.AS_ENTRIES),o=!(!n||!n.IS_ITERATOR),a=!(!n||!n.INTERRUPTED),s=tf(t,n&&n.that,1+i+a),c=function(e){return u&&kn(u),new Ji(!0,e)};if(t=function(e){return i?(ub(e),a?s(e[0],e[1],c):s(e[0],e[1])):a?s(e,c):s(e)},o)var u=e;else{if("function"!=typeof(o=Gi(e)))throw TypeError("Target is not iterable");if(ln(o)){for(o=0,n=xb(e.length);n>o;o++)if((r=t(e[o]))&&r instanceof Ji)return r;return new Ji(!1)}u=o.call(e)}for(e=u.next;!(o=e.call(u)).done;){try{r=t(o.value)}catch(e){throw kn(u),e}if("object"==typeof r&&r&&r instanceof Ji)return r}return new Ji(!1)},Et=/(?:iphone|ipod|ipad).*applewebkit/i.test(lh),qe="process"==Qd(na.process),sk=na.location,un=na.setImmediate,Ft=na.clearImmediate,OD=na.process,Gt=na.MessageChannel,vn=na.Dispatch,wn=0,Ki={},xn=function(e){if(Ki.hasOwnProperty(e)){var t=Ki[e];delete Ki[e],t()}},yn=function(e){return function(){xn(e)}},Ht=function(e){xn(e.data)},It=function(e){na.postMessage(e+"",sk.protocol+"//"+sk.host)};if(!un||!Ft)if(un=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Ki[++wn]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Li(wn),wn},Ft=function(e){delete Ki[e]},qe)var Li=function(e){OD.nextTick(yn(e))};else if(vn&&vn.now)Li=function(e){vn.now(yn(e))};else if(Gt&&!Et){var Jt=new Gt,Kt=Jt.port2;Jt.port1.onmessage=Ht,Li=tf(Kt.postMessage,Kt,1)}else na.addEventListener&&"function"==typeof postMessage&&!na.importScripts&&sk&&"file:"!==sk.protocol&&!Ga(It)?(Li=It,na.addEventListener("message",Ht,!1)):Li="onreadystatechange"in(dk?hh.createElement("script"):{})?function(e){on.appendChild(dk?hh.createElement("script"):{}).onreadystatechange=function(){on.removeChild(this),xn(e)}}:function(e){setTimeout(yn(e),0)};var zn=un,PD=/web0s(?!.*chrome)/i.test(lh),QD=pd.f,Lt=na.MutationObserver||na.WebKitMutationObserver,Mt=na.document,Nt=na.process,tk=na.Promise,Ot=QD(na,"queueMicrotask"),Pt=Ot&&Ot.value,jg,Mi;if(!Pt){var vk=function(){var e;for(qe&&(e=Nt.domain)&&e.exit();jg;){var t=jg.fn;jg=jg.next;try{t()}catch(e){throw jg?uk():Mi=void 0,e}}Mi=void 0,e&&e.enter()};if(Et||qe||PD||!Lt||!Mt)if(tk&&tk.resolve){var An=tk.resolve(void 0);An.constructor=tk;var RD=An.then,uk=function(){RD.call(An,vk)}}else uk=qe?function(){Nt.nextTick(vk)}:function(){zn.call(na,vk)};else{var Qt=!0,Rt=Mt.createTextNode("");new Lt(vk).observe(Rt,{characterData:!0}),uk=function(){Rt.data=Qt=!Qt}}}var St=Pt||function(e){e={fn:e,next:void 0},Mi&&(Mi.next=e),jg||(jg=e,uk()),Mi=e},SD=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Rc(t),this.reject=Rc(n)},Bn={f:function(e){return new SD(e)}},TD=function(e,t){var n=na.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},Cn=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},UD="object"==typeof window,VD=mb("species"),Tt=Sb.get,WD=Sb.set,XD=Sb.getterFor("Promise"),kg=qk&&qk.prototype,_ed=qk,wk=kg,Ut=na.TypeError,Dn=na.document,En=na.process,rh=Bn.f,YD=rh,ZD=!!(Dn&&Dn.createEvent&&na.dispatchEvent),Vt="function"==typeof PromiseRejectionEvent,Wt=!1,Ni=ne("Promise",(function(){var e=Zm(_ed)!==String(_ed);if(!e&&66===oe)return!0;if(51<=oe&&/native code/.test(_ed))return!1;var t=new _ed((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[VD]=n,!(Wt=t.then((function(){}))instanceof n)||!e&&UD&&!Vt})),$D=Ni||!mk((function(e){_ed.all(e).catch((function(){}))})),Xt=function(e){var t;return!(!fb(e)||"function"!=typeof(t=e.then))&&t},Fn=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;St((function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var a,s=n[o++],c=i?s.ok:s.fail,u=s.resolve,l=s.reject,f=s.domain;try{if(c){if(i||(2===e.rejection&&aE(e),e.rejection=1),!0===c)var d=r;else if(f&&f.enter(),d=c(r),f){f.exit();var p=!0}d===s.promise?l(Ut("Promise-chain cycle")):(a=Xt(d))?a.call(d,u,l):u(d)}else l(r)}catch(e){f&&!p&&f.exit(),l(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&bE(e)}))}},Yt=function(e,t,n){var r;if(ZD){var i=Dn.createEvent("Event");i.promise=t,i.reason=n,i.initEvent(e,!1,!0),na.dispatchEvent(i)}else i={promise:t,reason:n};!Vt&&(r=na["on"+e])?r(i):"unhandledrejection"===e&&TD("Unhandled promise rejection",n)},bE=function(e){zn.call(na,(function(){var t=e.facade,n=e.value;if(1!==e.rejection&&!e.parent){var r=Cn((function(){qe?En.emit("unhandledRejection",n,t):Yt("unhandledrejection",t,n)}));if(e.rejection=qe||1!==e.rejection&&!e.parent?2:1,r.error)throw r.value}}))},aE=function(e){zn.call(na,(function(){var t=e.facade;qe?En.emit("rejectionHandled",t):Yt("rejectionhandled",t,e.value)}))},sh=function(e,t,n){return function(r){e(t,r,n)}},th=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Fn(e,!0))},Gn=function e(t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===n)throw Ut("Promise can't be resolved itself");var i=Xt(n);i?St((function(){var r={done:!1};try{i.call(n,sh(e,r,t),sh(th,r,t))}catch(n){th(r,n,t)}})):(t.value=n,t.state=1,Fn(t,!1))}catch(n){th({done:!1},n,t)}}};if(Ni){_ed=function(e){Ud(this,_ed,"Promise"),Rc(e),Hn.call(this);var t=Tt(this);try{e(sh(Gn,t),sh(th,t))}catch(e){th(t,e)}},wk=_ed.prototype;var Hn=function(e){WD(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};Hn.prototype=qh(wk,{then:function(e,t){var n=XD(this),r=rh(eg(this,_ed));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=qe?En.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Fn(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}});var cE=function(){var e=new Hn,t=Tt(e);this.promise=e,this.resolve=sh(Gn,t),this.reject=sh(th,t)};if(Bn.f=rh=function(e){return e===_ed||e===dE?new cE(e):YD(e)},"function"==typeof qk&&kg!==Object.prototype){var eE=kg.then;Wt||(Ob(kg,"then",(function(e,t){var n=this;return new _ed((function(e,t){eE.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Ob(kg,"catch",wk.catch,{unsafe:!0}));try{delete kg.constructor}catch(d){}gc&&gc(kg,wk)}}wa({global:!0,wrap:!0,forced:Ni},{Promise:_ed}),Td(_ed,"Promise",!1),Ii("Promise");var dE=me("Promise");wa({target:"Promise",stat:!0,forced:Ni},{reject:function(e){var t=rh(this);return t.reject.call(void 0,e),t.promise}}),wa({target:"Promise",stat:!0,forced:Ni},{resolve:function(e){if(ub(this),!fb(e)||e.constructor!==this){var t=Bn.f(this);(0,t.resolve)(e),e=t.promise}return e}}),wa({target:"Promise",stat:!0,forced:$D},{all:function(e){var t=this,n=rh(t),r=n.resolve,i=n.reject,o=Cn((function(){var n=Rc(t.resolve),o=[],a=0,s=1;rk(e,(function(e){var c=a++,u=!1;o.push(void 0),s++,n.call(t,e).then((function(e){u||(u=!0,o[c]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=rh(t),r=n.reject,i=Cn((function(){var i=Rc(t.resolve);rk(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var fE=Math.floor,gE="".replace,hE=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,iE=/\$([$&'`]|\d{1,2})/g,jE=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,c=iE;return void 0!==i&&(i=Zb(i),c=hE),gE.call(o,c,(function(o,c){switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(a);case"<":o=i[c.slice(1,-1)];break;default:var u=+c;if(0===u)return o;if(u>s)return 0===(u=fE(u/10))?o:u<=s?void 0===r[u-1]?c.charAt(1):r[u-1]+c.charAt(1):o;o=r[u-1]}return void 0===o?"":o}))},kE=Math.max,lE=Math.min;jk("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,a=i?"$":"$0";return[function(n,r){var i=Ec(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(a)){var s=n(t,e,this,r);if(s.done)return s.value}var c=ub(e);e=String(this),(s="function"==typeof r)||(r=String(r));var u=c.global;if(u){var l=c.unicode;c.lastIndex=0}for(var f=[];;){var d=mh(c,e);if(null===d)break;if(f.push(d),!u)break;""===String(d[0])&&(c.lastIndex=hn(e,xb(c.lastIndex),l))}for(l="",u=c=0;u<f.length;u++){d=f[u];for(var p=String(d[0]),h=kE(lE(Rd(d.index),e.length),0),v=[],m=1;m<d.length;m++){var g=v,E=d[m];g.push.call(g,void 0===E?E:String(E))}d=d.groups,s?(v=[p].concat(v,h,e),void 0!==d&&v.push(d),d=String(r.apply(void 0,v))):d=jE(p,e,h,v,d,r),h>=c&&(l+=e.slice(c,h)+d,c=h+p.length)}return l+e.slice(c)}]}));var mE=Fi("slice"),nE=mb("species"),oE=[].slice,pE=Math.max;wa({target:"Array",proto:!0,forced:!mE},{slice:function(e,t){var n=Qc(this),r=xb(n.length);if(e=dd(e,r),t=dd(void 0===t?r:t,r),uf(n)){var i=n.constructor;if("function"!=typeof i||i!==Array&&!uf(i.prototype)?fb(i)&&null===(i=i[nE])&&(i=void 0):i=void 0,i===Array||void 0===i)return oE.call(n,e,t)}for(i=new(void 0===i?Array:i)(pE(t-e,0)),r=0;e<t;e++,r++)e in n&&oh(i,r,n[e]);return i.length=r,i}});var qE=Sb.set,rE=Sb.getterFor("Array Iterator"),xf=rn(Array,"Array",(function(e,t){qE(this,{type:"Array Iterator",target:Qc(e),index:0,kind:t})}),(function(){var e=rE(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");nh.Arguments=nh.Array,wf("keys"),wf("values"),wf("entries");var Zt="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,uh=function(e){if(void 0===e)return 0;e=Rd(e);var t=xb(e);if(e!==t)throw RangeError("Wrong length or index");return t},sE=Math.abs,Je=Math.pow,tE=Math.floor,uE=Math.log,vE=Math.LN2,In=function(e){var t=Zb(this),n=xb(t.length),r=arguments.length,i=dd(1<r?arguments[1]:void 0,n);for(n=void 0===(r=2<r?arguments[2]:void 0)?n:dd(r,n);n>i;)t[i++]=e;return t},wE=dg.f,xE=$b.f,vh=Sb.get,$t=Sb.set,Vd=na.ArrayBuffer,_fd2=Vd,_Wd=na.DataView,xk=_Wd&&_Wd.prototype,au=Object.prototype,yk=na.RangeError,bu=function(e,t,n){var r,i=Array(n),o=(1<<(n=8*n-t-1))-1,a=o>>1,s=23===t?Je(2,-24)-Je(2,-77):0,c=0>e||0===e&&0>1/e?1:0,u=0;if((e=sE(e))!=e||1/0===e){e=e!=e?1:0;var l=o}else l=tE(uE(e)/vE),1>e*(r=Je(2,-l))&&(l--,r*=2),2<=(e=1<=l+a?e+s/r:e+s*Je(2,1-a))*r&&(l++,r/=2),l+a>=o?(e=0,l=o):1<=l+a?(e=(e*r-1)*Je(2,t),l+=a):(e=e*Je(2,a-1)*Je(2,t),l=0);for(;8<=t;i[u++]=255&e,e/=256,t-=8);for(l=l<<t|e,n+=t;0<n;i[u++]=255&l,l/=256,n-=8);return i[--u]|=128*c,i},cu=function(e,t){var n=e.length,r=8*n-t-1,i=(1<<r)-1,o=i>>1;r-=7,--n;var a=e[n--],s=127&a;for(a>>=7;0<r;s=256*s+e[n],n--,r-=8);var c=s&(1<<-r)-1;for(s>>=-r,r+=t;0<r;c=256*c+e[n],n--,r-=8);if(0===s)s=1-o;else{if(s===i)return c?NaN:a?-1/0:1/0;c+=Je(2,t),s-=o}return(a?-1:1)*c*Je(2,s-t)},du=function(e){return[255&e]},eu=function(e){return[255&e,e>>8&255]},fu=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},gu=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},yE=function(e){return bu(e,23,4)},zE=function(e){return bu(e,52,8)},zk=function(e,t){xE(e.prototype,t,{get:function(){return vh(this)[t]}})},yf=function(e,t,n,r){n=uh(n);var i=vh(e);if(n+t>i.byteLength)throw yk("Wrong index");return e=vh(i.buffer).bytes,n+=i.byteOffset,t=e.slice(n,n+t),r?t:t.reverse()},zf=function(e,t,n,r,i,o){n=uh(n);var a=vh(e);if(n+t>a.byteLength)throw yk("Wrong index");for(e=vh(a.buffer).bytes,n+=a.byteOffset,r=r(+i),i=0;i<t;i++)e[n+i]=r[o?i:t-i-1]};if(Zt){if(!Ga((function(){Vd(1)}))||!Ga((function(){new Vd(-1)}))||Ga((function(){return new Vd,new Vd(1.5),new Vd(NaN),"ArrayBuffer"!=Vd.name}))){_fd2=function(e){return Ud(this,_fd2),new Vd(uh(e))};for(var AE=_fd2.prototype=Vd.prototype,hu=wE(Vd),iu=0,Jn;hu.length>iu;)(Jn=hu[iu++])in _fd2||ac(_fd2,Jn,Vd[Jn]);AE.constructor=_fd2}gc&&Md(xk)!==au&&gc(xk,au);var Ak=new _Wd(new _fd2(2)),ju=xk.setInt8;Ak.setInt8(0,2147483648),Ak.setInt8(1,2147483649),!Ak.getInt8(0)&&Ak.getInt8(1)||qh(xk,{setInt8:function(e,t){ju.call(this,e,t<<24>>24)},setUint8:function(e,t){ju.call(this,e,t<<24>>24)}},{unsafe:!0})}else _fd2=function(e){Ud(this,_fd2,"ArrayBuffer"),e=uh(e),$t(this,{bytes:In.call(Array(e),0),byteLength:e}),cb||(this.byteLength=e)},_Wd=function(e,t,n){Ud(this,_Wd,"DataView"),Ud(e,_fd2,"DataView");var r=vh(e).byteLength;if(0>(t=Rd(t))||t>r)throw yk("Wrong offset");if(t+(n=void 0===n?r-t:xb(n))>r)throw yk("Wrong length");$t(this,{buffer:e,byteLength:n,byteOffset:t}),cb||(this.buffer=e,this.byteLength=n,this.byteOffset=t)},cb&&(zk(_fd2,"byteLength"),zk(_Wd,"buffer"),zk(_Wd,"byteLength"),zk(_Wd,"byteOffset")),qh(_Wd.prototype,{getInt8:function(e){return yf(this,1,e)[0]<<24>>24},getUint8:function(e){return yf(this,1,e)[0]},getInt16:function(e){var t=yf(this,2,e,1<arguments.length?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=yf(this,2,e,1<arguments.length?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return gu(yf(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return gu(yf(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return cu(yf(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return cu(yf(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){zf(this,1,e,du,t)},setUint8:function(e,t){zf(this,1,e,du,t)},setInt16:function(e,t){zf(this,2,e,eu,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){zf(this,2,e,eu,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){zf(this,4,e,fu,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){zf(this,4,e,fu,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){zf(this,4,e,yE,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){zf(this,8,e,zE,t,2<arguments.length?arguments[2]:void 0)}});Td(_fd2,"ArrayBuffer"),Td(_Wd,"DataView");var Oi={ArrayBuffer:_fd2,DataView:_Wd},Kn=Oi.ArrayBuffer,ku=Oi.DataView,lu=Kn.prototype.slice,BE=Ga((function(){return!new Kn(2).slice(1,void 0).byteLength}));wa({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:BE},{slice:function(e,t){if(void 0!==lu&&void 0===t)return lu.call(ub(this),e);var n=ub(this).byteLength;e=dd(e,n),t=dd(void 0===t?n:t,n),n=new(eg(this,Kn))(xb(t-e));for(var r=new ku(this),i=new ku(n),o=0;e<t;)i.setUint8(o++,r.getUint8(e++));return n}});var CE=$b.f,Bk=na.Int8Array,Ln=Bk&&Bk.prototype,mu=na.Uint8ClampedArray,nu=mu&&mu.prototype,re=Bk&&Md(Bk),Xd=Ln&&Md(Ln),ou=Object.prototype,pu=ou.isPrototypeOf,qu=mb("toStringTag"),Mn=ih("TYPED_ARRAY_TAG"),Ke=Zt&&!!gc&&"Opera"!==ph(na.opera),ru=!1,gd,se={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},DE={BigInt64Array:8,BigUint64Array:8},Ck=function(e){return!!fb(e)&&(e=ph(e),Fa(se,e)||Fa(DE,e))};for(gd in se)na[gd]||(Ke=!1);if((!Ke||"function"!=typeof re||re===Function.prototype)&&(re=function(){throw TypeError("Incorrect invocation")},Ke))for(gd in se)na[gd]&&gc(na[gd],re);if((!Ke||!Xd||Xd===ou)&&(Xd=re.prototype,Ke))for(gd in se)na[gd]&&gc(na[gd].prototype,Xd);if(Ke&&Md(nu)!==Xd&&gc(nu,Xd),cb&&!Fa(Xd,qu))for(gd in ru=!0,CE(Xd,qu,{get:function(){return fb(this)?this[Mn]:void 0}}),se)na[gd]&&ac(na[gd],Mn,gd);var Pi=Ke,su=ru&&Mn,Gb=function(e){if(Ck(e))return e;throw TypeError("Target is not a typed array")},wh=function(e){if(gc){if(pu.call(re,e))return e}else for(var t in se)if(Fa(se,gd)){var n=na[t];if(n&&(e===n||pu.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},Cb=function(e,t,n){if(cb){if(n)for(var r in se){var i=na[r];if(i&&Fa(i.prototype,e))try{delete i.prototype[e]}catch(e){}}Xd[e]&&!n||Ob(Xd,e,n?t:Ke&&Ln[e]||t)}},tu=function(e,t,n){var r,i;if(cb){if(gc){if(n)for(r in se)if((i=na[r])&&Fa(i,e))try{delete i[e]}catch(e){}if(re[e]&&!n)return;try{return Ob(re,e,n?t:Ke&&re[e]||t)}catch(e){}}for(r in se)!(i=na[r])||i[e]&&!n||Ob(i,e,t)}},uu=re,Qi=Xd,EE=na.ArrayBuffer,lg=na.Int8Array,Nn=!Pi||!Ga((function(){lg(1)}))||!Ga((function(){new lg(-1)}))||!mk((function(e){new lg,new lg(null),new lg(1.5),new lg(e)}),!0)||Ga((function(){return 1!==new lg(new EE(2),1,void 0).length})),Dk=function(e,t){if(0>(e=Rd(e)))throw RangeError("The argument can't be less than 0");if(e%t)throw RangeError("Wrong offset");return e},On=function(e){var t=Zb(e),n=arguments.length,r=1<n?arguments[1]:void 0,i=void 0!==r,o=Gi(t);if(null!=o&&!ln(o)){var a=o.call(t),s=a.next;for(t=[];!(o=s.call(a)).done;)t.push(o.value)}for(i&&2<n&&(r=tf(r,arguments[2],2)),o=xb(t.length),a=new(wh(this))(o),n=0;o>n;n++)a[n]=i?r(t[n],n):t[n];return a},Ek=function(e,t,n){var r,i;return gc&&"function"==typeof(r=t.constructor)&&r!==n&&fb(i=r.prototype)&&i!==n.prototype&&gc(e,i),e},Ri=kc((function(e){var t=dg.f,n=Sb.get,r=Sb.set,i=$b.f,o=pd.f,a=Math.round,s=na.RangeError,c=Oi.ArrayBuffer,u=Oi.DataView,l=function(e,t){var n=0,r=t.length;for(e=new(wh(e))(r);r>n;)e[n]=t[n++];return e},f=function(e,t){i(e,t,{get:function(){return n(this)[t]}})},d=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=ph(e))||"SharedArrayBuffer"==t},p=function(e,t){return Ck(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},h=function(e,t){return p(e,t=le(t,!0))?ke(2,e[t]):o(e,t)},v=function(e,t,n){return!(p(e,t=le(t,!0))&&fb(n)&&Fa(n,"value"))||Fa(n,"get")||Fa(n,"set")||n.configurable||Fa(n,"writable")&&!n.writable||Fa(n,"enumerable")&&!n.enumerable?i(e,t,n):(e[t]=n.value,e)};cb?(Pi||(pd.f=h,$b.f=v,f(Qi,"buffer"),f(Qi,"byteOffset"),f(Qi,"byteLength"),f(Qi,"length")),wa({target:"Object",stat:!0,forced:!Pi},{getOwnPropertyDescriptor:h,defineProperty:v}),e.exports=function(e,o,f){var p=e.match(/\d+$/)[0]/8,h=e+(f?"Clamped":"")+"Array",v="get"+e,m="set"+e,g=na[h],E=g;e=E&&E.prototype;var _={},b=function(e,t){i(e,t,{get:function(){var e=n(this);return e.view[v](t*p+e.byteOffset,!0)},set:function(e){var r=n(this);f&&(e=0>(e=a(e))?0:255<e?255:255&e),r.view[m](t*p+r.byteOffset,e,!0)},enumerable:!0})};Pi?Nn&&(E=o((function(e,t,n,r){return Ud(e,E,h),Ek(fb(t)?d(t)?void 0!==r?new g(t,Dk(n,p),r):void 0!==n?new g(t,Dk(n,p)):new g(t):Ck(t)?l(E,t):On.call(E,t):new g(uh(t)),e,E)})),gc&&gc(E,uu),fg(t(g),(function(e){e in E||ac(E,e,g[e])})),E.prototype=e):(E=o((function(e,t,n,i){Ud(e,E,h);var o=0,a=0;if(fb(t)){if(!d(t))return Ck(t)?l(E,t):On.call(E,t);var f=t;if(a=Dk(n,p),t=t.byteLength,void 0===i){if(t%p)throw s("Wrong length");if(0>(i=t-a))throw s("Wrong length")}else if((i=xb(i)*p)+a>t)throw s("Wrong length");t=i/p}else t=uh(t),f=new c(i=t*p);for(r(e,{buffer:f,byteOffset:a,byteLength:i,length:t,view:new u(f)});o<t;)b(e,o++)})),gc&&gc(E,uu),e=E.prototype=vd(Qi)),e.constructor!==E&&ac(e,"constructor",E),su&&ac(e,su,h),_[h]=E,wa({global:!0,forced:E!=g,sham:!Pi},_),"BYTES_PER_ELEMENT"in E||ac(E,"BYTES_PER_ELEMENT",p),"BYTES_PER_ELEMENT"in e||ac(e,"BYTES_PER_ELEMENT",p),Ii(h)}):e.exports=function(){}}));Ri("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var FE=Math.min,GE=[].copyWithin||function(e,t){var n=Zb(this),r=xb(n.length),i=dd(e,r),o=dd(t,r),a=2<arguments.length?arguments[2]:void 0;for(r=FE((void 0===a?r:dd(a,r))-o,r-i),a=1,o<i&&i<o+r&&(a=-1,o+=r-1,i+=r-1);0<r--;)o in n?n[i]=n[o]:delete n[i],i+=a,o+=a;return n};Cb("copyWithin",(function(e,t){return GE.call(Gb(this),e,t,2<arguments.length?arguments[2]:void 0)})),Cb("every",(function(e){return pD(Gb(this),e,1<arguments.length?arguments[1]:void 0)})),Cb("fill",(function(e){return In.apply(Gb(this),arguments)})),Cb("filter",(function(e){var t=jt(Gb(this),e,1<arguments.length?arguments[1]:void 0),n=eg(this,this.constructor),r=0,i=t.length;for(n=new(wh(n))(i);i>r;)n[r]=t[r++];return n})),Cb("find",(function(e){return kt(Gb(this),e,1<arguments.length?arguments[1]:void 0)})),Cb("findIndex",(function(e){return lt(Gb(this),e,1<arguments.length?arguments[1]:void 0)})),Cb("forEach",(function(e){fg(Gb(this),e,1<arguments.length?arguments[1]:void 0)})),Cb("includes",(function(e){return Ss(Gb(this),e,1<arguments.length?arguments[1]:void 0)})),Cb("indexOf",(function(e){return bn(Gb(this),e,1<arguments.length?arguments[1]:void 0)}));var vu=mb("iterator"),wu=na.Uint8Array,HE=xf.values,IE=xf.keys,JE=xf.entries,Pn=wu&&wu.prototype[vu],xu=!!Pn&&("values"==Pn.name||null==Pn.name),yu=function(){return HE.call(Gb(this))};Cb("entries",(function(){return JE.call(Gb(this))})),Cb("keys",(function(){return IE.call(Gb(this))})),Cb("values",yu,!xu),Cb(vu,yu,!xu);var KE=[].join;Cb("join",(function(e){return KE.apply(Gb(this),arguments)}));var LE=Math.min,Qn=[].lastIndexOf,zu=!!Qn&&0>1/[1].lastIndexOf(1,-0),ME=gg("lastIndexOf"),Rn=zu||!ME?function(e){if(zu)return Qn.apply(this,arguments)||0;var t=Qc(this),n=xb(t.length),r=n-1;for(1<arguments.length&&(r=LE(r,Rd(arguments[1]))),0>r&&(r=n+r);0<=r;r--)if(r in t&&t[r]===e)return r||0;return-1}:Qn;Cb("lastIndexOf",(function(e){return Rn.apply(Gb(this),arguments)})),Cb("map",(function(e){return it(Gb(this),e,1<arguments.length?arguments[1]:void 0,(function(e,t){return new(wh(eg(e,e.constructor)))(t)}))}));var Au=function(e){return function(t,n,r,i){Rc(n),t=Zb(t);var o=zi(t),a=xb(t.length),s=e?a-1:0,c=e?-1:1;if(2>r)for(;;){if(s in o){i=o[s],s+=c;break}if(s+=c,e?0>s:a<=s)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=s:a>s;s+=c)s in o&&(i=n(i,o[s],s,t));return i}},Bu=Au(!1),Cu=Au(!0);Cb("reduce",(function(e){return Bu(Gb(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)})),Cb("reduceRight",(function(e){return Cu(Gb(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}));var NE=Math.floor;Cb("reverse",(function(){for(var e,t=Gb(this).length,n=NE(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var OE=Ga((function(){new Int8Array(1).set({})}));Cb("set",(function(e){Gb(this);var t=Dk(1<arguments.length?arguments[1]:void 0,1),n=this.length,r=Zb(e),i=xb(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),OE);var PE=[].slice,QE=Ga((function(){new Int8Array(1).slice()}));Cb("slice",(function(e,t){e=PE.call(Gb(this),e,t);var n=eg(this,this.constructor);t=0;var r=e.length;for(n=new(wh(n))(r);r>t;)n[t]=e[t++];return n}),QE),Cb("some",(function(e){return oD(Gb(this),e,1<arguments.length?arguments[1]:void 0)}));var RE=[].sort;Cb("sort",(function(e){return RE.call(Gb(this),e)})),Cb("subarray",(function(e,t){var n=Gb(this),r=n.length;return e=dd(e,r),new(eg(n,n.constructor))(n.buffer,n.byteOffset+e*n.BYTES_PER_ELEMENT,xb((void 0===t?r:dd(t,r))-e))}));var Fk=na.Int8Array,Du=[].toLocaleString,SE=[].slice,TE=!!Fk&&Ga((function(){Du.call(new Fk(1))})),UE=Ga((function(){return[1,2].toLocaleString()!=new Fk([1,2]).toLocaleString()}))||!Ga((function(){Fk.prototype.toLocaleString.call([1,2])}));Cb("toLocaleString",(function(){return Du.apply(TE?SE.call(Gb(this)):Gb(this),arguments)}),UE);var Eu=na.Uint8Array,VE=Eu&&Eu.prototype||{},Gk=[].toString,WE=[].join;Ga((function(){Gk.call({})}))&&(Gk=function(){return WE.call(this)}),Cb("toString",Gk,VE.toString!=Gk);var Fu=Oi.ArrayBuffer;wa({global:!0,forced:na.ArrayBuffer!==Fu},{ArrayBuffer:Fu}),Ii("ArrayBuffer");var XE=$b.f,Sn=Function.prototype,YE=Sn.toString,ZE=/^\s*function ([^ (]*)/;!cb||"name"in Sn||XE(Sn,"name",{configurable:!0,get:function(){try{return YE.call(this).match(ZE)[1]}catch(e){return""}}});var Gu=RegExp.prototype,Hu=Gu.toString,$E=Ga((function(){return"/a/b"!=Hu.call({source:"a",flags:"b"})})),aF="toString"!=Hu.name;($E||aF)&&Ob(RegExp.prototype,"toString",(function(){var e=ub(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in Gu)?hk.call(e):n)}),{unsafe:!0});var bF=Fi("splice"),cF=Math.max,dF=Math.min;wa({target:"Array",proto:!0,forced:!bF},{splice:function(e,t){var n,r,i=Zb(this),o=xb(i.length),a=dd(e,o),s=arguments.length;if(0===s?s=n=0:1===s?(s=0,n=o-a):(s-=2,n=dF(cF(Rd(t),0),o-a)),9007199254740991<o+s-n)throw TypeError("Maximum allowed length exceeded");var c=Ei(i,n);for(r=0;r<n;r++){var u=a+r;u in i&&oh(c,r,i[u])}if(c.length=n,s<n){for(r=a;r<o-n;r++){var l=r+s;(u=r+n)in i?i[l]=i[u]:delete i[l]}for(r=o;r>o-n+s;r--)delete i[r-1]}else if(s>n)for(r=o-n;r>a;r--)l=r+s-1,(u=r+n-1)in i?i[l]=i[u]:delete i[l];for(r=0;r<s;r++)i[r+a]=arguments[r+2];return i.length=o-n+s,c}});var Tn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Un=mb("iterator"),Iu=mb("toStringTag"),Vn=xf.values,Hk;for(Hk in Tn){var Ju=na[Hk],Le=Ju&&Ju.prototype;if(Le){if(Le[Un]!==Vn)try{ac(Le,Un,Vn)}catch(d){Le[Un]=Vn}if(Le[Iu]||ac(Le,Iu,Hk),Tn[Hk])for(var xh in xf)if(Le[xh]!==xf[xh])try{ac(Le,xh,xf[xh])}catch(d){Le[xh]=xf[xh]}}}var Ku=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};jk("search",1,(function(e,t,n){return[function(t){var n=Ec(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;e=ub(e);var i=String(this);return r=e.lastIndex,Ku(r,0)||(e.lastIndex=0),i=mh(e,i),Ku(e.lastIndex,r)||(e.lastIndex=r),null===i?-1:i.index}]})),kc((function(e){var t,n;t="undefined"!=typeof self?self:qb,n=function(e){function t(e){return btoa(e).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e){return e=(e+="===").slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function r(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function i(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function o(e){var t={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(t.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(t.length=e.length);break;case"HMAC":e.hash&&(t.hash=o(e.hash)),e.length&&(t.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(t.hash=o(e.hash)),e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return t}function a(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function s(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(i(e)))));var t={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(t.kty){case"oct":t.k=e.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach((function(n){n in e&&(t[n]=e[n])}));break;default:throw new TypeError("Unsupported key type")}return t}function c(e){return e=s(e),b&&(e.extractable=e.ext,delete e.ext),r(unescape(encodeURIComponent(JSON.stringify(e)))).buffer}function u(e){var n=l(e),r=!1;if("1.2.840.113549.1.1.1"!==(2<n.length&&(r=!0,n.shift()),e={ext:!0},n[0][0]))throw new TypeError("Unsupported key type");var o="n e d p q dp dq qi".split(" ");for(n=l(n[1]),r&&n.shift(),r=0;r<n.length;r++)n[r][0]||(n[r]=n[r].subarray(1)),e[o[r]]=t(i(n[r]));return e.kty="RSA",e}function l(e,t){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t||(t={pos:0,end:e.length}),2>t.end-t.pos||t.end>e.length)throw new RangeError("Malformed DER");var n=e[t.pos++],r=e[t.pos++];if(128<=r){if(r&=127,t.end-t.pos<r)throw new RangeError("Malformed DER");for(var o=0;r--;)o<<=8,o|=e[t.pos++];r=o}if(t.end-t.pos<r)throw new RangeError("Malformed DER");switch(n){case 2:n=e.subarray(t.pos,t.pos+=r);break;case 3:if(e[t.pos++])throw Error("Unsupported bit string");r--;case 4:n=new Uint8Array(e.subarray(t.pos,t.pos+=r)).buffer;break;case 5:n=null;break;case 6:if(!((e=btoa(i(e.subarray(t.pos,t.pos+=r))))in T))throw Error("Unsupported OBJECT ID "+e);n=T[e];break;case 48:for(n=[],r=t.pos+r;t.pos<r;)n.push(l(e,t));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function f(e,t){t||(t=[]);var n=t.length+2;if(t.push(0,0),e instanceof Uint8Array)for(var i=2,o=e.length,a=0;a<o;a++)t.push(e[a]);else if(e instanceof ArrayBuffer)for(i=4,o=e.byteLength,e=new Uint8Array(e),a=0;a<o;a++)t.push(e[a]);else if(null===e)i=5,o=0;else if("string"==typeof e&&e in S)for(i=6,o=(e=r(atob(S[e]))).length,a=0;a<o;a++)t.push(e[a]);else if(e instanceof Array){for(a=0;a<e.length;a++)f(e[a],t);i=48,o=t.length-n}else{if(!("object"===Ia(e)&&3===e.tag&&e.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+e);for(i=3,o=(e=new Uint8Array(e.value)).byteLength,t.push(0),a=0;a<o;a++)t.push(e[a]);o++}if(128<=o){for(a=o,o=4,t.splice(n,0,a>>24&255,a>>16&255,a>>8&255,255&a);1<o&&!(a>>24);)a<<=8,o--;4>o&&t.splice(n,4-o),o|=128}return t.splice(n-2,2,i,o),t}function d(e,t,n,r){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===n?e.extractable:n,enumerable:!0},algorithm:{value:void 0===t?e.algorithm:t,enumerable:!0},usages:{value:void 0===r?e.usages:r,enumerable:!0}})}function p(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function h(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}if("function"!=typeof Promise)throw"Promise support required";var v=e.crypto||e.msCrypto;if(v){var m=v.subtle||v.webkitSubtle;if(m){var g=e.Crypto||v.constructor||Object,E=e.SubtleCrypto||m.constructor||Object;e.CryptoKey||e.Key;var _=-1<e.navigator.userAgent.indexOf("Edge/"),b=!!e.msCrypto&&!_,y=!v.subtle&&!!v.webkitSubtle;if(b||y){var T={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},S={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(e){var t=m[e];m[e]=function(i,l,f){var g=[].slice.call(arguments);switch(e){case"generateKey":var E=o(i),_=l,T=f;break;case"importKey":E=o(f),_=g[3],T=g[4],"jwk"===i&&((l=s(l)).alg||(l.alg=a(E)),l.key_ops||(l.key_ops="oct"!==l.kty?"d"in l?T.filter(h):T.filter(p):T.slice()),g[1]=c(l));break;case"unwrapKey":E=g[4],_=g[5],T=g[6],g[2]=f._key}if("generateKey"===e&&"HMAC"===E.name&&E.hash)return E.length=E.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[E.hash.name],m.importKey("raw",v.getRandomValues(new Uint8Array(E.length+7>>3)),E,_,T);if(y&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===E.name&&(!E.modulusLength||2048<=E.modulusLength))return(i=o(i)).name="RSAES-PKCS1-v1_5",delete i.hash,m.generateKey(i,!0,["encrypt","decrypt"]).then((function(e){return Promise.all([m.exportKey("jwk",e.publicKey),m.exportKey("jwk",e.privateKey)])})).then((function(e){return e[0].alg=e[1].alg=a(E),e[0].key_ops=T.filter(p),e[1].key_ops=T.filter(h),Promise.all([m.importKey("jwk",e[0],E,!0,e[0].key_ops),m.importKey("jwk",e[1],E,_,e[1].key_ops)])})).then((function(e){return{publicKey:e[0],privateKey:e[1]}}));if((y||b&&"SHA-1"===(E.hash||{}).name)&&"importKey"===e&&"jwk"===i&&"HMAC"===E.name&&"oct"===l.kty)return m.importKey("raw",r(n(l.k)),f,g[3],g[4]);if(y&&"importKey"===e&&("spki"===i||"pkcs8"===i))return m.importKey("jwk",u(l),f,g[3],g[4]);if(b&&"unwrapKey"===e)return m.decrypt(g[3],f,l).then((function(e){return m.importKey(i,e,g[4],g[5],g[6])}));try{var S=t.apply(m,g)}catch(e){return Promise.reject(e)}return b&&(S=new Promise((function(e,t){S.onabort=S.onerror=function(e){t(e)},S.oncomplete=function(t){e(t.target.result)}}))),S=S.then((function(e){return"HMAC"!==E.name||E.length||(E.length=8*e.algorithm.length),0==E.name.search("RSA")&&(E.modulusLength||(E.modulusLength=(e.publicKey||e).algorithm.modulusLength),E.publicExponent||(E.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e.publicKey&&e.privateKey?{publicKey:new d(e.publicKey,E,_,T.filter(p)),privateKey:new d(e.privateKey,E,_,T.filter(h))}:new d(e,E,_,T)}))}})),["exportKey","wrapKey"].forEach((function(e){var o=m[e];m[e]=function(c,u,l){var d=[].slice.call(arguments);switch(e){case"exportKey":d[1]=u._key;break;case"wrapKey":d[1]=u._key,d[2]=l._key}if((y||b&&"SHA-1"===(u.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===c&&"HMAC"===u.algorithm.name&&(d[0]="raw"),!y||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(d[0]="jwk"),b&&"wrapKey"===e)return m.exportKey(c,u).then((function(e){return"jwk"===c&&(e=r(unescape(encodeURIComponent(JSON.stringify(s(e)))))),m.encrypt(d[3],l,e)}));try{var v=o.apply(m,d)}catch(e){return Promise.reject(e)}return b&&(v=new Promise((function(e,t){v.onabort=v.onerror=function(e){t(e)},v.oncomplete=function(t){e(t.target.result)}}))),"exportKey"===e&&"jwk"===c&&(v=v.then((function(e){return(y||b&&"SHA-1"===(u.algorithm.hash||{}).name)&&"HMAC"===u.algorithm.name?{kty:"oct",alg:a(u.algorithm),key_ops:u.usages.slice(),ext:!0,k:t(i(e))}:((e=s(e)).alg||(e.alg=a(u.algorithm)),e.key_ops||(e.key_ops="public"===u.type?u.usages.filter(p):"private"===u.type?u.usages.filter(h):u.usages.slice()),e)}))),!y||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(v=v.then((function(e){var t=[["",null]],i=!1;if("RSA"!==(e=s(e)).kty)throw new TypeError("Unsupported key type");for(var o="n e d p q dp dq qi".split(" "),a=[],c=0;c<o.length&&o[c]in e;c++){var u=a[c]=r(n(e[o[c]]));128&u[0]&&(a[c]=new Uint8Array(u.length+1),a[c].set(u,1))}return 2<a.length&&(i=!0,a.unshift(new Uint8Array([0]))),t[0][0]="1.2.840.113549.1.1.1",t.push(new Uint8Array(f(a)).buffer),i?t.unshift(new Uint8Array([0])):t[1]={tag:3,value:t[1]},new Uint8Array(f(t)).buffer}))),v}})),["encrypt","decrypt","sign","verify"].forEach((function(e){var t=m[e];m[e]=function(n,r,i,a){if(b&&(!i.byteLength||a&&!a.byteLength))throw Error("Empty input is not allowed");var s=[].slice.call(arguments),c=o(n);if(!b||"sign"!==e&&"verify"!==e||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(s[0]={name:n}),b&&r.algorithm.hash&&(s[0].hash=s[0].hash||r.algorithm.hash),b&&"decrypt"===e&&"AES-GCM"===c.name){var u=n.tagLength>>3;s[2]=(i.buffer||i).slice(0,i.byteLength-u),n.tag=(i.buffer||i).slice(i.byteLength-u)}b&&"AES-GCM"===c.name&&void 0===s[0].tagLength&&(s[0].tagLength=128),s[1]=r._key;try{var l=t.apply(m,s)}catch(e){return Promise.reject(e)}return b&&(l=new Promise((function(t,n){l.onabort=l.onerror=function(e){n(e)},l.oncomplete=function(n){if(n=n.target.result,"encrypt"===e&&n instanceof AesGcmEncryptResult){var r=n.ciphertext,i=n.tag;(n=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(i),r.byteLength),n=n.buffer}t(n)}}))),l}})),b){var w=m.digest;m.digest=function(e,t){if(!t.byteLength)throw Error("Empty input is not allowed");try{var n=w.call(m,e,t)}catch(e){return Promise.reject(e)}return n=new Promise((function(e,t){n.onabort=n.onerror=function(e){t(e)},n.oncomplete=function(t){e(t.target.result)}}))},e.crypto=Object.create(v,{getRandomValues:{value:function(e){return v.getRandomValues(e)}},subtle:{value:m}}),e.CryptoKey=d}y&&(v.subtle=m,e.Crypto=g,e.SubtleCrypto=E,e.CryptoKey=d)}}}},e.exports?e.exports=n(t):n(t)})),function(e){e.console||(e.console={}),e=e.console;for(var t,n=function(){},r=["memory"],i="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");t=r.pop();)e[t]||(e[t]={});for(;t=i.pop();)e[t]||(e[t]=n)}("undefined"==typeof window?qb:window),wa({target:"Object",stat:!0},{setPrototypeOf:gc});var eF=Ga((function(){Md(1)}));wa({target:"Object",stat:!0,forced:eF,sham:!qt},{getPrototypeOf:function(e){return Md(Zb(e))}});var Lu=[].slice,Wn={},fF=Function.bind||function(e){var t=Rc(this),n=Lu.call(arguments,1),r=function r(){var i=n.concat(Lu.call(arguments));if(this instanceof r){var o=i.length;if(!(o in Wn)){for(var a=[],s=0;s<o;s++)a[s]="a["+s+"]";Wn[o]=Function("C,a","return new C("+a.join(",")+")")}i=Wn[o](t,i)}else i=t.apply(e,i);return i};return fb(t.prototype)&&(r.prototype=t.prototype),r},Xn=me("Reflect","construct"),Mu=Ga((function(){function e(){}return!(Xn((function(){}),[],e)instanceof e)})),Nu=!Ga((function(){Xn((function(){}))})),Ou=Mu||Nu;wa({target:"Reflect",stat:!0,forced:Ou,sham:Ou},{construct:function(e,t){Rc(e),ub(t);var n=3>arguments.length?e:Rc(arguments[2]);if(Nu&&!Mu)return Xn(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}return(n=[null]).push.apply(n,t),new(fF.apply(e,n))}n=n.prototype,n=vd(fb(n)?n:Object.prototype);var r=Function.apply.call(e,n,t);return fb(r)?r:n}}),wa({target:"Reflect",stat:!0},{get:cr});var Pu=pd.f,gF=Ga((function(){Pu(1)}));wa({target:"Object",stat:!0,forced:!cb||gF,sham:!cb},{getOwnPropertyDescriptor:function(e,t){return Pu(Qc(e),t)}});var Qu=dg.f,hF={}.toString,Ru="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Yn=function(e){if(Ru&&"[object Window]"==hF.call(e))try{var t=Qu(e)}catch(e){t=Ru.slice()}else t=Qu(Qc(e));return t},Su={f:mb},iF=$b.f,Ik=function(e){var t=na.Symbol||(na.Symbol={});Fa(t,e)||iF(t,e,{value:Su.f(e)})},Sc=ek("hidden"),Tu=mb("toPrimitive"),jF=Sb.set,Uu=Sb.getterFor("Symbol"),wd=Object.prototype,_Tc=na.Symbol,Si=me("JSON","stringify"),Vu=pd.f,Af=$b.f,Wu=Yn,kF=yi,Me=rf("symbols"),Ti=rf("op-symbols"),Zn=rf("string-to-symbol-registry"),$n=rf("symbol-to-string-registry"),lF=rf("wks"),ao=na.QObject,bo=!ao||!ao.prototype||!ao.prototype.findChild,co=cb&&Ga((function(){return 7!=vd(Af({},"a",{get:function(){return Af(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Vu(wd,t);r&&delete wd[t],Af(e,t,n),r&&e!==wd&&Af(wd,t,r)}:Af,eo=function(e,t){var n=Me[e]=vd(_Tc.prototype);return jF(n,{type:"Symbol",tag:e,description:t}),cb||(n.description=t),n},fo=at?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof _Tc},Jk=function e(t,n,r){return t===wd&&e(Ti,n,r),ub(t),n=le(n,!0),ub(r),Fa(Me,n)?(r.enumerable?(Fa(t,Sc)&&t[Sc][n]&&(t[Sc][n]=!1),r=vd(r,{enumerable:ke(0,!1)})):(Fa(t,Sc)||Af(t,Sc,ke(1,{})),t[Sc][n]=!0),co(t,n,r)):Af(t,n,r)},Xu=function(e,t){ub(e);var n=Qc(t);return t=Ie(n).concat(go(n)),fg(t,(function(t){cb&&!ho.call(n,t)||Jk(e,t,n[t])})),e},ho=function(e){e=le(e,!0);var t=kF.call(this,e);return!(this===wd&&Fa(Me,e)&&!Fa(Ti,e))&&(!(t||!Fa(this,e)||!Fa(Me,e)||Fa(this,Sc)&&this[Sc][e])||t)},Yu=function(e,t){if(e=Qc(e),t=le(t,!0),e!==wd||!Fa(Me,t)||Fa(Ti,t)){var n=Vu(e,t);return!n||!Fa(Me,t)||Fa(e,Sc)&&e[Sc][t]||(n.enumerable=!0),n}},Zu=function(e){e=Wu(Qc(e));var t=[];return fg(e,(function(e){Fa(Me,e)||Fa(jh,e)||t.push(e)})),t},go=function(e){var t=e===wd;e=Wu(t?Ti:Qc(e));var n=[];return fg(e,(function(e){!Fa(Me,e)||t&&!Fa(wd,e)||n.push(Me[e])})),n};if(pe||(_Tc=function(){if(this instanceof _Tc)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=ih(e),n=function e(n){this===wd&&e.call(Ti,n),Fa(this,Sc)&&Fa(this[Sc],t)&&(this[Sc][t]=!1),co(this,t,ke(1,n))};return cb&&bo&&co(wd,t,{configurable:!0,set:n}),eo(t,e)},Ob(_Tc.prototype,"toString",(function(){return Uu(this).tag})),Ob(_Tc,"withoutSetter",(function(e){return eo(ih(e),e)})),yi=ho,$b.f=Jk,pd.f=Yu,dg.f=Yn=Zu,Ai.f=go,Su.f=function(e){return eo(mb(e),e)},cb&&(Af(_Tc.prototype,"description",{configurable:!0,get:function(){return Uu(this).description}}),Ob(wd,"propertyIsEnumerable",ho,{unsafe:!0}))),wa({global:!0,wrap:!0,forced:!pe,sham:!pe},{Symbol:_Tc}),fg(Ie(lF),(function(e){Ik(e)})),wa({target:"Symbol",stat:!0,forced:!pe},{for:function(e){if(e=String(e),Fa(Zn,e))return Zn[e];var t=_Tc(e);return Zn[e]=t,$n[t]=e,t},keyFor:function(e){if(!fo(e))throw TypeError(e+" is not a symbol");if(Fa($n,e))return $n[e]},useSetter:function(){bo=!0},useSimple:function(){bo=!1}}),wa({target:"Object",stat:!0,forced:!pe,sham:!cb},{create:function(e,t){return void 0===t?vd(e):Xu(vd(e),t)},defineProperty:Jk,defineProperties:Xu,getOwnPropertyDescriptor:Yu}),wa({target:"Object",stat:!0,forced:!pe},{getOwnPropertyNames:Zu,getOwnPropertySymbols:go}),wa({target:"Object",stat:!0,forced:Ga((function(){Ai.f(1)}))},{getOwnPropertySymbols:function(e){return Ai.f(Zb(e))}}),Si){var mF=!pe||Ga((function(){var e=_Tc();return"[null]"!=Si([e])||"{}"!=Si({a:e})||"{}"!=Si(Object(e))}));wa({target:"JSON",stat:!0,forced:mF},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(fb(t)||void 0!==e)&&!fo(e))return uf(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!fo(t))return t}),i[1]=t,Si.apply(null,i)}})}_Tc.prototype[Tu]||ac(_Tc.prototype,Tu,_Tc.prototype.valueOf),Td(_Tc,"Symbol"),jh[Sc]=!0;var nF=$b.f,Ne=na.Symbol;if(cb&&"function"==typeof Ne&&(!("description"in Ne.prototype)||void 0!==Ne().description)){var $u={},Ui=function e(){var t=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),n=this instanceof e?new Ne(t):void 0===t?Ne():Ne(t);return""===t&&($u[n]=!0),n};Vs(Ui,Ne);var io=Ui.prototype=Ne.prototype;io.constructor=Ui;var oF=io.toString,pF="Symbol(test)"==String(Ne("test")),qF=/^Symbol\((.*)\)[^)]+$/;nF(io,"description",{configurable:!0,get:function(){var e=fb(this)?this.valueOf():this,t=oF.call(e);return Fa($u,e)?"":""===(e=pF?t.slice(7,-1):t.replace(qF,"$1"))?void 0:e}}),wa({global:!0,forced:!0},{Symbol:Ui})}Ik("toStringTag"),Td(na.JSON,"JSON",!0),Td(Math,"Math",!0),function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}var s=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t,n){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:n})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=0,r=(e=this.listeners[e]).length;n<r;n++)if(e[n].callback===t){e.splice(n,1);break}}},{key:"dispatchEvent",value:function(e){var t=this;if(e.type in this.listeners){for(var n=function(){a=r[i];try{a.callback.call(t,e)}catch(e){Promise.resolve().then((function(){throw e}))}a.options&&a.options.once&&t.removeEventListener(e.type,a.callback)},r=this.listeners[e.type].slice(),i=0,o=r.length;i<o;i++){var a;n()}return!e.defaultPrevented}}}]),t}(),c=function(t){function c(){e(this,c);var t=u.call(this);return t.listeners||s.call(o(t)),Object.defineProperty(o(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(o(t),"onabort",{value:null,writable:!0,configurable:!0}),t}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(c,t);var u=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n=r(e);if(t){var i=r(this).constructor;n=Reflect.construct(n,arguments,i)}else n=n.apply(this,arguments);return!n||"object"!==Ia(n)&&"function"!=typeof n?o(this):n}}(c);return n(c,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),a(r(c.prototype),"dispatchEvent",this).call(this,e)}}]),c}(s),u=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new c,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(){try{var e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(u.prototype[Symbol.toStringTag]="AbortController",c.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var t=!0}else t="function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController;t&&(e.AbortController=u,e.AbortSignal=c)}("undefined"!=typeof self?self:qb)}();var rF=Math.floor,sF=Math.log,tF=Math.LOG2E;wa({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-rF(sF(e+.5)*tF):32}});var uF=Math.log,vF=Math.LN2,NA=Math.clz32||function(e){return 31-uF(e>>>0)/vF|0},Uf=String.fromCharCode,av={}.toString,jo=window.Uint8Array,ko=jo||Array,wF=av.call((window.ArrayBuffer||ko).prototype),lo;dr.prototype.decode=function(e){if(e=e&&e.buffer||e,av.call(e)!==wF)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var t="",n=0,r=0|(e=jo?new ko(e):e).length;n<r;n=n+32768|0)t+=Uf.apply(0,e[jo?"slice":"subarray"](n,n+32768|0));return t.replace(/[\xc0-\xff][\x80-\xbf]*/g,MA)},window.TextDecoder||(window.TextDecoder=dr),er.prototype.encode=function(e){for(var t=0|(e=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,OA)).length,n=new ko(t),r=0;r<t;r=r+1|0)n[r]=e.charCodeAt(r);return n},window.TextEncoder||(window.TextEncoder=er),function(e){var t,n,r,i,o,a,s,c,u,l,f,d,p;(n=t||(t={})).LOGIN="LOGIN",n.LOGIN_SUCCESS="LOGIN_SUCCESS",n.LOGIN_FAILURE="LOGIN_FAILURE",n.LOGIN_TIMEOUT="LOGIN_TIMEOUT",n.INTERRUPTED="INTERRUPTED",n.LOGOUT="LOGOUT",n.BANNED_BY_SERVER="BANNED_BY_SERVER",n.REMOTE_LOGIN="REMOTE_LOGIN",n.TOKEN_EXPIRED="TOKEN_EXPIRED",e.ConnectionChangeReason=t,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECTING="RECONNECTING",e.ABORTED="ABORTED"}(r||(r={})),e.ConnectionState=r,function(e){e.IDLE="IDLE",e.SENT_TO_REMOTE="SENT_TO_REMOTE",e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(i||(i={})),e.LocalInvitationState=i,function(e){e.INVITATION_RECEIVED="INVITATION_RECEIVED",e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",e.REFUSED="REFUSED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(o||(o={})),e.RemoteInvitationState=o,function(e){e.UNKNOWN="UNKNOWN",e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",e.INVITATION_EXPIRE="INVITATION_EXPIRE",e.PEER_OFFLINE="PEER_OFFLINE",e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(a||(a={})),e.LocalInvitationFailureReason=a,function(e){e.UNKNOWN="UNKNOWN",e.PEER_OFFLINE="PEER_OFFLINE",e.ACCEPT_FAILURE="ACCEPT_FAILURE",e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(s||(s={})),e.RemoteInvitationFailureReason=s,function(e){e.ONLINE="ONLINE",e.UNREACHABLE="UNREACHABLE",e.OFFLINE="OFFLINE"}(c||(c={})),e.PeerOnlineState=c,function(e){e.UNSUBSCRIBED="UNSUBSCRIBED",e.SUBSCRIBED="SUBSCRIBED"}(u||(u={})),e.subscribedState=u,(l||(l={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=l,function(e){e.TEXT="TEXT",e.RAW="RAW"}(f||(f={})),e.MessageType=f,function(e){e.CN="CN",e.NA="NA",e.EU="EU",e.AS="AS",e.JP="JP",e.IN="IN",e.GLOB="GLOB",e.OC="OC",e.SA="SA",e.AF="AF",e.OVS="OVS"}(d||(d={})),e.LegacyAreaCode=d,function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(p||(p={})),e.AreaCode=p}(lo||(lo={}));var Oa=lo;wa({target:"Array",proto:!0},{includes:function(e){return Ss(this,e,1<arguments.length?arguments[1]:void 0)}}),wf("includes");var mo=function(e){if(gn(e))throw TypeError("The method doesn't accept regular expressions");return e},xF=mb("match"),no=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[xF]=!1,"/./"[e](t)}catch(e){}}return!1};wa({target:"String",proto:!0,forced:!no("includes")},{includes:function(e){return!!~String(Ec(this)).indexOf(mo(e),1<arguments.length?arguments[1]:void 0)}});var Yd={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0,ENABLE_EDGE_AUTO_FALLBACK:!0};Ik("iterator"),Ik("asyncIterator");var oo=gg("forEach")?[].forEach:function(e){return fg(this,e,1<arguments.length?arguments[1]:void 0)},bv;for(bv in Tn){var cv=na[bv],Kk=cv&&cv.prototype;if(Kk&&Kk.forEach!==oo)try{ac(Kk,"forEach",oo)}catch(d){Kk.forEach=oo}}var yF=[].reverse,dv=[1,2];wa({target:"Array",proto:!0,forced:String(dv)===String(dv.reverse())},{reverse:function(){return uf(this)&&(this.length=this.length),yF.call(this)}});var W=kc((function(e){e=function(e){function t(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function n(e,t,n,o){return t=Object.create((t&&t.prototype instanceof i?t:i).prototype),o=new d(o||[]),t._invoke=function(e,t,n){var i=T;return function(o,a){if(i===w)throw Error("Generator is already running");if(i===R){if("throw"===o)throw a;return h()}for(n.method=o,n.arg=a;;){if((o=n.delegate)&&(o=u(o,n))){if(o===O)continue;return o}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===T)throw i=R,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(i=w,"normal"===(o=r(e,t,n)).type){if(i=n.done?R:S,o.arg===O)continue;return{value:o.arg,done:n.done}}"throw"===o.type&&(i=R,n.method="throw",n.arg=o.arg)}}}(e,n,o),t}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach((function(n){t(e,n,(function(e){return this._invoke(n,e)}))}))}function c(e,t){function n(i,o,a,s){if("throw"!==(i=r(e[i],e,o)).type){var c=i.arg;return(i=c.value)&&"object"===Ia(i)&&g.call(i,"__await")?t.resolve(i.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(i).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(i.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function u(e,t){var n=e.iterator[t.method];if(n===v){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=v,u(e,t),"throw"===t.method))return O;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return O}return"throw"===(n=r(n,e.iterator,t.arg)).type?(t.method="throw",t.arg=n.arg,t.delegate=null,O):(n=n.arg)?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,O):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,O)}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function f(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function d(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function p(e){if(e){var t=e[_];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1;return(t=function t(){for(;++n<e.length;)if(g.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=v,t.done=!0,t}).next=t}}return{next:h}}function h(){return{value:v,done:!0}}var v,m=Object.prototype,g=m.hasOwnProperty,E="function"==typeof Symbol?Symbol:{},_=E.iterator||"@@iterator",b=E.asyncIterator||"@@asyncIterator",y=E.toStringTag||"@@toStringTag";try{t({},"")}catch(e){t=function(e,t,n){return e[t]=n}}e.wrap=n;var T="suspendedStart",S="suspendedYield",w="executing",R="completed",O={};t(E={},_,(function(){return this}));var I=Object.getPrototypeOf;(I=I&&I(I(p([]))))&&I!==m&&g.call(I,_)&&(E=I);var A=a.prototype=i.prototype=Object.create(E);return o.prototype=a,t(A,"constructor",a),t(a,"constructor",o),o.displayName=t(a,y,"GeneratorFunction"),e.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,t(e,y,"GeneratorFunction")),e.prototype=Object.create(A),e},e.awrap=function(e){return{__await:e}},s(c.prototype),t(c.prototype,b,(function(){return this})),e.AsyncIterator=c,e.async=function(t,r,i,o,a){void 0===a&&(a=Promise);var s=new c(n(t,r,i,o),a);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},s(A),t(A,y,"Generator"),t(A,_,(function(){return this})),t(A,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t,n=[];for(t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=p,d.prototype={constructor:d,reset:function(e){if(this.next=this.prev=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(f),!e)for(var t in this)"t"===t.charAt(0)&&g.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=v),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=g.call(i,"catchLoc"),s=g.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(n=i?i.completion:{}).type=e,n.arg=t,i?(this.method="next",this.next=i.finallyLoc,O):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),O},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),f(n),O}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){if("throw"===(e=n.completion).type){var r=e.arg;f(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=v),O}},e}(e.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":Ia(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})),ev=!Ga((function(){return Object.isExtensible(Object.preventExtensions({}))})),po=kc((function(e){var t=$b.f,n=ih("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!fb(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Fa(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!Fa(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return ev&&a.REQUIRED&&i(e)&&!Fa(e,n)&&o(e),e}};jh[n]=!0})),fv=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=na[e],s=a&&a.prototype,c=a,u={},l=function(e){var t=s[e];Ob(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!fb(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!fb(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!fb(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(ne(e,"function"!=typeof a||!(i||s.forEach&&!Ga((function(){(new a).entries().next()})))))c=n.getConstructor(t,e,r,o),po.REQUIRED=!0;else if(ne(e,!0)){var f=new c,d=f[o](i?{}:-0,1)!=f,p=Ga((function(){f.has(1)})),h=mk((function(e){new a(e)})),v=!i&&Ga((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));h||((c=t((function(t,n){return Ud(t,c,e),t=Ek(new a,t,c),null!=n&&rk(n,t[o],{that:t,AS_ENTRIES:r}),t}))).prototype=s,s.constructor=c),(p||v)&&(l("delete"),l("has"),r&&l("get")),(v||d)&&l(o),i&&s.clear&&delete s.clear}return u[e]=c,wa({global:!0,forced:c!=a},u),Td(c,e),i||n.setStrong(c,e,r),c},zF=$b.f,gv=po.fastKey,hv=Sb.set,qo=Sb.getterFor,iv={getConstructor:function(e,t,n,r){var i=e((function(e,o){Ud(e,i,t),hv(e,{type:t,index:vd(null),first:void 0,last:void 0,size:0}),cb||(e.size=0),null!=o&&rk(o,e[r],{that:e,AS_ENTRIES:n})})),o=qo(t),a=function(e,t,n){var r,i=o(e),a=s(e,t);return a?a.value=n:(i.last=a={index:r=gv(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=a),t&&(t.next=a),cb?i.size++:e.size++,"F"!==r&&(i.index[r]=a)),e},s=function(e,t){e=o(e);var n=gv(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return qh(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,cb?e.size=0:this.size=0},delete:function(e){var t=o(this);if(e=s(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),cb?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=o(this),r=tf(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),qh(i.prototype,n?{get:function(e){return(e=s(this,e))&&e.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),cb&&zF(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=qo(t),o=qo(r);rn(e,t,(function(e,t){hv(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),Ii(t)}};fv("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),iv);var AF=yi,jv=function(e){return function(t){t=Qc(t);for(var n,r=Ie(t),i=r.length,o=0,a=[];i>o;)n=r[o++],cb&&!AF.call(t,n)||a.push(e?[n,t[n]]:t[n]);return a}},BF=jv(!0),CF=jv(!1);wa({target:"Object",stat:!0},{values:function(e){return CF(e)}});var ro=me("Reflect","apply"),DF=Function.apply,EF=!Ga((function(){ro((function(){}))}));wa({target:"Reflect",stat:!0,forced:EF},{apply:function(e,t,n){return Rc(e),ub(n),ro?ro(e,t,n):DF.call(e,t,n)}}),wa({target:"Reflect",stat:!0},{ownKeys:Us});var kv=mb("isConcatSpreadable"),FF=51<=oe||!Ga((function(){var e=[];return e[kv]=!1,e.concat()[0]!==e})),GF=Fi("concat");wa({target:"Array",proto:!0,forced:!FF||!GF},{concat:function(e){var t,n=Zb(this),r=Ei(n,0),i=0,o=-1;for(t=arguments.length;o<t;o++){var a=-1===o?n:arguments[o],s=a;if(fb(s)){var c=s[kv];s=void 0!==c?!!c:uf(s)}else s=!1;if(s){if(9007199254740991<i+(c=xb(a.length)))throw TypeError("Maximum allowed index exceeded");for(s=0;s<c;s++,i++)s in a&&oh(r,i,a[s])}else{if(9007199254740991<=i)throw TypeError("Maximum allowed index exceeded");oh(r,i++,a)}}return r.length=i,r}});var HF=Yn,IF=Ga((function(){return!Object.getOwnPropertyNames(1)}));wa({target:"Object",stat:!0,forced:IF},{getOwnPropertyNames:HF});var JF=dg.f,KF=pd.f,LF=$b.f,Bf=na.Number,Lk=Bf.prototype,MF="Number"==Qd(vd(Lk)),lv=function(e){var t,n=le(e,!1);if("string"==typeof n&&2<n.length)if(43===(e=(n=kk(n)).charCodeAt(0))||45===e){if(88===(e=n.charCodeAt(2))||120===e)return NaN}else if(48===e){switch(n.charCodeAt(1)){case 66:case 98:e=2;var r=49;break;case 79:case 111:e=8,r=55;break;default:return+n}var i=(n=n.slice(2)).length;for(t=0;t<i;t++){var o=n.charCodeAt(t);if(48>o||o>r)return NaN}return parseInt(n,e)}return+n};if(ne("Number",!Bf(" 0o1")||!Bf("0b1")||Bf("+0x1"))){for(var mg=function e(t){var n=1>arguments.length?0:t,r=this;return r instanceof e&&(MF?Ga((function(){Lk.valueOf.call(r)})):"Number"!=Qd(r))?Ek(new Bf(lv(n)),r,e):lv(n)},mv=cb?JF(Bf):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),so=0,Mk;mv.length>so;so++)Fa(Bf,Mk=mv[so])&&!Fa(mg,Mk)&&LF(mg,Mk,KF(Bf,Mk));mg.prototype=Lk,Lk.constructor=mg,Ob(na,"Number",mg)}var yh="object"===("undefined"==typeof Reflect?"undefined":Ia(Reflect))?Reflect:null,nv=yh&&"function"==typeof yh.apply?yh.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},NF=yh&&"function"==typeof yh.ownKeys?yh.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},ov=Number.isNaN||function(e){return e!=e};kb.EventEmitter=kb,kb.prototype._events=void 0,kb.prototype._eventsCount=0,kb.prototype._maxListeners=void 0;var pv=10;Object.defineProperty(kb,"defaultMaxListeners",{enumerable:!0,get:function(){return pv},set:function(e){if("number"!=typeof e||0>e||ov(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");pv=e}}),kb.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},kb.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||ov(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},kb.prototype.getMaxListeners=function(){return void 0===this._maxListeners?kb.defaultMaxListeners:this._maxListeners},kb.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);n="error"===e;var r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var i;if(0<t.length&&(i=t[0]),i instanceof Error)throw i;throw(t=Error("Unhandled error."+(i?" ("+i.message+")":""))).context=i,t}if(void 0===(n=r[e]))return!1;if("function"==typeof n)nv(n,this,t);else for(r=ir(n,i=n.length),n=0;n<i;++n)nv(r[n],this,t);return!0},kb.prototype.addListener=function(e,t){return fr(this,e,t,!1)},kb.prototype.on=kb.prototype.addListener,kb.prototype.prependListener=function(e,t){return fr(this,e,t,!0)},kb.prototype.once=function(e,t){return Cj(t),this.on(e,gr(this,e,t)),this},kb.prototype.prependOnceListener=function(e,t){return Cj(t),this.prependListener(e,gr(this,e,t)),this},kb.prototype.removeListener=function(e,t){var n;Cj(t);var r=this._events;if(void 0===r)return this;var i=r[e];if(void 0===i)return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){var o=-1;for(n=i.length-1;0<=n;n--)if(i[n]===t||i[n].listener===t){var a=i[n].listener;o=n;break}if(0>o)return this;if(0===o)i.shift();else{for(;o+1<i.length;o++)i[o]=i[o+1];i.pop()}1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},kb.prototype.off=kb.prototype.removeListener,kb.prototype.removeAllListeners=function(e){var t=this._events;if(void 0===t)return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var n=Object.keys(t);for(t=0;t<n.length;++t){var r=n[t];"removeListener"!==r&&this.removeAllListeners(r)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=t[e]))this.removeListener(e,n);else if(void 0!==n)for(t=n.length-1;0<=t;t--)this.removeListener(e,n[t]);return this},kb.prototype.listeners=function(e){return hr(this,e,!0)},kb.prototype.rawListeners=function(e){return hr(this,e,!1)},kb.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):jr.call(e,t)},kb.prototype.listenerCount=jr,kb.prototype.eventNames=function(){return 0<this._eventsCount?NF(this._events):[]},kb.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}kr(e,t,o,{once:!0}),"error"!==t&&QA(e,i,{once:!0})}))};var zh=Object.assign,qv=Object.defineProperty,Vi=!zh||Ga((function(){if(cb&&1!==zh({b:1},zh(qv({},"a",{enumerable:!0,get:function(){qv(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=zh({},e)[n]||"abcdefghijklmnopqrst"!=Ie(zh({},t)).join("")}))?function(e,t){for(var n=Zb(e),r=arguments.length,i=1,o=Ai.f,a=yi;r>i;)for(var s,c=zi(arguments[i++]),u=o?Ie(c).concat(o(c)):Ie(c),l=u.length,f=0;l>f;)s=u[f++],(!cb||a.call(c,s))&&(n[s]=c[s]);return n}:zh;wa({target:"Object",stat:!0,forced:Object.assign!==Vi},{assign:Vi}),fv("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),iv);var OF=Math.log,PF=Math.LN2;wa({target:"Math",stat:!0},{log2:function(e){return OF(e)/PF}});var QF=$b.f,RF=dg.f,SF=Sb.enforce,TF=mb("match"),te=na.RegExp,to=te.prototype,Wi=/a/g,uo=/a/g,vo=new te(Wi)!==Wi;if(cb&&ne("RegExp",!vo||Sd||Ga((function(){return uo[TF]=!1,te(Wi)!=Wi||te(uo)==uo||"/a/i"!=te(Wi,"i")})))){for(var Oe=function e(t,n){var r,i=this instanceof e,o=gn(t),a=void 0===n;return!i&&o&&t.constructor===e&&a||(vo?o&&!a&&(t=t.source):t instanceof e&&(a&&(n=hk.call(t)),t=t.source),Sd&&(r=!!n&&-1<n.indexOf("y"))&&(n=n.replace(/y/g,"")),t=Ek(vo?new te(t,n):te(t,n),i?this:to,e),Sd&&r&&(SF(t).sticky=!0)),t},UF=function(e){e in Oe||QF(Oe,e,{configurable:!0,get:function(){return te[e]},set:function(t){te[e]=t}})},rv=RF(te),sv=0;rv.length>sv;)UF(rv[sv++]);to.constructor=Oe,Oe.prototype=to,Ob(na,"RegExp",Oe)}Ii("RegExp"),Ri("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Ri("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Ri("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Ri("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var wo=function(e,t){return e===t?0:null==e?null==t?0:-1:null==t?null==e?0:1:"function"==typeof e.compare?e.compare(t):"function"==typeof t.compare?-t.compare(e):e<t?-1:e>t?1:0},xo=[],tv=xo.sort,VF=Ga((function(){xo.sort(void 0)})),WF=Ga((function(){xo.sort(null)})),XF=gg("sort");wa({target:"Array",proto:!0,forced:VF||!WF||!XF},{sort:function(e){return void 0===e?tv.call(Zb(this)):tv.call(Zb(this),Rc(e))}});var uv=Object.getPrototypeOf({}),Xi=function(e,t){var n;return e===t||(null==e?e==t:"function"===Ia(e.equiv)?e.equiv(t):null==t?e==t:"function"===Ia(t.equiv)?t.equiv(e):"string"!==Ia(e)&&"string"!==Ia(t)&&(null!=(n=Object.getPrototypeOf(e))&&n!==uv||null!=(n=Object.getPrototypeOf(t))&&n!==uv?"function"!==Ia(e)&&void 0!==e.length&&"function"!==Ia(t)&&void 0!==t.length?ZF(e,t):e instanceof Set&&t instanceof Set?$F(e,t):e instanceof Map&&t instanceof Map?aG(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:YF(e,t)))},ZF=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xi,r=e.length;if(r===t.length)for(;0<=--r&&n(e[r],t[r]););return 0>r},$F=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xi;return e.size===t.size&&n(ra(e.keys()).sort(),ra(t.keys()).sort())},aG=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xi;return e.size===t.size&&n(ra(e).sort(),ra(t).sort())},YF=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xi;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!t.hasOwnProperty(r)||!n(e[r],t[r]))return!1;return!0},vv=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return void 0!==e?": "+e:""};return function(n){function r(n){return ab(this,r),i.call(this,e(n)+t(n))}nb(r,n);var i=ob(r);return r}(di(Error))},bG=vv((function(){return"illegal argument(s)"})),Nk=function(e){throw new bG(e)},yo=vv((function(){return"index out of bounds"})),wv=1/4294967295,cG=function(){function e(){ab(this,e)}return Qb(e,[{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*wv*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*wv-.5)*e}},{key:"minmax",value:function(e,t){return this.float()*(t-e)+e}}]),e}(),zo=Math.random,dG=new(function(e){function t(){return ab(this,t),n.apply(this,arguments)}nb(t,e);var n=ob(t);return Qb(t,[{key:"int",value:function(){return 4294967296*zo()>>>0}},{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return zo()*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(zo()-.5)*e}}]),t}(cG)),hm=Symbol(),nr=function(){},eG=po.onFreeze,Ao=Object.freeze,fG=Ga((function(){Ao(1)}));wa({target:"Object",stat:!0,forced:fG,sham:!ev},{freeze:function(e){return Ao&&fb(e)?Ao(eG(e)):e}});var gG=gg("reduce"),hG=!qe&&79<oe&&83>oe;wa({target:"Array",proto:!0,forced:!gG||hG},{reduce:function(e){return Bu(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var mr=function(e){return null!=e&&"function"==typeof e.xform?e.xform():e},Dj=function(){function e(t){ab(this,e),this.value=t}return Qb(e,[{key:"deref",value:function(){return this.value}}]),e}(),im=function(e){return e instanceof Dj?e.deref():e},SA=function(e,t){return[e,function(e){return e},t]},iG=W.mark((function(e,t){var n,r,i,o,a,s;return W.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=mr(e)(RA()),r=n[1],i=n[2],o=0;case 4:if(!(o<t.length)){c.next=15;break}if(a=t[o],!((s=i([],a))instanceof Dj)){c.next=10;break}return c.delegateYield(im(r(s.deref())),"t0",9);case 9:return c.abrupt("return");case 10:if(!s.length){c.next=12;break}return c.delegateYield(s,"t1",12);case 12:o++,c.next=4;break;case 15:return c.delegateYield(im(r([])),"t2",16);case 16:case"end":return c.stop()}}),iG)})),TA=W.mark(lr),UA=function(e,t){return[e[0],e[1],t]},xv=!0;"findIndex"in[]&&Array(1).findIndex((function(){xv=!1})),wa({target:"Array",proto:!0,forced:xv},{findIndex:function(e){return lt(this,e,1<arguments.length?arguments[1]:void 0)}}),wf("findIndex"),wa({target:"Array",proto:!0},{fill:In}),wf("fill");var jG=function(){function e(t){ab(this,e),this._length=0,t&&this.into(t)}return Qb(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,t=this.head;t;)e=t.next,delete t.value,delete t.prev,delete t.next,t=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var t=this._length;if(t<e._length)return-1;if(t>e._length)return 1;if(0===t)return 0;t=this.head,e=e.head;for(var n=0;t&&0==n;)n=wo(t.value,e.value),t=t.next,e=e.next;return n}},{key:"equiv",value:function(t){if(!(t instanceof e||null!=t&&"function"!=typeof t&&void 0!==t.length)||this._length!==t.length)return!1;if(!this._length||this===t)return!0;for(var n=this.head,r=0;r<t.length;r++){if(!Xi(n.value,t[r]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:W.mark((function e(){var t;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.head;case 1:if(!t){e.next=7;break}return e.next=4,t.value;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"seq",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(e>=t||0>e)){e=this.nthCell(e);var n=this.nthCell(t-1);return t=function e(t){return{first:function(){return t.value},next:function(){return t!==n&&t.next?e(t.next):void 0}}},e?t(e):void 0}}},{key:"cycle",value:W.mark((function e(){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this,"t0",2);case 2:e.next=0;break;case 4:case"end":return e.stop()}}),e,this)}))},{key:"$reduce",value:function(e,t){for(var n=this.head;n&&!(t instanceof Dj);)t=e(t,n.value),n=n.next;return t}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,t){return e||Nk("cell is undefined"),t={value:t,next:e,prev:e.prev},e.prev?e.prev.next=t:this.head=t,e.prev=t,this._length++,this}},{key:"insertAfter",value:function(e,t){return e||Nk("cell is undefined"),t={value:t,next:e.next,prev:e},e.next?e.next.prev=t:this.tail=t,e.next=t,this._length++,this}},{key:"insertBeforeNth",value:function(e,t){if(0>e&&(e+=this._length),0>=e)return this.cons(t);if(0>e||e>=this._length)throw new yo(e);return this.insertBefore(this.nthCellUnsafe(e),t)}},{key:"insertAfterNth",value:function(e,t){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(t);if(0>e||e>=this._length)throw new yo(e);return this.insertAfter(this.nthCellUnsafe(e),t)}},{key:"insertSorted",value:function(e,t){t=t||wo;for(var n=this.head;n;){if(0>=t(e,n.value))return this.insertBefore(n,e);n=n.next}return this.push(e)}},{key:"find",value:function(e){for(var t=this.head;t;){if(t.value===e)return t;t=t.next}}},{key:"findWith",value:function(e){for(var t=this.head;t;){if(e(t.value))return t;t=t.next}}},{key:"concat",value:function(){for(var e=this.copy(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e.into(n[t]);return e}},{key:"into",value:function(e){for(var t=0;t<e.length;t++)this.push(e[t])}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;t=0>t?t+this._length:t,n=0>n?n+this._length:n,(0>t||0>n)&&Nk("invalid indices: ${from} / ${to}");for(var r=new e,i=this.nthCell(t);i&&++t<=n;)r.push(i.value),i=i.next;return r}},{key:"splice",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length?arguments[2]:void 0;if("number"==typeof t){if(0>t&&(t+=this._length),0>t||t>=this._length)throw new yo(t);var i=this.nthCellUnsafe(t)}else i=t;var o=new e;if(0<n)for(;i&&0<n--;)this.remove(i),o.push(i.value),i=i.next;else i&&(i=i.next);if(r)if(i)for(n=0;n<r.length;n++)this.insertBefore(i,r[n]);else for(i=0;i<r.length;i++)this.push(r[i]);return o}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,t){if(e!==t){var n=e.value;e.value=t.value,t.value=n}return this}},{key:"push",value:function(e){return this.tail?(e={value:e,prev:this.tail},this.tail=this.tail.next=e,this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,t){var n=this.nthCell(e);return!n&&Nk("index out of bounds: ".concat(e)),n.value=t,this}},{key:"nth",value:function(e,t){return(e=this.nthCell(e))?e.value:t}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(t){for(var n=new e,r=this.head;r;)n.push(t(r.value)),r=r.next;return n}},{key:"filter",value:function(t){for(var n=new e,r=this.head;r;)t(r.value)&&n.push(r.value),r=r.next;return n}},{key:"reduce",value:function(e,t){for(var n=this.head;n;)t=e(t,n.value),n=n.next;return t}},{key:"shuffle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:dG;if(2>this._length)return this;for(e=null!=e?e:Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var n=this.head;n;){var r=n.next;.5>t.float()?this.asHead(n):this.asTail(n),n=r}return this}},{key:"sort",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:wo;if(!this._length)return this;for(var t=1;;){var n=this.head;this.tail=this.head=void 0;for(var r=0;n;){r++;for(var i=n,o=0,a=0;a<t&&(o++,i=i.next);a++);for(a=t;0<o||0<a&&i;){if(0===o){var s=i;i=i.next,a--}else i&&0!==a?0>=e(n.value,i.value)?(s=n,n=n.next,o--):(s=i,i=i.next,a--):(s=n,n=n.next,o--);this.tail?this.tail.next=s:this.head=s,s.prev=this.tail,this.tail=s}n=i}if(this.tail.next=void 0,1>=r)return this;t*=2}}},{key:"reverse",value:function(){for(var e=this.head,t=this.tail,n=(this._length>>>1)+(1&this._length);e&&t&&0<n;){var r=e.value;e.value=t.value,t.value=r,e=e.next,t=t.prev,n--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],t=this.head;t;)e.push(String(t.value)),t=t.next;return e.join(", ")}},{key:"toJSON",value:function(){return ra(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var t=this.head,n="next";else t=this.tail,n="prev",e=this._length-e-1;for(;0<e--&&t;)t=t[n];return t}}]),e}(),ue=function(){function e(t,n){ab(this,e),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new jG,this._size=0,this.opts=n,t&&this.into(t)}return Qb(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return Ej((function(e){return[e.k,e]}),this.items)}},{key:"keys",value:function(){return Ej((function(e){return e.k}),this.items)}},{key:"values",value:function(){return Ej((function(e){return e.v}),this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var t=e.items.head;t;)e.map.set(t.value.k,t),t=t.next;return e}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var t;t=this.items.drop();)e(t.k,t.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,t){return(e=this.map.get(e))?this.resetEntry(e):t}},{key:"set",value:function(e,t){var n=this.opts.ksize(e)+this.opts.vsize(t),r=this.map.get(e);return this._size+=Math.max(0,n-(r?r.value.s:0)),this.ensureSize()&&this.doSetEntry(r,e,t,n),t}},{key:"into",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(e,t){var n=this,r=this.map.get(e);return r?Promise.resolve(this.resetEntry(r)):t().then((function(t){return n.set(e,t)}))}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,t=this.opts.maxsize,n=this.opts.maxlen;this._size>t||this.length>=n;){var r=this.items.drop();if(!r)return!1;this.map.delete(r.k),e&&e(r.k,r.v),this._size-=r.s}return!0}},{key:"removeEntry",value:function(e){var t=e.value;this.map.delete(t.k),this.items.remove(e),this.opts.release&&this.opts.release(t.k,t.v),this._size-=t.s}},{key:"doSetEntry",value:function(e,t,n,r){e?(e.value.v=n,e.value.s=r,this.items.asTail(e)):(this.items.push({k:t,v:n,s:r}),this.map.set(t,this.items.tail))}}]),e}(),kG=function(e){function t(e,r){return ab(this,t),r=Object.assign({ttl:36e5},r),n.call(this,e,r)}nb(t,e);var n=ob(t);return Qb(t,[{key:"empty",value:function(){return new t(null,this.opts)}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"get",value:function(e,t){if(e=this.map.get(e)){if(e.value.t>=Date.now())return this.resetEntry(e);this.removeEntry(e)}return t}},{key:"set",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.opts.ksize(e)+this.opts.vsize(t),i=this.map.get(e);return this._size+=Math.max(0,r-(i?i.value.s:0)),this.ensureSize()&&(n=Date.now()+n,i?(i.value.v=t,i.value.s=r,i.value.t=n,this.items.asTail(i)):(this.items.push({k:e,v:t,s:r,t:n}),this.map.set(e,this.items.tail))),t}},{key:"getSet",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.get(e);return i?Promise.resolve(i):t().then((function(t){return n.set(e,t,r)}))}},{key:"prune",value:function(){for(var e=Date.now(),t=this.items.head;t;)t.value.t<e&&this.removeEntry(t),t=t.next}},{key:"ensureSize",value:function(){for(var e=this.opts.maxsize,n=this.opts.maxlen,r=Date.now(),i=this.items.head;i&&(this._size>e||this.length>=n);)i.value.t<r&&this.removeEntry(i),i=i.next;return fm(Tf(t.prototype),"ensureSize",this).call(this)}}]),t}(ue),yv="object"==Ia(qb)&&qb&&qb.Object===Object&&qb,lG="object"==("undefined"==typeof self?"undefined":Ia(self))&&self&&self.Object===Object&&self,hd=yv||lG||Function("return this")(),xd=hd.Symbol,zv=Object.prototype,mG=zv.hasOwnProperty,nG=zv.toString,Yi=xd?xd.toStringTag:void 0,oG=Object.prototype.toString,Av=xd?xd.toStringTag:void 0,ng=function(e){if(null==e)e=void 0===e?"[object Undefined]":"[object Null]";else if(Av&&Av in Object(e)){var t=mG.call(e,Yi),n=e[Yi];try{e[Yi]=void 0;var r=!0}catch(e){}var i=nG.call(e);r&&(t?e[Yi]=n:delete e[Yi]),e=i}else e=oG.call(e);return e},Kc=function(e){var t=Ia(e);return null!=e&&("object"==t||"function"==t)},Em=function(e){return!!Kc(e)&&("[object Function]"==(e=ng(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},Bo=hd["__core-js_shared__"],Bv=function(){var e=/[^.]+$/.exec(Bo&&Bo.keys&&Bo.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),pG=Function.prototype.toString,og=function(e){if(null!=e){try{return pG.call(e)}catch(e){}return e+""}return""},qG=/^\[object .+?Constructor\]$/,rG=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),pg=function(e,t){return e=null==e?void 0:e[t],!Kc(e)||Bv&&Bv in e||!(Em(e)?rG:qG).test(og(e))?void 0:e},Zi=pg(Object,"create"),sG=Object.prototype.hasOwnProperty,tG=Object.prototype.hasOwnProperty;Vf.prototype.clear=function(){this.__data__=Zi?Zi(null):{},this.size=0},Vf.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},Vf.prototype.get=function(e){var t=this.__data__;return Zi?"__lodash_hash_undefined__"===(e=t[e])?void 0:e:sG.call(t,e)?t[e]:void 0},Vf.prototype.has=function(e){var t=this.__data__;return Zi?void 0!==t[e]:tG.call(t,e)},Vf.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Zi&&void 0===t?"__lodash_hash_undefined__":t,this};var $i=function(e,t){return e===t||e!=e&&t!=t},Ok=function(e,t){for(var n=e.length;n--;)if($i(e[n][0],t))return n;return-1},uG=Array.prototype.splice;Mg.prototype.clear=function(){this.__data__=[],this.size=0},Mg.prototype.delete=function(e){var t=this.__data__;return!(0>(e=Ok(t,e)))&&(e==t.length-1?t.pop():uG.call(t,e,1),--this.size,!0)},Mg.prototype.get=function(e){var t=this.__data__;return 0>(e=Ok(t,e))?void 0:t[e][1]},Mg.prototype.has=function(e){return-1<Ok(this.__data__,e)},Mg.prototype.set=function(e,t){var n=this.__data__,r=Ok(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var Gj=Mg,aj=pg(hd,"Map"),Pk=function(e,t){e=e.__data__;var n=Ia(t);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map};Ng.prototype.clear=function(){this.size=0,this.__data__={hash:new Vf,map:new(aj||Gj),string:new Vf}},Ng.prototype.delete=function(e){return e=Pk(this,e).delete(e),this.size-=e?1:0,e},Ng.prototype.get=function(e){return Pk(this,e).get(e)},Ng.prototype.has=function(e){return Pk(this,e).has(e)},Ng.prototype.set=function(e,t){var n=Pk(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var Fj=Ng;ei.prototype.add=ei.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},ei.prototype.has=function(e){return this.__data__.has(e)};var Cv=function(e,t,n,r){var i=e.length;for(n+=r?1:-1;r?n--:++n<i;)if(t(e[n],n,e))return n;return-1},vG=function(e){return e!=e},wG=function(e,t){var n;if(n=!(null==e||!e.length)){if(t==t)e:{n=-1;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=Cv(e,vG,0);n=-1<e}return n},xG=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1},yG=function(e,t){return e.has(t)},Ah=pg(hd,"Set"),zG=function(){},Co=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},AG=1/0,BG=Ah&&1/Co(new Ah([,-0]))[1]==AG?function(e){return new Ah(e)}:zG,Do=function(e,t,n){var r=-1,i=wG,o=e.length,a=!0,s=[],c=s;if(n)a=!1,i=xG;else if(200<=o){if(i=t?null:BG(e))return Co(i);a=!1,i=yG,c=new ei}else c=t?[]:s;e:for(;++r<o;){var u=e[r],l=t?t(u):u;if(u=n||0!==u?u:0,a&&l==l){for(var f=c.length;f--;)if(c[f]===l)continue e;t&&c.push(l),s.push(u)}else i(c,l,n)||(c!==s&&c.push(l),s.push(u))}return s},Dv=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},Rg=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};Og.prototype.clear=function(){this.__data__=new Gj,this.size=0},Og.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},Og.prototype.get=function(e){return this.__data__.get(e)},Og.prototype.has=function(e){return this.__data__.has(e)},Og.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Gj){var r=n.__data__;if(!aj||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Fj(r)}return n.set(e,t),this.size=n.size,this};var Qg=Og,cB=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},Qk=function(){try{var e=pg(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),bj=function(e,t,n){"__proto__"==t&&Qk?Qk(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},CG=Object.prototype.hasOwnProperty,sr=function(e,t,n){var r=e[t];CG.call(e,t)&&$i(r,n)&&(void 0!==n||t in e)||bj(e,t,n)},bh=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=r?r(n[s],e[s],s,n,e):void 0;void 0===c&&(c=e[s]),i?bj(n,s,c):sr(n,s,c)}return n},ee=function(e){return null!=e&&"object"==Ia(e)},Ev=function(e){return ee(e)&&"[object Arguments]"==ng(e)},Fv=Object.prototype,DG=Fv.hasOwnProperty,EG=Fv.propertyIsEnumerable,oi=Ev(function(){return arguments}())?Ev:function(e){return ee(e)&&DG.call(e,"callee")&&!EG.call(e,"callee")},lc=Array.isArray,FG=function(){return!1},gi=kc((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e;t=n&&n.exports===t?hd.Buffer:void 0,e.exports=(t?t.isBuffer:void 0)||FG})),GG=/^(?:0|[1-9]\d*)$/,Eo=function(e,t){var n=Ia(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&GG.test(e))&&-1<e&&0==e%1&&e<t},Fo=function(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e},Hb={};Hb["[object Float32Array]"]=Hb["[object Float64Array]"]=Hb["[object Int8Array]"]=Hb["[object Int16Array]"]=Hb["[object Int32Array]"]=Hb["[object Uint8Array]"]=Hb["[object Uint8ClampedArray]"]=Hb["[object Uint16Array]"]=Hb["[object Uint32Array]"]=!0,Hb["[object Arguments]"]=Hb["[object Array]"]=Hb["[object ArrayBuffer]"]=Hb["[object Boolean]"]=Hb["[object DataView]"]=Hb["[object Date]"]=Hb["[object Error]"]=Hb["[object Function]"]=Hb["[object Map]"]=Hb["[object Number]"]=Hb["[object Object]"]=Hb["[object RegExp]"]=Hb["[object Set]"]=Hb["[object String]"]=Hb["[object WeakMap]"]=!1;var HG=function(e){return ee(e)&&Fo(e.length)&&!!Hb[ng(e)]},Rk=function(e){return function(t){return e(t)}},Bh=kc((function(e,t){var n=t&&!t.nodeType&&t;n=(t=n&&e&&!e.nodeType&&e)&&t.exports===n&&yv.process;e:{try{var r=t&&t.require&&t.require("util").types;if(r){var i=r;break e}i=n&&n.binding&&n.binding("util");break e}catch(e){}i=void 0}e.exports=i})),Gv=Bh&&Bh.isTypedArray,om=Gv?Rk(Gv):HG,IG=Object.prototype.hasOwnProperty,Hv=function(e,t){var n=lc(e),r=!n&&oi(e),i=!n&&!r&&gi(e),o=!n&&!r&&!i&&om(e);if(n=n||r||i||o){r=e.length;for(var a=String,s=-1,c=Array(r);++s<r;)c[s]=a(s);r=c}else r=[];for(var u in a=r.length,e)!t&&!IG.call(e,u)||n&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Eo(u,a))||r.push(u);return r},JG=Object.prototype,Go=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||JG)},Iv=function(e,t){return function(n){return e(t(n))}},KG=Iv(Object.keys,Object),LG=Object.prototype.hasOwnProperty,$f=function(e){return null!=e&&Fo(e.length)&&!Em(e)},Wf=function(e){if($f(e))e=Hv(e);else if(Go(e)){var t,n=[];for(t in Object(e))LG.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=KG(e);return e},ZA=function(e,t){return e&&bh(t,Wf(t),e)},MG=Object.prototype.hasOwnProperty,hi=function(e){if($f(e))e=Hv(e,!0);else if(Kc(e)){var t=Go(e),n=[];for(r in e)("constructor"!=r||!t&&MG.call(e,r))&&n.push(r);e=n}else{var r=[];if(null!=e)for(t in Object(e))r.push(t);e=r}return e},XA=function(e,t){return e&&bh(t,hi(t),e)},pr=kc((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e,r=(t=n&&n.exports===t?hd.Buffer:void 0)?t.allocUnsafe:void 0;e.exports=function(e,t){return t?e.slice():(t=e.length,t=r?r(t):new e.constructor(t),e.copy(t),t)}})),jm=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},NG=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o},Jv=function(){return[]},OG=Object.prototype.propertyIsEnumerable,Kv=Object.getOwnPropertySymbols,Ho=Kv?function(e){return null==e?[]:(e=Object(e),NG(Kv(e),(function(t){return OG.call(e,t)})))}:Jv,YA=function(e,t){return bh(e,Ho(e),t)},nm=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},Io=Iv(Object.getPrototypeOf,Object),Lv=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)nm(t,Ho(e)),e=Io(e);return t}:Jv,WA=function(e,t){return bh(e,Lv(e),t)},Mv=function(e,t,n){return t=t(e),lc(e)?t:nm(t,n(e))},km=function(e){return Mv(e,Wf,Ho)},rr=function(e){return Mv(e,hi,Lv)},Jo=pg(hd,"DataView"),Ko=pg(hd,"Promise"),Lo=pg(hd,"WeakMap"),PG=og(Jo),QG=og(aj),RG=og(Ko),SG=og(Ah),TG=og(Lo),qg=ng;(Jo&&"[object DataView]"!=qg(new Jo(new ArrayBuffer(1)))||aj&&"[object Map]"!=qg(new aj)||Ko&&"[object Promise]"!=qg(Ko.resolve())||Ah&&"[object Set]"!=qg(new Ah)||Lo&&"[object WeakMap]"!=qg(new Lo))&&(qg=function(e){var t=ng(e);if(e=(e="[object Object]"==t?e.constructor:void 0)?og(e):"")switch(e){case PG:return"[object DataView]";case QG:return"[object Map]";case RG:return"[object Promise]";case SG:return"[object Set]";case TG:return"[object WeakMap]"}return t});var fi=qg,UG=Object.prototype.hasOwnProperty,VA=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&UG.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Sk=hd.Uint8Array,Mo=function(e){var t=new e.constructor(e.byteLength);return new Sk(t).set(new Sk(e)),t},VG=/\w*$/,Nv=xd?xd.prototype:void 0,Ov=Nv?Nv.valueOf:void 0,cs=function(e,t){return t=t?Mo(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)},$A=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Mo(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return t=n?Mo(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return cs(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return(t=new e.constructor(e.source,VG.exec(e))).lastIndex=e.lastIndex,t;case"[object Symbol]":return Ov?Object(Ov.call(e)):{}}},Pv=Object.create,WG=function(){function e(){}return function(t){return Kc(t)?Pv?Pv(t):(e.prototype=t,t=new e,e.prototype=void 0,t):{}}}(),qr=function(e){return"function"!=typeof e.constructor||Go(e)?{}:WG(Io(e))},XG=function(e){return ee(e)&&"[object Map]"==fi(e)},Qv=Bh&&Bh.isMap,bB=Qv?Rk(Qv):XG,YG=function(e){return ee(e)&&"[object Set]"==fi(e)},Rv=Bh&&Bh.isSet,aB=Rv?Rk(Rv):YG,zb={};zb["[object Arguments]"]=zb["[object Array]"]=zb["[object ArrayBuffer]"]=zb["[object DataView]"]=zb["[object Boolean]"]=zb["[object Date]"]=zb["[object Float32Array]"]=zb["[object Float64Array]"]=zb["[object Int8Array]"]=zb["[object Int16Array]"]=zb["[object Int32Array]"]=zb["[object Map]"]=zb["[object Number]"]=zb["[object Object]"]=zb["[object RegExp]"]=zb["[object Set]"]=zb["[object String]"]=zb["[object Symbol]"]=zb["[object Uint8Array]"]=zb["[object Uint8ClampedArray]"]=zb["[object Uint16Array]"]=zb["[object Uint32Array]"]=!0,zb["[object Error]"]=zb["[object Function]"]=zb["[object WeakMap]"]=!1;var Sg=function(e){return"symbol"==Ia(e)||ee(e)&&"[object Symbol]"==ng(e)},ZG=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$G=/^\w*$/,No=function(e,t){if(lc(e))return!1;var n=Ia(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Sg(e))||$G.test(e)||!ZG.test(e)||null!=t&&e in Object(t)};lm.Cache=Fj;var aH=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bH=/\\(\\)?/g,cH=function(e){var t=(e=lm(e,(function(e){return 500===t.size&&t.clear(),e}))).cache;return e}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(aH,(function(e,n,r,i){t.push(r?i.replace(bH,"$1"):n||e)})),t})),dB=1/0,Sv=xd?xd.prototype:void 0,ur=Sv?Sv.toString:void 0,Tk=function(e,t){return lc(e)?e:No(e,t)?[e]:cH(null==e?"":tr(e))},dH=1/0,cj=function(e){if("string"==typeof e||Sg(e))return e;var t=e+"";return"0"==t&&1/e==-dH?"-0":t},Uk=function(e,t){for(var n=0,r=(t=Tk(t,e)).length;null!=e&&n<r;)e=e[cj(t[n++])];return n&&n==r?e:void 0},eH=function(e,t){if(!(2>(t=Tk(t,e)).length)){var n=t,r=0,i=-1,o=-1,a=n.length;for(0>r&&(r=-r>a?0:a+r),0>(i=i>a?a:i)&&(i+=a),a=r>i?0:i-r>>>0,r>>>=0,i=Array(a);++o<a;)i[o]=n[o+r];e=Uk(e,i)}return(n=null==e)||(n=null==t?0:t.length,n=delete e[cj(n?t[n-1]:void 0)]),n},Tv=Function.prototype.toString,fH=Object.prototype.hasOwnProperty,gH=Tv.call(Object),ds=function(e){return!(!ee(e)||"[object Object]"!=ng(e))&&(null===(e=Io(e))||"function"==typeof(e=fH.call(e,"constructor")&&e.constructor)&&e instanceof e&&Tv.call(e)==gH)},hH=function(e){return ds(e)?void 0:e},Uv=xd?xd.isConcatSpreadable:void 0,eB=function(e){return lc(e)||oi(e)||!!(Uv&&e&&e[Uv])},iH=function(e){return null!=e&&e.length?mm(e,1):[]},jH=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},Vv=Math.max,Wv=function(e,t,n){return t=Vv(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Vv(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];for(i=-1,o=Array(t+1);++i<t;)o[i]=r[i];return o[t]=n(a),jH(e,this,o)}},kH=function(e){return function(){return e}},Vk=function(e){return e},lH=Date.now,Xv=function(e){var t=0,n=0;return function(){var r=lH(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Qk?function(e,t){return Qk(e,"toString",{configurable:!0,enumerable:!1,value:kH(t),writable:!0})}:Vk),Oo=(e=function(e,t){var n={};if(null==e)return n;var r=!1;t=Rg(t,(function(t){return t=Tk(t,e),r||(r=1<t.length),t})),bh(e,rr(e),n),r&&(n=Pg(n,7,hH));for(var i=t.length;i--;)eH(n,t[i]);return n},Xv(Wv(e,void 0,iH),e+"")),mH=function(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r},bs=function(e,t,n){for(var r=-1,i=Object(e),o=(n=n(e)).length;o--;){var a=n[++r];if(!1===t(i[a],a,i))break}return e},Yv=function(e,t){return e&&bs(e,t,Wf)},Po=function(e,t){return function(t,n){if(null==t)return t;if(!$f(t))return e(t,n);for(var r=t.length,i=-1,o=Object(t);++i<r&&!1!==n(o[i],i,o););return t}}(Yv),nH=function(e,t,n,r){return Po(e,(function(e,i,o){t(r,e,n(e),o)})),r},Zv=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},vr=function(e,t,n,r,i,o){var a=1&n,s=e.length,c=t.length;if(s!=c&&!(a&&c>s))return!1;c=o.get(e);var u=o.get(t);if(c&&u)return c==t&&u==e;c=-1,u=!0;var l=2&n?new ei:void 0;for(o.set(e,t),o.set(t,e);++c<s;){var f=e[c],d=t[c];if(r)var p=a?r(d,f,c,t,e,o):r(f,d,c,e,t,o);if(void 0!==p){if(p)continue;u=!1;break}if(l){if(!Zv(t,(function(e,t){if(!l.has(t)&&(f===e||i(f,e,n,r,o)))return l.push(t)}))){u=!1;break}}else if(f!==d&&!i(f,d,n,r,o)){u=!1;break}}return o.delete(e),o.delete(t),u},oH=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},$v=xd?xd.prototype:void 0,Qo=$v?$v.valueOf:void 0,fB=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!o(new Sk(e),new Sk(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $i(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=oH;case"[object Set]":if(s||(s=Co),e.size!=t.size&&!(1&r))break;return(n=a.get(e))?n==t:(r|=2,a.set(e,t),t=vr(s(e),s(t),r,i,o,a),a.delete(e),t);case"[object Symbol]":if(Qo)return Qo.call(e)==Qo.call(t)}return!1},gB=Object.prototype.hasOwnProperty,wr=Object.prototype.hasOwnProperty,pH=function(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var c=(s=n[i])[0],u=e[c],l=s[1];if(a&&s[2]){if(void 0===u&&!(c in e))return!1}else{if(s=new Qg,r)var f=r(u,l,c,e,t,s);if(void 0===f?!Tg(l,u,3,r,s):!f)return!1}}return!0},qH=function(e){for(var t=Wf(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!Kc(i)]}return t},aw=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},rH=function(e){var t=qH(e);return 1==t.length&&t[0][2]?aw(t[0][0],t[0][1]):function(n){return n===e||pH(n,e,t)}},sH=function(e,t){return No(e)&&t==t&&!Kc(t)?aw(cj(e),t):function(n){var r=null==n?void 0:Uk(n,e);if(void 0===(r=void 0===r?void 0:r)&&r===t){if(r=null!=n){for(var i=-1,o=(r=Tk(r=e,n)).length,a=!1;++i<o;){var s=cj(r[i]);if(!(a=null!=n&&null!=n&&s in Object(n)))break;n=n[s]}r=a||++i!=o?a:!!(o=null==n?0:n.length)&&Fo(o)&&Eo(s,o)&&(lc(n)||oi(n))}s=r}else s=Tg(t,r,3);return s}},tH=function(e){return function(t){return null==t?void 0:t[e]}},uH=function(e){return function(t){return Uk(t,e)}},Ch=function(e){return"function"==typeof e?e:null==e?Vk:"object"==Ia(e)?lc(e)?sH(e[0],e[1]):rH(e):No(e)?tH(cj(e)):uH(e)},Ro=function(e,t){return function(t,n){return(lc(t)?mH:nH)(t,e,Ch(n),{})}}((function(e,t,n){bj(e,n,t)})),Pe=function(e,t){var n={};return t=Ch(t),Yv(e,(function(e,r,i){bj(n,r,t(e,r,i))})),n},e;wa({target:"String",proto:!0,forced:Ga((function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length}))},{sub:function(){return"<sub>"+String(Ec(this))+"</sub>"}});var D=Ab,yd=null;try{yd=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(d){}Ab.prototype.__isLong__,Object.defineProperty(Ab.prototype,"__isLong__",{value:!0}),Ab.isLong=Lc;var yr={},xr={};Ab.fromInt=Xf,Ab.fromNumber=qd,Ab.fromBits=Bb;var Hj=Math.pow;Ab.fromString=pm,Ab.fromValue=Nd;var Ug=4294967296,zr=Ug*Ug,Br=zr/2,bw=Xf(16777216),rd=Xf(0);Ab.ZERO=rd;var Yf=Xf(0,!0);Ab.UZERO=Yf;var Dh=Xf(1);Ab.ONE=Dh;var cw=Xf(1,!0);Ab.UONE=cw;var So=Xf(-1);Ab.NEG_ONE=So;var Cr=Bb(-1,2147483647,!1);Ab.MAX_VALUE=Cr;var Ar=Bb(-1,-1,!0);Ab.MAX_UNSIGNED_VALUE=Ar;var Mc=Bb(0,-2147483648,!1);Ab.MIN_VALUE=Mc;var sa=Ab.prototype;sa.toInt=function(){return this.unsigned?this.low>>>0:this.low},sa.toNumber=function(){return this.unsigned?(this.high>>>0)*Ug+(this.low>>>0):this.high*Ug+(this.low>>>0)},sa.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Mc)){var t=qd(e),n=this.div(t);return t=n.mul(t).sub(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}n=qd(Hj(e,6),this.unsigned),t=this;for(var r="";;){var i=t.div(n),o=(t.sub(i.mul(n)).toInt()>>>0).toString(e);if((t=i).isZero())return o+r;for(;6>o.length;)o="0"+o;r=""+o+r}},sa.getHighBits=function(){return this.high},sa.getHighBitsUnsigned=function(){return this.high>>>0},sa.getLowBits=function(){return this.low},sa.getLowBitsUnsigned=function(){return this.low>>>0},sa.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Mc)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},sa.isZero=function(){return 0===this.high&&0===this.low},sa.eqz=sa.isZero,sa.isNegative=function(){return!this.unsigned&&0>this.high},sa.isPositive=function(){return this.unsigned||0<=this.high},sa.isOdd=function(){return 1==(1&this.low)},sa.isEven=function(){return 0==(1&this.low)},sa.equals=function(e){return Lc(e)||(e=Nd(e)),(this.unsigned===e.unsigned||1!=this.high>>>31||1!=e.high>>>31)&&this.high===e.high&&this.low===e.low},sa.eq=sa.equals,sa.notEquals=function(e){return!this.eq(e)},sa.neq=sa.notEquals,sa.ne=sa.notEquals,sa.lessThan=function(e){return 0>this.comp(e)},sa.lt=sa.lessThan,sa.lessThanOrEqual=function(e){return 0>=this.comp(e)},sa.lte=sa.lessThanOrEqual,sa.le=sa.lessThanOrEqual,sa.greaterThan=function(e){return 0<this.comp(e)},sa.gt=sa.greaterThan,sa.greaterThanOrEqual=function(e){return 0<=this.comp(e)},sa.gte=sa.greaterThanOrEqual,sa.ge=sa.greaterThanOrEqual,sa.compare=function(e){if(Lc(e)||(e=Nd(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},sa.comp=sa.compare,sa.negate=function(){return!this.unsigned&&this.eq(Mc)?Mc:this.not().add(Dh)},sa.neg=sa.negate,sa.add=function(e){Lc(e)||(e=Nd(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=e.high>>>16,o=65535&e.high,a=e.low>>>16;return r=(a=((e=(65535&this.low)+(65535&e.low))>>>16)+(r+a))>>>16,Bb((65535&a)<<16|65535&e,(t=((r+=n+o)>>>16)+(t+i)&65535)<<16|65535&r,this.unsigned)},sa.subtract=function(e){return Lc(e)||(e=Nd(e)),this.add(e.neg())},sa.sub=sa.subtract,sa.multiply=function(e){if(this.isZero())return rd;if(Lc(e)||(e=Nd(e)),yd){var t=yd.mul(this.low,this.high,e.low,e.high);return Bb(t,yd.get_high(),this.unsigned)}if(e.isZero())return rd;if(this.eq(Mc))return e.isOdd()?Mc:rd;if(e.eq(Mc))return this.isOdd()?Mc:rd;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(bw)&&e.lt(bw))return qd(this.toNumber()*e.toNumber(),this.unsigned);t=this.high>>>16;var n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,a=65535&e.high,s=e.low>>>16,c=i*(e=65535&e.low),u=(c>>>16)+r*e,l=u>>>16;l+=(u=(65535&u)+i*s)>>>16;var f=(l+=n*e)>>>16;return Bb((65535&u)<<16|65535&c,(f=(f+=(l=(65535&l)+r*s)>>>16)+((l=(65535&l)+i*a)>>>16)+(t*e+n*s+r*a+i*o)&65535)<<16|65535&l,this.unsigned)},sa.mul=sa.multiply,sa.divide=function(e){if(Lc(e)||(e=Nd(e)),e.isZero())throw Error("division by zero");if(yd)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?Bb(e=(this.unsigned?yd.div_u:yd.div_s)(this.low,this.high,e.low,e.high),yd.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Yf:rd;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Yf;if(e.gt(this.shru(1)))return cw;var t=Yf}else{if(this.eq(Mc)){if(e.eq(Dh)||e.eq(So))return Mc;if(e.eq(Mc))return Dh;var n=this.shr(1).div(e).shl(1);if(n.eq(rd))return e.isNegative()?Dh:So;var r=this.sub(e.mul(n));return n.add(r.div(e))}if(e.eq(Mc))return this.unsigned?Yf:rd;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();t=rd}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:Hj(2,i-48);for(var o=qd(n),a=o.mul(e);a.isNegative()||a.gt(r);)a=(o=qd(n-=i,this.unsigned)).mul(e);o.isZero()&&(o=Dh),t=t.add(o),r=r.sub(a)}return t},sa.div=sa.divide,sa.modulo=function(e){return Lc(e)||(e=Nd(e)),yd?Bb(e=(this.unsigned?yd.rem_u:yd.rem_s)(this.low,this.high,e.low,e.high),yd.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},sa.mod=sa.modulo,sa.rem=sa.modulo,sa.not=function(){return Bb(~this.low,~this.high,this.unsigned)},sa.and=function(e){return Lc(e)||(e=Nd(e)),Bb(this.low&e.low,this.high&e.high,this.unsigned)},sa.or=function(e){return Lc(e)||(e=Nd(e)),Bb(this.low|e.low,this.high|e.high,this.unsigned)},sa.xor=function(e){return Lc(e)||(e=Nd(e)),Bb(this.low^e.low,this.high^e.high,this.unsigned)},sa.shiftLeft=function(e){return Lc(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?Bb(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Bb(0,this.low<<e-32,this.unsigned)},sa.shl=sa.shiftLeft,sa.shiftRight=function(e){return Lc(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?Bb(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Bb(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},sa.shr=sa.shiftRight,sa.shiftRightUnsigned=function(e){if(Lc(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return 32>e?Bb(this.low>>>e|t<<32-e,t>>>e,this.unsigned):Bb(32===e?t:t>>>e-32,0,this.unsigned)},sa.shru=sa.shiftRightUnsigned,sa.shr_u=sa.shiftRightUnsigned,sa.toSigned=function(){return this.unsigned?Bb(this.low,this.high,!1):this},sa.toUnsigned=function(){return this.unsigned?this:Bb(this.low,this.high,!0)},sa.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},sa.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},sa.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Ab.fromBytes=function(e,t,n){return n?Ab.fromBytesLE(e,t):Ab.fromBytesBE(e,t)},Ab.fromBytesLE=function(e,t){return new Ab(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Ab.fromBytesBE=function(e,t){return new Ab(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var _qm=function(e,t){return(_qm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},To=!1,sd={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):To&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),To=e},get useDeprecatedSynchronousErrorHandling(){return To}},Wk={closed:!0,next:function(e){},error:function(e){if(sd.useDeprecatedSynchronousErrorHandling)throw e;Wg(e)},complete:function(){}},td=Array.isArray||function(e){return e&&"number"==typeof e.length},ii=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),dc=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(Vg(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var a=e instanceof ii?Dr(e.errors):[e]}}if(td(i))for(o=-1,t=i.length;++o<t;)if(rm(n=i[o]))try{n.unsubscribe()}catch(e){a=a||[],e instanceof ii?a=a.concat(Dr(e.errors)):a.push(e)}if(a)throw new ii(a)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(Ia(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),Xk="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),hb=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=Wk;break;case 1:if(!n){o.destination=Wk;break}if("object"===Ia(n)){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new dw(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new dw(o,n,r,i)}return o}return Ca(t,e),t.prototype[Xk]=function(){return this},t.create=function(e,n,r){return(e=new t(e,n,r)).syncErrorThrowable=!1,e},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=e,this},t}(dc),dw=function(e){function t(t,n,r,i){var o=e.call(this)||this;if(o._parentSubscriber=t,t=o,Vg(n))var a=n;else n&&(a=n.next,r=n.error,i=n.complete,n!==Wk&&(Vg((t=Object.create(n)).unsubscribe)&&o.add(t.unsubscribe.bind(t)),t.unsubscribe=o.unsubscribe.bind(o)));return o._context=t,o._next=a,o._error=r,o._complete=i,o}return Ca(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;sd.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=sd.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?this.__tryOrSetError(t,this._error,e):this.__tryOrUnsub(this._error,e),this.unsubscribe();else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Wg(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Wg(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};sd.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,n):this.__tryOrUnsub(n)}this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),sd.useDeprecatedSynchronousErrorHandling)throw e;Wg(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!sd.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{t.call(this._context,n)}catch(t){return sd.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0):Wg(t),!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._parentSubscriber=this._context=null,e.unsubscribe()},t}(hb),Xg="function"==typeof Symbol&&Symbol.observable||"@@observable",Za=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator;e:{if(e){if(e instanceof hb)break e;if(e[Xk]){e=e[Xk]();break e}}e=e||t||n?new hb(e,t,n):new hb(Wk)}if(r?e.add(r.call(e,this.source)):e.add(this.source||sd.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),sd.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){sd.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),sm(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Fr(t))((function(t,r){var i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Xg]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Er(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Fr(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}(),Cf=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),ew=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return Ca(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;this.subject=null,!t||0===t.length||e.isStopped||e.closed||-1!==(e=t.indexOf(this.subscriber))&&t.splice(e,1)}},t}(dc),fw=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return Ca(t,e),t}(hb),ec=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ca(t,e),t.prototype[Xk]=function(){return new fw(this)},t.prototype.lift=function(e){var t=new gw(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Cf;if(!this.isStopped){var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].next(e)}},t.prototype.error=function(e){if(this.closed)throw new Cf;this.hasError=!0,this.thrownError=e,this.isStopped=!0;var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Cf;this.isStopped=!0;var e=this.observers,t=e.length;e=e.slice();for(var n=0;n<t;n++)e[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Cf;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Cf;return this.hasError?(e.error(this.thrownError),dc.EMPTY):this.isStopped?(e.complete(),dc.EMPTY):(this.observers.push(e),new ew(this,e))},t.prototype.asObservable=function(){var e=new Za;return e.source=this,e},t.create=function(e,t){return new gw(e,t)},t}(Za),gw=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Ca(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):dc.EMPTY},t}(ec),hB=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;return n._refCount++,e=new vH(e,n),t=t.subscribe(e),e.closed||(e.connection=n.connect()),t},e}(),vH=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return Ca(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null},t}(hb),hw=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return Ca(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new dc).add(this.source.subscribe(new wH(this.getSubject(),this))),e.closed&&(this._connection=null,e=dc.EMPTY)),e},t.prototype.refCount=function(){return Gr()(this)},t}(Za),WB=function(){var e=hw.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),wH=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return Ca(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(fw);!function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}Ca(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null}}(hb),function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).keySelector=n,t.elementSelector=r,t.durationSelector=i,t.subjectSelector=o,t.groups=null,t.attemptedToUnsubscribe=!1,t.count=0,t}Ca(t,e),t.prototype._next=function(e){try{var t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r=n.get(t);if(this.elementSelector)try{var i=this.elementSelector(e)}catch(e){this.error(e)}else i=e;if(!r&&(r=this.subjectSelector?this.subjectSelector():new ec,n.set(t,r),e=new Uo(t,r,this),this.destination.next(e),this.durationSelector)){e=void 0;try{e=this.durationSelector(new Uo(t,r))}catch(e){return void this.error(e)}this.add(e.subscribe(new xH(t,r,this)))}r.closed||r.next(i)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))}}(hb);var xH=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return Ca(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(hb),Uo=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return Ca(t,e),t.prototype._subscribe=function(e){var t=new dc,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new yH(n)),t.add(r.subscribe(e)),t},t}(Za),yH=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return Ca(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),--t.count,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(dc),zH=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return Ca(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Cf;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(ec),dj=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return Ca(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return Ca(t,e),t.prototype.schedule=function(e,t){return this},t}(dc)),AH=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Ca(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),0<n?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return 0<n||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(dj),Vo=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),ej=function(e){function t(n,r){void 0===r&&(r=Vo.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return Ca(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Vo),fj=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ca(t,e),t}(ej))(AH),$c=new Za((function(e){return e.complete()})),Hr=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},Wo;!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(Wo||(Wo={}));var Eh=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return Wb(this.value);case"E":return Va(this.error);case"C":return ji()}throw Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),lB=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new iw(e,this.scheduler,this.delay))},e}(),iw=function(e){function t(t,n,r){return void 0===r&&(r=0),(t=e.call(this,t)||this).scheduler=n,t.delay=r,t}return Ca(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new BH(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Eh.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Eh.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Eh.createComplete()),this.unsubscribe()},t}(hb),BH=function(e,t){this.notification=e,this.destination=t},ah=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>t?1:t,i._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return Ca(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new CH(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;if(this.closed)throw new Cf;if(this.isStopped||this.hasError)var o=dc.EMPTY;else this.observers.push(e),o=new ew(this,e);if(r&&e.add(e=new iw(e,r)),t)for(t=0;t<i&&!e.closed;t++)e.next(n[t]);else for(t=0;t<i&&!e.closed;t++)e.next(n[t].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),o},t.prototype._getNow=function(){return(this.scheduler||fj).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),0<o&&r.splice(0,o),r},t}(ec),CH=function(e,t){this.time=e,this.value=t},li=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return Ca(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),dc.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),dc.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(ec),DH=1,EH=Promise.resolve(),vm={},jw={setImmediate:function(e){var t=DH++;return vm[t]=!0,EH.then((function(){return Ir(t)&&e()})),t},clearImmediate:function(e){Ir(e)}},FH=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Ca(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=jw.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(jw.clearImmediate(n),t.scheduled=void 0)},t}(dj),Fm=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ca(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(ej))(FH),GH=Fm,Xo=new ej(dj),Ee=Xo,HH=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Ca(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(dj),kw=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ca(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(ej))(HH),IH=function(e){function t(t,n){void 0===t&&(t=lw),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return Ca(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(ej),lw=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return Ca(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),this.delay=e.frame+r,(e=e.actions).push(this),e.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(dj),Yo=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),Lj=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),ad=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),mB=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new JH(e,this.project,this.thisArg))},e}(),JH=function(e){function t(t,n,r){return(t=e.call(this,t)||this).project=n,t.count=0,t.thisArg=r||t,t}return Ca(t,e),t.prototype._next=function(e){try{var t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(hb),Zo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ca(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(hb),rB=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return Ca(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(hb),KH=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Wg),t}},kf="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",LH=function(e){return function(t){for(var n=e[kf]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t}},MH=function(e){return function(t){var n=e[Xg]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},Or=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},mi=function(e){if(e&&"function"==typeof e[Xg])return MH(e);if(Or(e))return Hr(e);if(Mr(e))return KH(e);if(e&&"function"==typeof e[kf])return LH(e);throw e=rm(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},mw={},OH=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new NH(e,this.resultSelector))},e}(),NH=function(e){function t(t,n){return(t=e.call(this,t)||this).resultSelector=n,t.active=0,t.values=[],t.observables=[],t}return Ca(t,e),t.prototype._next=function(e){this.values.push(mw),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.toRespond=this.active=t;for(var n=0;n<t;n++)this.add(wm(this,e[n],void 0,n))}},t.prototype.notifyComplete=function(e){0==--this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=(e=this.values)[n];r=this.toRespond?r===mw?--this.toRespond:this.toRespond:0,e[n]=t,0===r&&(this.resultSelector?this._tryResultSelector(e):this.destination.next(e.slice()))},t.prototype._tryResultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Zo),Qe=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return Ca(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(hb);!function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}Ca(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(hb);var Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ca(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(hb);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Ca(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(hb);var vB=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new PH(e,this.project,this.concurrent))},e}(),PH=function(e){function t(t,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),(t=e.call(this,t)||this).project=n,t.concurrent=r,t.hasCompleted=!1,t.buffer=[],t.active=0,t.index=0,t}return Ca(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new Qe(this),n=this.destination;n.add(t),(e=De(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(Re),$o=na.parseFloat,nw=-1/0!=1/$o("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff-0")?function(e){e=kk(String(e));var t=$o(e);return 0===t&&"-"==e.charAt(0)?-0:t}:$o;wa({global:!0,forced:parseFloat!=nw},{parseFloat:nw});var ap=new Za(fe),AB=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new QH(e,this.predicate,this.thisArg))},e}(),QH=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.thisArg=r,t.count=0,t}return Ca(t,e),t.prototype._next=function(e){try{var t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(hb),BB=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new RH(e))},e}(),RH=function(e){function t(t){return(t=e.call(this,t)||this).hasFirst=!1,t.observables=[],t.subscriptions=[],t}return Ca(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=wm(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){for(this.hasFirst=!0,e=0;e<this.subscriptions.length;e++)if(e!==n){var r=this.subscriptions[e];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(t)},t}(Zo),EB=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new SH(e,this.resultSelector))},e}(),SH=function(e){function t(t,n,r){return(t=e.call(this,t)||this).resultSelector=n,t.iterators=[],t.active=0,t.resultSelector="function"==typeof n?n:void 0,t}return Ca(t,e),t.prototype._next=function(e){var t=this.iterators;td(e)?t.push(new TH(e)):"function"==typeof e[kf]?t.push(new UH(e[kf]())):t.push(new VH(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0===t)this.destination.complete();else{this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){var i=e[r];if("function"==typeof i.hasValue&&!i.hasValue())return}var o=!1,a=[];for(r=0;r<t;r++){var s=(i=e[r]).next();if(i.hasCompleted()&&(o=!0),s.done)return void n.complete();a.push(s.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),o&&n.complete()},t.prototype._tryresultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(hb),UH=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},e}(),TH=function(){function e(e){this.array=e,this.length=this.index=0,this.length=e.length}return e.prototype[kf]=function(){return this},e.prototype.next=function(e){e=this.index++;var t=this.array;return e<this.length?{value:t[e],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),VH=function(e){function t(t,n,r){return(t=e.call(this,t)||this).parent=n,t.observable=r,t.stillUnsubscribed=!0,t.buffer=[],t.isComplete=!1,t}return Ca(t,e),t.prototype[kf]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return 0<this.buffer.length},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return De(this.observable,new Qe(this))},t}(Re),WH=Object.freeze({__proto__:null,Observable:Za,ConnectableObservable:hw,GroupedObservable:Uo,observable:Xg,Subject:ec,BehaviorSubject:zH,ReplaySubject:ah,AsyncSubject:li,asap:GH,asapScheduler:Fm,async:Ee,asyncScheduler:Xo,queue:fj,queueScheduler:fj,animationFrame:kw,animationFrameScheduler:kw,VirtualTimeScheduler:IH,VirtualAction:lw,Scheduler:Vo,Subscription:dc,Subscriber:hb,Notification:Eh,get NotificationKind(){return Wo},pipe:tm,noop:fe,identity:jf,isObservable:function(e){return!!e&&(e instanceof Za||"function"==typeof e.lift&&"function"==typeof e.subscribe)},ArgumentOutOfRangeError:Yo,EmptyError:Lj,ObjectUnsubscribedError:Cf,UnsubscriptionError:ii,TimeoutError:ad,bindCallback:Jr,bindNodeCallback:Kr,combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=t=void 0;return Ce(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&td(e[0])&&(e=e[0]),ki(e,n).lift(new OH(t))},concat:Pr,defer:lf,empty:ji,forkJoin:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(td(n))return Jj(n,null);if(rm(n)&&Object.getPrototypeOf(n)===Object.prototype)return Jj((e=Object.keys(n)).map((function(e){return n[e]})),e)}if("function"==typeof e[e.length-1]){var r=e.pop();return Jj(e=1===e.length&&td(e[0])?e[0]:e,null).pipe(Wa((function(e){return r.apply(void 0,e)})))}return Jj(e,null)},from:ge,fromEvent:Bc,fromEventPattern:Rr,generate:function(e,t,n,r,i){if(1==arguments.length){var o=e.initialState;t=e.condition,n=e.iterate;var a=e.resultSelector||jf;i=e.scheduler}else void 0===r||Ce(r)?(o=e,a=jf,i=r):(o=e,a=r);return new Za((function(e){var r=o;if(i)return i.schedule(wB,0,{subscriber:e,iterate:n,condition:t,resultSelector:a,state:r});for(;;){if(t){var s=void 0;try{s=t(r)}catch(t){e.error(t);break}if(!s){e.complete();break}}s=void 0;try{s=a(r)}catch(t){e.error(t);break}if(e.next(s),e.closed)break;try{r=n(r)}catch(t){e.error(t);break}}}))},iif:function(e,t,n){return void 0===t&&(t=$c),void 0===n&&(n=$c),lf((function(){return e()?t:n}))},interval:Yg,merge:Nc,never:function(){return ap},of:Wb,onErrorResumeNext:ym,pairs:function(e,t){return new Za(t?function(n){var r=Object.keys(e),i=new dc;return i.add(t.schedule(yB,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},partition:function(e,t,n){return[sc(t,n)(new Za(mi(e))),sc(zB(t,n))(new Za(mi(e)))]},race:bb,range:function(e,t,n){return void 0===e&&(e=0),new Za((function(r){void 0===t&&(t=e,e=0);var i=0,o=e;if(n)return n.schedule(CB,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(o++),r.closed)break}}))},throwError:Va,timer:Fe,using:function(e,t){return new Za((function(n){try{var r=e()}catch(e){return void n.error(e)}try{var i=t(r)}catch(e){return void n.error(e)}var o=(i?ge(i):$c).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},zip:zm,scheduled:Nr,EMPTY:$c,NEVER:ap,config:sd}),FB=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new XH(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),YH=function(){this.buffer=[]},XH=function(e){function t(t,n,r,i,o){if((t=e.call(this,t)||this).bufferTimeSpan=n,t.bufferCreationInterval=r,t.maxBufferSize=i,t.scheduler=o,t.contexts=[],i=t.openContext(),t.timespanOnly=null==r||0>r,t.timespanOnly)t.add(i.closeAction=o.schedule(Sr,n,{subscriber:t,context:i,bufferTimeSpan:n}));else{var a={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:t,scheduler:o};t.add(i.closeAction=o.schedule(Tr,n,{subscriber:t,context:i})),t.add(o.schedule(GB,r,a))}return t}return Ca(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],a=o.buffer;a.push(e),a.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;0<t.length;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){if(this.closeContext(e),(e=e.closeAction).unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){e=this.openContext();var t=this.bufferTimeSpan;this.add(e.closeAction=this.scheduler.schedule(Sr,t,{subscriber:this,context:e,bufferTimeSpan:t}))}},t.prototype.openContext=function(){var e=new YH;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;0<=(t?t.indexOf(e):-1)&&t.splice(t.indexOf(e),1)},t}(hb),HB=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new ZH(e,this.selector,this.caught))},e}(),ZH=function(e){function t(t,n,r){return(t=e.call(this,t)||this).selector=n,t.caught=r,t}return Ca(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),t=new Qe(this),this.add(t),(n=De(n,t))!==t&&this.add(n)}},t}(Re),IB=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new $H(e,this.defaultValue))},e}(),$H=function(e){function t(t,n){return(t=e.call(this,t)||this).defaultValue=n,t.isEmpty=!0,t}return Ca(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(hb),JB=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new aI(e,this.delay,this.scheduler))},e}(),aI=function(e){function t(t,n,r){return(t=e.call(this,t)||this).delay=n,t.scheduler=r,t.queue=[],t.active=!1,t.errored=!1,t}return Ca(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;0<n.length&&0>=n[0].time-r.now();)n.shift().notification.observe(i);0<n.length?(t=Math.max(0,n[0].time-r.now()),this.schedule(e,t)):(this.unsubscribe(),t.active=!1)},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler;e=new bI(t.now()+this.delay,e),this.queue.push(e),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(Eh.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(Eh.createComplete()),this.unsubscribe()},t}(hb),bI=function(e,t){this.time=e,this.notification=t},KB=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new cI(e,this.keySelector,this.flushes))},e}(),cI=function(e){function t(t,n,r){return(t=e.call(this,t)||this).keySelector=n,t.values=new Set,r&&t.add(De(r,new Qe(t))),t}return Ca(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t=this.destination;try{var n=this.keySelector(e)}catch(e){return void t.error(e)}this._finalizeNext(n,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(Re),MB=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new dI(e,this.errorFactory))},e}(),dI=function(e){function t(t,n){return(t=e.call(this,t)||this).errorFactory=n,t.hasValue=!1,t}return Ca(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(hb),NB=function(){function e(e){if(this.total=e,0>this.total)throw new Yo}return e.prototype.call=function(e,t){return t.subscribe(new eI(e,this.total))},e}(),eI=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.count=0,t}return Ca(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(hb),OB=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new fI(e,this.callback))},e}(),fI=function(e){function t(t,n){return(t=e.call(this,t)||this).add(new dc(n)),t}return Ca(t,e),t}(hb),QB=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new gI(e))},e}(),gI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ca(t,e),t.prototype._next=function(e){},t}(hb),RB=function(){function e(e){if(this.total=e,0>this.total)throw new Yo}return e.prototype.call=function(e,t){return t.subscribe(new hI(e,this.total))},e}(),hI=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.ring=[],t.count=0,t}return Ca(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(0<t)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(hb),SB=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new iI(e,this.value))},e}(),iI=function(e){function t(t,n){return(t=e.call(this,t)||this).value=n,t}return Ca(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(hb),TB=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new jI(e,this.accumulator,this.seed,this.hasSeed))},e}(),jI=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this).accumulator=n,t._seed=r,t.hasSeed=i,t.index=0,t}return Ca(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=n,this.destination.next(n)},t}(hb),VB=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory();return(e=n(r).subscribe(e)).add(t.subscribe(r)),e},e}(),XB=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new kI(e,this.notifier,this.source))},e}(),kI=function(e){function t(t,n,r){return(t=e.call(this,t)||this).notifier=n,t.source=r,t}return Ca(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.retriesSubscription=this.errors=void 0;else{n=new ec;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=De(r,new Qe(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(Re),$B=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new lI(e,this.project))},e}(),lI=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.index=0,t}return Ca(t,e),t.prototype._next=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this._innerSub(n)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),t=new Qe(this);var n=this.destination;n.add(t),this.innerSubscription=De(e,t),this.innerSubscription!==t&&n.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(Re),aC=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){e=new mI(e);var n=De(this.notifier,new Qe(e));return n&&!e.seenValue?(e.add(n),t.subscribe(e)):e},e}(),mI=function(e){function t(t){return(t=e.call(this,t)||this).seenValue=!1,t}return Ca(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(Re),bC=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new nI(e,this.nextOrObserver,this.error,this.complete))},e}(),nI=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this)._tapNext=fe,t._tapError=fe,t._tapComplete=fe,t._tapError=r||fe,t._tapComplete=i||fe,Vg(n)?(t._context=t,t._tapNext=n):n&&(t._context=n,t._tapNext=n.next||fe,t._tapError=n.error||fe,t._tapComplete=n.complete||fe),t}return Ca(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(hb),dC={leading:!0,trailing:!1};!function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}Ca(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._sendValue;this._hasValue&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){(e=this.tryDurationSelector(e))&&this.add(this._throttled=De(e,new Qe(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()}}(Re);for(var eC=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new oI(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),oI=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).duration=n,t.scheduler=r,t.leading=i,t.trailing=o,t._hasTrailingValue=!1,t._trailingValue=null,t}return Ca(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(fC,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(hb),hC=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new pI(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),pI=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).absoluteTimeout=n,t.waitFor=r,t.withObservable=i,t.scheduler=o,t.scheduleTimeout(),t}return Ca(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(De(t,new Qe(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},t}(Re),jC=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new qI(e,this.observables,this.project))},e}(),qI=function(e){function t(t,n,r){(t=e.call(this,t)||this).observables=n,t.project=r,t.toRespond=[],r=n.length,t.values=Array(r);for(var i=0;i<r;i++)t.toRespond.push(i);for(i=0;i<r;i++)t.add(wm(t,n[i],void 0,i));return t}return Ca(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t,0<(e=this.toRespond).length&&-1!==(n=e.indexOf(n))&&e.splice(n,1)},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){0===this.toRespond.length&&(e=[e].concat(this.values),this.project?this._tryProject(e):this.destination.next(e))},t.prototype._tryProject=function(e){try{var t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Zo),ow=kc((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=Array(16);e.exports=function(){for(var e,t=0;16>t;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}})),tc=[],Yk=0;256>Yk;++Yk)tc[Yk]=(Yk+256).toString(16).substr(1);var pw=function(e,t){return t=t||0,[tc[e[t++]],tc[e[t++]],tc[e[t++]],tc[e[t++]],"-",tc[e[t++]],tc[e[t++]],"-",tc[e[t++]],tc[e[t++]],"-",tc[e[t++]],tc[e[t++]],"-",tc[e[t++]],tc[e[t++]],tc[e[t++]],tc[e[t++]],tc[e[t++]],tc[e[t++]]].join("")},gj=function(e,t,n){if(n=t&&n||0,"string"==typeof e&&(t="binary"===e?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||ow)())[6]=15&e[6]|64,e[8]=63&e[8]|128,t)for(var r=0;16>r;++r)t[n+r]=e[r];return t||pw(e)},hj=gj(),Bm=!1,$r=new AbortController,Se,Df,bp,cp,Ef,rg,Zd,sg,zd,dp,Te,tg,Ue,Ve,We,Fh,Uc,$d;!function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Se||(Se={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Df||(Df={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(bp||(bp={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(cp||(cp={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(Ef||(Ef={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(rg||(rg={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(Zd||(Zd={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_KICKED=4]="LEAVE_CHANNEL_ERR_KICKED",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(sg||(sg={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(zd||(zd={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(dp||(dp={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Te||(Te={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(tg||(tg={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Ue||(Ue={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Ve||(Ve={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Fh||(Fh={})),function(e){e[e.METADATA_OPERATION_ERR_OK=0]="METADATA_OPERATION_ERR_OK",e[e.METADATA_OPERATION_ERR_FAILURE=1]="METADATA_OPERATION_ERR_FAILURE",e[e.METADATA_OPERATION_ERR_INVALID_USER_ID=2]="METADATA_OPERATION_ERR_INVALID_USER_ID",e[e.METADATA_OPERATION_ERR_INVALID_ARGUMENT=3]="METADATA_OPERATION_ERR_INVALID_ARGUMENT",e[e.METADATA_OPERATION_ERR_SIZE_OVERFLOW=4]="METADATA_OPERATION_ERR_SIZE_OVERFLOW",e[e.METADATA_OPERATION_ERR_DUPLICATE_KEY=5]="METADATA_OPERATION_ERR_DUPLICATE_KEY",e[e.METADATA_OPERATION_ERR_TOO_OFTEN=6]="METADATA_OPERATION_ERR_TOO_OFTEN",e[e.METADATA_OPERATION_ERR_TIMEOUT=7]="METADATA_OPERATION_ERR_TIMEOUT",e[e.METADATA_OPERATION_ERR_OUTDATE_REVISION=8]="METADATA_OPERATION_ERR_OUTDATE_REVISION",e[e.METADATA_OPERATION_ERR_NOT_IN_CHANNEL=9]="METADATA_OPERATION_ERR_NOT_IN_CHANNEL",e[e.METADATA_OPERATION_ERR_NOT_INITIALIZED=101]="METADATA_OPERATION_ERR_NOT_INITIALIZED",e[e.METADATA_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="METADATA_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.METADATA_SUBSCRIPTION_ERR_OK=0]="METADATA_SUBSCRIPTION_ERR_OK",e[e.METADATA_SUBSCRIPTION_ERR_FAILURE=1]="METADATA_SUBSCRIPTION_ERR_FAILURE",e[e.METADATA_SUBSCRIPTION_ERR_TIMEOUT=2]="METADATA_SUBSCRIPTION_ERR_TIMEOUT",e[e.METADATA_SUBSCRIPTION_ERR_INVALID_ARGUMENT=3]="METADATA_SUBSCRIPTION_ERR_INVALID_ARGUMENT",e[e.METADATA_SUBSCRIPTION_ERR_TOO_OFTEN=4]="METADATA_SUBSCRIPTION_ERR_TOO_OFTEN",e[e.METADATA_SUBSCRIPTION_ERR_OVERFLOW=5]="METADATA_SUBSCRIPTION_ERR_OVERFLOW",e[e.METADATA_SUBSCRIPTION_USER_NOT_SUBSCRIBED=6]="METADATA_SUBSCRIPTION_USER_NOT_SUBSCRIBED",e[e.METADATA_SUBSCRIPTION_ERR_NOT_INITIALIZED=101]="METADATA_SUBSCRIPTION_ERR_NOT_INITIALIZED",e[e.METADATA_SUBSCRIPTION_ERR_NOT_LOGGED_IN=102]="METADATA_SUBSCRIPTION_ERR_NOT_LOGGED_IN"}($d||($d={}));var Ad=Se.ATTRIBUTE_OPERATION_ERR_FAILURE,Ub=Se.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,ch=Se.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Se.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var qw=Se.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Bd=Se.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Cd=Se.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,Zk=Df.CHANNEL_MESSAGE_ERR_FAILURE,ep=Df.CHANNEL_MESSAGE_ERR_TIMEOUT,rw=Df.CHANNEL_MESSAGE_ERR_TOO_OFTEN,fp=Df.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,rI=Df.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL,gp=Df.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,sI=bp.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,sw=cp.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Ve.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var tw=Ve.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Ve.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var uw=Ve.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,tI=Ve.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Ve.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var uI=Ve.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,vI=Ef.GET_MEMBERS_ERR_FAILURE,wI=Ef.GET_MEMBERS_ERR_REJECTED;Ef.GET_MEMBERS_ERR_TIMEOUT,Ef.GET_MEMBERS_ERR_TOO_OFTEN;var xI=Ef.GET_MEMBERS_ERR_NOT_IN_CHANNEL,yI=Ef.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,ve=rg.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,zI=rg.INVITATION_API_CALL_ERR_NOT_STARTED,$k=rg.INVITATION_API_CALL_ERR_ALREADY_END,vw=rg.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,AI=rg.INVITATION_API_CALL_ERR_ALREADY_SENT,ww=Zd.JOIN_CHANNEL_ERR_FAILURE;Zd.JOIN_CHANNEL_ERR_REJECTED;var BI=Zd.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,xw=Zd.JOIN_CHANNEL_TIMEOUT,yw=Zd.JOIN_CHANNEL_ERR_EXCEED_LIMIT,zw=Zd.JOIN_CHANNEL_ERR_ALREADY_JOINED;Zd.JOIN_CHANNEL_ERR_TOO_OFTEN;var Aw=Zd.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Bw=Zd.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Cw=sg.LEAVE_CHANNEL_ERR_FAILURE,Dw=sg.LEAVE_CHANNEL_ERR_REJECTED,CI=sg.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,DI=sg.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,EI=sg.LEAVE_CHANNEL_ERR_KICKED,Ew=zd.LOGIN_ERR_UNKNOWN,ij=zd.LOGIN_ERR_REJECTED,al=zd.LOGIN_ERR_INVALID_ARGUMENT,Fw=zd.LOGIN_ERR_INVALID_APP_ID,Gw=zd.LOGIN_ERR_INVALID_TOKEN,bl=zd.LOGIN_ERR_TOKEN_EXPIRED;zd.LOGIN_ERR_NOT_AUTHORIZED;var FI=zd.LOGIN_ERR_ALREADY_LOGIN,GI=zd.LOGIN_ERR_TIMEOUT,HI=zd.LOGIN_ERR_TOO_OFTEN,Hw=dp.LOGOUT_ERR_USER_NOT_LOGGED_IN,Iw=Te.PEER_MESSAGE_ERR_FAILURE,hp=Te.PEER_MESSAGE_ERR_TIMEOUT,Jw=Te.PEER_MESSAGE_ERR_TOO_OFTEN,Kw=Te.PEER_MESSAGE_ERR_INVALID_USERID,si=Te.PEER_MESSAGE_ERR_INVALID_MESSAGE,ip=Te.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN;Te.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE;var Lw=tg.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;tg.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var II=tg.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;tg.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var JI=tg.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,jp=Ue.RENEW_TOKEN_ERR_FAILURE,KI=Ue.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Ue.RENEW_TOKEN_ERR_REJECTED,Ue.RENEW_TOKEN_ERR_TOO_OFTEN;var LI=Ue.RENEW_TOKEN_ERR_TOKEN_EXPIRED,MI=Ue.RENEW_TOKEN_ERR_INVALID_TOKEN,Mw=Ue.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,Nw=We.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,jj=We.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;We.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var NI=We.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;We.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var Ow=We.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,kp=We.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Fh.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Fh.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Fh.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Fh.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var bd=Uc.METADATA_OPERATION_ERR_OK,He=Uc.METADATA_OPERATION_ERR_FAILURE;Uc.METADATA_OPERATION_ERR_INVALID_USER_ID;var Mb=Uc.METADATA_OPERATION_ERR_INVALID_ARGUMENT,Om=Uc.METADATA_OPERATION_ERR_SIZE_OVERFLOW,oC=Uc.METADATA_OPERATION_ERR_DUPLICATE_KEY,Vc=Uc.METADATA_OPERATION_ERR_TOO_OFTEN,cd=Uc.METADATA_OPERATION_ERR_TIMEOUT,of=Uc.METADATA_OPERATION_ERR_OUTDATE_REVISION;Uc.METADATA_OPERATION_ERR_NOT_INITIALIZED;var oc=Uc.METADATA_OPERATION_ERR_USER_NOT_LOGGED_IN,kj=Uc.METADATA_OPERATION_ERR_NOT_IN_CHANNEL,Pw=$d.METADATA_SUBSCRIPTION_ERR_OK,lp=$d.METADATA_SUBSCRIPTION_ERR_FAILURE,cl=$d.METADATA_SUBSCRIPTION_ERR_TIMEOUT,dl=$d.METADATA_SUBSCRIPTION_ERR_INVALID_ARGUMENT;$d.METADATA_SUBSCRIPTION_ERR_TOO_OFTEN;var OI=$d.METADATA_SUBSCRIPTION_ERR_OVERFLOW,PI=$d.METADATA_SUBSCRIPTION_USER_NOT_SUBSCRIBED;$d.METADATA_SUBSCRIPTION_ERR_NOT_INITIALIZED,$d.METADATA_SUBSCRIPTION_ERR_NOT_LOGGED_IN;var QI=function(e,t){var n;return Po(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n},el=function(e,t,n){if(!Kc(n))return!1;var r=Ia(t);return!!("number"==r?$f(n)&&Eo(t,n.length):"string"==r&&t in n)&&$i(n[t],e)},mp=function(e,t,n){var r=lc(e)?Zv:QI;return n&&el(e,t,n)&&(t=void 0),r(e,Ch(t))},RI=function(e,t){var n=-1,r=$f(e)?Array(e.length):[];return Po(e,(function(e,i,o){r[++n]=t(e,i,o)})),r},SI=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e},TI=function(e,t,n){t=t.length?Rg(t,(function(e){return lc(e)?function(t){return Uk(t,1===e.length?e[0]:e)}:e})):[Vk];var r=-1;return t=Rg(t,Rk(Ch)),e=RI(e,(function(e,n,i){return{criteria:Rg(t,(function(t){return t(e)})),index:++r,value:e}})),SI(e,(function(e,t){e:{for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){t:{var c=i[r],u=o[r];if(c!==u){var l=void 0!==c,f=null===c,d=c==c,p=Sg(c),h=void 0!==u,v=null===u,m=u==u,g=Sg(u);if(!v&&!g&&!p&&c>u||p&&h&&m&&!v&&!g||f&&h&&m||!l&&m||!d){c=1;break t}if(!f&&!p&&!g&&c<u||g&&l&&d&&!f&&!p||v&&l&&d||!h&&d||!m){c=-1;break t}}c=0}if(c){e=r>=s?c:c*("desc"==n[r]?-1:1);break e}}e=e.index-t.index}return e}))},Qw=function(e,t){return Xv(Wv(e,t,Vk),e+"")},Rw=Qw((function(e,t){if(null==e)return[];var n=t.length;return 1<n&&el(e,t[0],t[1])?t=[]:2<n&&el(t[0],t[1],t[2])&&(t=[t[0]]),TI(e,mm(t,1),[])})),Sw=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}(WH),Tw=kc((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[],r=function(e,t){return new WebSocket(e,t)};t.normalClosureMessage="Normal closure",t.default=function(e,i){var o=(i=void 0===i?{protocols:n,makeWebSocket:r}:i).protocols,a=void 0===o?n:o,s=void 0===(i=i.makeWebSocket)?r:i;return new Sw.Observable((function(n){var r,i=new Sw.Subject,o=s(e,a),c=!1,u=!1,l=function(e){if(r)throw c=!0,e=Error("Web socket message factory function called more than once"),n.error(e),e;return r=e.subscribe((function(e){o.send(e)})),i};return o.onopen=function(){u?(c=!0,o.close()):n.next(l)},o.onmessage=function(e){i.next(e.data)},o.onerror=function(e){c=!0,n.error(Error(e.message))},o.onclose=function(e){c||(c=!0,u?(n.complete(),i.complete()):n.error(Error(1e3===e.code?t.normalClosureMessage:e.reason)))},function(){u=!0,r&&r.unsubscribe(),c||(c=!0,o.close())}}))}}));!function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default}(Tw);var Dm=function(e,t,n){(void 0===n||$i(e[t],n))&&(void 0!==n||t in e)||bj(e,t,n)},Cm=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},UI=function(e){return Qw((function(t,n){var r=-1,i=n.length,o=1<i?n[i-1]:void 0,a=2<i?n[2]:void 0;for(o=3<e.length&&"function"==typeof o?(i--,o):void 0,a&&el(n[0],n[1],a)&&(o=3>i?void 0:o,i=1),t=Object(t);++r<i;)(a=n[r])&&e(t,a,r,o);return t}))}((function(e,t,n,r){as(e,t,n,r)})),VI=Math.floor,WI=Math.random,Uw=function(e,t){return e+VI(WI()*(t-e+1))},Vw=function(e){var t=e.length;return t?e[Uw(0,t-1)]:void 0},XI=function(e,t){return Rg(t,(function(t){return e[t]}))},Vm=function(e){return null==e?[]:XI(e,Wf(e))},YI=function(e){return Vw(Vm(e))},Es=function(e){return(lc(e)?Vw:YI)(e)},es=[],fs=function(e,t){return new WebSocket(e,t)};cb&&("g"!=/./g.flags||Sd)&&$b.f(RegExp.prototype,"flags",{configurable:!0,get:hk});var ZI=Math.floor;wa({target:"Number",stat:!0},{isInteger:function(e){return!fb(e)&&isFinite(e)&&ZI(e)===e}}),tu("from",On,Nn);var $I=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,a){n[r]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,a(e))}}))},aJ=kc((function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};var n=Array(64),r=Array(123);for(e=0;64>e;)r[n[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;t.encode=function(e,t,r){for(var i,o=null,a=[],s=0,c=0;t<r;){var u=e[t++];switch(c){case 0:a[s++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:a[s++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:a[s++]=n[i|u>>6],a[s++]=n[63&u],c=0}8191<s&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=n[i],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},t.decode=function(e,t,n){for(var i,o=n,a=0,s=0;s<e.length;){var c=e.charCodeAt(s++);if(61===c&&1<a)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(a){case 0:i=c,a=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:t[n++]=(3&i)<<6|c,a=0}}if(1===a)throw Error("invalid encoding");return n-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}));Oj.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},Oj.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else{e=this._listeners[e];for(var n=0;n<e.length;)e[n].fn===t?e.splice(n,1):++n}return this},Oj.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var bJ=gs(gs),cJ=function cJ(d){try{var b=eval("quire".replace(/^/,"re"))(d);if(b&&(b.length||Object.keys(b).length))return b}catch(e){}return null},dJ=kc((function(e,t){t.length=function(e){for(var t,n=0,r=0;r<e.length;++r)128>(t=e.charCodeAt(r))?n+=1:2048>t?n+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},t.read=function(e,t,n){if(1>n-t)return"";for(var r,i=null,o=[],a=0;t<n;)128>(r=e[t++])?o[a++]=r:191<r&&224>r?o[a++]=(31&r)<<6|63&e[t++]:239<r&&365>r?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<a&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,n){for(var r,i,o=n,a=0;a<e.length;++a)128>(r=e.charCodeAt(a))?t[n++]=r:(2048>r?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-o}})),eJ=function(e,t,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){return 1>n||n>i?e(n):(a+n>r&&(o=e(r),a=0),n=t.call(o,a,a+=n),7&a&&(a=1+(7|a)),n)}},ug=mc.zero=new mc(0,0);ug.toNumber=function(){return 0},ug.zzEncode=ug.zzDecode=function(){return this},ug.length=function(){return 1};var fJ=mc.zeroHash="\0\0\0\0\0\0\0\0";mc.fromNumber=function(e){if(0===e)return ug;var t=0>e;t&&(e=-e);var n=e>>>0;return e=(e-n)/4294967296>>>0,t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new mc(n,e)},mc.from=function(e){if("number"==typeof e)return mc.fromNumber(e);if(Ra.isString(e)){if(!Ra.Long)return mc.fromNumber(parseInt(e,10));e=Ra.Long.fromString(e)}return e.low||e.high?new mc(e.low>>>0,e.high>>>0):ug},mc.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var t=~this.hi>>>0;return e||(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi},mc.prototype.toLong=function(e){return Ra.Long?new Ra.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var Ff=String.prototype.charCodeAt;mc.fromHash=function(e){return e===fJ?ug:new mc((Ff.call(e,0)|Ff.call(e,1)<<8|Ff.call(e,2)<<16|Ff.call(e,3)<<24)>>>0,(Ff.call(e,4)|Ff.call(e,5)<<8|Ff.call(e,6)<<16|Ff.call(e,7)<<24)>>>0)},mc.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},mc.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},mc.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},mc.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>n?9:10};var Ra=kc((function(e,t){function n(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=$I,t.base64=aJ,t.EventEmitter=Oj,t.float=bJ,t.inquire=cJ,t.utf8=dJ,t.pool=eJ,t.LongBits=mc,t.isNode=!!(void 0!==qb&&qb&&qb.process&&qb.process.versions&&qb.process.versions.node),t.global=t.isNode&&qb||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||qb,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"===Ia(e)},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==Ia(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){return e=t.LongBits.fromHash(e),t.Long?t.Long.fromBits(e.lo,e.hi,n):e.toNumber(!!n)},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;-1<n;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),Lm=ib,np,fl=Ra.LongBits,Ww=Ra.base64,Xw=Ra.utf8,Yw=function(){return Ra.Buffer?function(){return(ib.create=function(){return new np})()}:function(){return new ib}};ib.create=Yw(),ib.alloc=function(e){return new Ra.Array(e)},Ra.Array!==Array&&(ib.alloc=Ra.pool(ib.alloc,Ra.Array.prototype.subarray)),ib.prototype._push=function(e,t,n){return this.tail=this.tail.next=new pi(e,t,n),this.len+=t,this},Im.prototype=Object.create(pi.prototype),Im.prototype.fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},ib.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Im(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ib.prototype.int32=function(e){return 0>e?this._push(Jm,10,fl.fromNumber(e)):this.uint32(e)},ib.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ib.prototype.uint64=function(e){return e=fl.from(e),this._push(Jm,e.length(),e)},ib.prototype.int64=ib.prototype.uint64,ib.prototype.sint64=function(e){return e=fl.from(e).zzEncode(),this._push(Jm,e.length(),e)},ib.prototype.bool=function(e){return this._push(Hm,1,e?1:0)},ib.prototype.fixed32=function(e){return this._push(Km,4,e>>>0)},ib.prototype.sfixed32=ib.prototype.fixed32,ib.prototype.fixed64=function(e){return e=fl.from(e),this._push(Km,4,e.lo)._push(Km,4,e.hi)},ib.prototype.sfixed64=ib.prototype.fixed64,ib.prototype.float=function(e){return this._push(Ra.float.writeFloatLE,4,e)},ib.prototype.double=function(e){return this._push(Ra.float.writeDoubleLE,8,e)};var gJ=Ra.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};ib.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Hm,1,0);if(Ra.isString(e)){var n=ib.alloc(t=Ww.length(e));Ww.decode(e,n,0),e=n}return this.uint32(t)._push(gJ,t,e)},ib.prototype.string=function(e){var t=Xw.length(e);return t?this.uint32(t)._push(Xw.write,t,e):this._push(Hm,1,0)},ib.prototype.fork=function(){return this.states=new mC(this),this.head=this.tail=new pi(Gm,0,0),this.len=0,this},ib.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new pi(Gm,0,0),this.len=0),this},ib.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},ib.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},ib._configure=function(e){np=e,ib.create=Yw(),np._configure()},(ie.prototype=Object.create(Lm.prototype)).constructor=ie,ie._configure=function(){ie.alloc=Ra._Buffer_allocUnsafe,ie.writeBytesBuffer=Ra.Buffer&&Ra.Buffer.prototype instanceof Uint8Array&&"set"===Ra.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},ie.prototype.bytes=function(e){Ra.isString(e)&&(e=Ra._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(ie.writeBytesBuffer,t,e),this},ie.prototype.string=function(e){var t=Ra.Buffer.byteLength(e);return this.uint32(t),t&&this._push(nC,t,e),this},ie._configure();var Nm=Yb,op,ls=Ra.LongBits,hJ=Ra.utf8,Zw="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Yb(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Yb(e);throw Error("illegal buffer")},$w=function(){return Ra.Buffer?function(e){return(Yb.create=function(e){return Ra.Buffer.isBuffer(e)?new op(e):Zw(e)})(e)}:Zw};Yb.create=$w(),Yb.prototype._slice=Ra.Array.prototype.subarray||Ra.Array.prototype.slice,Yb.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Od(this,10);return e}}(),Yb.prototype.int32=function(){return 0|this.uint32()},Yb.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Yb.prototype.bool=function(){return 0!==this.uint32()},Yb.prototype.fixed32=function(){if(this.pos+4>this.len)throw Od(this,4);return Pj(this.buf,this.pos+=4)},Yb.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Od(this,4);return 0|Pj(this.buf,this.pos+=4)},Yb.prototype.float=function(){if(this.pos+4>this.len)throw Od(this,4);var e=Ra.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Yb.prototype.double=function(){if(this.pos+8>this.len)throw Od(this,4);var e=Ra.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Yb.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Od(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},Yb.prototype.string=function(){var e=this.bytes();return hJ.read(e,0,e.length)},Yb.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw Od(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Od(this)}while(128&this.buf[this.pos++]);return this},Yb.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Yb._configure=function(e){op=e,Yb.create=$w(),op._configure();var t=Ra.Long?"toLong":"toNumber";Ra.merge(Yb.prototype,{int64:function(){return Mm.call(this)[t](!1)},uint64:function(){return Mm.call(this)[t](!0)},sint64:function(){return Mm.call(this).zzDecode()[t](!1)},fixed64:function(){return ms.call(this)[t](!0)},sfixed64:function(){return ms.call(this)[t](!1)}})},(ag.prototype=Object.create(Nm.prototype)).constructor=ag,ag._configure=function(){Ra.Buffer&&(ag.prototype._slice=Ra.Buffer.prototype.slice)},ag.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},ag._configure(),(qi.prototype=Object.create(Ra.EventEmitter.prototype)).constructor=qi,qi.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return Ra.asPromise(e,a,t,n,r,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){a.emit("error",e,t),setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},qi.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var iJ=kc((function(e,t){t.Service=qi})),jJ={},ae=kc((function(e,t){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=t;r.build="minimal",r.Writer=Lm,r.BufferWriter=ie,r.Reader=Nm,r.BufferReader=ag,r.util=Ra,r.rpc=iJ,r.roots=jJ,r.configure=n,n()}));ae.util.Long=D,ae.configure();var T=ae.Reader,ta=ae.Writer,I=ae.util,Q=ae.roots.default||(ae.roots.default={}),kJ=Q.URI=function(){var e={},t=Object.create(e);return t[e[0]="Unknown"]=0,t[e[1]="PingUri"]=1,t[e[2]="PongUri"]=2,t[e[11]="UserJoinUri"]=11,t[e[12]="UserRespUri"]=12,t[e[15]="UserTicketNearlyExpireUri"]=15,t[e[16]="UserRenewTokenReqUri"]=16,t[e[17]="UserRenewTokenRespUri"]=17,t[e[21]="UserQuitUri"]=21,t[e[22]="UserDropUri"]=22,t[e[31]="GroupEnterUri"]=31,t[e[32]="GroupLeaveUri"]=32,t[e[33]="GroupReplyUri"]=33,t[e[35]="GroupDropUri"]=35,t[e[36]="GroupEnterNoticeUri"]=36,t[e[37]="GroupLeaveNoticeUri"]=37,t[e[38]="GroupEventNoticeUri"]=38,t[e[39]="GroupCountNoticeUri"]=39,t[e[41]="UserStatusListUri"]=41,t[e[42]="UserStatusResultUri"]=42,t[e[51]="GroupStatusListUri"]=51,t[e[52]="GroupStatusResultUri"]=52,t[e[55]="GroupAllUsersListUri"]=55,t[e[56]="GroupAllUsersResultUri"]=56,t[e[100]="MessageUri"]=100,t[e[101]="AckUri"]=101,t[e[201]="UserJoinNoticeUri"]=201,t[e[202]="UserQuitNoticeUri"]=202,t[e[203]="UserWaitNoticeUri"]=203,t[e[301]="UserAttributeGetUri"]=301,t[e[302]="UserAttributeRetUri"]=302,t[e[303]="UserAttributeSetUri"]=303,t[e[304]="UserAttributeModUri"]=304,t[e[305]="UserAttributeDelUri"]=305,t[e[307]="UserAttributeRspUri"]=307,t[e[308]="UserAttributeErrUri"]=308,t[e[311]="UserAttributeKeysGetUri"]=311,t[e[312]="UserAttributeKeysRetUri"]=312,t[e[351]="GroupAttributeGetUri"]=351,t[e[352]="GroupAttributeRetUri"]=352,t[e[353]="GroupAttributeSetUri"]=353,t[e[354]="GroupAttributeModUri"]=354,t[e[355]="GroupAttributeDelUri"]=355,t[e[356]="GroupAttributeAltUri"]=356,t[e[357]="GroupAttributeRspUri"]=357,t[e[358]="GroupAttributeErrUri"]=358,t[e[361]="GroupAttributeKeysGetUri"]=361,t[e[362]="GroupAttributeKeysRetUri"]=362,t[e[401]="SubscribeUserStatusUri"]=401,t[e[402]="UnsubscribeUserStatusUri"]=402,t[e[499]="SubscribeResponseUri"]=499,t[e[601]="StateSubscribeUri"]=601,t[e[602]="StateUpdateUri"]=602,t[e[603]="StateSubscribeResultUri"]=603,t[e[604]="StateUnsubscribeUri"]=604,t[e[605]="StateSetUri"]=605,t[e[606]="StateModifyUri"]=606,t[e[607]="StateRequestResultUri"]=607,t[e[608]="StateGetUri"]=608,t[e[609]="StateGetResultUri"]=609,t[e[610]="StateLockAcquireUri"]=610,t[e[611]="StateLockReleaseUri"]=611,t[e[612]="StateLockAcquireResultUri"]=612,t[e[613]="StateLockUpdateUri"]=613,t[e[614]="StateLockReleaseResultUri"]=614,t[e[615]="StateLockDisableUri"]=615,t[e[616]="StateLockDisableResultUri"]=616,t}(),gl=Q.Wrapper=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.uri=0,e.prototype.data=I.newBuffer([]),e.encode=function(e,t){return t||(t=ta.create()),null!=e.uri&&Object.hasOwnProperty.call(e,"uri")&&t.uint32(8).int32(e.uri),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.Wrapper;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.uri=e.int32();break;case 2:n.data=e.bytes();break;default:e.skipType(7&r)}}return n},e}(),lJ=Q.Ping=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.Ping;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.ms=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),mJ=Q.Pong=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.Pong;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.ms=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),nJ=Q.UserJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.opt=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.opt&&Object.hasOwnProperty.call(e,"opt")&&t.uint32(16).uint64(e.opt),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(34).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(42).string(e.ticket),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserJoin;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.opt=e.uint64();break;case 3:n.instance=e.uint64();break;case 4:n.account=e.string();break;case 5:n.ticket=e.string();break;default:e.skipType(7&r)}}return n},e}(),oJ=Q.UserResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserResp;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),pJ=Q.UserQuit=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.encode=function(e,t){return t||(t=ta.create()),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserQuit;e.pos<t;){var r=e.uint32();e.skipType(7&r)}return n},e}(),qJ=Q.UserDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserDrop;e.pos<t;){var r=e.uint32();r>>>3===1?n.code=e.uint32():e.skipType(7&r)}return n},e}(),rJ=Q.UserTicketNearlyExpire=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.expireTs=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.ticket="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.expireTs&&Object.hasOwnProperty.call(e,"expireTs")&&t.uint32(8).uint64(e.expireTs),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(18).string(e.ticket),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserTicketNearlyExpire;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.expireTs=e.uint64();break;case 2:n.ticket=e.string();break;default:e.skipType(7&r)}}return n},e}(),sJ=Q.UserRenewTokenReq=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(26).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(34).string(e.ticket),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserRenewTokenReq;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.account=e.string();break;case 4:n.ticket=e.string();break;default:e.skipType(7&r)}}return n},e}(),tJ=Q.UserRenewTokenResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserRenewTokenResp;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),uJ=Q.GroupEnter=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupEnter;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;default:e.skipType(7&r)}}return n},e}(),vJ=Q.GroupLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupLeave;e.pos<t;){var r=e.uint32();r>>>3===1?n.account=e.string():e.skipType(7&r)}return n},e}(),wJ=Q.GroupReply=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupReply;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),ax=Q.GroupLeaveNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupLeaveNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.user=e.string();break;case 3:n.group=e.string();break;case 4:n.instance=e.uint64();break;case 5:n.size=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),bx=Q.GroupEnterNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupEnterNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.user=e.string();break;case 3:n.group=e.string();break;case 4:n.instance=e.uint64();break;case 5:n.size=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),cx=Q.Message=function(){function e(e){if(this.MiscMap={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.dialogue=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.options=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=I.newBuffer([]),e.prototype.MiscMap=I.emptyObject,e.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&t.uint32(32).uint64(e.options),null!=e.src&&Object.hasOwnProperty.call(e,"src")&&t.uint32(42).string(e.src),null!=e.dst&&Object.hasOwnProperty.call(e,"dst")&&t.uint32(50).string(e.dst),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(58).bytes(e.payload),null!=e.MiscMap&&Object.hasOwnProperty.call(e,"MiscMap"))for(var n=Object.keys(e.MiscMap),r=0;r<n.length;++r)t.uint32(66).fork().uint32(10).string(n[r]).uint32(18).bytes(e.MiscMap[n[r]]).ldelim();return null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(72).uint64(e.ms),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n,r,i=new Q.Message;e.pos<t;)switch(n=e.uint32(),n>>>3){case 1:i.instance=e.uint64();break;case 2:i.dialogue=e.uint64();break;case 3:i.sequence=e.uint64();break;case 4:i.options=e.uint64();break;case 5:i.src=e.string();break;case 6:i.dst=e.string();break;case 7:i.payload=e.bytes();break;case 8:i.MiscMap===I.emptyObject&&(i.MiscMap={});var o=e.uint32()+e.pos;for(n="",r=[];e.pos<o;){var a=e.uint32();switch(a>>>3){case 1:n=e.string();break;case 2:r=e.bytes();break;default:e.skipType(7&a)}}i.MiscMap[n]=r;break;case 9:i.ms=e.uint64();break;default:e.skipType(7&n)}return i},e}(),dx=Q.Ack=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.dialogue=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.Ack;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.dialogue=e.uint64();break;case 3:n.sequence=e.uint64();break;case 4:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),xJ=Q.GroupDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupDrop;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.account=e.string();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),yJ=Q.GroupAllUsersList=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(24).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(32).uint32(e.pageNumber),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAllUsersList;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.pageSize=e.uint32();break;case 4:n.pageNumber=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),zJ=Q.GroupAllUsersResult=function(){function e(e){if(this.memberInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&t.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(var n=0;n<e.memberInfos.length;++n)Q.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[n],t.uint32(50).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAllUsersResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.totalSize=e.uint32();break;case 4:n.pageSize=e.uint32();break;case 5:n.pageNumber=e.uint32();break;case 6:n.memberInfos&&n.memberInfos.length||(n.memberInfos=[]),n.memberInfos.push(Q.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.MemberInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAllUsersResult.MemberInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.account=e.string();break;case 2:n.ts=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),e}(),AJ=Q.UserStatusList=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.users=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserStatusList;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),BJ=Q.UserStatusResult=function(){function e(e){if(this.userInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.userInfos=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.userInfos&&e.userInfos.length)for(var n=0;n<e.userInfos.length;++n)Q.UserStatusResult.UserStatusInfo.encode(e.userInfos[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserStatusResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.userInfos&&n.userInfos.length||(n.userInfos=[]),n.userInfos.push(Q.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.UserStatusInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserStatusResult.UserStatusInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.account=e.string();break;case 2:n.ts=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),e}(),CJ=Q.UserAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),DJ=Q.UserAttributeRet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)Q.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeRet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(Q.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeRet.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),EJ=Q.UserAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)Q.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[n],t.uint32(26).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeSet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(Q.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeSet.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),FJ=Q.UserAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)Q.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[n],t.uint32(26).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeMod;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(Q.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeMod.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),GJ=Q.UserAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeDel;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),HJ=Q.UserAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeErr;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),IJ=Q.UserAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeKeysGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;default:e.skipType(7&r)}}return n},e}(),JJ=Q.UserAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.keys=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeKeysRet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),KJ=Q.UserAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserAttributeRsp;e.pos<t;){var r=e.uint32();r>>>3===1?n.seq=e.uint64():e.skipType(7&r)}return n},e}(),LJ=Q.GroupStatusList=function(){function e(e){if(this.groups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.groups=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groups&&e.groups.length)for(var n=0;n<e.groups.length;++n)t.uint32(18).string(e.groups[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupStatusList;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.groups&&n.groups.length||(n.groups=[]),n.groups.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),MJ=Q.GroupStatusResult=function(){function e(e){if(this.groupInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groupInfos&&e.groupInfos.length)for(var n=0;n<e.groupInfos.length;++n)Q.GroupStatusResult.GroupInfo.encode(e.groupInfos[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupStatusResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.groupInfos&&n.groupInfos.length||(n.groupInfos=[]),n.groupInfos.push(Q.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.GroupInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(10).string(e.group),null!=e.memberCount&&Object.hasOwnProperty.call(e,"memberCount")&&t.uint32(16).uint32(e.memberCount),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupStatusResult.GroupInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.group=e.string();break;case 2:n.memberCount=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),e}(),NJ=Q.GroupCountNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupCountNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.group=e.string();break;case 4:n.size=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),OJ=Q.GroupAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),PJ=Q.GroupAttributeRet=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(var n=0;n<e.attributeMaps.length;++n)Q.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeRet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.attributeMaps&&n.attributeMaps.length||(n.attributeMaps=[]),n.attributeMaps.push(Q.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeRet.AttributeMap;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;case 3:n.origin=e.string();break;case 4:n.ms=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),e}(),QJ=Q.GroupAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)Q.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[n],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeSet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(Q.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeSet.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),RJ=Q.GroupAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)Q.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[n],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeMod;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(Q.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeMod.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),SJ=Q.GroupAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(34).string(e.attributes[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeDel;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),TJ=Q.GroupAttributeAlt=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(var n=0;n<e.attributeMaps.length;++n)Q.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[n],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeAlt;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.instance=e.uint64();break;case 4:n.attributeMaps&&n.attributeMaps.length||(n.attributeMaps=[]),n.attributeMaps.push(Q.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeAlt.AttributeMap;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;case 3:n.origin=e.string();break;case 4:n.ms=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),e}(),UJ=Q.GroupAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeRsp;e.pos<t;){var r=e.uint32();r>>>3===1?n.seq=e.uint64():e.skipType(7&r)}return n},e}(),VJ=Q.GroupAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeErr;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),WJ=Q.GroupAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeKeysGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;default:e.skipType(7&r)}}return n},e}(),XJ=Q.GroupAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.keys=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.GroupAttributeKeysRet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),YJ=Q.SubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.users=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.SubscribeUserStatus;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),ZJ=Q.UnsubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.users=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UnsubscribeUserStatus;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),$J=Q.UserJoinNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserJoinNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.user=e.string();break;default:e.skipType(7&r)}}return n},e}(),aK=Q.UserQuitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserQuitNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.user=e.string();break;default:e.skipType(7&r)}}return n},e}(),bK=Q.UserWaitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.UserWaitNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.user=e.string();break;default:e.skipType(7&r)}}return n},e}(),cK=Q.StateSubscribe=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.subTarget="",e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.subTarget&&Object.hasOwnProperty.call(e,"subTarget")&&t.uint32(18).string(e.subTarget),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateSubscribe;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.subTarget=e.string();break;case 3:n.sequence=e.uint64();break;case 4:n.flags=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),dK=Q.StateUpdate=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.subTarget="",e.prototype.allStates="",e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.subTarget&&Object.hasOwnProperty.call(e,"subTarget")&&t.uint32(18).string(e.subTarget),null!=e.allStates&&Object.hasOwnProperty.call(e,"allStates")&&t.uint32(26).string(e.allStates),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateUpdate;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.subTarget=e.string();break;case 3:n.allStates=e.string();break;case 4:n.flags=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),eK=Q.StateSubscribeResult=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.subTarget="",e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.subTarget&&Object.hasOwnProperty.call(e,"subTarget")&&t.uint32(18).string(e.subTarget),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(40).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateSubscribeResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.subTarget=e.string();break;case 3:n.sequence=e.uint64();break;case 4:n.flags=e.uint64();break;case 5:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),fK=Q.StateUnsubscribe=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.subTarget="",e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.subTarget&&Object.hasOwnProperty.call(e,"subTarget")&&t.uint32(18).string(e.subTarget),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateUnsubscribe;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.subTarget=e.string();break;case 3:n.sequence=e.uint64();break;case 4:n.flags=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),gK=Q.StateSet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.author="",e.prototype.value="",e.prototype.lock="",e.prototype.requestUuid="",e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.baseRevision=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.lockRev=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.author&&Object.hasOwnProperty.call(e,"author")&&t.uint32(18).string(e.author),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(26).string(e.value),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(34).string(e.lock),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(42).string(e.requestUuid),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(48).uint64(e.sequence),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(56).uint64(e.flags),null!=e.baseRevision&&Object.hasOwnProperty.call(e,"baseRevision")&&t.uint32(64).uint64(e.baseRevision),null!=e.lockRev&&Object.hasOwnProperty.call(e,"lockRev")&&t.uint32(72).uint64(e.lockRev),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateSet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.author=e.string();break;case 3:n.value=e.string();break;case 4:n.lock=e.string();break;case 5:n.requestUuid=e.string();break;case 6:n.sequence=e.uint64();break;case 7:n.flags=e.uint64();break;case 8:n.baseRevision=e.uint64();break;case 9:n.lockRev=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),hK=Q.StateModify=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.author="",e.prototype.value="",e.prototype.lock="",e.prototype.requestUuid="",e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.baseRevision=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.lockRev=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.author&&Object.hasOwnProperty.call(e,"author")&&t.uint32(18).string(e.author),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(26).string(e.value),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(34).string(e.lock),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(42).string(e.requestUuid),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(48).uint64(e.sequence),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(56).uint64(e.flags),null!=e.baseRevision&&Object.hasOwnProperty.call(e,"baseRevision")&&t.uint32(64).uint64(e.baseRevision),null!=e.lockRev&&Object.hasOwnProperty.call(e,"lockRev")&&t.uint32(72).uint64(e.lockRev),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateModify;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.author=e.string();break;case 3:n.value=e.string();break;case 4:n.lock=e.string();break;case 5:n.requestUuid=e.string();break;case 6:n.sequence=e.uint64();break;case 7:n.flags=e.uint64();break;case 8:n.baseRevision=e.uint64();break;case 9:n.lockRev=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),iK=Q.StateRequestResult=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.requestUuid="",e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(10).string(e.requestUuid),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(16).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateRequestResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.requestUuid=e.string();break;case 2:n.sequence=e.uint64();break;case 3:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),jK=Q.StateGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.subTarget="",e.prototype.lock="",e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.lockRev=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.subTarget&&Object.hasOwnProperty.call(e,"subTarget")&&t.uint32(18).string(e.subTarget),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(26).string(e.lock),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(32).uint64(e.sequence),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(40).uint64(e.flags),null!=e.lockRev&&Object.hasOwnProperty.call(e,"lockRev")&&t.uint32(48).uint64(e.lockRev),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.subTarget=e.string();break;case 3:n.lock=e.string();break;case 4:n.sequence=e.uint64();break;case 5:n.flags=e.uint64();break;case 6:n.lockRev=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),kK=Q.StateGetResult=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.subTarget="",e.prototype.allStates="",e.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.subTarget&&Object.hasOwnProperty.call(e,"subTarget")&&t.uint32(18).string(e.subTarget),null!=e.allStates&&Object.hasOwnProperty.call(e,"allStates")&&t.uint32(26).string(e.allStates),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(32).uint64(e.sequence),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(40).uint64(e.flags),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(48).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateGetResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.subTarget=e.string();break;case 3:n.allStates=e.string();break;case 4:n.sequence=e.uint64();break;case 5:n.flags=e.uint64();break;case 6:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),lK=Q.StateLockAcquire=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.lock="",e.prototype.requestUuid="",e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.ttl=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(18).string(e.lock),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(26).string(e.requestUuid),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),null!=e.ttl&&Object.hasOwnProperty.call(e,"ttl")&&t.uint32(40).uint64(e.ttl),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateLockAcquire;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.lock=e.string();break;case 3:n.requestUuid=e.string();break;case 4:n.flags=e.uint64();break;case 5:n.ttl=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),mK=Q.StateLockRelease=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.lock="",e.prototype.requestUuid="",e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(18).string(e.lock),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(26).string(e.requestUuid),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateLockRelease;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.lock=e.string();break;case 3:n.requestUuid=e.string();break;case 4:n.flags=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),nK=Q.StateLockAcquireResult=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.lock="",e.prototype.requestUuid="",e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.lockRev=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.prototype.reason="",e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(18).string(e.lock),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(26).string(e.requestUuid),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),null!=e.lockRev&&Object.hasOwnProperty.call(e,"lockRev")&&t.uint32(40).uint64(e.lockRev),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(48).uint32(e.code),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(58).string(e.reason),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateLockAcquireResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.lock=e.string();break;case 3:n.requestUuid=e.string();break;case 4:n.flags=e.uint64();break;case 5:n.lockRev=e.uint64();break;case 6:n.code=e.uint32();break;case 7:n.reason=e.string();break;default:e.skipType(7&r)}}return n},e}(),oK=Q.StateLockUpdate=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.lock="",e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(18).string(e.lock),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(24).uint64(e.flags),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateLockUpdate;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.lock=e.string();break;case 3:n.flags=e.uint64();break;case 4:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),pK=Q.StateLockReleaseResult=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.lock="",e.prototype.requestUuid="",e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(18).string(e.lock),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(26).string(e.requestUuid),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(40).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateLockReleaseResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.lock=e.string();break;case 3:n.requestUuid=e.string();break;case 4:n.flags=e.uint64();break;case 5:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),qK=Q.StateLockDisable=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.lock="",e.prototype.userId="",e.prototype.requestUuid="",e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(18).string(e.lock),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(26).string(e.userId),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(34).string(e.requestUuid),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(40).uint64(e.flags),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateLockDisable;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.lock=e.string();break;case 3:n.userId=e.string();break;case 4:n.requestUuid=e.string();break;case 5:n.flags=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),rK=Q.StateLockDisableResult=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.target="",e.prototype.lock="",e.prototype.requestUuid="",e.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(10).string(e.target),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(18).string(e.lock),null!=e.requestUuid&&Object.hasOwnProperty.call(e,"requestUuid")&&t.uint32(26).string(e.requestUuid),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(32).uint64(e.flags),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(40).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.StateLockDisableResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.target=e.string();break;case 2:n.lock=e.string();break;case 3:n.requestUuid=e.string();break;case 4:n.flags=e.uint64();break;case 5:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),sK=Q.SubscribeResponse=function(){function e(e){if(this.errors=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,e.prototype.errors=I.emptyArray,e.encode=function(e,t){if(t||(t=ta.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.errors&&e.errors.length)for(var n=0;n<e.errors.length;++n)Q.SubscribeResponse.SubscribeErrorsType.encode(e.errors[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.SubscribeResponse;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.errors&&n.errors.length||(n.errors=[]),n.errors.push(Q.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.SubscribeErrorsType=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=ta.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof T||(e=T.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new Q.SubscribeResponse.SubscribeErrorsType;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.account=e.string();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),e}(),tK=Object.freeze({__proto__:null,URI:kJ,Wrapper:gl,Ping:lJ,Pong:mJ,UserJoin:nJ,UserResp:oJ,UserQuit:pJ,UserDrop:qJ,UserTicketNearlyExpire:rJ,UserRenewTokenReq:sJ,UserRenewTokenResp:tJ,GroupEnter:uJ,GroupLeave:vJ,GroupReply:wJ,GroupLeaveNotice:ax,GroupEnterNotice:bx,Message:cx,Ack:dx,GroupDrop:xJ,GroupAllUsersList:yJ,GroupAllUsersResult:zJ,UserStatusList:AJ,UserStatusResult:BJ,UserAttributeGet:CJ,UserAttributeRet:DJ,UserAttributeSet:EJ,UserAttributeMod:FJ,UserAttributeDel:GJ,UserAttributeErr:HJ,UserAttributeKeysGet:IJ,UserAttributeKeysRet:JJ,UserAttributeRsp:KJ,GroupStatusList:LJ,GroupStatusResult:MJ,GroupCountNotice:NJ,GroupAttributeGet:OJ,GroupAttributeRet:PJ,GroupAttributeSet:QJ,GroupAttributeMod:RJ,GroupAttributeDel:SJ,GroupAttributeAlt:TJ,GroupAttributeRsp:UJ,GroupAttributeErr:VJ,GroupAttributeKeysGet:WJ,GroupAttributeKeysRet:XJ,SubscribeUserStatus:YJ,UnsubscribeUserStatus:ZJ,UserJoinNotice:$J,UserQuitNotice:aK,UserWaitNotice:bK,StateSubscribe:cK,StateUpdate:dK,StateSubscribeResult:eK,StateUnsubscribe:fK,StateSet:gK,StateModify:hK,StateRequestResult:iK,StateGet:jK,StateGetResult:kK,StateLockAcquire:lK,StateLockRelease:mK,StateLockAcquireResult:nK,StateLockUpdate:oK,StateLockReleaseResult:pK,StateLockDisable:qK,StateLockDisableResult:rK,SubscribeResponse:sK,default:Q}),uK=Math.ceil,ex=function(e){return function(t,n,r){var i=(t=String(Ec(t))).length;return r=void 0===r?" ":String(r),(n=xb(n))<=i||""==r?t:(n-=i,(i=At.call(r,uK(n/r.length))).length>n&&(i=i.slice(0,n)),e?t+i:i+t)}},vK=ex(!1),wK=ex(!0),fx=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(lh);wa({target:"String",proto:!0,forced:fx},{padEnd:function(e){return wK(this,e,1<arguments.length?arguments[1]:void 0)}}),wa({target:"Object",stat:!0},{entries:function(e){return BF(e)}});var xK=pd.f,gx="".endsWith,yK=Math.min,hx=no("endsWith"),zK=!hx&&!!function(){var e=xK(String.prototype,"endsWith");return e&&!e.writable}();wa({target:"String",proto:!0,forced:!zK&&!hx},{endsWith:function(e){var t=String(Ec(this));mo(e);var n=1<arguments.length?arguments[1]:void 0,r=xb(t.length);return n=void 0===n?r:yK(xb(n),r),r=String(e),gx?gx.call(t,r,n):t.slice(n-r.length,n)===r}}),jk("match",1,(function(e,t,n){return[function(t){var n=Ec(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;if(e=ub(e),r=String(this),!e.global)return mh(e,r);var i=e.unicode;e.lastIndex=0;for(var o,a=[],s=0;null!==(o=mh(e,r));)o=String(o[0]),a[s]=o,""===o&&(e.lastIndex=hn(r,xb(e.lastIndex),i)),s++;return 0===s?null:a}]}));var AK=pd.f,ix="".startsWith,BK=Math.min,jx=no("startsWith"),CK=!jx&&!!function(){var e=AK(String.prototype,"startsWith");return e&&!e.writable}();wa({target:"String",proto:!0,forced:!CK&&!jx},{startsWith:function(e){var t=String(Ec(this));mo(e);var n=xb(BK(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return ix?ix.call(t,r,n):t.slice(n,n+r.length)===r}});var us=function(e){var t=/(%?)(%([jds]))/g,n=Array.prototype.slice.call(arguments,1);return n.length&&(e=e.replace(t,(function(e,t,r,i){switch(r=n.shift(),i){case"s":r=""+r;break;case"d":r=Number(r);break;case"j":r=JSON.stringify(r)}return t?(n.unshift(r),e):r}))),n.length&&(e+=" "+n.join(" ")),""+e.replace(/%{2,2}/g,"%")},DK=/\s/,EK=/^\s+/,kx=NaN,FK=/^[-+]0x[0-9a-f]+$/i,GK=/^0b[01]+$/i,HK=/^0o[0-7]+$/i,IK=parseInt,hl=function(e){if("number"==typeof e)return e;if(Sg(e))return kx;if(Kc(e)&&(e="function"==typeof e.valueOf?e.valueOf():e,e=Kc(e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;if(e){for(var t=e.slice,n=e.length;n--&&DK.test(e.charAt(n)););e=t.call(e,0,n+1).replace(EK,"")}return(t=GK.test(e))||HK.test(e)?IK(e.slice(2),t?2:8):FK.test(e)?kx:+e},JK=Math.max,KK=Math.min,LK=function(e,t,n){function r(t){var n=c,r=u;return c=u=void 0,p=t,l=e.apply(r,n)}function i(e){var n=e-d;return e-=p,void 0===d||n>=t||0>n||v&&e>=g}function o(){var e=hd.Date.now();if(i(e))return a(e);var n=setTimeout,r=e-p;e=t-(e-d),r=v?KK(e,g-r):e,f=n(o,r)}function a(e){return f=void 0,m&&c?r(e):(c=u=void 0,l)}function s(){var e=hd.Date.now(),n=i(e);if(c=arguments,u=this,d=e,n){if(void 0===f)return p=e=d,f=setTimeout(o,t),h?r(e):l;if(v)return clearTimeout(f),f=setTimeout(o,t),r(d)}return void 0===f&&(f=setTimeout(o,t)),l}var c,u,l,f,d,p=0,h=!1,v=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=hl(t)||0,Kc(n)){h=!!n.leading;var g=(v="maxWait"in n)?JK(hl(n.maxWait)||0,t):g;m="trailing"in n?!!n.trailing:m}return s.cancel=function(){void 0!==f&&clearTimeout(f),p=0,c=d=u=f=void 0},s.flush=function(){return void 0===f?l:a(hd.Date.now())},s},vb;!function(e){e[e.ChannelSMsg=1]="ChannelSMsg",e[e.ChannelRMsg=2]="ChannelRMsg",e[e.P2pSMsgOfflineFlag=3]="P2pSMsgOfflineFlag",e[e.P2pRMsgOfflineFlag=4]="P2pRMsgOfflineFlag",e[e.P2pSMsgNoOfflineFlag=5]="P2pSMsgNoOfflineFlag",e[e.P2pRMsgNoOfflineFlag=6]="P2pRMsgNoOfflineFlag",e[e.P2pCallInvitation=7]="P2pCallInvitation",e[e.P2pCallCancellation=8]="P2pCallCancellation",e[e.P2pCallAcceptance=9]="P2pCallAcceptance",e[e.P2pCallRefusal=10]="P2pCallRefusal"}(vb||(vb={}));var Xe=function(e){function t(e,r){return ab(this,t),E(L(e=n.call(this,ts(e,r))),"originalError",void 0),E(L(e),"code",void 0),E(L(e),"serverCode",void 0),"number"==typeof r?e.code=r:"string"==typeof r?e.name=r:void 0!==r&&(r.originalError&&(e.originalError=r.originalError),void 0!==r.code&&(e.code=r.code),void 0!==r.serverCode&&(e.serverCode=r.serverCode)),e}nb(t,e);var n=ob(t);return t}(di(Error)),Ib=function(e){function t(e,r){return ab(this,t),E(L(e=n.call(this,ts(e,r))),"name","RtmInternalError"),E(L(e),"code",void 0),e.code=r,e}nb(t,e);var n=ob(t);return t}(di(Error)),il=function(){return function(e){function t(e){ab(this,t);var r=Object.keys(e);return n.call(this,e[r[0]],r[0])}nb(t,e);var n=ob(t);return t}(Ib)},rb=il(),Pc=function(e){function t(){ab(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return E(L(e=n.call.apply(n,[this].concat(r))),"name","RtmTimeoutError"),e}nb(t,e);var n=ob(t);return t}(Xe),ja=function(e){function t(){ab(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return E(L(e=n.call.apply(n,[this].concat(r))),"name","RtmInvalidArgumentError"),e}nb(t,e);var n=ob(t);return t}(Xe),ia=function(e){function t(){ab(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return E(L(e=n.call.apply(n,[this].concat(r))),"name","RtmInvalidStatusError"),e}nb(t,e);var n=ob(t);return t}(Xe),Dc=function(e){function t(){ab(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return E(L(e=n.call.apply(n,[this].concat(r))),"name","RtmLimitExceededError"),e}nb(t,e);var n=ob(t);return t}(Xe),Fc=function(e){function t(){ab(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return E(L(e=n.call.apply(n,[this].concat(r))),"name","RtmInvokeTooOftenError"),e}nb(t,e);var n=ob(t);return t}(Xe),Pa=function(e){function t(){ab(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return E(L(e=n.call.apply(n,[this].concat(r))),"name","RtmUnavailableError"),E(L(e),"serverCode",void 0),E(L(e),"statusCode",void 0),e}nb(t,e);var n=ob(t);return t}(Xe),Gh=function(e){function t(){ab(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return E(L(e=n.call.apply(n,[this].concat(r))),"name","RtmUnauthenticatedError"),E(L(e),"serverCode",void 0),e}nb(t,e);var n=ob(t);return t}(Xe),id=function(e){function t(){ab(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return E(L(e=n.call.apply(n,[this].concat(r))),"name","RtmUnknownError"),e}nb(t,e);var n=ob(t);return t}(Xe),uc=function(e){return e instanceof Pc||e instanceof ad},Sa=function(e){return e instanceof Xe},vg=function(e,t,n){return['Executing "%s.%s" timed out after %ds',e,t,n/1e3]},ss=new Map,MK=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},vi=Object.keys,Vj=Object.entries.bind(Object),Sj=function(e){return"string"==typeof e?e.endsWith(".")?e:"".concat(e,"."):e},NK=Ga((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));wa({target:"Date",proto:!0,forced:NK},{toJSON:function(e){e=Zb(this);var t=le(e);return"number"!=typeof t||isFinite(t)?e.toISOString():null}}),wa({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var rC=Object.prototype.hasOwnProperty,lx=function(e,t,n){return JSON.stringify(As(e),t,n)};lx.ensureProperties=As;var OK=function(e,t){t=t||{};var n=Ia(e);if("string"===n&&0<e.length)return sC(e);if("number"===n&&isFinite(e))return e=t.long?864e5<=(t=Math.abs(e))?Xj(e,t,864e5,"day"):36e5<=t?Xj(e,t,36e5,"hour"):6e4<=t?Xj(e,t,6e4,"minute"):1e3<=t?Xj(e,t,1e3,"second"):e+" ms":864e5<=(t=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=t?Math.round(e/36e5)+"h":6e4<=t?Math.round(e/6e4)+"m":1e3<=t?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},PK=function(e){function t(e){function r(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(r.enabled){e=Number(new Date),r.diff=e-(i||e),r.prev=i,i=r.curr=e,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,i){return"%%"===e?"%":(a++,"function"==typeof(i=t.formatters[i])&&(e=i.call(r,n[a]),n.splice(a,1),a--),e)})),t.formatArgs.call(r,n),(r.log||t.log).apply(r,n)}}var i,o=null;return r.namespace=e,r.useColors=t.useColors(),r.color=t.selectColor(e),r.extend=n,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===o?t.enabled(e):o},set:function(e){o=e}}),"function"==typeof t.init&&t.init(r),r}function n(e,n){return(e=t(this.namespace+(void 0===n?":":n)+e)).log=this.log,e}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(ra(t.names.map(r)),ra(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r=0;for(n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=OK,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},mx=kc((function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){try{var e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var n=localStorage;break e}catch(r){}n=void 0}var r;t.storage=n,t.destroy=(r=!1,function(){r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),t.log=console.debug||console.log||function(){},e.exports=PK(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),nx=mx("RTM:DEBUG"),Hh;nx.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Hh||(Hh={}));var QK=function(){function e(t){ab(this,e),E(this,"uploadRequest",void 0),E(this,"uploadState",void 0),E(this,"uploadResendCount",void 0),E(this,"LogCache",void 0),E(this,"LogsToPost",void 0),E(this,"processId",void 0),E(this,"sdkVersion",void 0),E(this,"logId",void 0),E(this,"rtmConfig",void 0),this.processId=t.processId,this.sdkVersion=t.sdkVersion,this.rtmConfig=t.rtmConfig,this.uploadRequest=t.uploadRequest,this.uploadState=Hh.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Qb(e,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===Hh.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var t=this;this.uploadState=Hh.Uploading,setTimeout(za(W.mark((function n(){var r,i,o;return W.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={sdk_version:t.sdkVersion,process_id:t.processId,payload:JSON.stringify(e)},n.prev=1,n.next=4,t.uploadRequest(r,null!==(i=t.rtmConfig.enableCloudProxy)&&void 0!==i&&i);case 4:if(!Bm){n.next=6;break}throw Error("RTM is busy");case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),o=2>t.uploadResendCount++?2e3:1e4,setTimeout((function(){return t.postLog(t.LogsToPost)}),o),n.abrupt("return");case 13:if(nx('The logs uploaded for "process-'.concat(hj,'"')),0!==t.LogCache.length){n.next=17;break}return t.uploadState=Hh.Free,n.abrupt("return");case 17:t.uploadResendCount=0,t.LogsToPost=40>t.LogCache.length?t.LogCache.splice(0,t.LogCache.length):t.LogCache.splice(0,40),t.postLog(t.LogsToPost);case 20:case"end":return n.stop()}}),n,null,[[1,8]])}))),wg.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),ox=function e(t,n,r,i,o,a,s,c){var u=0;for(s=!!s&&tf(s,c,3);u<i;){if(u in r){if(c=s?s(r[u],u,n):r[u],0<a&&uf(c))o=e(t,n,c,xb(c.length),o,a-1)-1;else{if(9007199254740991<=o)throw TypeError("Exceed the acceptable array length");t[o]=c}o++}u++}return o},px=ox;wa({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Zb(this),n=xb(t.length),r=Ei(t,0);return r.length=px(r,t,t,n,0,void 0===e?1:Rd(e)),r}});var RK=["CODE"],jd,Gf,oa;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(oa||(oa={}));var SK={CN:oa.CHINA,NA:oa.NORTH_AMERICA,EU:oa.EUROPE,AS:oa.ASIA,JP:oa.JAPAN,IN:oa.INDIA,GLOB:oa.GLOBAL,AF:oa.AFRICA,OC:oa.OVERSEA,OVS:oa.OVERSEA,SA:oa.SOUTH_AMERICA},Yj=ys((jd={},E(jd,oa.ASIA,{CODE:oa.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.NORTH_AMERICA,{CODE:oa.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.EUROPE,{CODE:oa.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.JAPAN,{CODE:oa.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.INDIA,{CODE:oa.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.OVERSEA,{CODE:oa.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),E(jd,oa.GLOBAL,{CODE:oa.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.OCEANIA,{CODE:oa.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.SOUTH_AMERICA,{CODE:oa.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.AFRICA,{CODE:oa.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.CHINA,{CODE:oa.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),jd)),wi=(Gf={},E(Gf,oa.ASIA,[oa.CHINA,oa.JAPAN,oa.INDIA]),E(Gf,oa.EUROPE,[]),E(Gf,oa.NORTH_AMERICA,[]),E(Gf,oa.SOUTH_AMERICA,[]),E(Gf,oa.OCEANIA,[]),E(Gf,oa.AFRICA,[]),Gf),qx=[oa.OVERSEA,oa.GLOBAL,oa.CHINA,oa.NORTH_AMERICA,oa.EUROPE,oa.ASIA,oa.JAPAN,oa.INDIA,oa.OCEANIA,oa.SOUTH_AMERICA,oa.AFRICA],Bs=function(e){return Object.values(wi).flat().includes(e)},uC=function(e){var t;return null===(t=Vj(wi).find((function(t){return(t=Lb(t,2))[0],t[1].includes(e)})))||void 0===t?void 0:t[0]},TK=function(e){return e.sort((function(e,t){return qx.indexOf(e)-qx.indexOf(t)}))},eh=function(e){var t=new Set;if(0===(e=TK(e).slice(0,3).map((function(e){var n=Yj[e];if(void 0===n)throw new Ib("invalid area key");return e=n.CODE,n=em(n,RK),t.add(e),n}))).length)throw new Ib("areas cannot be empty");return tb({CODES:t},e.reduce((function(e,t){for(var n=0,r=Vj(e);n<r.length;n++){var i=Lb(r[n],2),o=i[0];i=i[1],e[o]=Array.from(new Set([].concat(ra(t[o]),ra(i))))}return e})))},Ba,rx=function(){var e=za(W.mark((function e(t,n){var r,i,o,a,s,c=arguments;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(2<(i=2<c.length&&void 0!==c[2]?c[2]:0))){e.next=3;break}return e.abrupt("return");case 3:return o={withCredentials:!0,body:t,timeout:2e4},a=0<i?(null==Ba?void 0:Ba.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(null==Ba?void 0:Ba.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",s=n?"https://".concat(null!==(r=null==Ba?void 0:Ba.PROXY_NGINX[0])&&void 0!==r?r:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(a,"&p=443&d=upload/v1"):"https://".concat(a,"/upload/v1"),e.next=8,Tj(s,o).catch((function(e){return rx(t,n,i+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),sx=new QK({processId:"process-".concat(hj),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.5.1-67-g0f6d3600"),uploadRequest:rx,rtmConfig:{}}),pp="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),tx="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),ux=["serverReceivedTs","hasPeerReceived","messageType","enableNotificationToChannelMembers","lastUpdateTs"],UK="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),fh=function(e){if("string"==typeof e)return wb(e);if(Array.isArray(e)&&e.every((function(e){return"string"==typeof e})))return e.map((function(e){return wb(e)}));if(!or(e)){for(var t={},n=0;n<ux.length;n++){var r=ux[n];r in e&&(t[r]=e[r])}if(0<Object.keys(t).length)return t;if(5>Object.keys(e).length){for(n=0,e=Object.entries(e);n<e.length;n++){var i=Lb(e[n],2);r=i[0],i=i[1],pp.includes(r)?t[r]="[Hidden Info]":t[wb(r)]="string"==typeof i?wb(i):"[Sensitive Info]"}return t}return"[Sensitive Info]"}return e},vx=function(e){return"object"===Ia(e)?Lg(e)?xs(Pg(e,5),pp,tx):e.constructor&&e.constructor.name:e},wx=function(e,t){return e instanceof Error?e.message:"string"!=typeof e?JSON.stringify(xs(Pg(e,5),pp,tx)):(t=t.map((function(e){return e instanceof Error?e.message:"object"===Ia(e)?lx(Array.isArray(e)?e.map(vx):vx(e)):e})),us.apply(void 0,[e.replace(/%[%Oo]/g,(function(e){return"%%"===e?"%":"%o"===e||"%O"===e?"%s":e}))].concat(ra(t))))},VK=1,xx=function(e,t,n){var r=mx(e);return r.enabled=!0,r.log=n,r.useColors=!1,function(n){for(var i=arguments.length,o=Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];if(t.enableLogUpload){i=Sj(n);var s=wx(i,o);sx.upload({log_item_id:"".concat(VK++),log_level:e,payload_str:"[".concat(MK(),"] ").concat(e," - ").concat(256<s.length?s.slice(0,256):s)})}switch(i=function(e){var t=s||wx(Sj(n),o),i=Yd.LOG_HANDLER;"function"==typeof i&&i({level:e,message:t}),r(t)},e){case"RTM:INFO":t.logFilter.info&&i("log");break;case"RTM:WARN":t.logFilter.warn&&i("warning");break;case"RTM:ERROR":t.logFilter.error&&i("error");break;case"RTM:TRACK":t.logFilter.track&&i("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":t.logFilter.debug&&i("debug")}}},qp,yx=function(e){return function(t){var n=1===qp||void 0===e?"":"Ins#".concat(e," ");return"".concat(n).concat(t)}},rp=function(e,t,n){var r=yx(qp);return xx("RTM:".concat(t),n,(function(t){return e(r(t))}))},Dd=function(){return function(e){function t(e,r){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];ab(this,t);var o=n.call(this);if(E(L(o),"logError",void 0),E(L(o),"invokeTracker",void 0),E(L(o),"resultTracker",void 0),E(L(o),"errorTracker",void 0),E(L(o),"eventTracker",void 0),E(L(o),"info",void 0),E(L(o),"warn",void 0),E(L(o),"log",void 0),E(L(o),"genLogger",void 0),E(L(o),"loggerId",void 0),E(L(o),"logger",void 0),E(L(o),"name",void 0),o.logger=e,o.name=r,o.loggerId=e.loggerId,o.info=e.info,o.warn=e.warn,o.logError=e.logError,o.genLogger=e.genLogger,o.log=e.genLogger("RTM:DEBUG","<".concat(r,"> ")),o.invokeTracker=e.genTracker("Invoke"),o.eventTracker=e.genTracker("Event"),o.resultTracker=e.genTracker("Result"),o.errorTracker=e.genTracker("Error"),i){var a=o.emit.bind(L(o));o.emit=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];e=t[0],n=t.slice(1);var i=UK.includes(e);o.eventTracker.apply(o,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map((function(){return"%o"}))):"%s emitted"),r,e].concat(ra(i?n.map(fh):n)));try{a.apply(void 0,t)}catch(t){o.logError("Caught in the callback function of the event %s",e,t)}}}return o}nb(t,e);var n=ob(t);return t}(kb)},WK=function(e){return rp(console.log.bind(console),"INFO",e)},XK=function(e){return rp(console.warn.bind(console),"WARN",e)},YK=function(e){return rp(console.error.bind(console),"ERROR",e)},zx=function(e,t){return function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=yx(e),o=console.debug.bind(console),a=xx(n,t,(function(e){return o(i(e))}));return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return a.apply(void 0,[r+e].concat(n))}}},ZK=function(e,t){return function(n){return zx(e,t)("RTM:TRACK","[".concat(n,"] "))}},Tm=Q.URI,wC=gl,$K=em(tK,["Wrapper"]),Cs=Oo($K,"URI"),Ax=function(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=e[r=Uw(n,i)];e[r]=e[n],e[n]=o}return e.length=t,e},aL=function(e){return Ax(jm(e))},bL=function(e){return Ax(Vm(e))},Ih=function(e){return(lc(e)?aL:bL)(e)},Jh={0:9591,1:9593},xg=function(e){var t=ui(null);return"https://".concat(t?null:e,"/api/v1")},cL=Wb.apply(void 0,ra(Ih(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map(xg)))),dL=Wb.apply(void 0,ra(Ih(["ap-web-1.agora.io","ap-web-2.agora.io"].map(xg)))),eL=Wb.apply(void 0,ra(Ih(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map(xg)))),fL=Wb.apply(void 0,ra(Ih(["ap-web-3.agora.io","ap-web-4.agora.io"].map(xg)))),vc=ae.Writer,O=ae.util,bc=ae.roots.default||(ae.roots.default={}),gL=bc.Session=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.appId&&Object.hasOwnProperty.call(e,"appId")&&t.uint32(42).string(e.appId),null!=e.ver&&Object.hasOwnProperty.call(e,"ver")&&t.uint32(50).string(e.ver),null!=e.buildno&&Object.hasOwnProperty.call(e,"buildno")&&t.uint32(56).int32(e.buildno),null!=e.installId&&Object.hasOwnProperty.call(e,"installId")&&t.uint32(66).string(e.installId),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(128).int32(e.os),null!=e.did&&Object.hasOwnProperty.call(e,"did")&&t.uint32(138).string(e.did),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&bc.Session.CommonIndex.encode(e.index,t.uint32(162).fork()).ldelim(),null!=e.token&&Object.hasOwnProperty.call(e,"token")&&t.uint32(170).string(e.token),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(176).int32(e.version),null!=e.subVersion&&Object.hasOwnProperty.call(e,"subVersion")&&t.uint32(184).int32(e.subVersion),t},e.CommonIndex=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=vc.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),e}(),hL=bc.ApEvent=function(){function e(e){if(this.linkServerList=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.apAddr="",e.prototype.linkServerList=O.emptyArray,e.prototype.errCode=0,e.prototype.serverErrCode=0,e.prototype.isp="",e.prototype.opId=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.envId=0,e.prototype.flag=0,e.prototype.area="",e.encode=function(e,t){if(t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.apAddr&&Object.hasOwnProperty.call(e,"apAddr")&&t.uint32(50).string(e.apAddr),null!=e.linkServerList&&e.linkServerList.length)for(var n=0;n<e.linkServerList.length;++n)t.uint32(58).string(e.linkServerList[n]);return null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(72).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(80).int32(e.serverErrCode),null!=e.isp&&Object.hasOwnProperty.call(e,"isp")&&t.uint32(90).string(e.isp),null!=e.opId&&Object.hasOwnProperty.call(e,"opId")&&t.uint32(96).int64(e.opId),null!=e.envId&&Object.hasOwnProperty.call(e,"envId")&&t.uint32(104).int32(e.envId),null!=e.flag&&Object.hasOwnProperty.call(e,"flag")&&t.uint32(112).int32(e.flag),null!=e.area&&Object.hasOwnProperty.call(e,"area")&&t.uint32(122).string(e.area),t},e}(),iL=bc.ApRequest=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.apAddr="",e.prototype.opId=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.envId=0,e.prototype.flag=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.apAddr&&Object.hasOwnProperty.call(e,"apAddr")&&t.uint32(42).string(e.apAddr),null!=e.opId&&Object.hasOwnProperty.call(e,"opId")&&t.uint32(48).int64(e.opId),null!=e.envId&&Object.hasOwnProperty.call(e,"envId")&&t.uint32(56).int32(e.envId),null!=e.flag&&Object.hasOwnProperty.call(e,"flag")&&t.uint32(64).int32(e.flag),t},e}(),jL=bc.LinkLoginRequest=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.destServerIp="",e.prototype.linkId=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(42).string(e.destServerIp),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),t},e}(),kL=bc.Link=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(40).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(48).int32(e.sc),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(58).string(e.destServerIp),null!=e.ackedServerIp&&Object.hasOwnProperty.call(e,"ackedServerIp")&&t.uint32(66).string(e.ackedServerIp),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(72).int32(e.responseTime),t},e}(),lL=bc.Logout=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),t},e}(),mL=bc.KickedOff=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(56).int32(e.code),null!=e.server&&Object.hasOwnProperty.call(e,"server")&&t.uint32(66).string(e.server),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(72).int32(e.serverCode),t},e}(),nL=bc.ChnJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),oL=bc.ChnJoinRes=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(64).int32(e.serverErrCode),t},e}(),pL=bc.ChnLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),qL=bc.ConnectionStateChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(e,t){return t||(t=vc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.oldState&&Object.hasOwnProperty.call(e,"oldState")&&t.uint32(40).int32(e.oldState),null!=e.newState&&Object.hasOwnProperty.call(e,"newState")&&t.uint32(48).int32(e.newState),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(56).int32(e.reason),null!=e.reconnId&&Object.hasOwnProperty.call(e,"reconnId")&&t.uint32(64).int32(e.reconnId),t},e}(),Bx=bc.RtmSdkMessageCount=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.vid=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.sid="",e.prototype.messagecategory=0,e.prototype.reportsequence=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.sentcount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.receivedcount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack10mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack25mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack50mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack75mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack100mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack150mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack200mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack250mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack300mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack400mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack500mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack600mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack800mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack1000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack2000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack3000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack5000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerack7000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.peerackslowcount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack10mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack25mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack50mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack75mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack100mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack150mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack200mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack250mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack300mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack400mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack500mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack600mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack800mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack1000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack2000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack3000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack5000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientack7000mscount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.norecipientackslowcount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.acktimeoutcount=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.apimajorversion=0,e.prototype.apiminorversion=0,e.prototype.os=0,e.prototype.toooftencount=0,e.prototype.receiverofflinecount=0,e.prototype.invalidmessagecount=0,e.prototype.unknowerrorcount=0,e.prototype.servercachedcount=0,e.prototype.timeoutcount=0,e.prototype.successcount=0,e.prototype.userid="",e.encode=function(e,t){return t||(t=vc.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(16).int64(e.vid),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(26).string(e.sid),null!=e.messagecategory&&Object.hasOwnProperty.call(e,"messagecategory")&&t.uint32(32).int32(e.messagecategory),null!=e.reportsequence&&Object.hasOwnProperty.call(e,"reportsequence")&&t.uint32(40).int64(e.reportsequence),null!=e.sentcount&&Object.hasOwnProperty.call(e,"sentcount")&&t.uint32(48).int64(e.sentcount),null!=e.receivedcount&&Object.hasOwnProperty.call(e,"receivedcount")&&t.uint32(56).int64(e.receivedcount),null!=e.peerack10mscount&&Object.hasOwnProperty.call(e,"peerack10mscount")&&t.uint32(64).int64(e.peerack10mscount),null!=e.peerack25mscount&&Object.hasOwnProperty.call(e,"peerack25mscount")&&t.uint32(72).int64(e.peerack25mscount),null!=e.peerack50mscount&&Object.hasOwnProperty.call(e,"peerack50mscount")&&t.uint32(80).int64(e.peerack50mscount),null!=e.peerack75mscount&&Object.hasOwnProperty.call(e,"peerack75mscount")&&t.uint32(88).int64(e.peerack75mscount),null!=e.peerack100mscount&&Object.hasOwnProperty.call(e,"peerack100mscount")&&t.uint32(96).int64(e.peerack100mscount),null!=e.peerack150mscount&&Object.hasOwnProperty.call(e,"peerack150mscount")&&t.uint32(104).int64(e.peerack150mscount),null!=e.peerack200mscount&&Object.hasOwnProperty.call(e,"peerack200mscount")&&t.uint32(112).int64(e.peerack200mscount),null!=e.peerack250mscount&&Object.hasOwnProperty.call(e,"peerack250mscount")&&t.uint32(120).int64(e.peerack250mscount),null!=e.peerack300mscount&&Object.hasOwnProperty.call(e,"peerack300mscount")&&t.uint32(128).int64(e.peerack300mscount),null!=e.peerack400mscount&&Object.hasOwnProperty.call(e,"peerack400mscount")&&t.uint32(136).int64(e.peerack400mscount),null!=e.peerack500mscount&&Object.hasOwnProperty.call(e,"peerack500mscount")&&t.uint32(144).int64(e.peerack500mscount),null!=e.peerack600mscount&&Object.hasOwnProperty.call(e,"peerack600mscount")&&t.uint32(152).int64(e.peerack600mscount),null!=e.peerack800mscount&&Object.hasOwnProperty.call(e,"peerack800mscount")&&t.uint32(160).int64(e.peerack800mscount),null!=e.peerack1000mscount&&Object.hasOwnProperty.call(e,"peerack1000mscount")&&t.uint32(168).int64(e.peerack1000mscount),null!=e.peerack2000mscount&&Object.hasOwnProperty.call(e,"peerack2000mscount")&&t.uint32(176).int64(e.peerack2000mscount),null!=e.peerack3000mscount&&Object.hasOwnProperty.call(e,"peerack3000mscount")&&t.uint32(184).int64(e.peerack3000mscount),null!=e.peerack5000mscount&&Object.hasOwnProperty.call(e,"peerack5000mscount")&&t.uint32(192).int64(e.peerack5000mscount),null!=e.peerack7000mscount&&Object.hasOwnProperty.call(e,"peerack7000mscount")&&t.uint32(200).int64(e.peerack7000mscount),null!=e.peerackslowcount&&Object.hasOwnProperty.call(e,"peerackslowcount")&&t.uint32(208).int64(e.peerackslowcount),null!=e.norecipientack10mscount&&Object.hasOwnProperty.call(e,"norecipientack10mscount")&&t.uint32(216).int64(e.norecipientack10mscount),null!=e.norecipientack25mscount&&Object.hasOwnProperty.call(e,"norecipientack25mscount")&&t.uint32(224).int64(e.norecipientack25mscount),null!=e.norecipientack50mscount&&Object.hasOwnProperty.call(e,"norecipientack50mscount")&&t.uint32(232).int64(e.norecipientack50mscount),null!=e.norecipientack75mscount&&Object.hasOwnProperty.call(e,"norecipientack75mscount")&&t.uint32(240).int64(e.norecipientack75mscount),null!=e.norecipientack100mscount&&Object.hasOwnProperty.call(e,"norecipientack100mscount")&&t.uint32(248).int64(e.norecipientack100mscount),null!=e.norecipientack150mscount&&Object.hasOwnProperty.call(e,"norecipientack150mscount")&&t.uint32(256).int64(e.norecipientack150mscount),null!=e.norecipientack200mscount&&Object.hasOwnProperty.call(e,"norecipientack200mscount")&&t.uint32(264).int64(e.norecipientack200mscount),null!=e.norecipientack250mscount&&Object.hasOwnProperty.call(e,"norecipientack250mscount")&&t.uint32(272).int64(e.norecipientack250mscount),null!=e.norecipientack300mscount&&Object.hasOwnProperty.call(e,"norecipientack300mscount")&&t.uint32(280).int64(e.norecipientack300mscount),null!=e.norecipientack400mscount&&Object.hasOwnProperty.call(e,"norecipientack400mscount")&&t.uint32(288).int64(e.norecipientack400mscount),null!=e.norecipientack500mscount&&Object.hasOwnProperty.call(e,"norecipientack500mscount")&&t.uint32(296).int64(e.norecipientack500mscount),null!=e.norecipientack600mscount&&Object.hasOwnProperty.call(e,"norecipientack600mscount")&&t.uint32(304).int64(e.norecipientack600mscount),null!=e.norecipientack800mscount&&Object.hasOwnProperty.call(e,"norecipientack800mscount")&&t.uint32(312).int64(e.norecipientack800mscount),null!=e.norecipientack1000mscount&&Object.hasOwnProperty.call(e,"norecipientack1000mscount")&&t.uint32(320).int64(e.norecipientack1000mscount),null!=e.norecipientack2000mscount&&Object.hasOwnProperty.call(e,"norecipientack2000mscount")&&t.uint32(328).int64(e.norecipientack2000mscount),null!=e.norecipientack3000mscount&&Object.hasOwnProperty.call(e,"norecipientack3000mscount")&&t.uint32(336).int64(e.norecipientack3000mscount),null!=e.norecipientack5000mscount&&Object.hasOwnProperty.call(e,"norecipientack5000mscount")&&t.uint32(344).int64(e.norecipientack5000mscount),null!=e.norecipientack7000mscount&&Object.hasOwnProperty.call(e,"norecipientack7000mscount")&&t.uint32(352).int64(e.norecipientack7000mscount),null!=e.norecipientackslowcount&&Object.hasOwnProperty.call(e,"norecipientackslowcount")&&t.uint32(360).int64(e.norecipientackslowcount),null!=e.acktimeoutcount&&Object.hasOwnProperty.call(e,"acktimeoutcount")&&t.uint32(368).int64(e.acktimeoutcount),null!=e.apimajorversion&&Object.hasOwnProperty.call(e,"apimajorversion")&&t.uint32(376).int32(e.apimajorversion),null!=e.apiminorversion&&Object.hasOwnProperty.call(e,"apiminorversion")&&t.uint32(384).int32(e.apiminorversion),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(392).int32(e.os),null!=e.toooftencount&&Object.hasOwnProperty.call(e,"toooftencount")&&t.uint32(400).int32(e.toooftencount),null!=e.receiverofflinecount&&Object.hasOwnProperty.call(e,"receiverofflinecount")&&t.uint32(408).int32(e.receiverofflinecount),null!=e.invalidmessagecount&&Object.hasOwnProperty.call(e,"invalidmessagecount")&&t.uint32(416).int32(e.invalidmessagecount),null!=e.unknowerrorcount&&Object.hasOwnProperty.call(e,"unknowerrorcount")&&t.uint32(424).int32(e.unknowerrorcount),null!=e.servercachedcount&&Object.hasOwnProperty.call(e,"servercachedcount")&&t.uint32(432).int32(e.servercachedcount),null!=e.timeoutcount&&Object.hasOwnProperty.call(e,"timeoutcount")&&t.uint32(440).int32(e.timeoutcount),null!=e.successcount&&Object.hasOwnProperty.call(e,"successcount")&&t.uint32(448).int32(e.successcount),null!=e.userid&&Object.hasOwnProperty.call(e,"userid")&&t.uint32(458).string(e.userid),t},e}(),rL=bc.SyncOperateEvent=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.userid="",e.prototype.vid=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.sid="",e.prototype.requestts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.replyts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.target="",e.prototype.eventtype="",e.prototype.revision=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.uuid="",e.prototype.sdktype=0,e.prototype.flags=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.code=0,e.prototype.seq=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.index=null,e.prototype.lock="",e.prototype.lockrev=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.subtarget="",e.prototype.usersid="",e.encode=function(e,t){return t||(t=vc.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.userid&&Object.hasOwnProperty.call(e,"userid")&&t.uint32(26).string(e.userid),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(32).int64(e.vid),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(42).string(e.sid),null!=e.requestts&&Object.hasOwnProperty.call(e,"requestts")&&t.uint32(48).int64(e.requestts),null!=e.replyts&&Object.hasOwnProperty.call(e,"replyts")&&t.uint32(56).int64(e.replyts),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(66).string(e.target),null!=e.eventtype&&Object.hasOwnProperty.call(e,"eventtype")&&t.uint32(74).string(e.eventtype),null!=e.revision&&Object.hasOwnProperty.call(e,"revision")&&t.uint32(80).int64(e.revision),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(90).string(e.uuid),null!=e.sdktype&&Object.hasOwnProperty.call(e,"sdktype")&&t.uint32(96).int32(e.sdktype),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(104).int64(e.flags),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(112).int32(e.code),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(120).int64(e.seq),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&bc.CommonIndex.encode(e.index,t.uint32(130).fork()).ldelim(),null!=e.lock&&Object.hasOwnProperty.call(e,"lock")&&t.uint32(138).string(e.lock),null!=e.lockrev&&Object.hasOwnProperty.call(e,"lockrev")&&t.uint32(144).int64(e.lockrev),null!=e.subtarget&&Object.hasOwnProperty.call(e,"subtarget")&&t.uint32(154).string(e.subtarget),null!=e.usersid&&Object.hasOwnProperty.call(e,"usersid")&&t.uint32(162).string(e.usersid),t},e}(),sL=bc.SyncSubscribeEvent=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.userid="",e.prototype.vid=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.sid="",e.prototype.target="",e.prototype.eventtype="",e.prototype.sdktype=0,e.prototype.flags=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.code=0,e.prototype.seq=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.requestts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.replyts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.index=null,e.prototype.subtarget="",e.prototype.usersid="",e.encode=function(e,t){return t||(t=vc.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.userid&&Object.hasOwnProperty.call(e,"userid")&&t.uint32(26).string(e.userid),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(32).int64(e.vid),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(42).string(e.sid),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(66).string(e.target),null!=e.eventtype&&Object.hasOwnProperty.call(e,"eventtype")&&t.uint32(74).string(e.eventtype),null!=e.sdktype&&Object.hasOwnProperty.call(e,"sdktype")&&t.uint32(96).int32(e.sdktype),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(104).int64(e.flags),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(112).int32(e.code),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(120).int64(e.seq),null!=e.requestts&&Object.hasOwnProperty.call(e,"requestts")&&t.uint32(128).int64(e.requestts),null!=e.replyts&&Object.hasOwnProperty.call(e,"replyts")&&t.uint32(136).int64(e.replyts),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&bc.CommonIndex.encode(e.index,t.uint32(146).fork()).ldelim(),null!=e.subtarget&&Object.hasOwnProperty.call(e,"subtarget")&&t.uint32(154).string(e.subtarget),null!=e.usersid&&Object.hasOwnProperty.call(e,"usersid")&&t.uint32(162).string(e.usersid),t},e}(),tL=bc.SyncUpdateEvent=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.userid="",e.prototype.vid=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.sid="",e.prototype.replyts=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.target="",e.prototype.eventtype="",e.prototype.revision=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.sdktype=0,e.prototype.flags=O.Long?O.Long.fromBits(0,0,!1):0,e.prototype.count=0,e.prototype.delta=0,e.prototype.code=0,e.prototype.index=null,e.prototype.subtarget="",e.encode=function(e,t){return t||(t=vc.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.userid&&Object.hasOwnProperty.call(e,"userid")&&t.uint32(26).string(e.userid),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(32).int64(e.vid),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(42).string(e.sid),null!=e.replyts&&Object.hasOwnProperty.call(e,"replyts")&&t.uint32(56).int64(e.replyts),null!=e.target&&Object.hasOwnProperty.call(e,"target")&&t.uint32(66).string(e.target),null!=e.eventtype&&Object.hasOwnProperty.call(e,"eventtype")&&t.uint32(74).string(e.eventtype),null!=e.revision&&Object.hasOwnProperty.call(e,"revision")&&t.uint32(80).int64(e.revision),null!=e.sdktype&&Object.hasOwnProperty.call(e,"sdktype")&&t.uint32(96).int32(e.sdktype),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&t.uint32(104).int64(e.flags),null!=e.count&&Object.hasOwnProperty.call(e,"count")&&t.uint32(112).int32(e.count),null!=e.delta&&Object.hasOwnProperty.call(e,"delta")&&t.uint32(120).int32(e.delta),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(128).int32(e.code),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&bc.CommonIndex.encode(e.index,t.uint32(138).fork()).ldelim(),null!=e.subtarget&&Object.hasOwnProperty.call(e,"subtarget")&&t.uint32(162).string(e.subtarget),t},e}(),uL=bc.CommonIndex=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=vc.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),xC=Object.freeze({__proto__:null,Session:gL,ApEvent:hL,ApRequest:iL,LinkLoginRequest:jL,Link:kL,Logout:lL,KickedOff:mL,ChnJoin:nL,ChnJoinRes:oL,ChnLeave:pL,ConnectionStateChange:qL,RtmSdkMessageCount:Bx,SyncOperateEvent:rL,SyncSubscribeEvent:sL,SyncUpdateEvent:tL,CommonIndex:uL,default:bc}),yC=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510,SyncOperateEvent:9654,SyncSubscribeEvent:9651,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510,SyncOperateEvent:9654,SyncSubscribeEvent:9651}}),Cx=il(),sp=function(e){function t(e,r,i,o,a,s){var c,u;ab(this,t);var l=n.call(this,a,Pm("Socket-",a.loggerId));if(E(L(l),"isActiveClose",!1),E(L(l),"loggedIn",!1),E(L(l),"useNewDomain",void 0),E(L(l),"receivedPacket",new ec),E(L(l),"open$",void 0),E(L(l),"input$",new ec),E(L(l),"userJoin$",new ec),E(L(l),"attemptsSinceLastError",0),E(L(l),"message$",new ec),E(L(l),"socket$",void 0),E(L(l),"toClose",new ec),E(L(l),"toReconnect",new ec),E(L(l),"sendLogger",void 0),E(L(l),"receiveLogger",void 0),E(L(l),"ip",void 0),E(L(l),"env",void 0),E(L(l),"ticket",void 0),E(L(l),"context",void 0),E(L(l),"getDomain",(function(){return Ds(l.ip,l.useNewDomain)})),E(L(l),"socketReconnector",(function(e){var t=function(e){return l.attemptsSinceLastError+=1,l.warn("The %s of Env %d reconnecting %s",l.name,l.env,e.message),Fe(3e3)};return e.pipe(Rb((function(e){return l.log("socket connection closed"),l.loggedIn=!1,2<=l.attemptsSinceLastError?(l.warn("socket connection failure"),l.emit("connectionFailure"),l.close(),Va(e)):l.isActiveClose?$c:(l.emit("reconnect"),l.useNewDomain=!l.useNewDomain,Va(e))})),Zg((function(e){return e.pipe(Cc(t))})))})),l.ip=e,l.env=r,l.ticket=i,l.context=o,l.useNewDomain=null!=s?s:.5<=Math.random(),l.sendLogger=l.genLogger("RTM:MSG:SEND"),l.receiveLogger=l.genLogger("RTM:MSG:RECV"),0!==r&&1!==r)throw new Cx({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});var f=Jh[r];l.log("Opening websocket address %s for the Env %d",l.ip,l.env),$a("LinkLoginRequest",{sid:l.context.sid,userId:l.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(l.context.startTime),destServerIp:l.ip,linkId:l.env},null!==(c=l.context.config.enableCloudProxy||l.context.socketUseProxy)&&void 0!==c&&c),$a("LinkLoginRequest",{sid:l.context.sid,userId:l.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(l.context.startTime),destServerIp:l.ip,linkId:l.env},null!==(u=l.context.config.enableCloudProxy||l.context.socketUseProxy)&&void 0!==u&&u);var d=Nc(l.input$,l.userJoin$.pipe(kC(2)),l.message$).pipe(Wa((function(e){return gl.encode(e).finish()})));return e=Nc(lC("",{protocols:[],makeWebSocket:function(){if(l.context.config.enableCloudProxy||l.context.socketUseProxy){if(0===l.context.cloudProxyServers.length)throw l.logError("No cloud proxy server to connect"),new Pa;var e=ui(null)?JSON.parse(null.replace(/-/g,".")):l.context.cloudProxyServers;e=dh(e="wss://".concat(Ds(Es(e),!1),"/"),"sid",l.context.sid),e=dh(e,"remote_port",f.toString()),e=dh(e,"remote_ip",l.ip),e=dh(e,"token",l.context.key),e=new WebSocket(e)}else e=new WebSocket("wss://".concat(l.getDomain(),":").concat(f));return e.binaryType="arraybuffer",e}}),l.toReconnect),l.socket$=bb(e,ap.pipe(Oc(7e3),Rb((function(e){return uc(e)&&l.warn("socket open timed out"),Va(e)})))).pipe(Wa((function(e){if(e instanceof Error)throw l.warn("Env_%d: Force reconnect the socket",l.env),e;return e(d).pipe(Wa((function(e){return gl.decode(new Uint8Array(e))})))})),l.socketReconnector),l.open$=l.socket$.pipe(Ka((function(e){l.log("Websocket opened",l.name),e.subscribe((function(e){var t=e.data;e=Tm[e.uri].slice(0,-3),t=Cs[e].decode(t);var n=UI({},Oo(t,"toJSON"),(function(e,t){return t instanceof D?rs(t):t})),r=!1;if((t instanceof bx||t instanceof ax)&&t.instance.lessThanOrEqual(4294967295)&&(r=!0),t instanceof cx||t instanceof dx){var i=t.instance,o=t.sequence;(t.dialogue.lessThanOrEqual(4294967295)||i.lessThanOrEqual(4294967295)||o.lessThan(1))&&(r=!0)}r?l.warn("Env_%d: Illegal %s, abandoned %o",l.env,e,n):("Pong"!==e&&l.receiveLogger("Env_%d: %s %o",l.env,e,n),l.receivedPacket.next([e,t]))}),(function(){}))})),ni(void 0),he(l.toClose),$g()),l}nb(t,e);var n=ob(t);return Qb(t,[{key:"address",get:function(){return"".concat(this.ip,":").concat(Jh[this.env])}},{key:"sendPacket",value:function(e,t){if("Ping"!==e){var n=Pe(t,(function(e){return e instanceof D?rs(e):e}));this.sendLogger("Env_%d: %s %o",this.env,e,n)}t=vC(e,t),"UserJoin"===e?this.userJoin$.next(t):"Message"===e?this.message$.next(t):this.input$.next(t)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(e){return this.receivedPacket.pipe(sc((function(t){return Lb(t,1)[0]===e})),Wa((function(e){return Lb(e,2)[1]})))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new Cx({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),t}(Dd());wa({target:"String",proto:!0,forced:fx},{padStart:function(e){return vK(this,e,1<arguments.length?arguments[1]:void 0)}});var vL=function(e){var t=vi(Yj);e=qC(e);for(var n=0;n<t.length;n++){var r=Yj[t[n]];if(null!=r&&r.AP_DOMAINS.includes(e)||null!=r&&r.AP_BACKUP_DOMAINS.includes(e)||null!=r&&r.PROXY_AP.includes(e))return[r.CODE]}return[oa.CHINA,oa.GLOBAL]},wL={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Dx={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},xL=[100,101,102],jl=/web-(\d)/,Ex=function(e){function t(e,r){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];ab(this,t);var o=n.call(this,r,"AccessPoint");return E(L(o),"handleUniLbsError",(function(e,t){var n=e;if(4<e.toString().length){var r=e.toString().padStart(8,"0"),i=parseInt(r.slice(0,4),10);if(r=parseInt(r.slice(4,8),10),201===i)n=r;else if(101===i&&!xL.includes(r))return Va(Error("service is currently unavailable"))}if(i=n.toString(),!Object.keys(Dx).includes(i))return(e=new Pa(["Login is rejected by the server. The response code is %d",e],ij)).serverCode=n,Va(e);switch(i=Dx[i],n=wL[i],i){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(t=new Gh(n,Fw)).serverCode=e,Va(t);case"INVALID_USER_ID":return(t=new Gh(n,al)).serverCode=e,Va(t);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(t=new Gh(n,bl)).serverCode=e,Va(t);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(t=new Gh(n,Gw)).serverCode=e,Va(t);case"CANNOT_MEET_AREA_DEMAND":return(t=vL(t)).forEach((function(e){return o.failedAreas.add(e)})),o.failedAreas.size===(void 0===Ba?2:Ba.CODES.size)?((t=new ja(n,ij)).serverCode=e,Va(t)):Va(Error("ap ".concat(t.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(t=new Pa(n,ij)).serverCode=e,Va(t);default:return Va(ps("ApResErrType",i))}})),E(L(o),"getApEdgeInfo$",void 0),E(L(o),"getApEdgeInfoEndFirst$",void 0),E(L(o),"apFinish$",new ec),E(L(o),"retryCount",0),E(L(o),"failedAreas",new Set),E(L(o),"usedUrl",[]),E(L(o),"newDomainUsed",!1),E(L(o),"backupNewDomainUsed",!1),E(L(o),"genUrl",(function(){return void 0===Ba?zm.apply(void 0,ra(Ih([cL,dL]))).pipe(Am((function(e){return Wb.apply(void 0,ra(e))}))):Wb.apply(void 0,ra(Ba.AP_DOMAINS.slice(0,3).map(xg)))})),E(L(o),"genBackupUrl",(function(){return void 0===Ba?zm.apply(void 0,ra(Ih([eL,fL]))).pipe(Am((function(e){return Wb.apply(void 0,ra(e))}))):Wb.apply(void 0,ra(Ba.AP_BACKUP_DOMAINS.slice(0,3).map(xg)))})),E(L(o),"getApUrl$",(function(e){var n,r;return o.genUrl().pipe(sc((function(e){return(!o.newDomainUsed||!e.includes("sd-rtn.com"))&&(e.includes("sd-rtn.com")&&(o.newDomainUsed=!0),!mp(o.usedUrl,(function(t){var n;return t===(null===(n=e.match(jl))||void 0===n?void 0:n[1])})))})),Ka((function(e){var t;void 0===Ba&&"string"==typeof(e=null===(t=e.match(jl))||void 0===t?void 0:t[1])&&o.usedUrl.push(e)})),Xb(e?Math.max(Yd.RECONNECTING_AP_NUM,null!==(n=null==Ba?void 0:Ba.CODES.size)&&void 0!==n?n:0):null!==(r=null==Ba?void 0:Ba.CODES.size)&&void 0!==r?r:2),Zf((function(){return t.runOutOfUrlSymbol})),Rb((function(e,n){return o.newDomainUsed=!1,e===t.runOutOfUrlSymbol?(o.usedUrl=[],n):Va(e)})))})),E(L(o),"getBackupApUrl$",(function(e){var n,r;return o.genBackupUrl().pipe(sc((function(e){return(!o.backupNewDomainUsed||!e.includes("sd-rtn.com"))&&(e.includes("sd-rtn.com")&&(o.backupNewDomainUsed=!0),!mp(o.usedUrl,(function(t){var n;return t===(null===(n=e.match(jl))||void 0===n?void 0:n[1])})))})),Ka((function(e){var t;void 0===Ba&&"string"==typeof(e=null===(t=e.match(jl))||void 0===t?void 0:t[1])&&o.usedUrl.push(e)})),Xb(e?Math.max(Yd.RECONNECTING_AP_NUM,null!==(n=null==Ba?void 0:Ba.CODES.size)&&void 0!==n?n:0):null!==(r=null==Ba?void 0:Ba.CODES.size)&&void 0!==r?r:2),Zf((function(){return t.runOutOfUrlSymbol})),Rb((function(e,n){return o.backupNewDomainUsed=!1,e===t.runOutOfUrlSymbol?(o.usedUrl=[],n):Va(e)})))})),E(L(o),"getProxyApUrl$",(function(e){var t,n;return Wb.apply(void 0,ra(((null==Ba?void 0:Ba.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map(xg))).pipe(Xb(e?Math.max(Yd.RECONNECTING_AP_NUM,null!==(t=null==Ba?void 0:Ba.CODES.size)&&void 0!==t?t:0):null!==(n=null==Ba?void 0:Ba.CODES.size)&&void 0!==n?n:2))})),E(L(o),"context",void 0),E(L(o),"fetchCloudProxy",(function(e,t){var n=Pm("AP-",o.loggerId);o.log("The AccessPoint requests %s(%s)",e,n);var r,i=new AbortController;return o.apFinish$.pipe(Xb(1)).subscribe((function(){return i.abort()})),lf(za(W.mark((function r(){var a,s;return W.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=Qj(0,Number.MAX_SAFE_INTEGER),o.log("%s request opid: %d",n,s),$a("ApRequest",{sid:o.context.sid,userId:o.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(o.context.startTime),apAddr:e,opId:D.fromNumber(s),envId:0,flag:128},null!==(a=o.context.config.enableCloudProxy)&&void 0!==a&&a),r.abrupt("return",Tj(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:o.context.sid,opid:s,appid:o.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:null!=t?t:o.context.key,cname:o.context.uid,uid:0,detail:tb({},void 0===Ba?{11:[oa.CHINA,oa.GLOBAL].join(),12:"1"}:{11:Array.from(Ba.CODES).map((function(e){return e===oa.OVERSEA?"".concat(oa.ASIA,",").concat(oa.EUROPE,",").concat(oa.AFRICA,",").concat(oa.NORTH_AMERICA,",").concat(oa.SOUTH_AMERICA,",").concat(oa.OCEANIA):e})).join(","),12:"1"})}}]},signal:i.signal}));case 4:case"end":return r.stop()}}),r)})))).pipe(Rb((function(t){return"AbortError"!==t.name&&(o.logError(t),o.warn("The AP server %s request failure",e,t)),$c})),Ac((r=za(W.mark((function t(r){var i,a,s,c,u,l,f,d,p,h,v,m,g,E,_,b,y,T,S;return W.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,a=JSON.parse(i),o.log("The %s response is %o",n,a),(void 0===(s=a.response_body)||0===s.length||s.some((function(e){var t;return void 0===(null===(t=e.buffer)||void 0===t?void 0:t.code)||23!==e.uri})))&&Va(new Pa("cloud proxy response_body not valid",ij)),0===(c=s.filter((function(e){return 0!==e.buffer.code}))).length){t.next=14;break}if(void 0===(u=c.find((function(e){return 128===e.buffer.flag})))){t.next=12;break}return t.abrupt("return",o.handleUniLbsError(u.buffer.code,e));case 12:return o.logError("cloud proxy error response"),t.abrupt("return",o.handleUniLbsError(c[0].buffer.code,e));case 14:for(l=[],f=0;f<s.length;f++)if(262144===(null==(h=s[f])||null===(d=h.buffer)||void 0===d?void 0:d.flag))null===(v=h.buffer)||void 0===v||null===(m=v.edges_services)||void 0===m||null===(g=m.forEach)||void 0===g||g.call(m,(function(e){ns(e=e.ip)&&-1===o.context.cloudProxyServers.indexOf(e)&&(o.log("got cloud proxy server: %s",e),o.context.cloudProxyServers.push(e))}));else if(128===(null==h||null===(p=h.buffer)||void 0===p?void 0:p.flag)){for(y=function(e,t){var n=t[e];l.some((function(e){return e.ip===n.ip}))||l.push({ip:n.ip,ticket:h.buffer.cert})},T=0,S=h.buffer.edges_services;T<S.length;T++)y(T,S);o.context.rtmArea=null!==(E=null===(_=h.buffer)||void 0===_||null===(b=_.detail)||void 0===b?void 0:b[9])&&void 0!==E?E:""}return t.abrupt("return",Wb.apply(void 0,ra(l).concat([fj])));case 19:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})),Rb((function(e){return Sa(e)?Va(e):$c})),Ij(),sc((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket&&ns(e.ip)})))})),E(L(o),"fetchAp",(function(e,t){var n=Pm("AP-",o.loggerId);o.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;o.apFinish$.pipe(Xb(1)).subscribe((function(){return r.abort()}));var i,a=Qj(0,Number.MAX_SAFE_INTEGER);return lf(za(W.mark((function i(){var s;return W.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o.log("%s request opid: %d",n,a),$a("ApRequest",{sid:o.context.sid,userId:o.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(o.context.startTime),apAddr:e,opId:D.fromNumber(a),envId:0,flag:128},null!==(s=o.context.config.enableCloudProxy)&&void 0!==s&&s),i.abrupt("return",Tj(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:a,key:t||o.context.key,cname:o.context.uid,detail:tb({},void 0===Ba?{11:[oa.CHINA,oa.GLOBAL].join(),12:"1"}:{11:Array.from(Ba.CODES).map((function(e){return e===oa.OVERSEA?"".concat(oa.ASIA,",").concat(oa.EUROPE,",").concat(oa.AFRICA,",").concat(oa.NORTH_AMERICA,",").concat(oa.SOUTH_AMERICA,",").concat(oa.OCEANIA):e})).join(","),12:"1"}),uid:0,sid:o.context.sid},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Rb((function(t){return"AbortError"!==t.name&&(o.logError(t),o.warn("The AP server %s request failure",e,t)),$c})),Ac((i=za(W.mark((function t(r){var i,s,c,u,l,f,d,p,h,v;return W.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r.responseText,u=JSON.parse(c),o.log("The %s response is %o",n,u),f=(l=u).code,d=l.addresses,p=l.detail,o.context.vid=null!==(i=p[8])&&void 0!==i?i:"",$a("ApEvent",{sid:o.context.sid,userId:o.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(o.context.startTime),apAddr:e,linkServerList:d.map((function(e){return e.ip})),serverErrCode:f,flag:128,envId:0,opId:D.fromNumber(a),errCode:0,area:p[9],isp:p[2]},null!==(s=o.context.config.enableCloudProxy)&&void 0!==s&&s),o.info(u),0===f){t.next=9;break}return t.abrupt("return",o.handleUniLbsError(f,e));case 9:if(h=d,ui(null)&&(v=JSON.parse(null.replace(/-/g,".")),h=v.map((function(e){return{ip:e,ticket:h[0].ticket}}))),0!==h.length){t.next=14;break}return t.abrupt("return",Va(Error("No available edge address to connect")));case 14:return o.context.rtmArea=null==p?void 0:p[9],t.abrupt("return",Wb.apply(void 0,ra(h).concat([fj])));case 16:case"end":return t.stop()}}),t)}))),function(e){return i.apply(this,arguments)})),Ij(),Rb((function(e){return Sa(e)?Va(e):$c})),sc((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),o.context=e,o.getApEdgeInfoEndFirst$=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return Fe(0,e||i?Yd.RECONNECTING_AP_INTERVAL:2e3).pipe(Xb(1),Ka((function(){o.retryCount+=1})),Ac((function(){return o.context.config.enableCloudProxy||o.context.socketUseProxy?o.getProxyApUrl$(e||i):(4<=o.retryCount&&(o.retryCount=0),3>=o.retryCount?o.getApUrl$(e||i):o.getBackupApUrl$(e||i))})),Ac((function(e){return o.context.config.enableCloudProxy||o.context.socketUseProxy?o.fetchCloudProxy(e):o.fetchAp(e)})),Rb((function(e){return e instanceof ad&&o.warn("AP request timeout"),Va(e)})),Vr((function(e){return e.ip})),he(o.apFinish$))},o.getApEdgeInfo$=function(e){return Fe(0,e||i?Yd.RECONNECTING_AP_INTERVAL:2e3).pipe(Xb(8),Ka((function(){o.retryCount+=1})),Ac((function(){return o.context.config.enableCloudProxy||o.context.socketUseProxy?o.getProxyApUrl$(e||i):3>=o.retryCount?o.getApUrl$(e||i):o.getBackupApUrl$(e||i)})),Ac((function(e){return(o.context.config.enableCloudProxy||o.context.socketUseProxy?o.fetchCloudProxy(e):o.fetchAp(e)).pipe()})),Rb((function(e){return e instanceof ad&&o.warn("AP request timeout"),Va(e)})),Vr((function(e){return e.ip})),he(o.apFinish$))},o}nb(t,e);var n=ob(t);return Qb(t,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),t}(Dd());E(Ex,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Fx=il(),Gx=function(e){function t(e,r,i){ab(this,t);var o=n.call(this,r,"Connection");E(L(o),"apClient",void 0),E(L(o),"lastOpenSockets",[new ah(1),new ah(1)]),E(L(o),"curOpenSockets",[void 0,void 0]),E(L(o),"ipIterator",0),E(L(o),"loginSocketOpenFailureCount",0),E(L(o),"firstEnv",.5<=Math.random()?1:0),E(L(o),"firstSocketOpener",void 0),E(L(o),"secondSocketOpener",void 0),E(L(o),"firstOpenKeeperSubject",new ec),E(L(o),"secondOpenKeeperSubject",new ec),E(L(o),"blacklistedIP",{}),E(L(o),"edgeInfoReplayed",void 0),E(L(o),"firstEnvOpenSocket",void 0),E(L(o),"firstOpenKeeperSub",void 0),E(L(o),"secondOpenKeeperSub",void 0),E(L(o),"context",void 0),E(L(o),"logger",void 0),o.context=e,o.logger=r,o.apClient=new Ex(o.context,r),o.apClient.apFinish$.subscribe((function(){o.log("Ap client fetch finished")}));var a,s=[];return o.edgeInfoReplayed=o.apClient.getApEdgeInfo$(i).pipe(Zg((function(e){return e.pipe(Ka((function(e){if(Sa(e))throw e})),mf(i?wg.getParameter("RECONNECTING_AP_INTERVAL"):900),he(Fe(2e4)))})),sc((function(e){var t;return!mp(s,e)&&1>=(null!==(t=o.blacklistedIP[e.ip])&&void 0!==t?t:0)})),Zf((function(){return new Fx({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),Ka((function(e){s.push(e),o.log("An edge info got %o",e)})),Ka({error:function(e){o.emit("connectionInitFailure",e)}}),Mj((function(){o.apClient.clearUp()})),Yr()),o.firstEnvOpenSocket=o.edgeInfoReplayed.pipe(Ac((function(e){if(void 0===e)return Va(Error("Invalid edge info"));var t=new sp(e.ip,o.firstEnv,e.ticket,o.context,r,a);if(o.firstEnv=1===o.firstEnv?0:1,t.once("connectionFailure",(function(){return o.onSocketConnectionFailure(t)})),!i&&Yd.ENABLE_EDGE_AUTO_FALLBACK&&!o.context.config.enableCloudProxy){var n,s=Date.now();t.on("reconnect",(function(){var e;o.loginSocketOpenFailureCount+=1,null!==(e=n)&&void 0!==e||(n=Date.now()-s),500>n&&1<o.loginSocketOpenFailureCount&&(o.context.socketUseProxy=!0)}))}return a=!t.useNewDomain,t.open$.pipe(ni(t))})),Ka((function(e){o.log("The websocket of ENV_%d opened to %s:%d",e.env,e.ip,Jh[e.env]),o.curOpenSockets[e.env]=e,o.lastOpenSockets[e.env].next(e),o.firstEnv=e.env,o.openSecondSocket(e.env,e.ip,e.useNewDomain)})),Xb(1),$g()),o.firstSocketOpener=o.firstEnvOpenSocket.pipe(Ac((function(e){return e.open$.pipe(Ka((function(){o.log("The websocket of first ENV_%d re-opened to %s:%d",e.env,e.ip,Jh[e.env]),o.curOpenSockets[e.env]=e,o.lastOpenSockets[e.env].next(e)})))}))),e=o.firstOpenKeeperSubject.pipe(Cc(jf)),o.firstOpenKeeperSub=e.subscribe({error:o.logError}),o}nb(t,e);var n=ob(t);return Qb(t,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(e,t){if(![0,1].includes(e))throw new rb({INVALID_ENV:"The env argument is not 0 or 1"});var n=e===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var r=this.curOpenSockets[e];this.curOpenSockets[e]=void 0,r&&(r.isActiveClose=!0,setTimeout((function(){r.close()}),t)),void 0!==n&&setTimeout((function(){null==n||n.unsubscribe()}),t)}},{key:"waitClosing",value:function(e){var t=this;return e.isActiveClose=!0,e.open$.pipe(PB(),Rb((function(e){return e.message===Tw.normalClosureMessage?$c:Va(e)})),Oc(5e3),Rb((function(n){return n instanceof ad?(t.warn("Force closing the ENV_%d connection",e.env),$c):Va(n)})))}},{key:"onSocketConnectionFailure",value:function(e){var t=[0,1].filter((function(t){return t!==e.env}))[0];(t=this.curOpenSockets[t])&&t.loggedIn?this.reopenSocketWithApRequest(e.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(e,t,n){var r=this,i=1===e?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(Xr((function(e,t){return[].concat(ra(e),[t])}),[]),Wa((function(e){return Rw(e,(function(e){return qs(t,e.ip)})).slice(-1)[0]})),Xb(1),Ac((function(e){if(void 0===e)return Va(Error("Invalid edge info"));var t=new sp(e.ip,i,e.ticket,r.context,r.logger,n);return t.on("connectionFailure",(function(){return r.onSocketConnectionFailure(t)})),t.open$.pipe(Ka((function(){r.lastOpenSockets[i].next(t),r.curOpenSockets[i]=t})))})),$g()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(jf)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(e){var t=this,n=[0,1].filter((function(t){return t!==e}))[0];if(void 0!==(n=this.curOpenSockets[n])){var r,i=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Zf((function(){return new Fx({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),Zg((function(e){return e.pipe(Ka((function(e){if(e.code===bl)t.emit("tokenExpired"),t.apClient.apFinish$.next(void 0);else if(Sa(e))throw e})),mf(wg.getParameter("RECONNECTING_AP_INTERVAL")),he(Fe(15e3)))})),Ka((function(e){t.log("An edge info got %o",e)})),Mj((function(){t.apClient.clearUp()}))).pipe(Xr((function(e,t){return[].concat(ra(e),[t])}),[]),Wa((function(e){return(e=Rw(e,(function(e){return qs(i,e.ip)}))).length-1>=t.ipIterator?e.slice(-t.ipIterator++-1)[0]:(t.ipIterator=0,e.slice(-1)[0])})),Zf(),Ac((function(n){if(void 0===n)return Va(Error("Invalid edge info"));var i=new sp(n.ip,e,n.ticket,t.context,t.logger,r);return i.on("connectionFailure",(function(){return t.onSocketConnectionFailure(i)})),r=!i.useNewDomain,i.open$.pipe(ni(i))})),Ka((function(n){t.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,Jh[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})),Ac((function(n){return n.open$.pipe(Ka((function(){t.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,Jh[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})))})),$g()),e===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),t}(Dd()),yL=function(e){function t(e,r,i){return ab(this,t),E(L(i=n.call(this,i,"Context")),"_token",void 0),E(L(i),"config",void 0),E(L(i),"_uid",void 0),E(L(i),"_sid",void 0),E(L(i),"_vid",void 0),E(L(i),"_startTime",void 0),E(L(i),"_lastModifyMeteDataTime",-1),E(L(i),"_lastGetMetaDataTime",-1),E(L(i),"_lastSubscribeMetaDataTime",-1),E(L(i),"_area","CN"),E(L(i),"_socketUseProxy",!1),E(L(i),"appId",void 0),E(L(i),"enableCloudProxy",!1),E(L(i),"cloudProxyServers",[]),i.appId=e,i.config=r,i}nb(t,e);var n=ob(t);return Qb(t,[{key:"socketUseProxy",get:function(){return this._socketUseProxy&&Yd.ENABLE_EDGE_AUTO_FALLBACK},set:function(e){this.log("socketUseProxy is set to %s",e),this._socketUseProxy=e}},{key:"token",set:function(e){this._token="string"==typeof e&&e?e:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new Ib("Cannot get illegal uid")},set:function(e){if(this.log("The user ID is set to %s",wb(e)),!yb(e))throw new Ib;this._uid=e}},{key:"vid",get:function(){if("string"==typeof this._vid)return this._vid;throw new Ib("Cannot get illegal vid")},set:function(e){if("string"!=typeof e)throw new Ib;this._vid=e}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new Ib("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new Ib("Cannot get illegal sid")},set:function(e){if(this.log("sid is set to %s",e),"string"!=typeof e||!e)throw new Ib;this._sid=e}},{key:"startTime",get:function(){if("number"==typeof this._startTime&&this._startTime)return this._startTime;throw new Ib("Cannot get illegal startTime")},set:function(e){if(this.log("startTime is set to %s",e),"number"!=typeof e||!e)throw new Ib;this._startTime=e}},{key:"rtmArea",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new Ib("Cannot get illegal area")},set:function(e){this.log("area is set to %s",e),"string"==typeof e&&e?this._area=e:this.warn("set area failed")}},{key:"lastModifyMeteDataTime",get:function(){if("number"==typeof this._lastModifyMeteDataTime&&this._lastModifyMeteDataTime)return this._lastModifyMeteDataTime;throw new Ib("Cannot get illegal lastModifyMeteDataTime")},set:function(e){if(this.log("lastModifyMeteDataTime is set to %s",e),"number"!=typeof e||!e)throw new Ib;this._lastModifyMeteDataTime=e}},{key:"lastGetMetaDataTime",get:function(){if("number"==typeof this._lastGetMetaDataTime&&this._lastGetMetaDataTime)return this._lastGetMetaDataTime;throw new Ib("Cannot get illegal lastGetMetaDataTime")},set:function(e){if(this.log("lastGetMetaDataTime is set to %s",e),"number"!=typeof e||!e)throw new Ib;this._lastGetMetaDataTime=e}},{key:"lastSubscribeMetaDataTime",get:function(){if("number"==typeof this._lastSubscribeMetaDataTime&&this._lastSubscribeMetaDataTime)return this._lastSubscribeMetaDataTime;throw new Ib("Cannot get illegal lastSubscribeMetaDataTime")},set:function(e){if(this.log("lastSubscribeMetaDataTime is set to %s",e),"number"!=typeof e||!e)throw new Ib;this._lastGetMetaDataTime=e}}]),t}(Dd());tu("of",(function(){for(var e=0,t=arguments.length,n=new(wh(this))(t);t>e;)n[e]=arguments[e++];return n}),Nn),wa({target:"Array",proto:!0,forced:Rn!==[].lastIndexOf},{lastIndexOf:Rn}),wa({target:"Array",proto:!0},{flatMap:function(e){var t=Zb(this),n=xb(t.length);Rc(e);var r=Ei(t,0);return r.length=px(r,t,t,n,0,1,e,1<arguments.length?arguments[1]:void 0),r}}),wf("flatMap");var zL=gg("reduceRight"),AL=!qe&&79<oe&&83>oe;wa({target:"Array",proto:!0,forced:!zL||AL},{reduceRight:function(e){return Cu(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var tp=function(e){return Ga((function(){return!!"\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff"[e]()||"\u200b\x85\u180e"!="\u200b\x85\u180e"[e]()||"\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff"[e].name!==e}))};wa({target:"String",proto:!0,forced:tp("trim")},{trim:function(){return kk(this)}});var Hx=tp("trimEnd"),Ix=Hx?function(){return lD(this)}:"".trimEnd;wa({target:"String",proto:!0,forced:Hx},{trimEnd:Ix,trimRight:Ix});var Jx=tp("trimStart"),Kx=Jx?function(){return kD(this)}:"".trimStart;wa({target:"String",proto:!0,forced:Jx},{trimStart:Kx,trimLeft:Kx});var Pd=kc((function(e,t){(function(){function n(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function r(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r}function i(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function o(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function a(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function s(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function c(e,t){return!(null==e||!e.length)&&-1<g(e,t,0)}function u(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function l(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function f(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function d(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function p(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function h(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function v(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function m(e,t,n,r){var i=e.length;for(n+=r?1:-1;r?n--:++n<i;)if(t(e[n],n,e))return n;return-1}function g(e,t,n){if(t==t)e:{--n;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=m(e,_,n);return e}function E(e,t,n,r){--n;for(var i=e.length;++n<i;)if(r(e[n],t))return n;return-1}function _(e){return e!=e}function b(e,t){var n=null==e?0:e.length;return n?w(e,t)/n:G}function y(e){return function(t){return null==t?B:t[e]}}function T(e){return function(t){return null==e?B:e[t]}}function S(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n}function w(e,t){for(var n,r=-1,i=e.length;++r<i;){var o=t(e[r]);o!==B&&(n=n===B?o:n+o)}return n}function R(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function O(e){return e?e.slice(0,F(e)+1).replace(oe,""):e}function I(e){return function(t){return e(t)}}function A(e,t){return l(t,(function(t){return e[t]}))}function k(e,t){return e.has(t)}function C(e,t){for(var n=-1,r=e.length;++n<r&&-1<g(t,e[n],0););return n}function N(e,t){for(var n=e.length;n--&&-1<g(t,e[n],0););return n}function x(e){return"\\"+De[e]}function D(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function P(e,t){return function(n){return e(t(n))}}function L(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n];a!==t&&"__lodash_placeholder__"!==a||(e[n]="__lodash_placeholder__",o[i++]=n)}return o}function M(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function U(e){if(Ie.test(e)){for(var t=Re.lastIndex=0;Re.test(e);)++t;e=t}else e=Xe(e);return e}function j(e){return Ie.test(e)?e.match(Re)||[]:e.split("")}function F(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var B,V=1/0,G=NaN,W=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],q=/\b__p \+= '';/g,H=/\b(__p \+=) '' \+/g,K=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z=/&(?:amp|lt|gt|quot|#39);/g,Y=/[&<>"']/g,J=RegExp(z.source),X=RegExp(Y.source),Q=/<%-([\s\S]+?)%>/g,$=/<%([\s\S]+?)%>/g,Z=/<%=([\s\S]+?)%>/g,ee=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,te=/^\w*$/,ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,re=/[\\^$.*+?()[\]{}|]/g,ie=RegExp(re.source),oe=/^\s+/,ae=/\s/,se=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ce=/\{\n\/\* \[wrapped with (.+)\] \*/,ue=/,? & /,le=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,fe=/[()=,{}\[\]\/\s]/,de=/\\(\\)?/g,pe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,he=/\w*$/,ve=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,ge=/^\[object .+?Constructor\]$/,Ee=/^0o[0-7]+$/i,_e=/^(?:0|[1-9]\d*)$/,be=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ye=/($^)/,Te=/['\n\r\u2028\u2029\\]/g,Se=/['\u2019]/g,we=/[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]/g,Re=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]?|[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,Oe=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['\u2019](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['\u2019](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,Ie=/[\u200d\ud800-\udfff\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff\ufe0e\ufe0f]/,Ae=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ke="Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),Ce=-1,Ne={};Ne["[object Float32Array]"]=Ne["[object Float64Array]"]=Ne["[object Int8Array]"]=Ne["[object Int16Array]"]=Ne["[object Int32Array]"]=Ne["[object Uint8Array]"]=Ne["[object Uint8ClampedArray]"]=Ne["[object Uint16Array]"]=Ne["[object Uint32Array]"]=!0,Ne["[object Arguments]"]=Ne["[object Array]"]=Ne["[object ArrayBuffer]"]=Ne["[object Boolean]"]=Ne["[object DataView]"]=Ne["[object Date]"]=Ne["[object Error]"]=Ne["[object Function]"]=Ne["[object Map]"]=Ne["[object Number]"]=Ne["[object Object]"]=Ne["[object RegExp]"]=Ne["[object Set]"]=Ne["[object String]"]=Ne["[object WeakMap]"]=!1;var xe={};xe["[object Arguments]"]=xe["[object Array]"]=xe["[object ArrayBuffer]"]=xe["[object DataView]"]=xe["[object Boolean]"]=xe["[object Date]"]=xe["[object Float32Array]"]=xe["[object Float64Array]"]=xe["[object Int8Array]"]=xe["[object Int16Array]"]=xe["[object Int32Array]"]=xe["[object Map]"]=xe["[object Number]"]=xe["[object Object]"]=xe["[object RegExp]"]=xe["[object Set]"]=xe["[object String]"]=xe["[object Symbol]"]=xe["[object Uint8Array]"]=xe["[object Uint8ClampedArray]"]=xe["[object Uint16Array]"]=xe["[object Uint32Array]"]=!0,xe["[object Error]"]=xe["[object Function]"]=xe["[object WeakMap]"]=!1;var De={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Pe=parseFloat,Le=parseInt,Me="object"==Ia(qb)&&qb&&qb.Object===Object&&qb,Ue="object"==("undefined"==typeof self?"undefined":Ia(self))&&self&&self.Object===Object&&self,je=Me||Ue||Function("return this")(),Fe=t&&!t.nodeType&&t,Be=Fe&&e&&!e.nodeType&&e,Ve=Be&&Be.exports===Fe,Ge=Ve&&Me.process,We=function(){try{return Be&&Be.require&&Be.require("util").types||Ge&&Ge.binding&&Ge.binding("util")}catch(e){}}(),qe=We&&We.isArrayBuffer,He=We&&We.isDate,Ke=We&&We.isMap,ze=We&&We.isRegExp,Ye=We&&We.isSet,Je=We&&We.isTypedArray,Xe=y("length"),Qe=T({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),$e=T({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Ze=T({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),et=function e(t){function T(e){if(Jr(e)&&!Fa(e)&&!(e instanceof De)){if(e instanceof Re)return e;if(ji.call(e,"__wrapped__"))return yr(e)}return new Re(e)}function ae(){}function Re(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=B}function De(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Me(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ue(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Fe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Be(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Fe;++t<n;)this.add(e[t])}function Ge(e){this.size=(this.__data__=new Ue(e)).size}function We(e,t){var n,r=Fa(e),i=!r&&ja(e),o=!r&&!i&&Va(e),a=!r&&!i&&!o&&Ka(e),s=(i=(r=r||i||o||a)?R(e.length,xi):[]).length;for(n in e)!t&&!ji.call(e,n)||r&&("length"==n||o&&("offset"==n||"parent"==n)||a&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||sr(n,s))||i.push(n);return i}function Xe(e){var t=e.length;return t?e[Kt(0,t-1)]:B}function tt(e,t){return gr(Sn(e),lt(t,0,e.length))}function nt(e){return gr(Sn(e))}function rt(e,t,n){(n===B||Vr(e[t],n))&&(n!==B||t in e)||ct(e,t,n)}function it(e,t,n){var r=e[t];ji.call(e,t)&&Vr(r,n)&&(n!==B||t in e)||ct(e,t,n)}function ot(e,t){for(var n=e.length;n--;)if(Vr(e[n][0],t))return n;return-1}function at(e,t,n,r){return Uo(e,(function(e,i,o){t(r,e,n(e),o)})),r}function st(e,t){return e&&wn(t,ui(t),e)}function ct(e,t,n){"__proto__"==t&&no?no(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ut(e,t){for(var n=-1,r=t.length,i=Ri(r),o=null==e;++n<r;)i[n]=o?B:si(e,t[n]);return i}function lt(e,t,n){return e==e&&(n!==B&&(e=e<=n?e:n),t!==B&&(e=e>=t?e:t)),e}function ft(e,t,n,r,o,a){var s,c=1&t,u=2&t,l=4&t;if(n&&(s=o?n(e,r,o,a):n(e)),s!==B)return s;if(!Yr(e))return e;if(r=Fa(e)){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ji.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!c)return Sn(e,s)}else{var f=Yo(e),d="[object Function]"==f||"[object GeneratorFunction]"==f;if(Va(e))return gn(e,c);if("[object Object]"==f||"[object Arguments]"==f||d&&!o){if(s=u||d?{}:or(e),!c)return u?function(e,t){return wn(e,zo(e),t)}(e,function(e,t){return e&&wn(t,li(t),e)}(s,e)):function(e,t){return wn(e,Ko(e),t)}(e,st(s,e))}else{if(!xe[f])return o?e:{};s=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return En(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return t=n?En(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return _n(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return(t=new e.constructor(e.source,he.exec(e))).lastIndex=e.lastIndex,t;case"[object Symbol]":return Po?Ci(Po.call(e)):{}}}(e,f,c)}}if(a||(a=new Ge),o=a.get(e))return o;a.set(e,s),Ha(e)?e.forEach((function(r){s.add(ft(r,t,n,r,e,a))})):Wa(e)&&e.forEach((function(r,i){s.set(i,ft(r,t,n,i,e,a))})),u=l?u?Qn:Xn:u?li:ui;var p=r?B:u(e);return i(p||e,(function(r,i){p&&(r=e[i=r]),it(s,i,ft(r,t,n,i,e,a))})),s}function dt(e,t,n){var r=n.length;if(null==e)return!r;for(e=Ci(e);r--;){var i=n[r],o=t[i],a=e[i];if(a===B&&!(i in e)||!o(a))return!1}return!0}function pt(e,t,n){if("function"!=typeof e)throw new Di("Expected a function");return Qo((function(){e.apply(B,n)}),t)}function ht(e,t,n,r){var i=-1,o=c,a=!0,s=e.length,f=[],d=t.length;if(!s)return f;n&&(t=l(t,I(n))),r?(o=u,a=!1):200<=t.length&&(o=k,a=!1,t=new Be(t));e:for(;++i<s;){var p=e[i],h=null==n?p:n(p);if(p=r||0!==p?p:0,a&&h==h){for(var v=d;v--;)if(t[v]===h)continue e;f.push(p)}else o(t,h,r)||f.push(p)}return f}function vt(e,t){var n=!0;return Uo(e,(function(e,r,i){return n=!!t(e,r,i)})),n}function mt(e,t,n){for(var r=-1,i=e.length;++r<i;){var o=e[r],a=t(o);if(null!=a&&(s===B?a==a&&!Zr(a):n(a,s)))var s=a,c=o}return c}function gt(e,t){var n=[];return Uo(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function Et(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=ar),i||(i=[]);++o<a;){var s=e[o];0<t&&n(s)?1<t?Et(s,t-1,n,r,i):f(i,s):r||(i[i.length]=s)}return i}function _t(e,t){return e&&Fo(e,t,ui)}function bt(e,t){return e&&Bo(e,t,ui)}function yt(e,t){return s(t,(function(t){return Hr(e[t])}))}function Tt(e,t){for(var n=0,r=(t=vn(t,e)).length;null!=e&&n<r;)e=e[Er(t[n++])];return n&&n==r?e:B}function St(e,t,n){return t=t(e),Fa(e)?t:f(t,n(e))}function wt(e){if(null==e)return e===B?"[object Undefined]":"[object Null]";if(to&&to in Ci(e)){var t=ji.call(e,to),n=e[to];try{e[to]=B;var r=!0}catch(e){}var i=Vi.call(e);r&&(t?e[to]=n:delete e[to]),e=i}else e=Vi.call(e);return e}function Rt(e,t){return e>t}function Ot(e,t){return null!=e&&ji.call(e,t)}function It(e,t){return null!=e&&t in Ci(e)}function At(e,t,n){for(var r=n?u:c,i=e[0].length,o=e.length,a=o,s=Ri(o),f=1/0,d=[];a--;){var p=e[a];a&&t&&(p=l(p,I(t))),f=vo(p.length,f),s[a]=!n&&(t||120<=i&&120<=p.length)?new Be(a&&p):B}p=e[0];var h=-1,v=s[0];e:for(;++h<i&&d.length<f;){var m=p[h],g=t?t(m):m;if(m=n||0!==m?m:0,v?!v.has(g):!r(d,g,n)){for(a=o;--a;){var E=s[a];if(E?!E.has(g):!r(e[a],g,n))continue e}v&&v.push(g),d.push(m)}}return d}function kt(e,t,r){return null==(t=null==(e=2>(t=vn(t,e)).length?e:Tt(e,Zt(t,0,-1)))?e:e[Er(Or(t))])?B:n(t,e,r)}function Ct(e){return Jr(e)&&"[object Arguments]"==wt(e)}function Nt(e,t,n,r,i){if(e===t)return!0;if(null==e||null==t||!Jr(e)&&!Jr(t))return e!=e&&t!=t;e:{var o=Fa(e),a=Fa(t),s=o?"[object Array]":Yo(e),c=a?"[object Array]":Yo(t),u="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s);if(a="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=s==c)&&Va(e)){if(!Va(t)){t=!1;break e}o=!0,u=!1}if(c&&!u)i||(i=new Ge),t=o||Ka(e)?Yn(e,t,n,r,Nt,i):function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!o(new zi(e),new zi(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Vr(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=D;case"[object Set]":if(s||(s=M),e.size!=t.size&&!(1&r))break;return(n=a.get(e))?n==t:(r|=2,a.set(e,t),t=Yn(s(e),s(t),r,i,o,a),a.delete(e),t);case"[object Symbol]":if(Po)return Po.call(e)==Po.call(t)}return!1}(e,t,s,n,r,Nt,i);else{if(!(1&n)&&(o=u&&ji.call(e,"__wrapped__"),s=a&&ji.call(t,"__wrapped__"),o||s)){e=o?e.value():e,t=s?t.value():t,i||(i=new Ge),t=Nt(e,t,n,r,i);break e}if(c)t:if(i||(i=new Ge),o=1&n,s=Xn(e),a=s.length,c=Xn(t).length,a==c||o){for(c=a;c--;){var l=s[c];if(!(o?l in t:ji.call(t,l))){t=!1;break t}}if(u=i.get(e),l=i.get(t),u&&l)t=u==t&&l==e;else{u=!0,i.set(e,t),i.set(t,e);for(var f=o;++c<a;){var d=e[l=s[c]],p=t[l];if(r)var h=o?r(p,d,l,t,e,i):r(d,p,l,e,t,i);if(h===B?d!==p&&!Nt(d,p,n,r,i):!h){u=!1;break}f||(f="constructor"==l)}u&&!f&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(u=!1),i.delete(e),i.delete(t),t=u}}else t=!1;else t=!1}}return t}function xt(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Ci(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var c=(s=n[i])[0],u=e[c],l=s[1];if(a&&s[2]){if(u===B&&!(c in e))return!1}else{if(s=new Ge,r)var f=r(u,l,c,e,t,s);if(f===B?!Nt(l,u,3,r,s):!f)return!1}}return!0}function Dt(e){return!(!Yr(e)||Bi&&Bi in e)&&(Hr(e)?qi:ge).test(_r(e))}function Pt(e){return"function"==typeof e?e:null==e?gi:"object"==Ia(e)?Fa(e)?Ft(e[0],e[1]):jt(e):yi(e)}function Lt(e){if(!fr(e))return po(e);var t,n=[];for(t in Ci(e))ji.call(e,t)&&"constructor"!=t&&n.push(t);return n}function Mt(e,t){return e<t}function Ut(e,t){var n=-1,r=Gr(e)?Ri(e.length):[];return Uo(e,(function(e,i,o){r[++n]=t(e,i,o)})),r}function jt(e){var t=nr(e);return 1==t.length&&t[0][2]?dr(t[0][0],t[0][1]):function(n){return n===e||xt(n,e,t)}}function Ft(e,t){return ur(e)&&t==t&&!Yr(t)?dr(Er(e),t):function(n){var r=si(n,e);return r===B&&r===t?ci(n,e):Nt(t,r,3)}}function Bt(e,t,n,r,i){e!==t&&Fo(t,(function(o,a){if(i||(i=new Ge),Yr(o)){o=i;var s=hr(e,a),c=hr(t,a),u=o.get(c);if(u)rt(e,a,u);else{var l=(u=r?r(s,c,a+"",e,t,o):B)===B;if(l){var f=Fa(c),d=!f&&Va(c),p=!f&&!d&&Ka(c);u=c,f||d||p?Fa(s)?u=s:Wr(s)?u=Sn(s):d?(l=!1,u=gn(c,!0)):p?(l=!1,u=_n(c,!0)):u=[]:Qr(c)||ja(c)?(u=s,ja(s)?u=oi(s):Yr(s)&&!Hr(s)||(u=or(c))):l=!1}l&&(o.set(c,u),Bt(u,c,n,r,o),o.delete(c)),rt(e,a,u)}}else(s=r?r(hr(e,a),o,a+"",e,t,i):B)===B&&(s=o),rt(e,a,s)}),li)}function Vt(e,t){var n=e.length;if(n)return sr(t+=0>t?n:0,n)?e[t]:B}function Gt(e,t,n){t=t.length?l(t,(function(e){return Fa(e)?function(t){return Tt(t,1===e.length?e[0]:e)}:e})):[gi];var r=-1;return t=l(t,I(er())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(e=Ut(e,(function(e,n,i){return{criteria:l(t,(function(t){return t(e)})),index:++r,value:e}})),(function(e,t){e:{for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){var c=bn(i[r],o[r]);if(c){if(r>=s){e=c;break e}e=c*("desc"==n[r]?-1:1);break e}}e=e.index-t.index}return e}))}function Wt(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=Tt(e,a);n(s,a)&&Qt(o,vn(a,e),s)}return o}function qt(e,t,n,r){var i=r?E:g,o=-1,a=t.length,s=e;for(e===t&&(t=Sn(t)),n&&(s=l(e,I(n)));++o<a;){var c=0,u=t[o];for(u=n?n(u):u;-1<(c=i(s,u,c,r));)s!==e&&$i.call(s,c,1),$i.call(e,c,1)}return e}function Ht(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;sr(i)?$i.call(e,i,1):cn(e,i)}}return e}function Kt(e,t){return e+so(Eo()*(t-e+1))}function zt(e,t){var n="";if(!e||1>t||9007199254740991<t)return n;do{t%2&&(n+=e),(t=so(t/2))&&(e+=e)}while(t);return n}function Yt(e,t){return $o(pr(e,t,gi),e+"")}function Jt(e){return Xe(di(e))}function Xt(e,t){return gr(e=di(e),lt(t,0,e.length))}function Qt(e,t,n,r){if(!Yr(e))return e;for(var i=-1,o=(t=vn(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var c=Er(t[i]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)break;if(i!=a){var l=s[c];(u=r?r(l,c,s):B)===B&&(u=Yr(l)?l:sr(t[i+1])?[]:{})}it(s,c,u),s=s[c]}return e}function $t(e){return gr(di(e))}function Zt(e,t,n){var r=-1,i=e.length;for(0>t&&(t=-t>i?0:i+t),0>(n=n>i?i:n)&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0,n=Ri(i);++r<i;)n[r]=e[r+t];return n}function en(e,t){var n;return Uo(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n}function tn(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&2147483647>=i){for(;r<i;){var o=r+i>>>1,a=e[o];null!==a&&!Zr(a)&&(n?a<=t:a<t)?r=o+1:i=o}return i}return nn(e,t,gi,n)}function nn(e,t,n,r){var i=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=n(t))!=t,s=null===t,c=Zr(t),u=t===B;i<o;){var l=so((i+o)/2),f=n(e[l]),d=f!==B,p=null===f,h=f==f,v=Zr(f);(a?r||h:u?h&&(r||d):s?h&&d&&(r||!p):c?h&&d&&!p&&(r||!v):!p&&!v&&(r?f<=t:f<t))?i=l+1:o=l}return vo(o,4294967294)}function rn(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n],s=t?t(a):a;if(!n||!Vr(s,c)){var c=s;o[i++]=0===a?0:a}}return o}function on(e){return"number"==typeof e?e:Zr(e)?G:+e}function an(e){if("string"==typeof e)return e;if(Fa(e))return l(e,an)+"";if(Zr(e))return Lo?Lo.call(e):"";var t=e+"";return"0"==t&&1/e==-V?"-0":t}function sn(e,t,n){var r=-1,i=c,o=e.length,a=!0,s=[],l=s;if(n)a=!1,i=u;else if(200<=o){if(i=t?null:qo(e))return M(i);a=!1,i=k,l=new Be}else l=t?[]:s;e:for(;++r<o;){var f=e[r],d=t?t(f):f;if(f=n||0!==f?f:0,a&&d==d){for(var p=l.length;p--;)if(l[p]===d)continue e;t&&l.push(d),s.push(f)}else i(l,d,n)||(l!==s&&l.push(d),s.push(f))}return s}function cn(e,t){return null==(e=2>(t=vn(t,e)).length?e:Tt(e,Zt(t,0,-1)))||delete e[Er(Or(t))]}function un(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?Zt(e,r?0:o,r?o+1:i):Zt(e,r?o+1:0,r?i:o)}function ln(e,t){return e instanceof De&&(e=e.value()),d(t,(function(e,t){return t.func.apply(t.thisArg,f([e],t.args))}),e)}function fn(e,t,n){var r=e.length;if(2>r)return r?sn(e[0]):[];for(var i=-1,o=Ri(r);++i<r;)for(var a=e[i],s=-1;++s<r;)s!=i&&(o[i]=ht(o[i]||a,e[s],t,n));return sn(Et(o,1),t,n)}function dn(e,t,n){for(var r=-1,i=e.length,o=t.length,a={};++r<i;)n(a,e[r],r<o?t[r]:B);return a}function pn(e){return Wr(e)?e:[]}function hn(e){return"function"==typeof e?e:gi}function vn(e,t){return Fa(e)?e:ur(e,t)?[e]:Zo(ai(e))}function mn(e,t,n){var r=e.length;return n=n===B?r:n,!t&&n>=r?e:Zt(e,t,n)}function gn(e,t){return t?e.slice():(t=e.length,t=Yi?Yi(t):new e.constructor(t),e.copy(t),t)}function En(e){var t=new e.constructor(e.byteLength);return new zi(t).set(new zi(e)),t}function _n(e,t){return t=t?En(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)}function bn(e,t){if(e!==t){var n=e!==B,r=null===e,i=e==e,o=Zr(e),a=t!==B,s=null===t,c=t==t,u=Zr(t);if(!s&&!u&&!o&&e>t||o&&a&&c&&!s&&!u||r&&a&&c||!n&&c||!i)return 1;if(!r&&!o&&!u&&e<t||u&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!c)return-1}return 0}function yn(e,t,n,r){var i=-1,o=e.length,a=n.length,s=-1,c=t.length,u=ho(o-a,0),l=Ri(c+u);for(r=!r;++s<c;)l[s]=t[s];for(;++i<a;)(r||i<o)&&(l[n[i]]=e[i]);for(;u--;)l[s++]=e[i++];return l}function Tn(e,t,n,r){var i=-1,o=e.length,a=-1,s=n.length,c=-1,u=t.length,l=ho(o-s,0),f=Ri(l+u);for(r=!r;++i<l;)f[i]=e[i];for(l=i;++c<u;)f[l+c]=t[c];for(;++a<s;)(r||i<o)&&(f[l+n[a]]=e[i++]);return f}function Sn(e,t){var n=-1,r=e.length;for(t||(t=Ri(r));++n<r;)t[n]=e[n];return t}function wn(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=r?r(n[s],e[s],s,n,e):B;c===B&&(c=e[s]),i?ct(n,s,c):it(n,s,c)}return n}function Rn(e,t){return function(n,i){var o=Fa(n)?r:at,a=t?t():{};return o(n,e,er(i,2),a)}}function On(e){return Yt((function(t,n){var r=-1,i=n.length,o=1<i?n[i-1]:B,a=2<i?n[2]:B;for(o=3<e.length&&"function"==typeof o?(i--,o):B,a&&cr(n[0],n[1],a)&&(o=3>i?B:o,i=1),t=Ci(t);++r<i;)(a=n[r])&&e(t,a,r,o);return t}))}function In(e,t){return function(n,r){if(null==n)return n;if(!Gr(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=Ci(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function An(e){return function(t,n,r){for(var i=-1,o=Ci(t),a=(r=r(t)).length;a--;){var s=r[e?a:++i];if(!1===n(o[s],s,o))break}return t}}function kn(e){return function(t){t=ai(t);var n=Ie.test(t)?j(t):B,r=n?n[0]:t.charAt(0);return t=n?mn(n,1).join(""):t.slice(1),r[e]()+t}}function Cn(e){return function(t){return d(vi(hi(t).replace(Se,"")),e,"")}}function Nn(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Mo(e.prototype);return Yr(t=e.apply(n,t))?t:n}}function xn(e){return function(t,n,r){var i=Ci(t);if(!Gr(t)){var o=er(n,3);t=ui(t),n=function(e){return o(i[e],e,i)}}return-1<(n=e(t,n,r))?i[o?t[n]:n]:B}}function Dn(e){return Jn((function(t){var n=t.length,r=n,i=Re.prototype.thru;for(e&&t.reverse();r--;){var o=t[r];if("function"!=typeof o)throw new Di("Expected a function");if(i&&!a&&"wrapper"==$n(o))var a=new Re([],!0)}for(r=a?r:n;++r<n;){var s="wrapper"==(i=$n(o=t[r]))?Ho(o):B;a=s&&lr(s[0])&&424==s[1]&&!s[4].length&&1==s[9]?a[$n(s[0])].apply(a,s[3]):1==o.length&&lr(o)?a[i]():a.thru(o)}return function(){var e=arguments,r=e[0];if(a&&1==e.length&&Fa(r))return a.plant(r).value();var i=0;for(e=n?t[i].apply(this,e):r;++i<n;)e=t[i].call(this,e);return e}}))}function Pn(e,t,n,r,i,o,a,s,c,u){var l=128&t,f=1&t,d=2&t,p=24&t,h=512&t,v=d?B:Nn(e);return function m(){for(var g=arguments.length,E=Ri(g),_=g;_--;)E[_]=arguments[_];if(p){var b,y=Zn(m);for(_=E.length,b=0;_--;)E[_]===y&&++b}if(r&&(E=yn(E,r,i,p)),o&&(E=Tn(E,o,a,p)),g-=b,p&&g<u)return y=L(E,y),Vn(e,t,Pn,m.placeholder,n,E,y,s,c,u-g);if(y=f?n:this,_=d?y[e]:e,g=E.length,s){b=E.length;for(var T=vo(s.length,b),S=Sn(E);T--;){var w=s[T];E[T]=sr(w,b)?S[w]:B}}else h&&1<g&&E.reverse();return l&&c<g&&(E.length=c),this&&this!==je&&this instanceof m&&(_=v||Nn(_)),_.apply(y,E)}}function Ln(e,t){return function(n,r){return function(e,t,n,r){return _t(e,(function(e,i,o){t(r,n(e),i,o)})),r}(n,e,t(r),{})}}function Mn(e,t){return function(n,r){var i;if(n===B&&r===B)return t;if(n!==B&&(i=n),r!==B){if(i===B)return r;"string"==typeof n||"string"==typeof r?(n=an(n),r=an(r)):(n=on(n),r=on(r)),i=e(n,r)}return i}}function Un(e){return Jn((function(t){return t=l(t,I(er())),Yt((function(r){var i=this;return e(t,(function(e){return n(e,i,r)}))}))}))}function jn(e,t){var n=(t=t===B?" ":an(t)).length;return 2>n?n?zt(t,e):t:(n=zt(t,ao(e/U(t))),Ie.test(t)?mn(j(n),0,e).join(""):n.slice(0,e))}function Fn(e){return function(t,n,r){r&&"number"!=typeof r&&cr(t,n,r)&&(n=r=B),t=ti(t),n===B?(n=t,t=0):n=ti(n),r=r===B?t<n?1:-1:ti(r);var i=-1;n=ho(ao((n-t)/(r||1)),0);for(var o=Ri(n);n--;)o[e?n:++i]=t,t+=r;return o}}function Bn(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=ii(t),n=ii(n)),e(t,n)}}function Vn(e,t,n,r,i,o,a,s,c,u){var l=8&t;return 4&(t=(t|(l?32:64))&~(l?64:32))||(t&=-4),i=[e,t,i,l?o:B,l?a:B,o=l?B:o,a=l?B:a,s,c,u],n=n.apply(B,i),lr(e)&&Xo(n,i),n.placeholder=r,vr(n,e,t)}function Gn(e){var t=ki[e];return function(e,n){return e=ii(e),(n=null==n?0:vo(ni(n),292))&&lo(e)?(e=(ai(e)+"e").split("e"),+((e=(ai(e=t(e[0]+"e"+(+e[1]+n)))+"e").split("e"))[0]+"e"+(+e[1]-n))):t(e)}}function Wn(e){return function(t){var n=Yo(t);return"[object Map]"==n?D(t):"[object Set]"==n?function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}(t):function(e,t){return l(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function qn(e,t,r,i,o,a,s,c){var u=2&t;if(!u&&"function"!=typeof e)throw new Di("Expected a function");var l=i?i.length:0;if(l||(t&=-97,i=o=B),s=s===B?s:ho(ni(s),0),c=c===B?c:ni(c),l-=o?o.length:0,64&t){var f=i,d=o;i=o=B}var p=u?B:Ho(e);return a=[e,t,r,i,o,f,d,a,s,c],p&&(t=(r=a[1])|(e=p[1]),i=128==e&&8==r||128==e&&256==r&&a[7].length<=p[8]||384==e&&p[7].length<=p[8]&&8==r,131>t||i)&&(1&e&&(a[2]=p[2],t|=1&r?0:4),(r=p[3])&&(i=a[3],a[3]=i?yn(i,r,p[4]):r,a[4]=i?L(a[3],"__lodash_placeholder__"):p[4]),(r=p[5])&&(i=a[5],a[5]=i?Tn(i,r,p[6]):r,a[6]=i?L(a[5],"__lodash_placeholder__"):p[6]),(r=p[7])&&(a[7]=r),128&e&&(a[8]=null==a[8]?p[8]:vo(a[8],p[8])),null==a[9]&&(a[9]=p[9]),a[0]=p[0],a[1]=t),e=a[0],t=a[1],r=a[2],i=a[3],o=a[4],!(c=a[9]=a[9]===B?u?0:e.length:ho(a[9]-l,0))&&24&t&&(t&=-25),u=t&&1!=t?8==t||16==t?function(e,t,r){var i=Nn(e);return function o(){for(var a=arguments.length,s=Ri(a),c=a,u=Zn(o);c--;)s[c]=arguments[c];return(a-=(c=3>a&&s[0]!==u&&s[a-1]!==u?[]:L(s,u)).length)<r?Vn(e,t,Pn,o.placeholder,B,s,c,B,B,r-a):n(this&&this!==je&&this instanceof o?i:e,this,s)}}(e,t,c):32!=t&&33!=t||o.length?Pn.apply(B,a):function(e,t,r,i){var o=1&t,a=Nn(e);return function t(){for(var s=-1,c=arguments.length,u=-1,l=i.length,f=Ri(l+c),d=this&&this!==je&&this instanceof t?a:e;++u<l;)f[u]=i[u];for(;c--;)f[u++]=arguments[++s];return n(d,o?r:this,f)}}(e,t,r,i):function(e,t,n){var r=1&t,i=Nn(e);return function t(){return(this&&this!==je&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,r),vr((p?Vo:Xo)(u,a),e,t)}function Hn(e,t,n,r){return e===B||Vr(e,Li[n])&&!ji.call(r,n)?t:e}function Kn(e,t,n,r,i,o){return Yr(e)&&Yr(t)&&(o.set(t,e),Bt(e,t,B,Kn,o),o.delete(t)),e}function zn(e){return Qr(e)?B:e}function Yn(e,t,n,r,i,o){var a=1&n,s=e.length,c=t.length;if(s!=c&&!(a&&c>s))return!1;c=o.get(e);var u=o.get(t);if(c&&u)return c==t&&u==e;c=-1,u=!0;var l=2&n?new Be:B;for(o.set(e,t),o.set(t,e);++c<s;){var f=e[c],d=t[c];if(r)var p=a?r(d,f,c,t,e,o):r(f,d,c,e,t,o);if(p!==B){if(p)continue;u=!1;break}if(l){if(!h(t,(function(e,t){if(!l.has(t)&&(f===e||i(f,e,n,r,o)))return l.push(t)}))){u=!1;break}}else if(f!==d&&!i(f,d,n,r,o)){u=!1;break}}return o.delete(e),o.delete(t),u}function Jn(e){return $o(pr(e,B,wr),e+"")}function Xn(e){return St(e,ui,Ko)}function Qn(e){return St(e,li,zo)}function $n(e){for(var t=e.name+"",n=Io[t],r=ji.call(Io,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function Zn(e){return(ji.call(T,"placeholder")?T:e).placeholder}function er(){var e=T.iteratee||Ei;return e=e===Ei?Pt:e,arguments.length?e(arguments[0],arguments[1]):e}function tr(e,t){e=e.__data__;var n=Ia(t);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map}function nr(e){for(var t=ui(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!Yr(i)]}return t}function rr(e,t){return Dt(e=null==e?B:e[t])?e:B}function ir(e,t,n){for(var r=-1,i=(t=vn(t,e)).length,o=!1;++r<i;){var a=Er(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&zr(i)&&sr(a,i)&&(Fa(e)||ja(e))}function or(e){return"function"!=typeof e.constructor||fr(e)?{}:Mo(Ji(e))}function ar(e){return Fa(e)||ja(e)||!!(Zi&&e&&e[Zi])}function sr(e,t){var n=Ia(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&_e.test(e))&&-1<e&&0==e%1&&e<t}function cr(e,t,n){if(!Yr(n))return!1;var r=Ia(t);return!!("number"==r?Gr(n)&&sr(t,n.length):"string"==r&&t in n)&&Vr(n[t],e)}function ur(e,t){if(Fa(e))return!1;var n=Ia(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Zr(e))||te.test(e)||!ee.test(e)||null!=t&&e in Ci(t)}function lr(e){var t=$n(e),n=T[t];return"function"==typeof n&&t in De.prototype&&(e===n||!!(t=Ho(n))&&e===t[0])}function fr(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Li)}function dr(e,t){return function(n){return null!=n&&n[e]===t&&(t!==B||e in Ci(n))}}function pr(e,t,r){return t=ho(t===B?e.length-1:t,0),function(){for(var i=arguments,o=-1,a=ho(i.length-t,0),s=Ri(a);++o<a;)s[o]=i[t+o];for(o=-1,a=Ri(t+1);++o<t;)a[o]=i[o];return a[t]=r(s),n(e,this,a)}}function hr(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function vr(e,t,n){var r=t+"";t=$o;var i=br,o=(o=r.match(ce))?o[1].split(ue):[];return n=i(o,n),(i=n.length)&&(n[o=i-1]=(1<i?"& ":"")+n[o],n=n.join(2<i?", ":" "),r=r.replace(se,"{\n/* [wrapped with "+n+"] */\n")),t(e,r)}function mr(e){var t=0,n=0;return function(){var r=mo(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(B,arguments)}}function gr(e,t){var n=-1,r=e.length,i=r-1;for(t=t===B?r:t;++n<t;){var o=e[r=Kt(n,i)];e[r]=e[n],e[n]=o}return e.length=t,e}function Er(e){if("string"==typeof e||Zr(e))return e;var t=e+"";return"0"==t&&1/e==-V?"-0":t}function _r(e){if(null!=e){try{return Ui.call(e)}catch(e){}return e+""}return""}function br(e,t){return i(W,(function(n){var r="_."+n[0];t&n[1]&&!c(e,r)&&e.push(r)})),e.sort()}function yr(e){if(e instanceof De)return e.clone();var t=new Re(e.__wrapped__,e.__chain__);return t.__actions__=Sn(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Tr(e,t,n){var r=null==e?0:e.length;return r?(0>(n=null==n?0:ni(n))&&(n=ho(r+n,0)),m(e,er(t,3),n)):-1}function Sr(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return n!==B&&(i=ni(n),i=0>n?ho(r+i,0):vo(i,r-1)),m(e,er(t,3),i,!0)}function wr(e){return null!=e&&e.length?Et(e,1):[]}function Rr(e){return e&&e.length?e[0]:B}function Or(e){var t=null==e?0:e.length;return t?e[t-1]:B}function Ir(e,t){return e&&e.length&&t&&t.length?qt(e,t):e}function Ar(e){return null==e?e:_o.call(e)}function kr(e){if(!e||!e.length)return[];var t=0;return e=s(e,(function(e){if(Wr(e))return t=ho(e.length,t),!0})),R(t,(function(t){return l(e,y(t))}))}function Cr(e,t){return e&&e.length?(e=kr(e),null==t?e:l(e,(function(e){return n(t,B,e)}))):[]}function Nr(e){return(e=T(e)).__chain__=!0,e}function xr(e,t){return t(e)}function Dr(e,t){return(Fa(e)?i:Uo)(e,er(t,3))}function Pr(e,t){return(Fa(e)?o:jo)(e,er(t,3))}function Lr(e,t){return(Fa(e)?l:Ut)(e,er(t,3))}function Mr(e,t,n){return t=n?B:t,t=e&&null==t?e.length:t,qn(e,128,B,B,B,B,t)}function Ur(e,t){var n;if("function"!=typeof t)throw new Di("Expected a function");return e=ni(e),function(){return 0<--e&&(n=t.apply(this,arguments)),1>=e&&(t=B),n}}function jr(e,t,n){function r(t){var n=c,r=u;return c=u=B,p=t,l=e.apply(r,n)}function i(e){var n=e-d;return e-=p,d===B||n>=t||0>n||v&&e>=g}function o(){var e=Oa();if(i(e))return a(e);var n=Qo,r=e-p;e=t-(e-d),r=v?vo(e,g-r):e,f=n(o,r)}function a(e){return f=B,m&&c?r(e):(c=u=B,l)}function s(){var e=Oa(),n=i(e);if(c=arguments,u=this,d=e,n){if(f===B)return p=e=d,f=Qo(o,t),h?r(e):l;if(v)return Wo(f),f=Qo(o,t),r(d)}return f===B&&(f=Qo(o,t)),l}var c,u,l,f,d,p=0,h=!1,v=!1,m=!0;if("function"!=typeof e)throw new Di("Expected a function");if(t=ii(t)||0,Yr(n)){h=!!n.leading;var g=(v="maxWait"in n)?ho(ii(n.maxWait)||0,t):g;m="trailing"in n?!!n.trailing:m}return s.cancel=function(){f!==B&&Wo(f),p=0,c=d=u=f=B},s.flush=function(){return f===B?l:a(Oa())},s}function Fr(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Di("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;return o.has(i)?o.get(i):(r=e.apply(this,r),n.cache=o.set(i,r)||o,r)};return n.cache=new(Fr.Cache||Fe),n}function Br(e){if("function"!=typeof e)throw new Di("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Vr(e,t){return e===t||e!=e&&t!=t}function Gr(e){return null!=e&&zr(e.length)&&!Hr(e)}function Wr(e){return Jr(e)&&Gr(e)}function qr(e){if(!Jr(e))return!1;var t=wt(e);return"[object Error]"==t||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!Qr(e)}function Hr(e){return!!Yr(e)&&("[object Function]"==(e=wt(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)}function Kr(e){return"number"==typeof e&&e==ni(e)}function zr(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e}function Yr(e){var t=Ia(e);return null!=e&&("object"==t||"function"==t)}function Jr(e){return null!=e&&"object"==Ia(e)}function Xr(e){return"number"==typeof e||Jr(e)&&"[object Number]"==wt(e)}function Qr(e){return!(!Jr(e)||"[object Object]"!=wt(e))&&(null===(e=Ji(e))||"function"==typeof(e=ji.call(e,"constructor")&&e.constructor)&&e instanceof e&&Ui.call(e)==Gi)}function $r(e){return"string"==typeof e||!Fa(e)&&Jr(e)&&"[object String]"==wt(e)}function Zr(e){return"symbol"==Ia(e)||Jr(e)&&"[object Symbol]"==wt(e)}function ei(e){if(!e)return[];if(Gr(e))return $r(e)?j(e):Sn(e);if(eo&&e[eo]){e=e[eo]();for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}return("[object Map]"==(t=Yo(e))?D:"[object Set]"==t?M:di)(e)}function ti(e){return e?(e=ii(e))===V||e===-V?17976931348623157e292*(0>e?-1:1):e==e?e:0:0===e?e:0}function ni(e){var t=(e=ti(e))%1;return e==e?t?e-t:e:0}function ri(e){return e?lt(ni(e),0,4294967295):0}function ii(e){if("number"==typeof e)return e;if(Zr(e))return G;if(Yr(e)&&(e=Yr(e="function"==typeof e.valueOf?e.valueOf():e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=O(e);var t=me.test(e);return t||Ee.test(e)?Le(e.slice(2),t?2:8):ve.test(e)?G:+e}function oi(e){return wn(e,li(e))}function ai(e){return null==e?"":an(e)}function si(e,t,n){return(e=null==e?B:Tt(e,t))===B?n:e}function ci(e,t){return null!=e&&ir(e,t,It)}function ui(e){return Gr(e)?We(e):Lt(e)}function li(e){if(Gr(e))e=We(e,!0);else if(Yr(e)){var t=fr(e),n=[];for(r in e)("constructor"!=r||!t&&ji.call(e,r))&&n.push(r);e=n}else{var r=[];if(null!=e)for(t in Ci(e))r.push(t);e=r}return e}function fi(e,t){if(null==e)return{};var n=l(Qn(e),(function(e){return[e]}));return t=er(t),Wt(e,n,(function(e,n){return t(e,n[0])}))}function di(e){return null==e?[]:A(e,ui(e))}function pi(e){return Es(ai(e).toLowerCase())}function hi(e){return(e=ai(e))&&e.replace(be,Qe).replace(we,"")}function vi(e,t,n){return e=ai(e),(t=n?B:t)===B?Ae.test(e)?e.match(Oe)||[]:e.match(le)||[]:e.match(t)||[]}function mi(e){return function(){return e}}function gi(e){return e}function Ei(e){return Pt("function"==typeof e?e:ft(e,1))}function _i(e,t,n){var r=ui(t),o=yt(t,r);null!=n||Yr(t)&&(o.length||!r.length)||(n=t,t=e,e=this,o=yt(t,ui(t)));var a=!(Yr(n)&&"chain"in n&&!n.chain),s=Hr(e);return i(o,(function(n){var r=t[n];e[n]=r,s&&(e.prototype[n]=function(){var t=this.__chain__;if(a||t){var n=e(this.__wrapped__);return(n.__actions__=Sn(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,f([this.value()],arguments))})})),e}function bi(){}function yi(e){return ur(e)?y(Er(e)):function(e){return function(t){return Tt(t,e)}}(e)}function Ti(){return[]}function Si(){return!1}var wi,Ri=(t=null==t?je:et.defaults(je.Object(),t,et.pick(je,ke))).Array,Oi=t.Date,Ii=t.Error,Ai=t.Function,ki=t.Math,Ci=t.Object,Ni=t.RegExp,xi=t.String,Di=t.TypeError,Pi=Ri.prototype,Li=Ci.prototype,Mi=t["__core-js_shared__"],Ui=Ai.prototype.toString,ji=Li.hasOwnProperty,Fi=0,Bi=(wi=/[^.]+$/.exec(Mi&&Mi.keys&&Mi.keys.IE_PROTO||""))?"Symbol(src)_1."+wi:"",Vi=Li.toString,Gi=Ui.call(Ci),Wi=je._,qi=Ni("^"+Ui.call(ji).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hi=Ve?t.Buffer:B,Ki=t.Symbol,zi=t.Uint8Array,Yi=Hi?Hi.allocUnsafe:B,Ji=P(Ci.getPrototypeOf,Ci),Xi=Ci.create,Qi=Li.propertyIsEnumerable,$i=Pi.splice,Zi=Ki?Ki.isConcatSpreadable:B,eo=Ki?Ki.iterator:B,to=Ki?Ki.toStringTag:B,no=function(){try{var e=rr(Ci,"defineProperty");return e({},"",{}),e}catch(e){}}(),ro=t.clearTimeout!==je.clearTimeout&&t.clearTimeout,io=Oi&&Oi.now!==je.Date.now&&Oi.now,oo=t.setTimeout!==je.setTimeout&&t.setTimeout,ao=ki.ceil,so=ki.floor,co=Ci.getOwnPropertySymbols,uo=Hi?Hi.isBuffer:B,lo=t.isFinite,fo=Pi.join,po=P(Ci.keys,Ci),ho=ki.max,vo=ki.min,mo=Oi.now,go=t.parseInt,Eo=ki.random,_o=Pi.reverse,bo=rr(t,"DataView"),yo=rr(t,"Map"),To=rr(t,"Promise"),So=rr(t,"Set"),wo=rr(t,"WeakMap"),Ro=rr(Ci,"create"),Oo=wo&&new wo,Io={},Ao=_r(bo),ko=_r(yo),Co=_r(To),No=_r(So),xo=_r(wo),Do=Ki?Ki.prototype:B,Po=Do?Do.valueOf:B,Lo=Do?Do.toString:B,Mo=function(){function e(){}return function(t){return Yr(t)?Xi?Xi(t):(e.prototype=t,t=new e,e.prototype=B,t):{}}}();T.templateSettings={escape:Q,evaluate:$,interpolate:Z,variable:"",imports:{_:T}},T.prototype=ae.prototype,T.prototype.constructor=T,Re.prototype=Mo(ae.prototype),Re.prototype.constructor=Re,De.prototype=Mo(ae.prototype),De.prototype.constructor=De,Me.prototype.clear=function(){this.__data__=Ro?Ro(null):{},this.size=0},Me.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},Me.prototype.get=function(e){var t=this.__data__;return Ro?"__lodash_hash_undefined__"===(e=t[e])?B:e:ji.call(t,e)?t[e]:B},Me.prototype.has=function(e){var t=this.__data__;return Ro?t[e]!==B:ji.call(t,e)},Me.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ro&&t===B?"__lodash_hash_undefined__":t,this},Ue.prototype.clear=function(){this.__data__=[],this.size=0},Ue.prototype.delete=function(e){var t=this.__data__;return!(0>(e=ot(t,e)))&&(e==t.length-1?t.pop():$i.call(t,e,1),--this.size,!0)},Ue.prototype.get=function(e){var t=this.__data__;return 0>(e=ot(t,e))?B:t[e][1]},Ue.prototype.has=function(e){return-1<ot(this.__data__,e)},Ue.prototype.set=function(e,t){var n=this.__data__,r=ot(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this},Fe.prototype.clear=function(){this.size=0,this.__data__={hash:new Me,map:new(yo||Ue),string:new Me}},Fe.prototype.delete=function(e){return e=tr(this,e).delete(e),this.size-=e?1:0,e},Fe.prototype.get=function(e){return tr(this,e).get(e)},Fe.prototype.has=function(e){return tr(this,e).has(e)},Fe.prototype.set=function(e,t){var n=tr(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Be.prototype.add=Be.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Be.prototype.has=function(e){return this.__data__.has(e)},Ge.prototype.clear=function(){this.__data__=new Ue,this.size=0},Ge.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},Ge.prototype.get=function(e){return this.__data__.get(e)},Ge.prototype.has=function(e){return this.__data__.has(e)},Ge.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ue){var r=n.__data__;if(!yo||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Fe(r)}return n.set(e,t),this.size=n.size,this};var Uo=In(_t),jo=In(bt,!0),Fo=An(),Bo=An(!0),Vo=Oo?function(e,t){return Oo.set(e,t),e}:gi,Go=no?function(e,t){return no(e,"toString",{configurable:!0,enumerable:!1,value:mi(t),writable:!0})}:gi,Wo=ro||function(e){return je.clearTimeout(e)},qo=So&&1/M(new So([,-0]))[1]==V?function(e){return new So(e)}:bi,Ho=Oo?function(e){return Oo.get(e)}:bi,Ko=co?function(e){return null==e?[]:(e=Ci(e),s(co(e),(function(t){return Qi.call(e,t)})))}:Ti,zo=co?function(e){for(var t=[];e;)f(t,Ko(e)),e=Ji(e);return t}:Ti,Yo=wt;(bo&&"[object DataView]"!=Yo(new bo(new ArrayBuffer(1)))||yo&&"[object Map]"!=Yo(new yo)||To&&"[object Promise]"!=Yo(To.resolve())||So&&"[object Set]"!=Yo(new So)||wo&&"[object WeakMap]"!=Yo(new wo))&&(Yo=function(e){var t=wt(e);if(e=(e="[object Object]"==t?e.constructor:B)?_r(e):"")switch(e){case Ao:return"[object DataView]";case ko:return"[object Map]";case Co:return"[object Promise]";case No:return"[object Set]";case xo:return"[object WeakMap]"}return t});var Jo=Mi?Hr:Si,Xo=mr(Vo),Qo=oo||function(e,t){return je.setTimeout(e,t)},$o=mr(Go),Zo=function(e){var t=(e=Fr(e,(function(e){return 500===t.size&&t.clear(),e}))).cache;return e}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ne,(function(e,n,r,i){t.push(r?i.replace(de,"$1"):n||e)})),t})),ea=Yt((function(e,t){return Wr(e)?ht(e,Et(t,1,Wr,!0)):[]})),ta=Yt((function(e,t){var n=Or(t);return Wr(n)&&(n=B),Wr(e)?ht(e,Et(t,1,Wr,!0),er(n,2)):[]})),na=Yt((function(e,t){var n=Or(t);return Wr(n)&&(n=B),Wr(e)?ht(e,Et(t,1,Wr,!0),B,n):[]})),ra=Yt((function(e){var t=l(e,pn);return t.length&&t[0]===e[0]?At(t):[]})),ia=Yt((function(e){var t=Or(e),n=l(e,pn);return t===Or(n)?t=B:n.pop(),n.length&&n[0]===e[0]?At(n,er(t,2)):[]})),oa=Yt((function(e){var t=Or(e),n=l(e,pn);return(t="function"==typeof t?t:B)&&n.pop(),n.length&&n[0]===e[0]?At(n,B,t):[]})),aa=Yt(Ir),sa=Jn((function(e,t){var n=null==e?0:e.length,r=ut(e,t);return Ht(e,l(t,(function(e){return sr(e,n)?+e:e})).sort(bn)),r})),ca=Yt((function(e){return sn(Et(e,1,Wr,!0))})),ua=Yt((function(e){var t=Or(e);return Wr(t)&&(t=B),sn(Et(e,1,Wr,!0),er(t,2))})),la=Yt((function(e){var t=Or(e);return t="function"==typeof t?t:B,sn(Et(e,1,Wr,!0),B,t)})),fa=Yt((function(e,t){return Wr(e)?ht(e,t):[]})),da=Yt((function(e){return fn(s(e,Wr))})),pa=Yt((function(e){var t=Or(e);return Wr(t)&&(t=B),fn(s(e,Wr),er(t,2))})),ha=Yt((function(e){var t=Or(e);return t="function"==typeof t?t:B,fn(s(e,Wr),B,t)})),va=Yt(kr),ma=Yt((function(e){var t=e.length;return t="function"==typeof(t=1<t?e[t-1]:B)?(e.pop(),t):B,Cr(e,t)})),ga=Jn((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,i=function(t){return ut(t,e)};return!(1<t||this.__actions__.length)&&r instanceof De&&sr(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:xr,args:[i],thisArg:B}),new Re(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(B),e}))):this.thru(i)})),Ea=Rn((function(e,t,n){ji.call(e,n)?++e[n]:ct(e,n,1)})),_a=xn(Tr),ba=xn(Sr),ya=Rn((function(e,t,n){ji.call(e,n)?e[n].push(t):ct(e,n,[t])})),Ta=Yt((function(e,t,r){var i=-1,o="function"==typeof t,a=Gr(e)?Ri(e.length):[];return Uo(e,(function(e){a[++i]=o?n(t,e,r):kt(e,t,r)})),a})),Sa=Rn((function(e,t,n){ct(e,n,t)})),wa=Rn((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]})),Ra=Yt((function(e,t){if(null==e)return[];var n=t.length;return 1<n&&cr(e,t[0],t[1])?t=[]:2<n&&cr(t[0],t[1],t[2])&&(t=[t[0]]),Gt(e,Et(t,1),[])})),Oa=io||function(){return je.Date.now()},Aa=Yt((function(e,t,n){var r=1;if(n.length){var i=L(n,Zn(Aa));r|=32}return qn(e,r,t,n,i)})),ka=Yt((function(e,t,n){var r=3;if(n.length){var i=L(n,Zn(ka));r|=32}return qn(t,r,e,n,i)})),Ca=Yt((function(e,t){return pt(e,1,t)})),Na=Yt((function(e,t,n){return pt(e,ii(t)||0,n)}));Fr.Cache=Fe;var xa=Yt((function(e,t){var r=(t=1==t.length&&Fa(t[0])?l(t[0],I(er())):l(Et(t,1),I(er()))).length;return Yt((function(i){for(var o=-1,a=vo(i.length,r);++o<a;)i[o]=t[o].call(this,i[o]);return n(e,this,i)}))})),Da=Yt((function(e,t){var n=L(t,Zn(Da));return qn(e,32,B,t,n)})),Pa=Yt((function(e,t){var n=L(t,Zn(Pa));return qn(e,64,B,t,n)})),La=Jn((function(e,t){return qn(e,256,B,B,B,t)})),Ma=Bn(Rt),Ua=Bn((function(e,t){return e>=t})),ja=Ct(function(){return arguments}())?Ct:function(e){return Jr(e)&&ji.call(e,"callee")&&!Qi.call(e,"callee")},Fa=Ri.isArray,Ba=qe?I(qe):function(e){return Jr(e)&&"[object ArrayBuffer]"==wt(e)},Va=uo||Si,Ga=He?I(He):function(e){return Jr(e)&&"[object Date]"==wt(e)},Wa=Ke?I(Ke):function(e){return Jr(e)&&"[object Map]"==Yo(e)},qa=ze?I(ze):function(e){return Jr(e)&&"[object RegExp]"==wt(e)},Ha=Ye?I(Ye):function(e){return Jr(e)&&"[object Set]"==Yo(e)},Ka=Je?I(Je):function(e){return Jr(e)&&zr(e.length)&&!!Ne[wt(e)]},za=Bn(Mt),Ya=Bn((function(e,t){return e<=t})),Ja=On((function(e,t){if(fr(t)||Gr(t))wn(t,ui(t),e);else for(var n in t)ji.call(t,n)&&it(e,n,t[n])})),Xa=On((function(e,t){wn(t,li(t),e)})),Qa=On((function(e,t,n,r){wn(t,li(t),e,r)})),$a=On((function(e,t,n,r){wn(t,ui(t),e,r)})),Za=Jn(ut),es=Yt((function(e,t){e=Ci(e);var n=-1,r=t.length,i=2<r?t[2]:B;for(i&&cr(t[0],t[1],i)&&(r=1);++n<r;)for(var o=li(i=t[n]),a=-1,s=o.length;++a<s;){var c=o[a],u=e[c];(u===B||Vr(u,Li[c])&&!ji.call(e,c))&&(e[c]=i[c])}return e})),ts=Yt((function(e){return e.push(B,Kn),n(as,B,e)})),ns=Ln((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Vi.call(t)),e[t]=n}),mi(gi)),rs=Ln((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Vi.call(t)),ji.call(e,t)?e[t].push(n):e[t]=[n]}),er),is=Yt(kt),os=On((function(e,t,n){Bt(e,t,n)})),as=On((function(e,t,n,r){Bt(e,t,n,r)})),ss=Jn((function(e,t){var n={};if(null==e)return n;var r=!1;t=l(t,(function(t){return t=vn(t,e),r||(r=1<t.length),t})),wn(e,Qn(e),n),r&&(n=ft(n,7,zn));for(var i=t.length;i--;)cn(n,t[i]);return n})),cs=Jn((function(e,t){return null==e?{}:function(e,t){return Wt(e,t,(function(t,n){return ci(e,n)}))}(e,t)})),us=Wn(ui),ls=Wn(li),fs=Cn((function(e,t,n){return t=t.toLowerCase(),e+(n?pi(t):t)})),ds=Cn((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),ps=Cn((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),hs=kn("toLowerCase"),vs=Cn((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()})),ms=Cn((function(e,t,n){return e+(n?" ":"")+Es(t)})),gs=Cn((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Es=kn("toUpperCase"),_s=Yt((function(e,t){try{return n(e,B,t)}catch(e){return qr(e)?e:new Ii(e)}})),bs=Jn((function(e,t){return i(t,(function(t){t=Er(t),ct(e,t,Aa(e[t],e))})),e})),ys=Dn(),Ts=Dn(!0),Ss=Yt((function(e,t){return function(n){return kt(n,e,t)}})),ws=Yt((function(e,t){return function(n){return kt(e,n,t)}})),Rs=Un(l),Os=Un(a),Is=Un(h),As=Fn(),ks=Fn(!0),Cs=Mn((function(e,t){return e+t}),0),Ns=Gn("ceil"),xs=Mn((function(e,t){return e/t}),1),Ds=Gn("floor"),Ps=Mn((function(e,t){return e*t}),1),Ls=Gn("round"),Ms=Mn((function(e,t){return e-t}),0);return T.after=function(e,t){if("function"!=typeof t)throw new Di("Expected a function");return e=ni(e),function(){if(1>--e)return t.apply(this,arguments)}},T.ary=Mr,T.assign=Ja,T.assignIn=Xa,T.assignInWith=Qa,T.assignWith=$a,T.at=Za,T.before=Ur,T.bind=Aa,T.bindAll=bs,T.bindKey=ka,T.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Fa(e)?e:[e]},T.chain=Nr,T.chunk=function(e,t,n){if(t=(n?cr(e,t,n):t===B)?1:ho(ni(t),0),!(n=null==e?0:e.length)||1>t)return[];for(var r=0,i=0,o=Ri(ao(n/t));r<n;)o[i++]=Zt(e,r,r+=t);return o},T.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},T.concat=function(){var e=arguments.length;if(!e)return[];for(var t=Ri(e-1),n=arguments[0];e--;)t[e-1]=arguments[e];return f(Fa(n)?Sn(n):[n],Et(t,1))},T.cond=function(e){var t=null==e?0:e.length,r=er();return e=t?l(e,(function(e){if("function"!=typeof e[1])throw new Di("Expected a function");return[r(e[0]),e[1]]})):[],Yt((function(r){for(var i=-1;++i<t;){var o=e[i];if(n(o[0],this,r))return n(o[1],this,r)}}))},T.conforms=function(e){return function(e){var t=ui(e);return function(n){return dt(n,e,t)}}(ft(e,1))},T.constant=mi,T.countBy=Ea,T.create=function(e,t){return e=Mo(e),null==t?e:st(e,t)},T.curry=function e(t,n,r){return(t=qn(t,8,B,B,B,B,B,n=r?B:n)).placeholder=e.placeholder,t},T.curryRight=function e(t,n,r){return(t=qn(t,16,B,B,B,B,B,n=r?B:n)).placeholder=e.placeholder,t},T.debounce=jr,T.defaults=es,T.defaultsDeep=ts,T.defer=Ca,T.delay=Na,T.difference=ea,T.differenceBy=ta,T.differenceWith=na,T.drop=function(e,t,n){var r=null==e?0:e.length;return r?Zt(e,0>(t=n||t===B?1:ni(t))?0:t,r):[]},T.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?Zt(e,0,0>(t=r-(t=n||t===B?1:ni(t)))?0:t):[]},T.dropRightWhile=function(e,t){return e&&e.length?un(e,er(t,3),!0,!0):[]},T.dropWhile=function(e,t){return e&&e.length?un(e,er(t,3),!0):[]},T.fill=function(e,t,n,r){var i=null==e?0:e.length;if(!i)return[];for(n&&"number"!=typeof n&&cr(e,t,n)&&(n=0,r=i),i=e.length,0>(n=ni(n))&&(n=-n>i?0:i+n),0>(r=r===B||r>i?i:ni(r))&&(r+=i),r=n>r?0:ri(r);n<r;)e[n++]=t;return e},T.filter=function(e,t){return(Fa(e)?s:gt)(e,er(t,3))},T.flatMap=function(e,t){return Et(Lr(e,t),1)},T.flatMapDeep=function(e,t){return Et(Lr(e,t),V)},T.flatMapDepth=function(e,t,n){return n=n===B?1:ni(n),Et(Lr(e,t),n)},T.flatten=wr,T.flattenDeep=function(e){return null!=e&&e.length?Et(e,V):[]},T.flattenDepth=function(e,t){return null!=e&&e.length?Et(e,t=t===B?1:ni(t)):[]},T.flip=function(e){return qn(e,512)},T.flow=ys,T.flowRight=Ts,T.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},T.functions=function(e){return null==e?[]:yt(e,ui(e))},T.functionsIn=function(e){return null==e?[]:yt(e,li(e))},T.groupBy=ya,T.initial=function(e){return null!=e&&e.length?Zt(e,0,-1):[]},T.intersection=ra,T.intersectionBy=ia,T.intersectionWith=oa,T.invert=ns,T.invertBy=rs,T.invokeMap=Ta,T.iteratee=Ei,T.keyBy=Sa,T.keys=ui,T.keysIn=li,T.map=Lr,T.mapKeys=function(e,t){var n={};return t=er(t,3),_t(e,(function(e,r,i){ct(n,t(e,r,i),e)})),n},T.mapValues=function(e,t){var n={};return t=er(t,3),_t(e,(function(e,r,i){ct(n,r,t(e,r,i))})),n},T.matches=function(e){return jt(ft(e,1))},T.matchesProperty=function(e,t){return Ft(e,ft(t,1))},T.memoize=Fr,T.merge=os,T.mergeWith=as,T.method=Ss,T.methodOf=ws,T.mixin=_i,T.negate=Br,T.nthArg=function(e){return e=ni(e),Yt((function(t){return Vt(t,e)}))},T.omit=ss,T.omitBy=function(e,t){return fi(e,Br(er(t)))},T.once=function(e){return Ur(2,e)},T.orderBy=function(e,t,n,r){return null==e?[]:(Fa(t)||(t=null==t?[]:[t]),Fa(n=r?B:n)||(n=null==n?[]:[n]),Gt(e,t,n))},T.over=Rs,T.overArgs=xa,T.overEvery=Os,T.overSome=Is,T.partial=Da,T.partialRight=Pa,T.partition=wa,T.pick=cs,T.pickBy=fi,T.property=yi,T.propertyOf=function(e){return function(t){return null==e?B:Tt(e,t)}},T.pull=aa,T.pullAll=Ir,T.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?qt(e,t,er(n,2)):e},T.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?qt(e,t,B,n):e},T.pullAt=sa,T.range=As,T.rangeRight=ks,T.rearg=La,T.reject=function(e,t){return(Fa(e)?s:gt)(e,Br(er(t,3)))},T.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=er(t,3);++r<o;){var a=e[r];t(a,r,e)&&(n.push(a),i.push(r))}return Ht(e,i),n},T.rest=function(e,t){if("function"!=typeof e)throw new Di("Expected a function");return Yt(e,t=t===B?t:ni(t))},T.reverse=Ar,T.sampleSize=function(e,t,n){return t=(n?cr(e,t,n):t===B)?1:ni(t),(Fa(e)?tt:Xt)(e,t)},T.set=function(e,t,n){return null==e?e:Qt(e,t,n)},T.setWith=function(e,t,n,r){return r="function"==typeof r?r:B,null==e?e:Qt(e,t,n,r)},T.shuffle=function(e){return(Fa(e)?nt:$t)(e)},T.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&cr(e,t,n)?(t=0,n=r):(t=null==t?0:ni(t),n=n===B?r:ni(n)),Zt(e,t,n)):[]},T.sortBy=Ra,T.sortedUniq=function(e){return e&&e.length?rn(e):[]},T.sortedUniqBy=function(e,t){return e&&e.length?rn(e,er(t,2)):[]},T.split=function(e,t,n){return n&&"number"!=typeof n&&cr(e,t,n)&&(t=n=B),(n=n===B?4294967295:n>>>0)?(e=ai(e))&&("string"==typeof t||null!=t&&!qa(t))&&!(t=an(t))&&Ie.test(e)?mn(j(e),0,n):e.split(t,n):[]},T.spread=function(e,t){if("function"!=typeof e)throw new Di("Expected a function");return t=null==t?0:ho(ni(t),0),Yt((function(r){var i=r[t];return r=mn(r,0,t),i&&f(r,i),n(e,this,r)}))},T.tail=function(e){var t=null==e?0:e.length;return t?Zt(e,1,t):[]},T.take=function(e,t,n){return e&&e.length?Zt(e,0,0>(t=n||t===B?1:ni(t))?0:t):[]},T.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?Zt(e,0>(t=r-(t=n||t===B?1:ni(t)))?0:t,r):[]},T.takeRightWhile=function(e,t){return e&&e.length?un(e,er(t,3),!1,!0):[]},T.takeWhile=function(e,t){return e&&e.length?un(e,er(t,3)):[]},T.tap=function(e,t){return t(e),e},T.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new Di("Expected a function");return Yr(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),jr(e,t,{leading:r,maxWait:t,trailing:i})},T.thru=xr,T.toArray=ei,T.toPairs=us,T.toPairsIn=ls,T.toPath=function(e){return Fa(e)?l(e,Er):Zr(e)?[e]:Sn(Zo(ai(e)))},T.toPlainObject=oi,T.transform=function(e,t,n){var r=Fa(e),o=r||Va(e)||Ka(e);if(t=er(t,4),null==n){var a=e&&e.constructor;n=o?r?new a:[]:Yr(e)&&Hr(a)?Mo(Ji(e)):{}}return(o?i:_t)(e,(function(e,r,i){return t(n,e,r,i)})),n},T.unary=function(e){return Mr(e,1)},T.union=ca,T.unionBy=ua,T.unionWith=la,T.uniq=function(e){return e&&e.length?sn(e):[]},T.uniqBy=function(e,t){return e&&e.length?sn(e,er(t,2)):[]},T.uniqWith=function(e,t){return t="function"==typeof t?t:B,e&&e.length?sn(e,B,t):[]},T.unset=function(e,t){return null==e||cn(e,t)},T.unzip=kr,T.unzipWith=Cr,T.update=function(e,t,n){return null!=e&&(e=Qt(e,t,(n=hn(n))(Tt(e,t)),void 0)),e},T.updateWith=function(e,t,n,r){return r="function"==typeof r?r:B,null!=e&&(e=Qt(e,t,(n=hn(n))(Tt(e,t)),r)),e},T.values=di,T.valuesIn=function(e){return null==e?[]:A(e,li(e))},T.without=fa,T.words=vi,T.wrap=function(e,t){return Da(hn(t),e)},T.xor=da,T.xorBy=pa,T.xorWith=ha,T.zip=va,T.zipObject=function(e,t){return dn(e||[],t||[],it)},T.zipObjectDeep=function(e,t){return dn(e||[],t||[],Qt)},T.zipWith=ma,T.entries=us,T.entriesIn=ls,T.extend=Xa,T.extendWith=Qa,_i(T,T),T.add=Cs,T.attempt=_s,T.camelCase=fs,T.capitalize=pi,T.ceil=Ns,T.clamp=function(e,t,n){return n===B&&(n=t,t=B),n!==B&&(n=(n=ii(n))==n?n:0),t!==B&&(t=(t=ii(t))==t?t:0),lt(ii(e),t,n)},T.clone=function(e){return ft(e,4)},T.cloneDeep=function(e){return ft(e,5)},T.cloneDeepWith=function(e,t){return ft(e,5,t="function"==typeof t?t:B)},T.cloneWith=function(e,t){return ft(e,4,t="function"==typeof t?t:B)},T.conformsTo=function(e,t){return null==t||dt(e,t,ui(t))},T.deburr=hi,T.defaultTo=function(e,t){return null==e||e!=e?t:e},T.divide=xs,T.endsWith=function(e,t,n){e=ai(e),t=an(t);var r=e.length;return r=n=n===B?r:lt(ni(n),0,r),0<=(n-=t.length)&&e.slice(n,r)==t},T.eq=Vr,T.escape=function(e){return(e=ai(e))&&X.test(e)?e.replace(Y,$e):e},T.escapeRegExp=function(e){return(e=ai(e))&&ie.test(e)?e.replace(re,"\\$&"):e},T.every=function(e,t,n){var r=Fa(e)?a:vt;return n&&cr(e,t,n)&&(t=B),r(e,er(t,3))},T.find=_a,T.findIndex=Tr,T.findKey=function(e,t){return v(e,er(t,3),_t)},T.findLast=ba,T.findLastIndex=Sr,T.findLastKey=function(e,t){return v(e,er(t,3),bt)},T.floor=Ds,T.forEach=Dr,T.forEachRight=Pr,T.forIn=function(e,t){return null==e?e:Fo(e,er(t,3),li)},T.forInRight=function(e,t){return null==e?e:Bo(e,er(t,3),li)},T.forOwn=function(e,t){return e&&_t(e,er(t,3))},T.forOwnRight=function(e,t){return e&&bt(e,er(t,3))},T.get=si,T.gt=Ma,T.gte=Ua,T.has=function(e,t){return null!=e&&ir(e,t,Ot)},T.hasIn=ci,T.head=Rr,T.identity=gi,T.includes=function(e,t,n,r){return e=Gr(e)?e:di(e),n=n&&!r?ni(n):0,r=e.length,0>n&&(n=ho(r+n,0)),$r(e)?n<=r&&-1<e.indexOf(t,n):!!r&&-1<g(e,t,n)},T.indexOf=function(e,t,n){var r=null==e?0:e.length;return r?(0>(n=null==n?0:ni(n))&&(n=ho(r+n,0)),g(e,t,n)):-1},T.inRange=function(e,t,n){return t=ti(t),n===B?(n=t,t=0):n=ti(n),(e=ii(e))>=vo(t,n)&&e<ho(t,n)},T.invoke=is,T.isArguments=ja,T.isArray=Fa,T.isArrayBuffer=Ba,T.isArrayLike=Gr,T.isArrayLikeObject=Wr,T.isBoolean=function(e){return!0===e||!1===e||Jr(e)&&"[object Boolean]"==wt(e)},T.isBuffer=Va,T.isDate=Ga,T.isElement=function(e){return Jr(e)&&1===e.nodeType&&!Qr(e)},T.isEmpty=function(e){if(null==e)return!0;if(Gr(e)&&(Fa(e)||"string"==typeof e||"function"==typeof e.splice||Va(e)||Ka(e)||ja(e)))return!e.length;var t=Yo(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(fr(e))return!Lt(e).length;for(var n in e)if(ji.call(e,n))return!1;return!0},T.isEqual=function(e,t){return Nt(e,t)},T.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:B)?n(e,t):B;return r===B?Nt(e,t,B,n):!!r},T.isError=qr,T.isFinite=function(e){return"number"==typeof e&&lo(e)},T.isFunction=Hr,T.isInteger=Kr,T.isLength=zr,T.isMap=Wa,T.isMatch=function(e,t){return e===t||xt(e,t,nr(t))},T.isMatchWith=function(e,t,n){return n="function"==typeof n?n:B,xt(e,t,nr(t),n)},T.isNaN=function(e){return Xr(e)&&e!=+e},T.isNative=function(e){if(Jo(e))throw new Ii("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Dt(e)},T.isNil=function(e){return null==e},T.isNull=function(e){return null===e},T.isNumber=Xr,T.isObject=Yr,T.isObjectLike=Jr,T.isPlainObject=Qr,T.isRegExp=qa,T.isSafeInteger=function(e){return Kr(e)&&-9007199254740991<=e&&9007199254740991>=e},T.isSet=Ha,T.isString=$r,T.isSymbol=Zr,T.isTypedArray=Ka,T.isUndefined=function(e){return e===B},T.isWeakMap=function(e){return Jr(e)&&"[object WeakMap]"==Yo(e)},T.isWeakSet=function(e){return Jr(e)&&"[object WeakSet]"==wt(e)},T.join=function(e,t){return null==e?"":fo.call(e,t)},T.kebabCase=ds,T.last=Or,T.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;if(n!==B&&(i=0>(i=ni(n))?ho(r+i,0):vo(i,r-1)),t==t)e:{for(n=i+1;n--;)if(e[n]===t){e=n;break e}e=n}else e=m(e,_,i,!0);return e},T.lowerCase=ps,T.lowerFirst=hs,T.lt=za,T.lte=Ya,T.max=function(e){return e&&e.length?mt(e,gi,Rt):B},T.maxBy=function(e,t){return e&&e.length?mt(e,er(t,2),Rt):B},T.mean=function(e){return b(e,gi)},T.meanBy=function(e,t){return b(e,er(t,2))},T.min=function(e){return e&&e.length?mt(e,gi,Mt):B},T.minBy=function(e,t){return e&&e.length?mt(e,er(t,2),Mt):B},T.stubArray=Ti,T.stubFalse=Si,T.stubObject=function(){return{}},T.stubString=function(){return""},T.stubTrue=function(){return!0},T.multiply=Ps,T.nth=function(e,t){return e&&e.length?Vt(e,ni(t)):B},T.noConflict=function(){return je._===this&&(je._=Wi),this},T.noop=bi,T.now=Oa,T.pad=function(e,t,n){e=ai(e);var r=(t=ni(t))?U(e):0;return!t||r>=t?e:jn(so(t=(t-r)/2),n)+e+jn(ao(t),n)},T.padEnd=function(e,t,n){e=ai(e);var r=(t=ni(t))?U(e):0;return t&&r<t?e+jn(t-r,n):e},T.padStart=function(e,t,n){e=ai(e);var r=(t=ni(t))?U(e):0;return t&&r<t?jn(t-r,n)+e:e},T.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),go(ai(e).replace(oe,""),t||0)},T.random=function(e,t,n){if(n&&"boolean"!=typeof n&&cr(e,t,n)&&(t=n=B),n===B&&("boolean"==typeof t?(n=t,t=B):"boolean"==typeof e&&(n=e,e=B)),e===B&&t===B?(e=0,t=1):(e=ti(e),t===B?(t=e,e=0):t=ti(t)),e>t){var r=e;e=t,t=r}return n||e%1||t%1?(n=Eo(),vo(e+n*(t-e+Pe("1e-"+((n+"").length-1))),t)):Kt(e,t)},T.reduce=function(e,t,n){var r=Fa(e)?d:S,i=3>arguments.length;return r(e,er(t,4),n,i,Uo)},T.reduceRight=function(e,t,n){var r=Fa(e)?p:S,i=3>arguments.length;return r(e,er(t,4),n,i,jo)},T.repeat=function(e,t,n){return t=(n?cr(e,t,n):t===B)?1:ni(t),zt(ai(e),t)},T.replace=function(){var e=arguments,t=ai(e[0]);return 3>e.length?t:t.replace(e[1],e[2])},T.result=function(e,t,n){var r=-1,i=(t=vn(t,e)).length;for(i||(i=1,e=B);++r<i;){var o=null==e?B:e[Er(t[r])];o===B&&(r=i,o=n),e=Hr(o)?o.call(e):o}return e},T.round=Ls,T.runInContext=e,T.sample=function(e){return(Fa(e)?Xe:Jt)(e)},T.size=function(e){if(null==e)return 0;if(Gr(e))return $r(e)?U(e):e.length;var t=Yo(e);return"[object Map]"==t||"[object Set]"==t?e.size:Lt(e).length},T.snakeCase=vs,T.some=function(e,t,n){var r=Fa(e)?h:en;return n&&cr(e,t,n)&&(t=B),r(e,er(t,3))},T.sortedIndex=function(e,t){return tn(e,t)},T.sortedIndexBy=function(e,t,n){return nn(e,t,er(n,2))},T.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=tn(e,t);if(r<n&&Vr(e[r],t))return r}return-1},T.sortedLastIndex=function(e,t){return tn(e,t,!0)},T.sortedLastIndexBy=function(e,t,n){return nn(e,t,er(n,2),!0)},T.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=tn(e,t,!0)-1;if(Vr(e[n],t))return n}return-1},T.startCase=ms,T.startsWith=function(e,t,n){return e=ai(e),n=null==n?0:lt(ni(n),0,e.length),t=an(t),e.slice(n,n+t.length)==t},T.subtract=Ms,T.sum=function(e){return e&&e.length?w(e,gi):0},T.sumBy=function(e,t){return e&&e.length?w(e,er(t,2)):0},T.template=function(e,t,n){var r=T.templateSettings;n&&cr(e,t,n)&&(t=B),e=ai(e),t=Qa({},t,r,Hn);var i,o,a=ui(n=Qa({},t.imports,r.imports,Hn)),s=A(n,a),c=0;n=t.interpolate||ye;var u="__p += '";n=Ni((t.escape||ye).source+"|"+n.source+"|"+(n===Z?pe:ye).source+"|"+(t.evaluate||ye).source+"|$","g");var l="//# sourceURL="+(ji.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ce+"]")+"\n";if(e.replace(n,(function(t,n,r,a,s,l){return r||(r=a),u+=e.slice(c,l).replace(Te,x),n&&(i=!0,u+="' +\n__e("+n+") +\n'"),s&&(o=!0,u+="';\n"+s+";\n__p += '"),r&&(u+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=l+t.length,t})),u+="';\n",t=ji.call(t,"variable")&&t.variable){if(fe.test(t))throw new Ii("Invalid `variable` option passed into `_.template`")}else u="with (obj) {\n"+u+"\n}\n";if(u=(o?u.replace(q,""):u).replace(H,"$1").replace(K,"$1;"),u="function("+(t||"obj")+") {\n"+(t?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+u+"return __p\n}",(t=_s((function(){return Ai(a,l+"return "+u).apply(B,s)}))).source=u,qr(t))throw t;return t},T.times=function(e,t){if(1>(e=ni(e))||9007199254740991<e)return[];var n=4294967295,r=vo(e,4294967295);for(e-=4294967295,r=R(r,t=er(t));++n<e;)t(n);return r},T.toFinite=ti,T.toInteger=ni,T.toLength=ri,T.toLower=function(e){return ai(e).toLowerCase()},T.toNumber=ii,T.toSafeInteger=function(e){return e?lt(ni(e),-9007199254740991,9007199254740991):0===e?e:0},T.toString=ai,T.toUpper=function(e){return ai(e).toUpperCase()},T.trim=function(e,t,n){return(e=ai(e))&&(n||t===B)?O(e):e&&(t=an(t))?mn(e=j(e),t=C(e,n=j(t)),n=N(e,n)+1).join(""):e},T.trimEnd=function(e,t,n){return(e=ai(e))&&(n||t===B)?e.slice(0,F(e)+1):e&&(t=an(t))?mn(e=j(e),0,t=N(e,j(t))+1).join(""):e},T.trimStart=function(e,t,n){return(e=ai(e))&&(n||t===B)?e.replace(oe,""):e&&(t=an(t))?mn(e=j(e),t=C(e,j(t))).join(""):e},T.truncate=function(e,t){var n=30,r="...";if(Yr(t)){var i="separator"in t?t.separator:i;n="length"in t?ni(t.length):n,r="omission"in t?an(t.omission):r}if(t=(e=ai(e)).length,Ie.test(e)){var o=j(e);t=o.length}if(n>=t)return e;if(1>(t=n-U(r)))return r;if(n=o?mn(o,0,t).join(""):e.slice(0,t),i===B)return n+r;if(o&&(t+=n.length-t),qa(i)){if(e.slice(t).search(i)){for(o=n,i.global||(i=Ni(i.source,ai(he.exec(i))+"g")),i.lastIndex=0;e=i.exec(o);)var a=e.index;n=n.slice(0,a===B?t:a)}}else e.indexOf(an(i),t)!=t&&-1<(i=n.lastIndexOf(i))&&(n=n.slice(0,i));return n+r},T.unescape=function(e){return(e=ai(e))&&J.test(e)?e.replace(z,Ze):e},T.uniqueId=function(e){var t=++Fi;return ai(e)+t},T.upperCase=gs,T.upperFirst=Es,T.each=Dr,T.eachRight=Pr,T.first=Rr,_i(T,function(){var e={};return _t(T,(function(t,n){ji.call(T.prototype,n)||(e[n]=t)})),e}(),{chain:!1}),T.VERSION="4.17.21",i("bind bindKey curry curryRight partial partialRight".split(" "),(function(e){T[e].placeholder=T})),i(["drop","take"],(function(e,t){De.prototype[e]=function(n){n=n===B?1:ho(ni(n),0);var r=this.__filtered__&&!t?new De(this):this.clone();return r.__filtered__?r.__takeCount__=vo(n,r.__takeCount__):r.__views__.push({size:vo(n,4294967295),type:e+(0>r.__dir__?"Right":"")}),r},De.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),i(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;De.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:er(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),i(["head","last"],(function(e,t){var n="take"+(t?"Right":"");De.prototype[e]=function(){return this[n](1).value()[0]}})),i(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");De.prototype[e]=function(){return this.__filtered__?new De(this):this[n](1)}})),De.prototype.compact=function(){return this.filter(gi)},De.prototype.find=function(e){return this.filter(e).head()},De.prototype.findLast=function(e){return this.reverse().find(e)},De.prototype.invokeMap=Yt((function(e,t){return"function"==typeof e?new De(this):this.map((function(n){return kt(n,e,t)}))})),De.prototype.reject=function(e){return this.filter(Br(er(e)))},De.prototype.slice=function(e,t){e=ni(e);var n=this;return n.__filtered__&&(0<e||0>t)?new De(n):(0>e?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==B&&(n=0>(t=ni(t))?n.dropRight(-t):n.take(t-e)),n)},De.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},De.prototype.toArray=function(){return this.take(4294967295)},_t(De.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),i=T[r?"take"+("last"==t?"Right":""):t],o=r||/^find/.test(t);i&&(T.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,s=t instanceof De,c=a[0],u=s||Fa(t),l=function(e){return e=i.apply(T,f([e],a)),r&&d?e[0]:e};u&&n&&"function"==typeof c&&1!=c.length&&(s=u=!1);var d=this.__chain__,p=!!this.__actions__.length;return c=o&&!d,s=s&&!p,!o&&u?(t=s?t:new De(this),(t=e.apply(t,a)).__actions__.push({func:xr,args:[l],thisArg:B}),new Re(t,d)):c&&s?e.apply(this,a):(t=this.thru(l),c?r?t.value()[0]:t.value():t)})})),i("pop push shift sort splice unshift".split(" "),(function(e){var t=Pi[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);T.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(Fa(i)?i:[],e)}return this[n]((function(n){return t.apply(Fa(n)?n:[],e)}))}})),_t(De.prototype,(function(e,t){if(e=T[t]){var n=e.name+"";ji.call(Io,n)||(Io[n]=[]),Io[n].push({name:t,func:e})}})),Io[Pn(B,2).name]=[{name:"wrapper",func:B}],De.prototype.clone=function(){var e=new De(this.__wrapped__);return e.__actions__=Sn(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Sn(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Sn(this.__views__),e},De.prototype.reverse=function(){if(this.__filtered__){var e=new De(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},De.prototype.value=function(){for(var e=this.__wrapped__.value(),t=this.__dir__,n=Fa(e),r=0>t,i=n?e.length:0,o=0,a=i,s=this.__views__,c=-1,u=s.length;++c<u;){var l=s[c],f=l.size;switch(l.type){case"drop":o+=f;break;case"dropRight":a-=f;break;case"take":a=vo(a,o+f);break;case"takeRight":o=ho(o,a-f)}}if(a=(s=a)-o,o=r?s:o-1,c=(s=this.__iteratees__).length,u=0,l=vo(a,this.__takeCount__),!n||!r&&i==a&&l==a)return ln(e,this.__actions__);n=[];e:for(;a--&&u<l;){for(r=-1,i=e[o+=t];++r<c;){var d=s[r];if(f=d.iteratee,d=d.type,f=f(i),2==d)i=f;else if(!f){if(1==d)continue e;break e}}n[u++]=i}return n},T.prototype.at=ga,T.prototype.chain=function(){return Nr(this)},T.prototype.commit=function(){return new Re(this.value(),this.__chain__)},T.prototype.next=function(){this.__values__===B&&(this.__values__=ei(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?B:this.__values__[this.__index__++]}},T.prototype.plant=function(e){for(var t,n=this;n instanceof ae;){var r=yr(n);r.__index__=0,r.__values__=B,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t},T.prototype.reverse=function(){var e=this.__wrapped__;return e instanceof De?(this.__actions__.length&&(e=new De(this)),(e=e.reverse()).__actions__.push({func:xr,args:[Ar],thisArg:B}),new Re(e,this.__chain__)):this.thru(Ar)},T.prototype.toJSON=T.prototype.valueOf=T.prototype.value=function(){return ln(this.__wrapped__,this.__actions__)},T.prototype.first=T.prototype.head,eo&&(T.prototype[eo]=function(){return this}),T}();Be?((Be.exports=et)._=et,Fe._=et):je._=et}).call(qb)})),Nz=1/0,wq=function(e){return e?(e=hl(e))===Nz||e===-Nz?17976931348623157e292*(0>e?-1:1):e==e?e:0:0===e?e:0},KO=Math.max,AC=function(e,t,n){var r=Object(e);if(!$f(e)){var i=Ch(t);e=Wf(e),t=function(e){return i(r[e],e,r)}}return-1<(t=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;if(null==n)n=0;else{var i=(n=wq(n))%1;n=n==n?i?n-i:n:0}return 0>n&&(n=KO(r+n,0)),Cv(e,Ch(t),n)}(e,t,n))?r[i?e[t]:t]:void 0},zC=function(e,t){return e&&e.length?Do(e,void 0,"function"==typeof t?t:void 0):[]},Oz=function(){function e(){ab(this,e),E(this,"size",0),E(this,"fields",new Map)}return Qb(e,[{key:"define",value:function(e,t,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");ak(t={val:0,isNumber:"number"===t,isBoolean:"boolean"===t,oneof:"number"===t||"boolean"===t?void 0:t,len:n}),this.fields.set(e,t)}},{key:"set",value:function(e,t){if(!(e=this.fields.get(e)))throw Error("field not found");var n=e.oneof;if(!D.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(t=n[t]))throw Error("field type not found")}ak(e,t),e.val=t}},{key:"toNumber",value:function(){for(var e=0,t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=Lb(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e+=D.fromValue(i).shiftLeft(t).toNumber(),t+=o)}return e}},{key:"toLong",value:function(){for(var e=D.fromNumber(0,!0),t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=Lb(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e=D.fromValue(i).shiftLeft(t).add(e),t+=o)}return e}},{key:"assert",value:function(e,t){function n(e){if(!D.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===i)throw Error("invalid field type");if(void 0===(e=i[e]))throw Error("field type not found")}return ak(r,e),Zj(e,r.val)}var r=this.fields.get(e);if(!r)throw Error("field not found");var i=r.oneof;if(!Array.isArray(t))return n(t);if(1===t.length)return n(t[0]);if(t.every((function(e){return"string"==typeof e}))&&void 0!==i)return t.some((function(e){return n(e)}));throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=D.fromValue(e);for(var t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=Lb(r[n],2)[1],o=i.len,a=D.fromNumber(Math.pow(2,o)-1,!0).shiftLeft(t);ak(i,a=e.and(a).shiftRightUnsigned(t)),i.val=a,t+=o}}},{key:"typeOf",value:function(e){if(void 0!==(e=this.fields.get(e))){var t=e.oneof;if(e=e.val,void 0!==t){var n=0;for(t=Object.entries(t);n<t.length;n++){var r=Lb(t[n],2),i=r[0];if(Zj(e,r[1]))return i}}}throw new TypeError("can only get type of oneof type")}}]),e}(),Pz=function(e){function t(e){ab(this,t);var r=n.call(this);return r.define("Rejoin","boolean",1),r.define("Unused","number",31),r.define("Platform","number",8),r.define("Version","number",12),r.define("Subversion","number",12),r.set("Platform",7),r.set("Version",7),r.set("Subversion",228),r.set("Rejoin",e),r}nb(t,e);var n=ob(t);return t}(Oz),LO=tb(tb({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),Qz={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},MO=tb(tb({},LO),Qz),NO={Uncompressed:0,Zlib:1},Yh=function(e){function t(e){ab(this,t);var r=n.call(this);if(r.define("MessageType",MO,8),r.define("BroadcastJumps","number",2),r.define("ToCache","boolean",1),r.define("FromCache","boolean",1),r.define("CompressionMethod",NO,2),r.define("IterationNumber","number",4),r.define("BufferedMessage","boolean",1),r.define("ToArchive","boolean",1),r.define("FromArchive","boolean",1),"number"==typeof e||D.isLong(e))r.from(e);else if(void 0!==e){var i=0;for(e=Vj(e);i<e.length;i++){var o=Lb(e[i],2);r.set(o[0],o[1])}}return r}nb(t,e);var n=ob(t);return Qb(t,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(e){var t=this;return void 0!==e?this.assert("MessageType",e):vi(Qz).some((function(e){return t.assert("MessageType",e)}))}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),t}(Oz),Fs=function(){function e(t){var n,r,i,o,a;ab(this,e),E(this,"key",void 0),E(this,"value",void 0),E(this,"revision",void 0),E(this,"updateTs",void 0),E(this,"authorUserId",void 0),this.key=null!==(n=null==t?void 0:t.key)&&void 0!==n?n:"",this.value=null!==(r=null==t?void 0:t.value)&&void 0!==r?r:"",this.revision=null!==(i=null==t?void 0:t.revision)&&void 0!==i?i:-1,this.updateTs=null!==(o=null==t?void 0:t.updateTs)&&void 0!==o?o:0,this.authorUserId=null!==(a=null==t?void 0:t.authorUserId)&&void 0!==a?a:""}return Qb(e,[{key:"setKey",value:function(e){if("string"!=typeof e)throw new Ib("Cannot set MetaDataItem key as ".concat(e));this.key=e,this.key=e}},{key:"getKey",value:function(){if("string"==typeof this.key)return this.key;throw new Ib("Cannot get MetaDataItem key")}},{key:"setValue",value:function(e){if("string"!=typeof e&&!Pd.isNull(null))throw new Ib("Cannot set MetaDataItem value as ".concat(e));this.value=e}},{key:"getValue",value:function(){if("string"==typeof this.value||Pd.isNull(null))return this.value;throw new Ib("Cannot get MetaDataItem value")}},{key:"setRevision",value:function(e){if("number"!=typeof e||0!=e%1)throw new Ib("Cannot set MetaDataItem revision as ".concat(e));this.revision=e}},{key:"getRevision",value:function(){if("number"==typeof this.revision)return this.revision;throw new Ib("Cannot get MetaDataItem revision")}},{key:"getUpdateTs",value:function(){return this.updateTs}},{key:"getAuthorUserId",value:function(){return this.authorUserId}}]),e}(),Ge,bg;!function(e){e.STATE_REVISION_KEY_PREFIX="_rev_",e.STATE_TIMESTAMP_PREFIX="_t_",e.STATE_AUTHOR_PREFIX="_m_",e.STATE_REVISION="_rev",e.STATE_INTERNAL_PREFIX="_"}(Ge||(Ge={})),function(e){e[e.StateOk=0]="StateOk",e[e.DuplicatedOperation=1]="DuplicatedOperation",e[e.SyncServerError=2]="SyncServerError",e[e.ArgumentError=3]="ArgumentError",e[e.AuthicationError=4]="AuthicationError",e[e.ExceedLimitationError=5]="ExceedLimitationError",e[e.OutdateRevision=6]="OutdateRevision",e[e.LockAcquireFailed=7]="LockAcquireFailed",e[e.LockExpired=8]="LockExpired",e[e.LockWatching=9]="LockWatching",e[e.InvalidLock=10]="InvalidLock",e[e.TimeOutError=100]="TimeOutError",e[e.UnknownError=255]="UnknownError"}(bg||(bg={}));var OO=Math.max,PO=Math.min,Rz=function(e,t,n){return t=wq(t),void 0===n?(n=t,t=0):n=wq(n),(e=hl(e))>=PO(t,n)&&e<OO(t,n)},Wl=function(e){function t(e,r,i){return ab(this,t),E(L(r=n.call(this,r,"MessageReport")),"messagecount",r.getInitMessageCount()),E(L(r),"context",void 0),E(L(r),"rtmMessageCategory",void 0),E(L(r),"seq",D.fromNumber(1,!0)),r.context=e,r.rtmMessageCategory=i,r}nb(t,e);var n=ob(t);return Qb(t,[{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1)}},{key:"getInitMessageCount",value:function(){return{peerack10mscount:D.fromNumber(0),peerack25mscount:D.fromNumber(0),peerack50mscount:D.fromNumber(0),peerack75mscount:D.fromNumber(0),peerack100mscount:D.fromNumber(0),peerack150mscount:D.fromNumber(0),peerack200mscount:D.fromNumber(0),peerack250mscount:D.fromNumber(0),peerack300mscount:D.fromNumber(0),peerack400mscount:D.fromNumber(0),peerack500mscount:D.fromNumber(0),peerack600mscount:D.fromNumber(0),peerack800mscount:D.fromNumber(0),peerack1000mscount:D.fromNumber(0),peerack2000mscount:D.fromNumber(0),peerack3000mscount:D.fromNumber(0),peerack5000mscount:D.fromNumber(0),peerack7000mscount:D.fromNumber(0),peerackslowcount:D.fromNumber(0),norecipientack10mscount:D.fromNumber(0),norecipientack25mscount:D.fromNumber(0),norecipientack50mscount:D.fromNumber(0),norecipientack75mscount:D.fromNumber(0),norecipientack100mscount:D.fromNumber(0),norecipientack150mscount:D.fromNumber(0),norecipientack200mscount:D.fromNumber(0),norecipientack250mscount:D.fromNumber(0),norecipientack300mscount:D.fromNumber(0),norecipientack400mscount:D.fromNumber(0),norecipientack500mscount:D.fromNumber(0),norecipientack600mscount:D.fromNumber(0),norecipientack800mscount:D.fromNumber(0),norecipientack1000mscount:D.fromNumber(0),norecipientack2000mscount:D.fromNumber(0),norecipientack3000mscount:D.fromNumber(0),norecipientack5000mscount:D.fromNumber(0),norecipientack7000mscount:D.fromNumber(0),norecipientackslowcount:D.fromNumber(0),sentcount:D.fromNumber(0),receivedcount:D.fromNumber(0),acktimeoutcount:D.fromNumber(0),toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0}}},{key:"updatePeerAckCount",value:function(e){e/=2;for(var t=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],n=0;n<t.length;n++){var r,i=t[n];if(Rz(e,i[0],i[1]))i="peerack".concat(i[1],"mscount"),this.messagecount[i]=null===(r=this.messagecount[i])||void 0===r?void 0:r.add(1);else if(7e3<e){var o;this.messagecount.peerackslowcount=null===(o=this.messagecount.peerackslowcount)||void 0===o?void 0:o.add(1)}}}},{key:"updateNorecipientackCount",value:function(e){e/=2;for(var t=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],n=0;n<t.length;n++){var r,i=t[n];if(Rz(e,i[0],i[1]))i="norecipientack".concat(i[1],"mscount"),this.messagecount[i]=null===(r=this.messagecount[i])||void 0===r?void 0:r.add(1);else if(7e3<e){var o;this.messagecount.norecipientackslowcount=null===(o=this.messagecount.norecipientackslowcount)||void 0===o?void 0:o.add(1)}}}},{key:"updateCommonCount",value:function(e){var t=this.messagecount[e];D.isLong(t)?this.messagecount[e]=t.add(1):this.messagecount[e]=t+1}},{key:"report",value:function(){var e,t;$a("RtmSdkMessageCount",new Bx(tb(tb({},this.messagecount),{},{vid:D.fromString(null!==(e=this.context.vid)&&void 0!==e?e:"0"),os:7,lts:D.fromNumber(Date.now()),sid:this.context.sid,reportsequence:this.incGetSeq(),apimajorversion:7,apiminorversion:228,userid:this.context.uid,messagecategory:this.rtmMessageCategory})),null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),this.messagecount=tb(tb({},this.messagecount),{},{toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0})}}]),t}(Dd()),QO=function(e){function t(e){return ab(this,t),E(L(e=n.call(this,e,"ChatManager")),"dialogueLru",new kG(void 0,{maxlen:1e4,ttl:1e4})),e}nb(t,e);var n=ob(t);return Qb(t,[{key:"getChatInfo",value:function(e){var t=this.dialogueLru.get(e);if(this.dialogueLru.prune(),t){var n=t.dialogue,r={dialogue:n,sequence:t=t.sequence.add(1)};return this.dialogueLru.set(e,{dialogue:n,sequence:t}),r}return n={dialogue:Rj(),sequence:D.fromNumber(1,!0)},this.dialogueLru.set(e,n),n}}]),t}(Dd()),X={};"object"==Ia(module)&&(module.exports=X),X.parse=function(e,t){var n,r=X.bin.readUshort,i=X.bin.readUint,o={};for(n=(e=new Uint8Array(e)).length-4;101010256!=i(e,n);)n--;var a=r(e,n=n+4+4);r(e,n+=2),i(e,n+=2),n=i(e,n+=4);for(var s=0;s<a;s++){i(e,n),n+=4,n+=4,n+=4,i(e,n+=4);var c=i(e,n+=4),u=i(e,n+=4),l=r(e,n+=4),f=r(e,n+2),d=r(e,n+4);n+=6;var p=i(e,n+=8);n+=4,n+=l+f+d,X._readLocal(e,p,o,c,u,t)}return o},X._readLocal=function(e,t,n,r,i,o){var a=X.bin.readUshort,s=X.bin.readUint;s(e,t),a(e,t+=4),a(e,t+=2);var c=a(e,t+=2);s(e,t+=2),s(e,t+=4),s=a(e,t=t+4+8);var u=a(e,t+=2);if(t+=2,a=X.bin.readUTF8(e,t,s),t=t+s+u,o)n[a]={size:i,csize:r};else if(e=new Uint8Array(e.buffer,t),0==c)n[a]=new Uint8Array(e.buffer.slice(t,t+r));else{if(8!=c)throw"unknown compression method: "+c;t=new Uint8Array(i),X.inflateRaw(e,t),n[a]=t}},X.inflateRaw=function(e,t){return X.F.inflate(e,t)},X.inflate=function(e,t){return e[0],e[1],X.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),t)},X.deflate=function(e,t){null==t&&(t={level:6});var n=0,r=new Uint8Array(50+Math.floor(1.1*e.length));return r[n]=120,r[n+1]=156,n=X.F.deflateRaw(e,r,n+2,t.level),e=X.adler(e,0,e.length),r[n+0]=e>>>24&255,r[n+1]=e>>>16&255,r[n+2]=e>>>8&255,r[n+3]=e>>>0&255,new Uint8Array(r.buffer,0,n+4)},X.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),r=X.F.deflateRaw(e,n,r,t.level);return new Uint8Array(n.buffer,0,r)},X.encode=function(e,t){null==t&&(t=!1);var n,r=0,i=X.bin.writeUint,o=X.bin.writeUshort,a={};for(n in e){var s=!X._noNeed(n)&&!t,c=e[n],u=X.crc.crc(c,0,c.length);a[n]={cpr:s,usize:c.length,crc:u,file:s?X.deflateRaw(c):c}}for(n in a)r+=a[n].file.length+30+46+2*X.bin.sizeUTF8(n);for(n in e=new Uint8Array(r+22),t=0,c=[],a)u=a[n],c.push(t),t=X._writeHeader(e,t,n,u,0);for(n in r=0,s=t,a)u=a[n],c.push(t),t=X._writeHeader(e,t,n,u,1,c[r++]);return a=t-s,i(e,t,101010256),o(e,t=t+4+4,r),o(e,t+=2,r),i(e,t+=2,a),i(e,t+4,s),e.buffer},X._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(e)},X._writeHeader=function(e,t,n,r,i,o){var a=X.bin.writeUint,s=X.bin.writeUshort,c=r.file;return a(e,t,0==i?67324752:33639248),t+=4,1==i&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,r.cpr?8:0),a(e,t+=2,0),a(e,t+=4,r.crc),a(e,t+=4,c.length),a(e,t+=4,r.usize),s(e,t+=4,X.bin.sizeUTF8(n)),s(e,t+=2,0),t+=2,1==i&&(a(e,t=t+2+2+6,o),t+=4),t+=n=X.bin.writeUTF8(e,t,n),0==i&&(e.set(c,t),t+=c.length),t},X.crc={table:function(){for(var e=new Uint32Array(256),t=0;256>t;t++){for(var n=t,r=0;8>r;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=X.crc.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^X.crc.update(4294967295,e,t,n)}},X.adler=function(e,t,n){var r=1,i=0,o=t;for(t+=n;o<t;){for(n=Math.min(o+5552,t);o<n;)i+=r+=e[o++];r%=65521,i%=65521}return i<<16|r},X.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,t,n){for(var r,i="",o=0;o<n;o++)i+="%"+X.bin.pad(e[t+o].toString(16));try{r=decodeURIComponent(i)}catch(r){return X.bin.readASCII(e,t,n)}return r},writeUTF8:function(e,t,n){for(var r=n.length,i=0,o=0;o<r;o++){var a=n.charCodeAt(o);if(0==(4294967168&a))e[t+i]=a,i++;else if(0==(4294965248&a))e[t+i]=192|a>>6,e[t+i+1]=128|a>>0&63,i+=2;else if(0==(4294901760&a))e[t+i]=224|a>>12,e[t+i+1]=128|a>>6&63,e[t+i+2]=128|a>>0&63,i+=3;else{if(0!=(4292870144&a))throw"e";e[t+i]=240|a>>18,e[t+i+1]=128|a>>12&63,e[t+i+2]=128|a>>6&63,e[t+i+3]=128|a>>0&63,i+=4}}return i},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e.charCodeAt(r);if(0==(4294967168&i))n++;else if(0==(4294965248&i))n+=2;else if(0==(4294901760&i))n+=3;else{if(0!=(4292870144&i))throw"e";n+=4}}return n}},X.F={},X.F.deflateRaw=function(e,t,n,r){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],o=X.F.U,a=X.F._goodIndex;X.F._hash;var s=X.F._putsE,c=0;n<<=3;var u=0,l=e.length;if(0==r){for(;c<l;){var f=Math.min(65535,l-c);s(t,n,c+f==l?1:0),n=X.F._copyExact(e,c,f,t,n+8),c+=f}return n>>>3}s=o.lits,r=o.strt;var d=o.prev,p=0,h=0,v=0,m=0,g=0;for(2<l&&(r[g=X.F._hash(e,0)]=0),c=0;c<l;c++){if(f=g,c+1<l-2){g=X.F._hash(e,c+1);var E=c+1&32767;d[E]=r[g],r[g]=E}if(u<=c){if((14e3<p||26697<h)&&100<l-c&&(u<c&&(s[p]=c-u,p+=2,u=c),n=X.F._writeBlock(c==l-1||u==l?1:0,s,p,m,e,v,c-v,t,n),p=h=m=0,v=c),E=0,c<l-2&&(E=X.F._bestMatch(e,c,d,f,Math.min(i[2],l-c),i[3])),0!=E){f=E>>>16,E&=65535;var _=a(f,o.of0);o.lhst[257+_]++;var b=a(E,o.df0);o.dhst[b]++,m+=o.exb[_]+o.dxb[b],s[p]=f<<23|c-u,s[p+1]=E<<16|_<<8|b,p+=2,u=c+f}else o.lhst[e[c]]++;h++}}for(v==c&&0!=e.length||(u<c&&(s[p]=c-u,p+=2),n=X.F._writeBlock(1,s,p,m,e,v,c-v,t,n));0!=(7&n);)n++;return n>>>3},X.F._bestMatch=function(e,t,n,r,i,o){var a=32767&t,s=n[a],c=a-s+32768&32767;if(s==a||r!=X.F._hash(e,t-c))return 0;for(var u=r=0,l=Math.min(32767,t);c<=l&&0!=--o&&s!=a;){if((0==r||e[t+r]==e[t+r-c])&&(a=X.F._howLong(e,t,c))>r){if(u=c,(r=a)>=i)break;c+2<a&&(a=c+2);for(var f=0,d=0;d<a-2;d++){var p=t-c+d+32768&32767,h=p-n[p]+32768&32767;h>f&&(f=h,s=p)}}c+=(a=s)-(s=n[a])+32768&32767}return r<<16|u},X.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]==e[t-n];)t++;return t-r},X.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},X.saved=0,X.F._writeBlock=function(e,t,n,r,i,o,a,s,c){var u=X.F.U,l=X.F._putsF,f=X.F._putsE;u.lhst[256]++;var d=X.F.getTrees(),p=d[0],h=d[1],v=d[2],m=d[3],g=d[4],E=d[5],_=d[6];d=d[7];var b=32+(0==(c+3&7)?0:8-(c+3&7))+(a<<3),y=r+X.F.contSize(u.fltree,u.lhst)+X.F.contSize(u.fdtree,u.dhst);r=r+X.F.contSize(u.ltree,u.lhst)+X.F.contSize(u.dtree,u.dhst),r+=14+3*E+X.F.contSize(u.itree,u.ihst)+(2*u.ihst[16]+3*u.ihst[17]+7*u.ihst[18]);for(var T=0;286>T;T++)u.lhst[T]=0;for(T=0;30>T;T++)u.dhst[T]=0;for(T=0;19>T;T++)u.ihst[T]=0;if(b=b<y&&b<r?0:y<r?1:2,l(s,c,e),l(s,c+1,b),c+=3,0==b){for(;0!=(7&c);)c++;c=X.F._copyExact(i,o,a,s,c)}else{if(1==b)var S=u.fltree,w=u.fdtree;if(2==b){for(X.F.makeCodes(u.ltree,p),X.F.revCodes(u.ltree,p),X.F.makeCodes(u.dtree,h),X.F.revCodes(u.dtree,h),X.F.makeCodes(u.itree,v),X.F.revCodes(u.itree,v),S=u.ltree,w=u.dtree,f(s,c,m-257),f(s,c+=5,g-1),f(s,c+=5,E-4),c+=4,e=0;e<E;e++)f(s,c+3*e,u.itree[1+(u.ordr[e]<<1)]);c=X.F._codeTiny(_,u.itree,s,c+3*E),c=X.F._codeTiny(d,u.itree,s,c)}for(E=0;E<n;E+=2){for(_=(e=t[E])>>>23,e=o+(8388607&e);o<e;)c=X.F._writeLit(i[o++],S,s,c);0!=_&&(e=(p=t[E+1])>>16,a=p>>8&255,p&=255,f(s,c=X.F._writeLit(257+a,S,s,c),_-u.of0[a]),c+=u.exb[a],l(s,c=X.F._writeLit(p,w,s,c),e-u.df0[p]),c+=u.dxb[p],o+=_)}c=X.F._writeLit(256,S,s,c)}return c},X.F._copyExact=function(e,t,n,r,i){var o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(e.buffer,t,n),o),i+(n+4<<3)},X.F.getTrees=function(){for(var e=X.F.U,t=X.F._hufTree(e.lhst,e.ltree,15),n=X.F._hufTree(e.dhst,e.dtree,15),r=[],i=X.F._lenCodes(e.ltree,r),o=[],a=X.F._lenCodes(e.dtree,o),s=0;s<r.length;s+=2)e.ihst[r[s]]++;for(s=0;s<o.length;s+=2)e.ihst[o[s]]++;s=X.F._hufTree(e.ihst,e.itree,7);for(var c=19;4<c&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,n,s,i,a,c,r,o]},X.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},X.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},X.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},X.F._codeTiny=function(e,t,n,r){for(var i=0;i<e.length;i+=2){var o=e[i],a=e[i+1];r=X.F._writeLit(o,t,n,r);var s=16==o?2:17==o?3:7;15<o&&(X.F._putsE(n,r,a,s),r+=s)}return r},X.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=e[r+1],o=r+3<n?e[r+3]:-1,a=r+5<n?e[r+5]:-1,s=0==r?-1:e[r-1];if(0==i&&o==i&&a==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;11>(i=Math.min(o+1-r>>>1,138))?t.push(17,i-3):t.push(18,i-11),r+=2*i-2}else if(i==s&&o==i&&a==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;i=Math.min(o+1-r>>>1,6),t.push(16,i-3),r+=2*i-2}else t.push(i,0)}return n>>>1},X.F._hufTree=function(e,t,n){var r=[],i=e.length,o=t.length,a=0;for(a=0;a<o;a+=2)t[a]=0,t[a+1]=0;for(a=0;a<i;a++)0!=e[a]&&r.push({lit:a,f:e[a]});if(e=r.length,i=r.slice(0),0==e)return 0;if(1==e)return t[1+((n=r[0].lit)<<1)]=1,t[1+((0==n?1:0)<<1)]=1;r.sort((function(e,t){return e.f-t.f})),a=r[0],o=r[1];var s=0,c=1,u=2;for(r[0]={lit:-1,f:a.f+o.f,l:a,r:o,d:0};c!=e-1;)a=s!=c&&(u==e||r[s].f<r[u].f)?r[s++]:r[u++],o=s!=c&&(u==e||r[s].f<r[u].f)?r[s++]:r[u++],r[c++]={lit:-1,f:a.f+o.f,l:a,r:o};for((r=X.F.setDepth(r[c-1],0))>n&&(X.F.restrictDepth(i,n,r),r=n),a=0;a<e;a++)t[1+(i[a].lit<<1)]=i[a].d;return r},X.F.setDepth=function(e,t){return-1!=e.lit?e.d=t:Math.max(X.F.setDepth(e.l,t+1),X.F.setDepth(e.r,t+1))},X.F.restrictDepth=function(e,t,n){var r=0,i=1<<n-t,o=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),r=0;r<e.length&&e[r].d>t;r++){var a=e[r].d;e[r].d=t,o+=i-(1<<n-a)}for(o>>>=n-t;0<o;)(a=e[r].d)<t?(e[r].d++,o-=1<<t-a-1):r++;for(;0<=r;r--)e[r].d==t&&0>o&&(e[r].d--,o++);0!=o&&console.log("debt left")},X.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},X.F._writeLit=function(e,t,n,r){return X.F._putsF(n,r,t[e<<1]),r+t[1+(e<<1)]},X.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=X.F,i=r._bitsF,o=r._bitsE,a=r._decodeTiny,s=r.makeCodes,c=r.codes2map,u=r._get17,l=r.U,f=null==t;f&&(t=new n(e.length>>>2<<3));for(var d,p,h,v,m=0,g=0,E=p=0,_=0;0==m;)if(m=i(e,_,1),d=i(e,_+1,2),_+=3,0==d)0!=(7&_)&&(_+=8-(7&_)),d=e[(_=4+(_>>>3))-4]|e[_-3]<<8,f&&(t=X.F._check(t,E+d)),t.set(new n(e.buffer,e.byteOffset+_,d),E),_=_+d<<3,E+=d;else{if(f&&(t=X.F._check(t,E+131072)),1==d&&(h=l.flmap,v=l.fdmap,g=511,p=31),2==d){for(p=o(e,_,5)+257,d=o(e,_+5,5)+1,h=o(e,_+10,4)+4,_+=14,v=0;38>v;v+=2)l.itree[v]=0,l.itree[v+1]=0;for(g=1,v=0;v<h;v++){var b=o(e,_+3*v,3);l.itree[1+(l.ordr[v]<<1)]=b,b>g&&(g=b)}_+=3*h,s(l.itree,g),c(l.itree,g,l.imap),h=l.lmap,v=l.dmap,_=a(l.imap,(1<<g)-1,p+d,e,_,l.ttree),g=(1<<(b=r._copyOut(l.ttree,0,p,l.ltree)))-1,p=(1<<(d=r._copyOut(l.ttree,p,d,l.dtree)))-1,s(l.ltree,b),c(l.ltree,b,h),s(l.dtree,d),c(l.dtree,d,v)}for(;;)if(_+=15&(d=h[u(e,_)&g]),0==(b=d>>>4)>>>8)t[E++]=b;else{if(256==b)break;d=E+b-254,264<b&&(d=E+((b=l.ldef[b-257])>>>3)+o(e,_,7&b),_+=7&b),_+=15&(b=v[u(e,_)&p]);var y=((b=l.ddef[b>>>4])>>>4)+i(e,_,15&b);for(_+=15&b,f&&(t=X.F._check(t,E+131072));E<d;)t[E]=t[E++-y],t[E]=t[E++-y],t[E]=t[E++-y],t[E]=t[E++-y];E=d}}return t.length==E?t:t.slice(0,E)},X.F._check=function(e,t){var n=e.length;return t<=n?e:((t=new Uint8Array(Math.max(n<<1,t))).set(e,0),t)},X.F._decodeTiny=function(e,t,n,r,i,o){for(var a=X.F._bitsE,s=X.F._get17,c=0;c<n;){var u=e[s(r,i)&t];i+=15&u;var l=u>>>4;if(15>=l)o[c]=l,c++;else{var f=u=0;for(16==l?(f=3+a(r,i,2),i+=2,u=o[c-1]):17==l?(f=3+a(r,i,3),i+=3):18==l&&(f=11+a(r,i,7),i+=7),l=c+f;c<l;)o[c]=u,c++}}return i},X.F._copyOut=function(e,t,n,r){for(var i=0,o=0,a=r.length>>>1;o<n;){var s=e[o+t];r[o<<1]=0,r[1+(o<<1)]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return i},X.F.makeCodes=function(e,t){var n,r,i=X.F.U,o=e.length,a=i.bl_count;for(n=0;n<=t;n++)a[n]=0;for(n=1;n<o;n+=2)a[e[n]]++;for(i=i.next_code,n=0,a[0]=0,r=1;r<=t;r++)n=n+a[r-1]<<1,i[r]=n;for(t=0;t<o;t+=2)0!=(a=e[t+1])&&(e[t]=i[a],i[a]++)},X.F.codes2map=function(e,t,n){for(var r=e.length,i=X.F.U.rev15,o=0;o<r;o+=2)if(0!=e[o+1]){var a=e[o+1],s=o>>1<<4|a,c=t-a;for(c=(a=e[o]<<c)+(1<<c);a!=c;)n[i[a]>>>15-t]=s,a++}},X.F.revCodes=function(e,t){for(var n=X.F.U.rev15,r=15-t,i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r},X.F._putsE=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8},X.F._putsF=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8,e[t+2]|=n>>>16},X.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},X.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},X.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},X.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},X.F.U=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(e,t,n){for(;0!=t--;)e.push(0,n)}for(var t=X.F.U,n=0;32768>n;n++){var r=n;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,t.rev15[n]=(r>>>16|r<<16)>>>17}for(n=0;32>n;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];e(t.fltree,144,8),e(t.fltree,112,9),e(t.fltree,24,7),e(t.fltree,8,8),X.F.makeCodes(t.fltree,9),X.F.codes2map(t.fltree,9,t.flmap),X.F.revCodes(t.fltree,9),e(t.fdtree,32,5),X.F.makeCodes(t.fdtree,5),X.F.codes2map(t.fdtree,5,t.fdmap),X.F.revCodes(t.fdtree,5),e(t.itree,19,0),e(t.ltree,286,0),e(t.dtree,30,0),e(t.ttree,320,0)}();var RO=Array.isArray||function(e){return e&&"number"==typeof e.length},SO=Object.defineProperty({isArray:RO},"__esModule",{value:!0}),TO=Object.defineProperty({isObject:function(e){return null!==e&&"object"===Ia(e)}},"__esModule",{value:!0}),UO=Object.defineProperty({isFunction:function(e){return"function"==typeof e}},"__esModule",{value:!0}),VO=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),bk=Object.defineProperty({UnsubscriptionError:VO},"__esModule",{value:!0}),WO=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(UO.isFunction(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var a=e instanceof bk.UnsubscriptionError?Gs(e.errors):[e]}}if(SO.isArray(i))for(o=-1,t=i.length;++o<t;)if(n=i[o],TO.isObject(n))try{n.unsubscribe()}catch(e){a=a||[],e instanceof bk.UnsubscriptionError?a=a.concat(Gs(e.errors)):a.push(e)}if(a)throw new bk.UnsubscriptionError(a)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(Ia(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=((t=new e).closed=!0,t),e}(),XO=Object.defineProperty({Subscription:WO},"__esModule",{value:!0}),YO=qb&&qb.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ZO=function(e){function t(t,n){return e.call(this)||this}return YO(t,e),t.prototype.schedule=function(e,t){return this},t}(XO.Subscription),$O=Object.defineProperty({Action:ZO},"__esModule",{value:!0}),aP=qb&&qb.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Sz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return aP(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}($O.Action);Object.defineProperty({AsyncAction:Sz},"__esModule",{value:!0});var bP=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),Tz=Object.defineProperty({Scheduler:bP},"__esModule",{value:!0}),cP=qb&&qb.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Uz=function(e){function t(n,r){void 0===r&&(r=Tz.Scheduler.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return cP(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Tz.Scheduler);Object.defineProperty({AsyncScheduler:Uz},"__esModule",{value:!0});var dP=mb("iterator"),xq=!Ga((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[dP]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),eP=/[^\0-\u007E]/,fP=/[.\u3002\uFF0E\uFF61]/g,Zh=Math.floor,yq=String.fromCharCode,Vz=function(e){var t=Gi(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return ub(t.call(e))},Wz=me("fetch"),zq=me("Headers"),gP=mb("iterator"),Xz=Sb.set,od=Sb.getterFor("URLSearchParams"),hP=Sb.getterFor("URLSearchParamsIterator"),iP=/\+/g,Yz=Array(4),jP=function(e){try{return decodeURIComponent(e)}catch(t){return e}},Zz=function(e){var t=e.replace(iP," ");e=4;try{return decodeURIComponent(t)}catch(i){for(;e;){var n=t.replace,r=e--;r=Yz[r-1]||(Yz[r-1]=RegExp("((?:%[\\da-f]{2}){"+r+"})","gi")),t=n.call(t,r,jP)}return t}},$z=/[!'()~]|%20/g,kP={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},aA=function(e){return kP[e]},bA=function(e,t){if(t){t=t.split("&");for(var n,r=0;r<t.length;)(n=t[r++]).length&&(n=n.split("="),e.push({key:Zz(n.shift()),value:Zz(n.join("="))}))}},lP=function(e){this.entries.length=0,bA(this.entries,e)},$h=function(e,t){if(e<t)throw TypeError("Not enough arguments")},Aq=yt((function(e,t){Xz(this,{type:"URLSearchParamsIterator",iterator:Vz(od(e).entries),kind:t})}),"Iterator",(function(){var e=hP(this),t=e.kind,n=(e=e.iterator.next()).value;return e.done||(e.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),e})),xj=function e(){Ud(this,e,"URLSearchParams");var t,n,r,i=0<arguments.length?arguments[0]:void 0,o=[];if(Xz(this,{type:"URLSearchParams",entries:o,updateURL:function(){},updateSearchParams:lP}),void 0!==i)if(fb(i)){var a=Gi(i);if("function"==typeof a)for(i=a.call(i),a=i.next;!(t=a.call(i)).done;){var s=(t=Vz(ub(t.value))).next;if((n=s.call(t)).done||(r=s.call(t)).done||!s.call(t).done)throw TypeError("Expected sequence with length 2");o.push({key:n.value+"",value:r.value+""})}else for(t in i)Fa(i,t)&&o.push({key:t,value:i[t]+""})}else bA(o,"string"==typeof i?"?"===i.charAt(0)?i.slice(1):i:i+"")},Xl=xj.prototype;qh(Xl,{append:function(e,t){$h(arguments.length,2);var n=od(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){$h(arguments.length,1);for(var t=od(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){$h(arguments.length,1);for(var t=od(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){$h(arguments.length,1);for(var t=od(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){$h(arguments.length,1);for(var t=od(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){$h(arguments.length,1);for(var n,r=od(this),i=r.entries,o=!1,a=e+"",s=t+"",c=0;c<i.length;c++)(n=i[c]).key===a&&(o?i.splice(c--,1):(o=!0,n.value=s));o||i.push({key:a,value:s}),r.updateURL()},sort:function(){var e,t,n=od(this),r=n.entries,i=r.slice();for(t=r.length=0;t<i.length;t++){var o=i[t];for(e=0;e<t;e++)if(r[e].key>o.key){r.splice(e,0,o);break}e===t&&r.push(o)}n.updateURL()},forEach:function(e){for(var t,n=od(this).entries,r=tf(e,1<arguments.length?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new Aq(this,"keys")},values:function(){return new Aq(this,"values")},entries:function(){return new Aq(this,"entries")}},{enumerable:!0}),Ob(Xl,gP,Xl.entries),Ob(Xl,"toString",(function(){for(var e,t=od(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(encodeURIComponent(e.key).replace($z,aA)+"="+encodeURIComponent(e.value).replace($z,aA));return n.join("&")}),{enumerable:!0}),Td(xj,"URLSearchParams"),wa({global:!0,forced:!xq},{URLSearchParams:xj}),xq||"function"!=typeof Wz||"function"!=typeof zq||wa({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t=[e];if(1<arguments.length){var n=arguments[1];if(fb(n)){var r=n.body;if("URLSearchParams"===ph(r)){var i=n.headers?new zq(n.headers):new zq;i.has("content-type")||i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),n=vd(n,{body:ke(0,String(r)),headers:ke(0,i)})}}t.push(n)}return Wz.apply(this,t)}});var yj=na.URL,mP=xj,nP=Sb.set,Tb=Sb.getterFor("URL"),oP=Math.floor,cA=Math.pow,dA=/[A-Za-z]/,pP=/[\d+-.A-Za-z]/,Bq=/\d/,qP=/^(0x|0X)/,rP=/^[0-7]+$/,sP=/^\d+$/,eA=/^[\dA-Fa-f]+$/,tP=/[\0\t\n\r #%/:?@[\\]]/,uP=/[\0\t\n\r #/:?@[\\]]/,vP=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,wP=/[\t\n\r]/g,Cq=function(e,t){var n;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";var r=xP(t.slice(1,-1));if(!r)return"Invalid host"}else if(rc(e)){for(r=[],t=t.toLowerCase().replace(fP,".").split("."),n=0;n<t.length;n++){var i=t[n],o=r,a=o.push;if(eP.test(i)){var s=i;i=[];var c=s;s=[];for(var u=0,l=c.length;u<l;){var f=c.charCodeAt(u++);if(55296<=f&&56319>=f&&u<l){var d=c.charCodeAt(u++);56320==(64512&d)?s.push(((1023&f)<<10)+(1023&d)+65536):(s.push(f),u--)}else s.push(f)}u=s.length,l=128;var p=0,h=72;for(c=0;c<s.length;c++){var v=s[c];128>v&&i.push(yq(v))}for((d=f=i.length)&&i.push("-");d<u;){var m=2147483647;for(c=0;c<s.length;c++)(v=s[c])>=l&&v<m&&(m=v);var g=d+1;if(m-l>Zh((2147483647-p)/g))throw RangeError("Overflow: input needs wider integers to process");for(p+=(m-l)*g,l=m,c=0;c<s.length;c++){if((v=s[c])<l&&2147483647<++p)throw RangeError("Overflow: input needs wider integers to process");if(v==l){var E=p;for(v=36;!(E<(m=v<=h?1:v>=h+26?26:v-h));v+=36){var _=36-m,b=i;m+=(E-=m)%_,b.push.call(b,yq(m+22+75*(26>m))),E=Zh(E/_)}for(i.push(yq(E+22+75*(26>E))),h=g,v=0,p=d==f?Zh(p/700):p>>1,p+=Zh(p/h);455<p;v+=36)p=Zh(p/35);h=Zh(v+36*p/(p+38)),p=0,++d}}++p,++l}i="xn--"+i.join("")}a.call(o,i)}if(t=r.join("."),tP.test(t))return"Invalid host";if(null===(r=yP(t)))return"Invalid host"}else{if(uP.test(t))return"Invalid host";for(r="",t=hg(t),n=0;n<t.length;n++)r+=Qf(t[n],Yl)}e.host=r},yP=function(e){var t,n=e.split(".");n.length&&""==n[n.length-1]&&n.pop();var r=n.length;if(4<r)return e;var i=[];for(t=0;t<r;t++){var o=n[t];if(""==o)return e;var a=10;if(1<o.length&&"0"==o.charAt(0)&&(a=qP.test(o)?16:8,o=o.slice(8==a?1:2)),""===o)o=0;else{if(!(10==a?sP:8==a?rP:eA).test(o))return e;o=parseInt(o,a)}i.push(o)}for(t=0;t<r;t++)if(o=i[t],t==r-1){if(o>=cA(256,5-r))return null}else if(255<o)return null;for(e=i.pop(),t=0;t<i.length;t++)e+=i[t]*cA(256,3-t);return e},xP=function(e){var t,n,r=[0,0,0,0,0,0,0,0],i=0,o=null,a=0,s=function(){return e.charAt(a)};if(":"==s()){if(":"!=e.charAt(1))return;a+=2,o=++i}for(;s();){if(8==i)return;if(":"==s()){if(null!==o)return;a++,o=++i}else{for(t=n=0;4>n&&eA.test(s());)t=16*t+parseInt(s(),16),a++,n++;if("."==s()){if(0==n)return;if(a-=n,6<i)return;for(t=0;s();){if(n=null,0<t){if(!("."==s()&&4>t))return;a++}if(!Bq.test(s()))return;for(;Bq.test(s());){var c=parseInt(s(),10);if(null===n)n=c;else{if(0==n)return;n=10*n+c}if(255<n)return;a++}r[i]=256*r[i]+n,2!=++t&&4!=t||i++}if(4!=t)return;break}if(":"==s()){if(a++,!s())return}else if(s())return;r[i++]=t}}if(null!==o)for(s=i-o,i=7;0!=i&&0<s;)t=r[i],r[i--]=r[o+s-1],r[o+--s]=t;else if(8!=i)return;return r},zj=function(e){var t,n;if("number"==typeof e){var r=[];for(t=0;4>t;t++)r.unshift(e%256),e=oP(e/256);return r.join(".")}if("object"==typeof e){r="",t=null;for(var i=1,o=null,a=0,s=0;8>s;s++)0!==e[s]?(a>i&&(t=o,i=a),o=null,a=0):(null===o&&(o=s),++a);for(a>i&&(t=o),i=t,t=0;8>t;t++)n&&0===e[t]||(n&&(n=!1),i===t?(r+=t?":":"::",n=!0):(r+=e[t].toString(16),7>t&&(r+=":")));return"["+r+"]"}return e},Yl={},fA=Vi({},Yl,{" ":1,'"':1,"<":1,">":1,"`":1}),gA=Vi({},fA,{"#":1,"?":1,"{":1,"}":1}),Dq=Vi({},gA,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qf=function(e,t){var n=fD(e,0);return 32<n&&127>n&&!Fa(t,e)?e:encodeURIComponent(e)},Zl={ftp:21,file:null,http:80,https:443,ws:80,wss:443},rc=function(e){return Fa(Zl,e.scheme)},Eq=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},Aj=function(e,t){var n;return 2==e.length&&dA.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},hA=function(e){var t;return 1<e.length&&Aj(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},iA=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&Aj(t[0],!0)||t.pop()},Fq={},jA={},Gq={},kA={},lA={},Hq={},mA={},nA={},$l={},am={},Iq={},Jq={},Kq={},Lq={},oA={},Mq={},Bj={},ze={},pA={},Gg={},hf={},Ae=function(e,t,n,r){var i=n||Fq,o=0,a="",s=!1,c=!1,u=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(vP,"")),t=t.replace(wP,""),t=hg(t);o<=t.length;){var l=t[o];switch(i){case Fq:if(!l||!dA.test(l)){if(n)return"Invalid scheme";i=Gq;continue}a+=l.toLowerCase(),i=jA;break;case jA:if(l&&(pP.test(l)||"+"==l||"-"==l||"."==l))a+=l.toLowerCase();else{if(":"!=l){if(n)return"Invalid scheme";a="",i=Gq,o=0;continue}if(n&&(rc(e)!=Fa(Zl,a)||"file"==a&&(""!=e.username||""!=e.password||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=a,n)return void(rc(e)&&Zl[e.scheme]==e.port&&(e.port=null));a="","file"==e.scheme?i=Lq:rc(e)&&r&&r.scheme==e.scheme?i=kA:rc(e)?i=nA:"/"==t[o+1]?(i=lA,o++):(e.cannotBeABaseURL=!0,e.path.push(""),i=pA)}break;case Gq:if(!r||r.cannotBeABaseURL&&"#"!=l)return"Invalid scheme";if(r.cannotBeABaseURL&&"#"==l){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,i=hf;break}i="file"==r.scheme?Lq:Hq;continue;case kA:if("/"!=l||"/"!=t[o+1]){i=Hq;continue}i=$l,o++;break;case lA:if("/"==l){i=am;break}i=ze;continue;case Hq:if(e.scheme=r.scheme,null==l)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==l||"\\"==l&&rc(e))i=mA;else if("?"==l)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",i=Gg;else{if("#"!=l){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),i=ze;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",i=hf}break;case mA:if(!rc(e)||"/"!=l&&"\\"!=l){if("/"!=l){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,i=ze;continue}i=am}else i=$l;break;case nA:if(i=$l,"/"!=l||"/"!=a.charAt(o+1))continue;o++;break;case $l:if("/"!=l&&"\\"!=l){i=am;continue}break;case am:if("@"==l){for(s&&(a="%40"+a),s=!0,a=hg(a),l=0;l<a.length;l++){var f=a[l];":"!=f||u?(f=Qf(f,Dq),u?e.password+=f:e.username+=f):u=!0}a=""}else if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&rc(e)){if(s&&""==a)return"Invalid authority";o-=hg(a).length+1,a="",i=Iq}else a+=l;break;case Iq:case Jq:if(n&&"file"==e.scheme){i=Mq;continue}if(":"!=l||c){if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&rc(e)){if(rc(e)&&""==a)return"Invalid host";if(n&&""==a&&(""!=e.username||""!=e.password||null!==e.port))return;if(i=Cq(e,a))return i;if(a="",i=Bj,n)return;continue}"["==l?c=!0:"]"==l&&(c=!1),a+=l}else{if(""==a)return"Invalid host";if(i=Cq(e,a))return i;if(a="",i=Kq,n==Jq)return}break;case Kq:if(!Bq.test(l)){if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&rc(e)||n){if(""!=a){if(65535<(i=parseInt(a,10)))return"Invalid port";e.port=rc(e)&&i===Zl[e.scheme]?null:i,a=""}if(n)return;i=Bj;continue}return"Invalid port"}a+=l;break;case Lq:if(e.scheme="file","/"==l||"\\"==l)i=oA;else{if(!r||"file"!=r.scheme){i=ze;continue}if(null==l)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==l)e.host=r.host,e.path=r.path.slice(),e.query="",i=Gg;else{if("#"!=l){hA(t.slice(o).join(""))||(e.host=r.host,e.path=r.path.slice(),iA(e)),i=ze;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",i=hf}}break;case oA:if("/"==l||"\\"==l){i=Mq;break}r&&"file"==r.scheme&&!hA(t.slice(o).join(""))&&(Aj(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),i=ze;continue;case Mq:if(null==l||"/"==l||"\\"==l||"?"==l||"#"==l){if(!n&&Aj(a))i=ze;else{if(""==a){if(e.host="",n)return}else{if(i=Cq(e,a))return i;if("localhost"==e.host&&(e.host=""),n)return;a=""}i=Bj}continue}a+=l;break;case Bj:if(rc(e)){if(i=ze,"/"!=l&&"\\"!=l)continue}else if(n||"?"!=l)if(n||"#"!=l){if(null!=l&&(i=ze,"/"!=l))continue}else e.fragment="",i=hf;else e.query="",i=Gg;break;case ze:if(null==l||"/"==l||"\\"==l&&rc(e)||!n&&("?"==l||"#"==l)){if(".."===(f=(f=a).toLowerCase())||"%2e."===f||".%2e"===f||"%2e%2e"===f?(iA(e),"/"==l||"\\"==l&&rc(e)||e.path.push("")):"."===a||"%2e"===a.toLowerCase()?"/"==l||"\\"==l&&rc(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&Aj(a)&&(e.host&&(e.host=""),a=a.charAt(0)+":"),e.path.push(a)),a="","file"==e.scheme&&(null==l||"?"==l||"#"==l))for(;1<e.path.length&&""===e.path[0];)e.path.shift();"?"==l?(e.query="",i=Gg):"#"==l&&(e.fragment="",i=hf)}else a+=Qf(l,gA);break;case pA:"?"==l?(e.query="",i=Gg):"#"==l?(e.fragment="",i=hf):null!=l&&(e.path[0]+=Qf(l,Yl));break;case Gg:n||"#"!=l?null!=l&&("'"==l&&rc(e)?e.query+="%27":e.query="#"==l?e.query+"%23":e.query+Qf(l,Yl)):(e.fragment="",i=hf);break;case hf:null!=l&&(e.fragment+=Qf(l,fA))}o++}},Rf=function e(t){var n=Ud(this,e,"URL"),r=1<arguments.length?arguments[1]:void 0,i=String(t),o=nP(n,{type:"URL"});if(void 0!==r)if(r instanceof e)var a=Tb(r);else if(r=Ae(a={},String(r)))throw TypeError(r);if(r=Ae(o,i,null,a))throw TypeError(r);var s=o.searchParams=new mP;(i=od(s)).updateSearchParams(o.query),i.updateURL=function(){o.query=String(s)||null},cb||(n.href=bm.call(n),n.origin=qA.call(n),n.protocol=rA.call(n),n.username=sA.call(n),n.password=tA.call(n),n.host=uA.call(n),n.hostname=vA.call(n),n.port=wA.call(n),n.pathname=xA.call(n),n.search=yA.call(n),n.searchParams=zA.call(n),n.hash=AA.call(n))},Nq=Rf.prototype,bm=function(){var e=Tb(this),t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",""==e.username&&""==e.password||(u+=n+(r?":"+r:"")+"@"),u+=zj(i),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},qA=function(){var e=Tb(this),t=e.scheme,n=e.port;if("blob"==t)try{return new Rf(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&rc(e)?t+"://"+zj(e.host)+(null!==n?":"+n:""):"null"},rA=function(){return Tb(this).scheme+":"},sA=function(){return Tb(this).username},tA=function(){return Tb(this).password},uA=function(){var e=Tb(this),t=e.host;return e=e.port,null===t?"":null===e?zj(t):zj(t)+":"+e},vA=function(){var e=Tb(this).host;return null===e?"":zj(e)},wA=function(){var e=Tb(this).port;return null===e?"":String(e)},xA=function(){var e=Tb(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},yA=function(){var e=Tb(this).query;return e?"?"+e:""},zA=function(){return Tb(this).searchParams},AA=function(){var e=Tb(this).fragment;return e?"#"+e:""},Kd=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(cb&&vt(Nq,{href:Kd(bm,(function(e){var t=Tb(this);if(e=Ae(t,String(e)))throw TypeError(e);od(t.searchParams).updateSearchParams(t.query)})),origin:Kd(qA),protocol:Kd(rA,(function(e){var t=Tb(this);Ae(t,String(e)+":",Fq)})),username:Kd(sA,(function(e){var t=Tb(this);if(e=hg(String(e)),!Eq(t)){t.username="";for(var n=0;n<e.length;n++)t.username+=Qf(e[n],Dq)}})),password:Kd(tA,(function(e){var t=Tb(this);if(e=hg(String(e)),!Eq(t)){t.password="";for(var n=0;n<e.length;n++)t.password+=Qf(e[n],Dq)}})),host:Kd(uA,(function(e){var t=Tb(this);t.cannotBeABaseURL||Ae(t,String(e),Iq)})),hostname:Kd(vA,(function(e){var t=Tb(this);t.cannotBeABaseURL||Ae(t,String(e),Jq)})),port:Kd(wA,(function(e){var t=Tb(this);Eq(t)||(""==(e=String(e))?t.port=null:Ae(t,e,Kq))})),pathname:Kd(xA,(function(e){var t=Tb(this);t.cannotBeABaseURL||(t.path=[],Ae(t,e+"",Bj))})),search:Kd(yA,(function(e){var t=Tb(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Ae(t,e,Gg)),od(t.searchParams).updateSearchParams(t.query)})),searchParams:Kd(zA),hash:Kd(AA,(function(e){var t=Tb(this);""==(e=String(e))?t.fragment=null:("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Ae(t,e,hf))}))}),Ob(Nq,"toJSON",(function(){return bm.call(this)}),{enumerable:!0}),Ob(Nq,"toString",(function(){return bm.call(this)}),{enumerable:!0}),yj){var BA=yj.createObjectURL,CA=yj.revokeObjectURL;BA&&Ob(Rf,"createObjectURL",(function(e){return BA.apply(yj,arguments)})),CA&&Ob(Rf,"revokeObjectURL",(function(e){return CA.apply(yj,arguments)}))}Td(Rf,"URL"),wa({global:!0,forced:!xq,sham:!cb},{URL:Rf});var zP=new Blob(["var fakeIdToId = {};onmessage = function (event) {\tvar data = event.data,\t\tname = data.name,\t\tfakeId = data.fakeId,\t\ttime;\tif(data.hasOwnProperty('time')) {\t\ttime = data.time;\t}\tswitch (name) {\t\tcase 'setInterval':\t\t\tfakeIdToId[fakeId] = setInterval(function () {\t\t\t\tpostMessage({fakeId: fakeId});\t\t\t}, time);\t\t\tbreak;\t\tcase 'clearInterval':\t\t\tif (fakeIdToId.hasOwnProperty (fakeId)) {\t\t\t\tclearInterval(fakeIdToId[fakeId]);\t\t\t\tdelete fakeIdToId[fakeId];\t\t\t}\t\t\tbreak;\t}}"]),AP=window.URL.createObjectURL(zP),gh={},xi=0,Xm=new Worker(AP);Xm.onmessage=function(e){if(e=e.data.fakeId,gh.hasOwnProperty(e)){var t=gh[e];e=t.callback,t=t.parameters,e.apply(window,t)}};var BP=function(e){function t(){return ab(this,t),n.apply(this,arguments)}nb(t,e);var n=ob(t);return Qb(t,[{key:"requestAsyncId",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return BC(e.flush.bind(e,this),n)}},{key:"recycleAsyncId",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(null!==n&&this.delay===n&&!1===this.pending)return t;gh.hasOwnProperty(t)&&(delete gh[t],Xm.postMessage({name:"clearInterval",fakeId:t}))}}]),t}(Sz),CP=new Uz(BP),DP=["group"],Oq=X.inflate,DA=X.deflate,Pq=function(e){function t(e,n,i,o){ab(this,t);var a=r.call(this,o,"Session");return E(L(a),"lastNoticeTicket",""),E(L(a),"chatManager",void 0),E(L(a),"usedChannelIds",[]),E(L(a),"lastUserMeteUpdateRecord",{}),E(L(a),"lastChannelMetaUpdateRecord",{}),E(L(a),"msgDedupLru",new ue(void 0,{maxlen:200})),E(L(a),"startTime",Date.now()),E(L(a),"seq",D.fromNumber(1,!0)),E(L(a),"userJoinOptions",new Pz(!1)),E(L(a),"seqSentStatuses",[!1,!1]),E(L(a),"dialogueSequenceLru",new ue(void 0,{maxlen:1e4})),E(L(a),"loggedOut",!1),E(L(a),"messageSentTimes",[]),E(L(a),"curLoginSockets",[void 0,void 0]),E(L(a),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),E(L(a),"lastLoginSockets",[new ah(1),new ah(1)]),E(L(a),"dialPendingMsgSubjectMap",new Map),E(L(a),"context",void 0),E(L(a),"connection",void 0),E(L(a),"instanceId",void 0),E(L(a),"lastPingTime",void 0),E(L(a),"chanelStringMessageReport",void 0),E(L(a),"chanelRawMessageReport",void 0),E(L(a),"p2pSMsgNoOfflineReport",void 0),E(L(a),"p2pRMsgNoOfflineReport",void 0),E(L(a),"registerSocketsFailureListener",(function(){a.connection.once("socketsFailure",(function(){a.log("socketsFailure, creating a new connection"),lf((function(){return a.connection.removeAllListeners(),a.connection=new Gx(a.context,a.logger,!0),a.loginHandler(15e3,!0)})).pipe(Zg((function(e){return e.pipe(mf(wg.getParameter("RECONNECTING_AP_INTERVAL")))})),he(a.connection.apClient.apFinish$)).subscribe((function(){a.log("new connection connected")}))})),0===a.connection.listenerCount("tokenExpired")&&a.connection.on("tokenExpired",(function(){a.emit("tokenExpired")}))})),a.context=e,a.context.startTime=a.startTime,a.connection=n,a.instanceId=i,a.chatManager=new QO(o),a.lastPingTime=[0,0],a.setMaxListeners(512),a.log("The instanceId is %s",a.instanceId.toString()),a.chanelStringMessageReport=new Wl(e,o,vb.ChannelSMsg),a.chanelRawMessageReport=new Wl(e,o,vb.ChannelRMsg),a.p2pSMsgNoOfflineReport=new Wl(e,o,vb.P2pSMsgNoOfflineFlag),a.p2pRMsgNoOfflineReport=new Wl(e,o,vb.P2pRMsgNoOfflineFlag),a}nb(t,e);var n,r=ob(t);return Qb(t,[{key:"loginHandler",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:12e3,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new ia("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var r=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),i=Date.now();return r.forEach((function(t,r){var o=e.loginSocketSubs[r].login;void 0!==o&&o.unsubscribe(),e.loginSocketSubs[r].login=t.pipe(Ka((function(t){var o;e.curLoginSockets[r]=t;var a=Date.now();$a("Link",{ackedServerIp:t.address,destServerIp:t.ip,ec:0,sc:0,elapse:Nb(e.startTime),lts:D.fromNumber(a),responseTime:a-i,sid:fc(e.instanceId),userId:e.context.uid},null!==(o=e.context.config.enableCloudProxy)&&void 0!==o&&o),e.emit("userJoined",t.env),n&&e.connection.apClient.apFinish$.next(void 0)}))).subscribe(e.lastLoginSockets[r])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Nc.apply(void 0,ra(r).concat([Bc(this.connection,"connectionInitFailure").pipe(Ka((function(e){if(Sa(e)||uc(e))throw e;throw new Pa("Login failure",{code:Ew,originalError:e})})))])).pipe(Xb(1),Oc(t),Rb((function(t){return t instanceof ad&&e.warn("Client login timeout"),t&&t.code===bl&&(e.connection.emit("tokenExpired"),e.connection.apClient.apFinish$.next(void 0)),e.clearSockets(0,n),Va(t)})),Ka((function(){n||e.registerSocketsFailureListener()})),Mj((function(){n||e.connection.apClient.apFinish$.next(void 0)})))}},{key:"logoutHandler",value:(n=za(W.mark((function e(){var t,n,r,i,o=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),t=this.incGetSeq(),n=this.getLoginSockets(),r=n.map((function(e){var n,r;return e.sendPacket("StateUnsubscribe",{sequence:t,target:o.context.uid,subTarget:"",flags:D.fromNumber(0)}),delete o.lastUserMeteUpdateRecord[o.context.sid],$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:o.context.uid,vid:null!==(n=o.context)&&void 0!==n&&n.vid?D.fromString(o.context.vid):D.fromNumber(0),sid:"",usersid:o.context.sid,target:o.context.uid,requestts:D.fromNumber(Date.now()),replyts:D.fromNumber(Date.now()),eventtype:"UnSubscribe",sdktype:3,flags:D.fromNumber(0),code:0,seq:t,index:{index1:o.context.uid,index2:o.context.appId,index3:"enableLogUpload=".concat(o.context.config.enableLogUpload)},subtarget:o.context.uid},null!==(r=o.context.config.enableCloudProxy)&&void 0!==r&&r),e.sendPacket("UserQuit",{}),o.connection.waitClosing(e)})),this.clearSockets(5e3),i=n.map((function(e){return e.env})),[0,1].filter((function(e){return!i.includes(e)})).forEach((function(e){o.connection.closeSocket(e,0)})),e.abrupt("return",Nc.apply(void 0,ra(r)).toPromise());case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"requestChannelJoin",value:function(){var e=za(W.mark((function e(t){var n,r,i,o=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.getLoginSockets().length){e.next=2;break}throw new ia("Client is not logged in. Cannot join the channel",Aw);case 2:return n=Bc(this,"channelLeft").pipe(sc((function(e){return t===e})),Xb(1)),r=this.incGetSeq(),(i=this.lastLoginSockets.map((function(e){return e.pipe(Cc((function(e,n){0!==n&&o.incSeqIfNeeded(e.env);var i=0===n?r:o.seq;return e.sendPacket("GroupEnter",{account:t,seq:i}),e.fromReceived("GroupReply").pipe(La((function(e){return i.eq(e.seq)})),Ka((function(e){if(0!==(e=e.code))throw new Pa(["Channel join failure. The response code is %d",e],ww)})))})),he(n),$g())}))).forEach((function(e,n){var r=function(){return o.loginSocketSubs[n].channels.delete(t)};o.loginSocketSubs[n].channels.set(t,e.subscribe({error:r,complete:r}))})),e.next=8,Nc.apply(void 0,ra(i)).pipe(Xb(1),Oc(1e4),Rb((function(e){return e instanceof ad&&o.warn("Channel join timeout"),Va(e)}))).toPromise();case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(e){this.getLoginSockets().forEach((function(t){t.sendPacket("GroupLeave",{account:e})}))}},{key:"requestUpdateEdgeTicket",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in. Cannot renew token",Mw);var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserRenewTokenReq",{instance:n.instanceId,seq:i,account:n.context.uid,ticket:e})})),bb.apply(void 0,[t.genTimeoutError(jp)].concat(ra(r.map((function(e){return e.fromReceived("UserRenewTokenResp").pipe(La((function(e){var t=e.code;return i.eq(e.seq)&&0===t})))})))))}},{key:"requestChannelMemberList",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in. Cannot get the channel members",wI);var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAllUsersList",{group:e,pageNumber:0,pageSize:200,seq:r})})),bb.apply(void 0,[t.genTimeoutError(uw)].concat(ra(n.map((function(t){return t.fromReceived("GroupAllUsersResult").pipe(La((function(t){var n=t.seq;return t.group===e&&r.eq(n)})))})))))}},{key:"requestPeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserStatusList",{users:e,seq:r})})),bb.apply(void 0,[t.genTimeoutError(II)].concat(ra(n.map((function(e){return e.fromReceived("UserStatusResult").pipe(La((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSetLocalUserAttributes",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t,i){void 0!==n&&i!==n||t.sendPacket("UserAttributeSet",{account:r.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=Lb(e,2))[0],value:e[1]}})),seq:o})})),bb.apply(void 0,ra(i.map((function(e){return e.fromReceived("UserAttributeErr").pipe(La((function(e){return o.eq(e.seq)})),Wa((function(e){throw new Pa(["The user attributes set failure, code %d",e.code],Ad)})))}))).concat([t.genTimeoutError(Bd)],ra(i.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(La((function(e){return o.eq(e.seq)})))})))))}},{key:"requestSetChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeSet",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=Lb(e,2))[0],value:e[1]}})),seq:o})})),bb.apply(void 0,ra(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(La((function(e){return o.eq(e.seq)})),Wa((function(e){throw new Pa(["The group attributes set failure, code %d",e.code],Ad)})))}))).concat([t.genTimeoutError(Bd)],ra(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(La((function(e){return o.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=Lb(e,2))[0],value:e[1]}})),seq:i})})),bb.apply(void 0,ra(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(La((function(e){return i.eq(e.seq)})),Wa((function(e){throw new Pa(["The user attributes add or update failure, code %d",e.code],Ad)})))}))).concat([t.genTimeoutError(Bd)],ra(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(La((function(e){return i.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeMod",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=Lb(e,2))[0],value:e[1]}})),seq:o})})),bb.apply(void 0,ra(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(La((function(e){return o.eq(e.seq)})),Wa((function(e){throw new Pa(["The group attributes add or update failure, code %d",e.code],Ad)})))}))).concat([t.genTimeoutError(Bd)],ra(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(La((function(e){return o.eq(e.seq)})))})))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:e,seq:i})})),bb.apply(void 0,ra(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(La((function(e){return i.eq(e.seq)})),Wa((function(e){throw new Pa(["The user attributes delete failure, code %d",e.code],Ad)})))}))).concat([t.genTimeoutError(Bd)],ra(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(La((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetChannelMetaData",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in. Cannot get the channel metadata",oc);if(void 0!==this.context.lastGetMetaDataTime&&250>Date.now()-this.context.lastGetMetaDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastGetMetaDataTime=Date.now();var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("StateGet",{target:e,subTarget:"",lock:"",sequence:r,flags:new D(1,0,!0),lockRev:D.fromNumber(0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(n.map((function(e){return e.fromReceived("StateGetResult").pipe(La((function(e){return r.eq(e.sequence)})),Wa((function(e){var t=e.code;if(e=e.allStates,ud(t)!==bd)throw new Pa(["Get metaData failure. The response code from the RTM service is %d",t],He);return e})))})))))}},{key:"requestGetLocalMetaData",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in. Cannot get the local metaData",oc);if(void 0!==this.context.lastGetMetaDataTime&&250>Date.now()-this.context.lastGetMetaDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastGetMetaDataTime=Date.now();var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("StateGet",{target:e,subTarget:"",lock:"",sequence:r,flags:D.fromNumber(0),lockRev:D.fromNumber(0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(n.map((function(e){return e.fromReceived("StateGetResult").pipe(La((function(e){return r.eq(e.sequence)})),Wa((function(e){var t=e.code;if(e=e.allStates,ud(t)!==bd)throw new Pa(["Get metaData failure. The response code from the RTM service is %d",t],He);return e})))})))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeDel",{group:e,broadcast:r,attributes:n,seq:o})})),bb.apply(void 0,ra(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(La((function(e){return o.eq(e.seq)})),Wa((function(e){throw new Pa(["The channel attributes delete failure, code %d",e.code],Ad)})))}))).concat([t.genTimeoutError(Bd)],ra(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(La((function(e){return o.eq(e.seq)})))})))))}},{key:"requestClearLocalUserAttributes",value:function(){var e=this,n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeSet",{account:e.context.uid,seq:r,attributeInfos:[]})})),bb.apply(void 0,ra(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(La((function(e){return r.eq(e.seq)})),Wa((function(e){throw new Pa(["The user attributes clear failure, code %d",e.code],Ad)})))}))).concat([t.genTimeoutError(Bd)],ra(n.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(La((function(e){return r.eq(e.seq)})))})))))}},{key:"requestClearChannelAttributes",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeSet",{group:e,seq:i,attributeInfos:[],broadcast:n})})),bb.apply(void 0,ra(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(La((function(e){return i.eq(e.seq)})),Wa((function(e){throw new Pa(["The channel attributes clear failure, code %d",e.code],Ad)})))}))).concat([t.genTimeoutError(Bd)],ra(r.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(La((function(e){return i.eq(e.seq)})))})))))}},{key:"requestAddChannelMetadata",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},i=2<arguments.length?arguments[2]:void 0,o=this.getLoginSockets();if(0===o.length)throw new ia("Client is not logged in");if(r.majorRevision&&(-1>r.majorRevision||0!=r.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(nf({items:e,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Add"}),void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var a=this.incGetSeq(),s=JSON.stringify(pf(Pd.cloneDeep(e).map((function(e){return e.setRevision(0),e})),r.majorRevision)),c=Date.now();return o.forEach((function(e){e.sendPacket("StateModify",{sequence:a,target:i,requestUuid:"".concat(a,"_").concat(n.instanceId),lock:"",lockRev:D.fromNumber(0),value:s,baseRevision:D.fromNumber(0),author:r.enableRecordUserId?n.context.uid:"",flags:r.enableRecordTs?new D(524289,0,!0):new D(1,0,!0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(o.map((function(e){return e.fromReceived("StateRequestResult").pipe(La((function(e){return a.eq(e.sequence)})),Wa((function(e){var t,o,s=ud(e=e.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:n.context.uid,vid:D.fromString(null!==(t=n.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:n.context.sid,requestts:D.fromNumber(c),replyts:D.fromNumber(Date.now()),target:i,eventtype:"Add",revision:D.fromNumber(0),uuid:"".concat(a,"_").concat(n.instanceId),sdktype:3,flags:r.enableRecordTs?new D(524289,0,!0):new D(1,0,!0),code:s,seq:a,index:{index1:i,index2:n.context.appId,index3:"enableLogUpload=".concat(n.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:n.context.uid},null!==(o=n.context.config.enableCloudProxy)&&void 0!==o&&o),s!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",e],s)})))})))))}},{key:"requestUpdateChannelMetadata",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},i=2<arguments.length?arguments[2]:void 0,o=this.getLoginSockets();if(0===o.length)throw new ia("Client is not logged in");if(r.majorRevision&&(-1>r.majorRevision||0!=r.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(0===r.majorRevision)throw new ja("MajorRevision can not be set to 0",of);if(nf({items:e,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Update"}),void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var a=this.incGetSeq(),s=JSON.stringify(pf(Pd.cloneDeep(e).map((function(e){return-1===e.getRevision()&&e.setRevision(-2),e})),r.majorRevision)),c=Date.now();return o.forEach((function(e){e.sendPacket("StateModify",{sequence:a,target:i,requestUuid:"".concat(a,"_").concat(n.instanceId),lock:"",lockRev:D.fromNumber(0),value:s,baseRevision:D.fromNumber(0),author:r.enableRecordUserId?n.context.uid:"",flags:r.enableRecordTs?new D(524289,0,!0):new D(1,0,!0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(o.map((function(e){return e.fromReceived("StateRequestResult").pipe(La((function(e){return a.eq(e.sequence)})),Wa((function(e){var t,o,s=ud(e=e.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:n.context.uid,vid:D.fromString(null!==(t=n.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:n.context.sid,requestts:D.fromNumber(c),replyts:D.fromNumber(Date.now()),target:i,eventtype:"Update",revision:D.fromNumber(0),uuid:"".concat(a,"_").concat(n.instanceId),sdktype:3,flags:r.enableRecordTs?new D(524289,0,!0):new D(1,0,!0),code:s,seq:a,index:{index1:n.context.uid,index2:n.context.appId,index3:"enableLogUpload=".concat(n.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:n.context.uid},null!==(o=n.context.config.enableCloudProxy)&&void 0!==o&&o),s!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",e],s)})))})))))}},{key:"requestDeleteChannelMetadata",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},i=2<arguments.length?arguments[2]:void 0,o=this.getLoginSockets();if(0===o.length)throw new ia("Client is not logged in");if(r.majorRevision&&(-1>r.majorRevision||0!=r.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(0===r.majorRevision)throw new ja("MajorRevision can not be set to 0",of);if(nf({items:e,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Delete"}),void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var a=this.incGetSeq(),s=JSON.stringify(pf(Pd.cloneDeep(e).map((function(e){return e.setValue(null),e})),r.majorRevision)),c=Date.now();return o.forEach((function(e){e.sendPacket("StateModify",{sequence:a,target:i,requestUuid:"".concat(a,"_").concat(n.instanceId),lock:"",lockRev:D.fromNumber(0),value:s,baseRevision:D.fromNumber(0),author:r.enableRecordUserId?n.context.uid:"",flags:r.enableRecordTs?new D(524289,0,!0):new D(1,0,!0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(o.map((function(e){return e.fromReceived("StateRequestResult").pipe(La((function(e){return a.eq(e.sequence)})),Wa((function(e){var t,o,s=ud(e=e.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:n.context.uid,vid:D.fromString(null!==(t=n.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:n.context.sid,requestts:D.fromNumber(c),replyts:D.fromNumber(Date.now()),target:i,eventtype:"Delete",revision:D.fromNumber(0),uuid:"".concat(a,"_").concat(n.instanceId),sdktype:3,flags:r.enableRecordTs?new D(524289,0,!0):new D(1,0,!0),code:s,seq:a,index:{index1:n.context.uid,index2:n.context.appId,index3:"enableLogUpload=".concat(n.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:n.context.uid},null!==(o=n.context.config.enableCloudProxy)&&void 0!==o&&o),s!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",e],He)})))})))))}},{key:"requestSetChannelMetadata",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},i=2<arguments.length?arguments[2]:void 0,o=this.getLoginSockets();if(0===o.length)throw new ia("Client is not logged in");if(r.majorRevision&&(-1>r.majorRevision||0!=r.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(nf({items:e,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Set"}),void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var a=this.incGetSeq(),s=Date.now();return o.forEach((function(t){t.sendPacket("StateSet",{sequence:a,target:i,requestUuid:"".concat(a,"_").concat(n.instanceId),value:JSON.stringify(pf(e,r.majorRevision)),lock:"",lockRev:D.fromNumber(0),baseRevision:D.fromNumber(0),author:r.enableRecordUserId?n.context.uid:"",flags:r.enableRecordTs?new D(524289,0,!0):new D(1,0,!0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(o.map((function(e){return e.fromReceived("StateRequestResult").pipe(La((function(e){return a.eq(e.sequence)})),Wa((function(e){var t,o,c=ud(e=e.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:n.context.uid,vid:D.fromString(null!==(t=n.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:n.context.sid,requestts:D.fromNumber(s),replyts:D.fromNumber(Date.now()),target:i,eventtype:"Set",revision:D.fromNumber(0),uuid:"".concat(a,"_").concat(n.instanceId),sdktype:3,flags:r.enableRecordTs?new D(524289,0,!0):new D(1,0,!0),code:c,seq:a,index:{index1:n.context.uid,index2:n.context.appId,index3:"enableLogUpload=".concat(n.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:n.context.uid},null!==(o=n.context.config.enableCloudProxy)&&void 0!==o&&o),c!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",e],c)})))})))))}},{key:"requestClearChannelMetadata",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},r=1<arguments.length?arguments[1]:void 0,i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");if(n.majorRevision&&-1>n.majorRevision&&0==n.majorRevision%1)throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(0===n.majorRevision)throw new ja("MajorRevision can not be set to 0",of);if(void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var o=this.incGetSeq(),a=Date.now();return i.forEach((function(t){t.sendPacket("StateSet",{sequence:o,target:r,requestUuid:"".concat(o,"_").concat(e.instanceId),lock:"",lockRev:D.fromNumber(0),value:JSON.stringify({}),baseRevision:D.fromNumber(0),author:n.enableRecordUserId?e.context.uid:"",flags:n.enableRecordTs?new D(589825,0,!0):new D(65537,0,!0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(i.map((function(t){return t.fromReceived("StateRequestResult").pipe(La((function(e){return o.eq(e.sequence)})),Wa((function(t){var i,s,c=ud(t=t.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:e.context.uid,vid:D.fromString(null!==(i=e.context.vid)&&void 0!==i?i:"0"),sid:"",usersid:e.context.sid,requestts:D.fromNumber(a),replyts:D.fromNumber(Date.now()),target:r,eventtype:"Clear",revision:D.fromNumber(0),uuid:"".concat(o,"_").concat(e.instanceId),sdktype:3,flags:n.enableRecordTs?new D(589825,0,!0):new D(65537,0,!0),code:c,seq:o,index:{index1:e.context.uid,index2:e.context.appId,index3:"enableLogUpload=".concat(e.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:e.context.uid},null!==(s=e.context.config.enableCloudProxy)&&void 0!==s&&s),c!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",t],c)})))})))))}},{key:"requestAddLocalMetadata",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");if(r.majorRevision&&(-1>r.majorRevision||0!=r.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(nf({items:e,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Add"}),void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var o=this.incGetSeq(),a=JSON.stringify(pf(Pd.cloneDeep(e).map((function(e){return e.setRevision(0),e})),r.majorRevision)),s=Date.now();return i.forEach((function(e){e.sendPacket("StateModify",{sequence:o,target:n.context.uid,requestUuid:"".concat(o,"_").concat(n.instanceId),lock:"",lockRev:D.fromNumber(0),value:a,baseRevision:D.fromNumber(0),author:r.enableRecordUserId?n.context.uid:"",flags:r.enableRecordTs?new D(524288,0,!0):D.fromNumber(0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(i.map((function(e){return e.fromReceived("StateRequestResult").pipe(La((function(e){return o.eq(e.sequence)})),Ka((function(e){var t,i,a=ud(e=e.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:n.context.uid,vid:D.fromString(null!==(t=n.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:n.context.sid,requestts:D.fromNumber(s),replyts:D.fromNumber(Date.now()),target:n.context.uid,eventtype:"Add",revision:D.fromNumber(0),uuid:"".concat(o,"_").concat(n.instanceId),sdktype:3,flags:r.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:a,seq:o,index:{index1:n.context.uid,index2:n.context.appId,index3:"enableLogUpload=".concat(n.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:n.context.uid},null!==(i=n.context.config.enableCloudProxy)&&void 0!==i&&i),a!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",e],a)})))})))))}},{key:"requestUpdateLocalMetadata",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");if(r.majorRevision&&(-1>r.majorRevision||0!=r.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(0===r.majorRevision)throw new ja("MajorRevision can not be set to 0",of);if(nf({items:e,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Update"}),void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var o=this.incGetSeq(),a=JSON.stringify(pf(Pd.cloneDeep(e).map((function(e){return-1===e.getRevision()&&e.setRevision(-2),e})),r.majorRevision)),s=Date.now();return i.forEach((function(e){e.sendPacket("StateModify",{sequence:o,target:n.context.uid,requestUuid:"".concat(o,"_").concat(n.instanceId),lock:"",lockRev:D.fromNumber(0),value:a,baseRevision:D.fromNumber(0),author:r.enableRecordUserId?n.context.uid:"",flags:r.enableRecordTs?new D(524288,0,!0):D.fromNumber(0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(i.map((function(e){return e.fromReceived("StateRequestResult").pipe(La((function(e){return o.eq(e.sequence)})),Ka((function(e){var t,i,a=ud(e=e.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:n.context.uid,vid:D.fromString(null!==(t=n.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:n.context.sid,requestts:D.fromNumber(s),replyts:D.fromNumber(Date.now()),target:n.context.uid,eventtype:"Update",revision:D.fromNumber(0),uuid:"".concat(o,"_").concat(n.instanceId),sdktype:3,flags:r.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:a,seq:o,index:{index1:n.context.uid,index2:n.context.appId,index3:"enableLogUpload=".concat(n.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:n.context.uid},null!==(i=n.context.config.enableCloudProxy)&&void 0!==i&&i),a!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",e],a)})))})))))}},{key:"requestDeleteLocalMetadata",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");if(r.majorRevision&&(-1>r.majorRevision||0!=r.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(0===r.majorRevision)throw new ja("MajorRevision can not be set to 0",of);if(nf({items:e,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Delete"}),void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var o=this.incGetSeq(),a=JSON.stringify(pf(Pd.cloneDeep(e).map((function(e){return e.setValue(null),e})),r.majorRevision)),s=Date.now();return i.forEach((function(e){e.sendPacket("StateModify",{sequence:o,target:n.context.uid,requestUuid:"".concat(o,"_").concat(n.instanceId),lock:"",lockRev:D.fromNumber(0),value:a,baseRevision:D.fromNumber(0),author:r.enableRecordUserId?n.context.uid:"",flags:r.enableRecordTs?new D(524288,0,!0):D.fromNumber(0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(i.map((function(e){return e.fromReceived("StateRequestResult").pipe(La((function(e){return o.eq(e.sequence)})),Ka((function(e){var t,i,a=ud(e=e.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:n.context.uid,vid:D.fromString(null!==(t=n.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:n.context.sid,requestts:D.fromNumber(s),replyts:D.fromNumber(Date.now()),target:n.context.uid,eventtype:"Delete",revision:D.fromNumber(0),uuid:"".concat(o,"_").concat(n.instanceId),sdktype:3,flags:r.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:a,seq:o,index:{index1:n.context.uid,index2:n.context.appId,index3:"enableLogUpload=".concat(n.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:n.context.uid},null!==(i=n.context.config.enableCloudProxy)&&void 0!==i&&i),a!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",e],a)})))})))))}},{key:"requestSetLocalMetadata",value:function(e){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");if(r.majorRevision&&(-1>r.majorRevision||0!=r.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(nf({items:e,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Set"}),void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var o=this.incGetSeq(),a=Date.now();return i.forEach((function(t){t.sendPacket("StateSet",{sequence:o,target:n.context.uid,requestUuid:"".concat(o,"_").concat(n.instanceId),value:JSON.stringify(pf(e,r.majorRevision)),lock:"",lockRev:D.fromNumber(0),baseRevision:D.fromNumber(0),author:r.enableRecordUserId?n.context.uid:"",flags:r.enableRecordTs?new D(524288,0,!0):new D(0,0,!0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(i.map((function(e){return e.fromReceived("StateRequestResult").pipe(La((function(e){return o.eq(e.sequence)})),Ka((function(e){var t,i,s=ud(e=e.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:n.context.uid,vid:D.fromString(null!==(t=n.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:n.context.sid,requestts:D.fromNumber(a),replyts:D.fromNumber(Date.now()),target:n.context.uid,eventtype:"Set",revision:D.fromNumber(0),uuid:"".concat(o,"_").concat(n.instanceId),sdktype:3,flags:r.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:s,seq:o,index:{index1:n.context.uid,index2:n.context.appId,index3:"enableLogUpload=".concat(n.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:n.context.uid},null!==(i=n.context.config.enableCloudProxy)&&void 0!==i&&i),s!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",e],s)})))})))))}},{key:"requestClearLocalMetadata",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in");if(n.majorRevision&&(-1>n.majorRevision||0!=n.majorRevision%1))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(0===n.majorRevision)throw new ja("MajorRevision can not be set to 0",of);if(void 0!==this.context.lastModifyMeteDataTime&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var i=this.incGetSeq(),o=Date.now();return r.forEach((function(t){t.sendPacket("StateSet",{sequence:i,target:e.context.uid,requestUuid:"".concat(i,"_").concat(e.instanceId),lock:"",lockRev:D.fromNumber(0),value:JSON.stringify({}),baseRevision:D.fromNumber(0),author:n.enableRecordUserId?e.context.uid:"",flags:n.enableRecordTs?new D(589824,0,!0):new D(65536,0,!0)})})),bb.apply(void 0,[t.genTimeoutError(cd)].concat(ra(r.map((function(t){return t.fromReceived("StateRequestResult").pipe(La((function(e){return i.eq(e.sequence)})),Ka((function(t){var r,a,s=ud(t=t.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:e.context.uid,vid:D.fromString(null!==(r=e.context.vid)&&void 0!==r?r:"0"),sid:"",usersid:e.context.sid,requestts:D.fromNumber(o),replyts:D.fromNumber(Date.now()),target:e.context.uid,eventtype:"Clear",revision:D.fromNumber(0),uuid:"".concat(i,"_").concat(e.instanceId),sdktype:3,flags:n.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:s,seq:i,index:{index1:e.context.uid,index2:e.context.appId,index3:"enableLogUpload=".concat(e.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:e.context.uid},null!==(a=e.context.config.enableCloudProxy)&&void 0!==a&&a),s!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",t],s)})))})))))}},{key:"requestSubscribeUserMetadata",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");if(void 0!==this.context.lastSubscribeMetaDataTime&&500>Date.now()-this.context.lastSubscribeMetaDataTime)throw new Fc(["The frequency of subscription metedata exceeded the limit of %d queries per %d second",10,5e3],Vc);this.context.lastSubscribeMetaDataTime=Date.now();var o=this.incGetSeq(),a=Date.now();return i.forEach((function(t){t.sendPacket("StateSubscribe",{sequence:o,target:e,subTarget:"",flags:D.fromNumber(0)})})),bb.apply(void 0,[t.genTimeoutErrorWithoutNotice(cl,void 0,n)].concat(ra(i.map((function(t){return t.fromReceived("StateSubscribeResult").pipe(La((function(e){return o.eq(e.sequence)})),Ka((function(t){var i,s;t=t.code;var c=Pw;if(0!==t&&1!==t&&(c=100===t?cl:lp),c!==Pw)throw new Pa(["User metaData Subscribe failure. The response code from the RTM service is %d",t],c);"RECONNECTED"!==n&&void 0===r.lastUserMeteUpdateRecord[e]&&(r.lastUserMeteUpdateRecord[e]=-1),$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:r.context.uid,vid:D.fromString(null!==(i=r.context.vid)&&void 0!==i?i:"0"),sid:"",usersid:r.context.sid,target:e,requestts:D.fromNumber(a),replyts:D.fromNumber(Date.now()),eventtype:"Subscribe",sdktype:3,flags:D.fromNumber(0),code:0,seq:o,index:{index1:r.context.uid,index2:r.context.appId,index3:"enableLogUpload=".concat(r.context.config.enableLogUpload)},subtarget:r.context.uid},null!==(s=r.context.config.enableCloudProxy)&&void 0!==s&&s)})))})))))}},{key:"requestUnsubscribeUserMetadata",value:function(e){var t,n,r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in");var i=this.incGetSeq(),o=Date.now();r.forEach((function(t){t.sendPacket("StateUnsubscribe",{sequence:i,target:e,subTarget:"",flags:D.fromNumber(0)})})),delete this.lastUserMeteUpdateRecord[e],$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:this.context.uid,vid:D.fromString(null!==(t=this.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:this.context.sid,target:e,requestts:D.fromNumber(o),replyts:D.fromNumber(Date.now()),eventtype:"UnSubscribe",sdktype:3,flags:D.fromNumber(0),code:0,seq:i,index:{index1:this.context.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},subtarget:this.context.uid},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n)}},{key:"requestUnsubscribeChannelMetadata",value:function(e){var t,n,r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in");var i=this.incGetSeq();r.forEach((function(t){t.sendPacket("StateUnsubscribe",{sequence:i,target:e,subTarget:"",flags:new D(1,0,!0)})})),delete this.lastChannelMetaUpdateRecord[e],$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:this.context.uid,vid:D.fromString(null!==(t=this.context.vid)&&void 0!==t?t:"0"),sid:"",usersid:this.context.sid,target:e,requestts:D.fromNumber(Date.now()),replyts:D.fromNumber(Date.now()),eventtype:"UnSubscribe",sdktype:3,flags:new D(1,0,!0),code:0,seq:i,index:{index1:this.context.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},subtarget:this.context.uid},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n)}},{key:"requestSubscribeChannelMetadata",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new ia("Client is not logged in");if(void 0!==this.context.lastSubscribeMetaDataTime&&500>Date.now()-this.context.lastSubscribeMetaDataTime)throw new Fc(["The frequency of subscription metedata exceeded the limit of %d queries per %d second",10,5e3],Vc);var o=this.incGetSeq(),a=Date.now();return i.forEach((function(t){t.sendPacket("StateSubscribe",{sequence:o,target:e,subTarget:"",flags:new D(1,0,!0)})})),bb.apply(void 0,[t.genTimeoutError(cl)].concat(ra(i.map((function(t){return t.fromReceived("StateSubscribeResult").pipe(La((function(e){return o.eq(e.sequence)})),Ka((function(t){var i,s;if(0!==(t=t.code)&&1!==t){if(100===t)throw new Pa(["MetaData Subscribe failure. The response code from the RTM service is %d",t],cl);throw new Pa(["MetaData Subscribe failure. The response code from the RTM service is %d",t],lp)}"JOIN"===n&&(r.lastChannelMetaUpdateRecord[e]=-1),$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:r.context.uid,vid:D.fromString(null!==(i=r.context.vid)&&void 0!==i?i:"0"),sid:"",usersid:r.context.sid,target:e,requestts:D.fromNumber(a),replyts:D.fromNumber(Date.now()),eventtype:"Subscribe",sdktype:3,flags:D.fromNumber(0),code:t,seq:o,index:{index1:r.context.uid,index2:r.context.appId,index3:"enableLogUpload=".concat(r.context.config.enableLogUpload)},subtarget:r.context.uid},null!==(s=r.context.config.enableCloudProxy)&&void 0!==s&&s)})))})))))}},{key:"requestGetUserAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeGet",{account:e,seq:i,attributes:n})})),bb.apply(void 0,[t.genTimeoutError(Bd)].concat(ra(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(La((function(e){return i.eq(e.seq)})),Wa((function(e){if(10008===(e=e.code))throw new Pa("The user requested is not online",qw);throw new id(["User attribute operation unknown error code: %d",e],Ad)})))}))),ra(r.map((function(e){return e.fromReceived("UserAttributeRet").pipe(La((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new ia("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeGet",{group:e,seq:i,attributes:n})})),bb.apply(void 0,[t.genTimeoutError(Bd)].concat(ra(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(La((function(e){return i.eq(e.seq)})),Wa((function(e){throw new Pa(["The channel attributes get failure, code %d",e.code],Ad)})))}))),ra(r.map((function(e){return e.fromReceived("GroupAttributeRet").pipe(La((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributeKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeKeysGet",{account:e,seq:r})})),bb.apply(void 0,[t.genTimeoutError(Bd)].concat(ra(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(La((function(e){return r.eq(e.seq)})),Wa((function(e){if(10008===(e=e.code))throw new Pa("The user requested is not online",qw);throw new id(["User attribute operation unknown error code: %d",e],Ad)})))}))),ra(n.map((function(e){return e.fromReceived("UserAttributeKeysRet").pipe(La((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAttributeKeysGet",{group:e,seq:r})})),bb.apply(void 0,[t.genTimeoutError(Bd)].concat(ra(n.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(La((function(e){return r.eq(e.seq)})),Wa((function(e){throw new id(["Channel attribute operation unknown error code: %d",e.code],Ad)})))}))),ra(n.map((function(e){return e.fromReceived("GroupAttributeKeysRet").pipe(La((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelMemberCount",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupStatusList",{groups:e,seq:r})})),bb.apply(void 0,[t.genTimeoutError(uw)].concat(ra(n.map((function(e){return e.fromReceived("GroupStatusResult").pipe(La((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSubscribePeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new ia("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("SubscribeUserStatus",{seq:r,users:e})})),bb.apply(void 0,[t.genTimeoutError(NI)].concat(ra(n.map((function(e){return e.fromReceived("SubscribeResponse").pipe(La((function(e){return r.eq(e.seq)})))})))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(e){var t=this.getLoginSockets();if(0===t.length)throw new ia("Client is not logged in");var n=this.incGetSeq();t.forEach((function(t){t.sendPacket("UnsubscribeUserStatus",{seq:n,users:e})}))}},{key:"sendInvitationMessage",value:function(){var e=za(W.mark((function e(t){var n,r,i,o,a,s,c,u,l,f,d,p,h=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerId,r=t.callId,i=t.extra,o=t.isAcceptAck,a=t.channelId,s=t.type,c={callId:r},void 0===o){e.next=6;break}if("CallAccept"===s){e.next=5;break}throw Error("invalid invitation type");case 5:c.type=o?"ack":"request";case 6:return c.channel=a,("CallInvite"===s||"CallCancel"===s||"CallReject"===s||"CallAccept"===s&&!1===o)&&void 0!==i&&(c.extra=i),u=Rj(),this.log("The sent invitation body is %o",c),l=function(e){return{MiscMap:{},sequence:D.fromNumber(1),dialogue:u,instance:h.instanceId,dst:n,ms:D.fromNumber(Date.now(),!0),options:new Yh({IterationNumber:e,MessageType:s}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(c)),src:h.context.uid}},e.next=14,ge(this.sendMessageToRetry(l,!0)).pipe(Oc(1e4),Rb((function(e){return e instanceof ad&&h.warn("Send invitation timeout"),Va(e)}))).toPromise();case 14:return f=e.sent,d=f.code,p=f.retryTimes,e.abrupt("return",{hasPeerReceived:0===d,hasReSent:0!==p});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var e=za(W.mark((function e(t,n,r,i,o){var a,s,c,u,l,f,d,p,h,v,m,g=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Date.now(),s=i?vb.P2pRMsgNoOfflineFlag:vb.ChannelRMsg,yb(r)&&t instanceof Uint8Array&&"string"==typeof n){e.next=4;break}throw new ja("The send message arguments are not valid",i?Kw:Zk);case 4:if(!(32768<t.byteLength+new Blob([n]).size)){e.next=8;break}throw this.emit("messageCount",{messageCategory:s,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:s,type:"common",key:"invalidmessagecount"}),new Dc("The message size is over the 32KB limit",i?si:fp);case 8:return c=!wg.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=t.byteLength,u=this.chatManager.getChatInfo(r),l=u.dialogue,f=u.sequence,d=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(d,"-").concat(l,"#").concat(f,'"'),c?" compressed":"",i?"peer":"channel",wb(r)),p=function(e){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:f,dialogue:l,instance:d,dst:r,ms:D.fromNumber(Date.now(),!0),options:new Yh({IterationNumber:e,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:i?"PeerRawMessage":"ChannelRawMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:c?DA(t):t,src:g.context.uid}},e.next=15,ge(this.sendMessageToRetry(p,!0)).pipe(Oc(void 0===o?1e4:o),Rb((function(e){return e instanceof ad&&g.warn("Send message timeout"),Va(e)}))).toPromise();case 15:return h=e.sent,v=h.code,m=0===v,this.emit("messageCount",{messageCategory:s,type:"common",key:"sentcount"}),m&&(this.emit("messageCount",{messageCategory:s,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:s,type:i?"peer":"recipient",delay:Nb(a).toNumber()})),e.abrupt("return",{hasPeerReceived:m});case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var e=za(W.mark((function e(t,n,r,i){var o,a,s,c,u,l,f,d,p,h,v,m,g=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Date.now(),a=r?vb.P2pSMsgNoOfflineFlag:vb.ChannelSMsg,yb(n)){e.next=4;break}throw new ja("The send message arguments are not valid",r?Kw:Zk);case 4:if(!(32768<new Blob([t]).size)){e.next=8;break}throw this.emit("messageCount",{messageCategory:a,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:a,type:"common",key:"invalidmessagecount"}),new Dc("The message size is over the 32KB limit",r?si:fp);case 8:return s=!wg.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([t]).size,c=this.chatManager.getChatInfo(n),u=c.dialogue,l=c.sequence,f=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(f,"-").concat(u,"#").concat(l,'"'),s?" compressed":"",r?"peer":"channel",wb(n)),d=(new TextEncoder).encode(t),p=function(e){return{MiscMap:{},sequence:l,dialogue:u,instance:f,dst:n,ms:D.fromNumber(Date.now(),!0),options:new Yh({IterationNumber:e,CompressionMethod:s?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:s?DA(d):d,src:g.context.uid}},e.next=16,ge(this.sendMessageToRetry(p,!0)).pipe(Oc(void 0===i?1e4:i),Rb((function(e){return e instanceof ad&&(g.emit("messageCount",{messageCategory:a,type:"common",key:"sentcount"}),g.emit("messageCount",{messageCategory:a,type:"common",key:"timeoutcount"}),g.warn("Send message timeout")),Va(e)}))).toPromise();case 16:return h=e.sent,v=h.code,m=0===v,this.emit("messageCount",{messageCategory:a,type:"common",key:"sentcount"}),m&&(this.emit("messageCount",{messageCategory:a,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:a,type:r?"peer":"recipient",delay:Nb(o).toNumber()})),e.abrupt("return",{hasPeerReceived:m});case 22:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(e,t){Object.entries(this.loginSocketSubs[e]).forEach((function(e){var n=(e=Lb(e,2))[1];"channels"===e[0]&&t||(Array.isArray(n)||n instanceof Map?n.forEach((function(e){return e.unsubscribe()})):n&&n.unsubscribe())})),this.loginSocketSubs[e]={channels:t?this.loginSocketSubs[e].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var e=za(W.mark((function e(t,n){var r,i,o,a,s,c,u,l,f,d=this,p=arguments;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<p.length&&void 0!==p[2]?p[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:r}),0!==(i=this.getLoginSockets()).length){e.next=5;break}throw Error("no logged-in sockets");case 5:return o=t(r),i.forEach((function(e){e.sendPacket("Message",o)})),a=o.dialogue,s=o.sequence,c=o.instance,u=i.map((function(e){return e.fromReceived("Ack").pipe(sc((function(e){return a.eq(e.dialogue)&&s.eq(e.sequence)&&c.eq(e.instance)})))})),e.prev=9,e.next=12,Nc.apply(void 0,ra(u)).pipe(Oc(6e3),Rb((function(e){return uc(e)&&d.warn("Message send timeout, retry times %d",r),Va(e)})),Xb(1)).toPromise();case 12:return l=e.sent,f=l.code,this.log("The message has been acked, %o",{code:f}),e.abrupt("return",{code:f,retryTimes:r});case 18:if(e.prev=18,e.t0=e.catch(9),!(e.t0 instanceof ad&&n)){e.next=22;break}return e.abrupt("return",this.sendMessageToRetry(t,!1,r+1));case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return Fe(0,2500,Kg()?void 0:CP).pipe(Ka((function(){e.sendPing(t)})))})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAlive;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAlive=t.subscribe({error:function(){}})}))}},{key:"initKeepAliveReconnector",value:function(){var e=this;this.lastLoginSockets.map((function(e){return e.pipe(Cc((function(e){var t,n=!1,r=e.userJoin$.pipe(Ka((function(){n=!0}))),i=e.input$.pipe(Ka((function(e){"Ping"!==Tm[e.uri].slice(0,-3)&&(n=!1)})));return Nc(Fe(6e3,1e4).pipe(iC(e.receivedPacket),Ka((function(r){r=Lb(r,2),r=Lb(r[1],2)[1],t!==r||n||e.forceReconnect(),t=r}))),r,i)})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAliveReconnector;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAliveReconnector=t.subscribe({error:function(){}})}))}},{key:"initLoginReceiver",value:function(){var e=this;bb.apply(void 0,ra(this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return t.fromReceived("UserTicketNearlyExpire").pipe(cC(5e3),Ka(e.onUserTicketNearlyExpire(t)))})))})))).subscribe(),bb.apply(void 0,ra(this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return t.fromReceived("StateUpdate").pipe(Ka(e.onStateUpdate()))})))})))).subscribe();var t=Bc(this,"messageCount"),n=t.pipe(sc((function(e){return e.messageCategory===vb.ChannelSMsg})));n.subscribe((function(t){return e.updateMessageCount(t)})),n.pipe(Kj(6e3)).subscribe((function(t){t.length&&e.chanelStringMessageReport.report()})),Nc(Wb(void 0),n).pipe(Cc((function(){return Yg(36e5)}))).subscribe((function(){e.chanelStringMessageReport.report()})),(n=t.pipe(sc((function(e){return e.messageCategory===vb.ChannelRMsg})))).subscribe((function(t){return e.updateMessageCount(t)})),n.pipe(Kj(6e3)).subscribe((function(t){t.length&&e.chanelRawMessageReport.report()})),Nc(Wb(void 0),n).pipe(Cc((function(){return Yg(36e5)}))).subscribe((function(){e.chanelRawMessageReport.report()})),(n=t.pipe(sc((function(e){return e.messageCategory===vb.P2pSMsgNoOfflineFlag})))).subscribe((function(t){return e.updateMessageCount(t)})),n.pipe(Kj(6e3)).subscribe((function(t){t.length&&e.p2pSMsgNoOfflineReport.report()})),Nc(Wb(void 0),n).pipe(Cc((function(){return Yg(36e5)}))).subscribe((function(){e.p2pSMsgNoOfflineReport.report()})),(t=t.pipe(sc((function(e){return e.messageCategory===vb.P2pRMsgNoOfflineFlag})))).subscribe((function(t){return e.updateMessageCount(t)})),t.pipe(Kj(6e3)).subscribe((function(t){t.length&&e.p2pRMsgNoOfflineReport.report()})),Nc(Wb(void 0),t).pipe(Cc((function(){return Yg(36e5)}))).subscribe((function(){e.p2pSMsgNoOfflineReport.report()})),this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return Nc(Bc(t,"reconnect").pipe(Ka(e.onSocketReconnect(t))),t.fromReceived("Message").pipe(Ka(e.onMessage(t))),t.fromReceived("GroupEnterNotice").pipe(Ka(e.onGroupEnterNotice())),t.fromReceived("GroupLeaveNotice").pipe(Ka(e.onGroupLeaveNotice())),t.fromReceived("GroupCountNotice").pipe(Ka(e.onGroupCountNotice())),t.fromReceived("GroupAttributeAlt").pipe(Ka(e.onGroupAttributeAlt())),t.fromReceived("UserJoinNotice").pipe(Ka(e.onUserNotice(Oa.PeerOnlineState.ONLINE))),t.fromReceived("UserQuitNotice").pipe(Ka(e.onUserNotice(Oa.PeerOnlineState.OFFLINE))),t.fromReceived("UserWaitNotice").pipe(Ka(e.onUserNotice(Oa.PeerOnlineState.UNREACHABLE))),t.fromReceived("Pong").pipe(Ka(e.onPong())),t.fromReceived("UserDrop").pipe(Ka(e.onUserDrop(t))),t.fromReceived("GroupDrop").pipe(Ka(e.onGroupDrop()))).pipe(ni(void 0))})))})).forEach((function(t,n){e.loginSocketSubs[n].receivers.push(t.subscribe({error:function(){}}))}))}},{key:"requestSocketLogin",value:function(e,t,n){var r=this;return Pr(lf((function(){r.userJoinOptions=new Pz(t),e.sendPacket("UserJoin",{account:r.context.uid,instance:r.instanceId,opt:r.userJoinOptions.toLong(),seq:n,ticket:e.ticket})})),e.fromReceived("UserResp").pipe(La((function(e){return n.eq(e.seq)})),Ka((function(t){if(0!==(t=t.code))throw r.clearSockets(),r.logError("Connected to gateway success but the Rtm server rejected login"),new Pa(["Login failure. The response code from the RTM service is %d",t],ij);e.attemptsSinceLastError=0,e.loggedIn=!0,r.log("ENV_%d logged in",e.env)})),ni(e),Oc(6e3))).pipe(sc((function(e){return void 0!==e})),Rb((function(n){n instanceof ad&&r.warn("Login response timeout, rejoin: %s",t);var i=r.getLoginSockets();if(0<i.length){var o=i.map((function(e){return e.env}));[0,1].filter((function(e){return!o.includes(e)})).forEach((function(e){r.cleanLoginSubs(e,!1),r.connection.closeSocket(e,0)}))}return n.name="loginRespTimeout",r.emit("banEdgeIP",e.ip),Va(n)})))}},{key:"getSocketLoginObservables",value:function(e,t){var n=this;return e.map((function(e){return e.pipe(Cc((function(e,r){return n.incSeqIfNeeded(e.env),n.requestSocketLogin(e,0!==r,0===r?t:n.seq)})),$g())}))}},{key:"incSeqIfNeeded",value:function(e){if(![0,1].includes(e))throw new rb({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[e]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[e]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var e=this.curLoginSockets,t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i}},{key:"emitMessage",value:function(e,n){var r,i=e.options,o=e.payload,a=e.src,s=e.dst,c=e.instance,u=e.dialogue,l=e.sequence,f=e.ms,d=e.MiscMap;this.dialogueSequenceLru.set(u.toString(),l),c="".concat(c,"-").concat(u,"#").concat(l),this.msgDedupLru.has(c)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,c):(this.msgDedupLru.set(c,void 0),i=new Yh(i),this.lastLoginSockets.forEach((r=za(W.mark((function n(r){var i;return W.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.pipe(Xb(1)).toPromise();case 2:i=n.sent,t.sendMessageAck(e,i);case 4:case"end":return n.stop()}}),n)}))),function(e){return r.apply(this,arguments)})),n=i.isZlibCompressed(),i.isInvitation()?(s=ti(n?Oq(zs(o,Uint8Array.of(0,0,0,0))):o),s=JSON.parse(s),this.log("The received invitation body is %o",s),this.emit("invitationMessage",{body:s,type:i.getInvitationType(),peerId:a,serverReceivedTs:f.toNumber()})):i.isTextMessage()?(d=i.isPeerTextMessage(),o=ti(n?Oq(zs(o,Uint8Array.of(0,0,0,0))):o),this.info("Received a %s %s text message from %s to %s, %s",n?" compressed":"",d?"peer":"channel",wb(a),wb(s),c),d?(a={text:o,peerId:a,properties:{serverReceivedTs:f.toNumber()}},this.emit("peerTextMessage",a),this.emit("messageCount",{messageCategory:vb.P2pSMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelTextMessage",{channelId:s,memberId:a,text:o,properties:{serverReceivedTs:f.toNumber()}}),this.emit("messageCount",{messageCategory:vb.ChannelSMsg,type:"common",key:"receivedcount"}))):i.isRawMessage()&&(i=i.isRawPeerMessage(),d=void 0===(d=d.description)?"":ti(d),o=n?Oq(o):o,this.info("Received a %s %s raw message from %s to %s, %s",n?" compressed":"",i?"peer":"channel",wb(a),wb(s),c),i?(a={desc:d,raw:o,peerId:a,properties:{serverReceivedTs:f.toNumber()}},this.emit("peerRawMessage",a),this.emit("messageCount",{messageCategory:vb.P2pRMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelRawMessage",{desc:d,raw:o,channelId:s,memberId:a,properties:{serverReceivedTs:f.toNumber()}}),this.emit("messageCount",{messageCategory:vb.ChannelRMsg,type:"common",key:"receivedcount"}))))}},{key:"onSocketReconnect",value:function(e){var t=this;return function(){var n=[0,1].filter((function(t){return t!==e.env}))[0];(n=t.connection.curOpenSockets[n])&&!n.loggedIn&&t.emit("connectionLost")}}},{key:"onUserTicketNearlyExpire",value:function(e){var t=this;return function(n){(n=n.ticket)!==t.lastNoticeTicket&&n===e.ticket?(t.lastNoticeTicket=n,t.emit("tokenPrivilegeWillExpire")):t.requestUpdateEdgeTicket(e.ticket).toPromise()}}},{key:"onGroupDrop",value:function(){var e=this;return function(t){var n,r=t.account;$a("ChnLeave",{cname:r,lts:D.fromNumber(Date.now()),elapse:Nb(e.startTime),errCode:EI,sid:fc(e.instanceId),userId:e.context.uid},null!==(n=e.context.config.enableCloudProxy)&&void 0!==n&&n),[0,1].forEach((function(t){return e.loginSocketSubs[t].channels.delete(r)})),e.logError("the user is kicked out of the current channel")}}},{key:"onStateUpdate",value:function(){var e=this;return function(t){var n=t.flags,r=t.target;t=Wm(t.allStates),n.and(new D(1,0,!0)).isZero()?void 0!==e.lastUserMeteUpdateRecord[r]&&t.majorRevision>e.lastUserMeteUpdateRecord[r]&&(e.emit("userMetaDataUpdated",{uid:r,data:n.and(new D(0,2,!0)).isZero()?t:tb(tb({},t),{},{majorRevision:0})}),e.lastUserMeteUpdateRecord[r]=t.majorRevision):void 0!==e.lastChannelMetaUpdateRecord[r]&&t.majorRevision>e.lastChannelMetaUpdateRecord[r]&&(e.emit("channelMetaDataUpdated",{channelId:r,data:n.and(new D(0,2,!0)).isZero()?t:tb(tb({},t),{},{majorRevision:0})}),e.lastChannelMetaUpdateRecord[r]=t.majorRevision)}}},{key:"onUserDrop",value:function(e){var t=this;return function(n){var r;n=n.code,$a("KickedOff",{code:0,elapse:Nb(t.startTime),linkId:parseInt(e.name.split("-")[1],10),lts:D.fromNumber(Date.now()),server:e.address,serverCode:n,sid:fc(t.instanceId),userId:t.context.uid},null!==(r=t.context.config.enableCloudProxy)&&void 0!==r&&r),10006===n||10001===n?t.warn("Login too often and kicked off, reconnect and login"):10009===n?(t.warn("The instance ID conflicts, reconnecting"),t.instanceId=Rj(),t.context.sid=fc(t.instanceId),t.emit("instanceChanged",t.instanceId)):[2,11,14,15,16,10019].includes(n)&&(t.emit("userDrop",n),t.clearSockets())}}},{key:"clearSockets",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach((function(r){e.cleanLoginSubs(r,n),e.connection.closeSocket(r,t)}))}},{key:"onMessage",value:function(e){var t=this;return function(n){var r=n.dialogue,i=n.instance,o=n.sequence,a=n.options;if(n.src===t.context.uid)t.log("The message is from the local account, ignored");else{var s=r.toString(),c=t.dialPendingMsgSubjectMap.get(s);if(r="".concat(i,"-").concat(r,"#").concat(o),c)c.next(n),t.log("Env_%d: The dialogue has pending messages, next: %s",e.env,r);else{var u=t.dialogueSequenceLru.get(s);if(c=!u&&o.eq(1),i=void 0!==u&&o.sub(u).eq(1),c||i)t.emitMessage(n,e.env);else{if(u){if(o.lte(u))return;t.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",e.env,r)}else t.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",e.env,r);o=new ec,t.dialPendingMsgSubjectMap.set(s,o);var l=o.pipe(kB(Xo),Nj((function(e,t){return[].concat(ra(e),[t])}),[]),Wa((function(e){return ra(e).sort((function(e,t){return e=e.sequence,t=t.sequence,e.eq(t)?0:e.gt(t)?1:-1}))})),Yr(1));a=!(a=new Yh(a)).isFromCache()&&!a.isBufferedMessage(),l.pipe(he(Fe(a?750:1500)),La((function(e){if(2>e.length)return!1;for(var t=void 0===u?D.fromNumber(1,!0):u.add(1),n=0;n<e.length;t=t.add(1),n++)if(!e[n].sequence.eq(t))return!1;return!0})),Mj((function(){t.dialPendingMsgSubjectMap.delete(s)}))).subscribe((function(n){n.forEach((function(n){t.emitMessage(n,e.env),t.log("Env_%d: The message queue has fully ordered, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))}))}),(function(n){n instanceof Lj&&l.pipe(Xb(1)).subscribe((function(n){return n.forEach((function(n){t.log("Env_%d: The message pending queue expired, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),t.emitMessage(n,e.env)}))}))})),o.next(n)}}}}}},{key:"onPong",value:function(){var e=this;return function(){document.hidden&&e.getLoginSockets().forEach((function(t){e.sendPing(t)}))}}},{key:"onGroupEnterNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberJoined",size:t.size})}}},{key:"onGroupLeaveNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberLeft",size:t.size})}}},{key:"onGroupCountNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,type:"MemberCountUpdated",size:t.size})}}},{key:"onGroupAttributeAlt",value:function(){var e=this;return function(t){var n=t.group;t=em(t,DP),e.emit("channelAttributesUpdated",tb({channelId:n},t))}}},{key:"onUserNotice",value:function(e){var t=this;return function(n){t.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:e})}}},{key:"sendPing",value:function(e){2500>=Date.now()-this.lastPingTime[e.env]||(this.incSeqIfNeeded(e.env),e.sendPacket("Ping",{ms:D.fromNumber(Date.now(),!0),seq:this.seq}),this.lastPingTime[e.env]=Date.now())}},{key:"updateMessageCount",value:function(e){var t,n=(t={},E(t,vb.ChannelRMsg,this.chanelRawMessageReport),E(t,vb.ChannelSMsg,this.chanelStringMessageReport),E(t,vb.P2pRMsgNoOfflineFlag,this.p2pRMsgNoOfflineReport),E(t,vb.P2pSMsgNoOfflineFlag,this.p2pSMsgNoOfflineReport),E(t,3,void 0),E(t,4,void 0),E(t,7,void 0),E(t,8,void 0),E(t,9,void 0),E(t,10,void 0),t)[e.messageCategory];"common"===e.type?null==n||n.updateCommonCount(e.key):"peer"===e.type?null==n||n.updatePeerAckCount(e.delay):null==n||n.updateNorecipientackCount(e.delay)}}],[{key:"sendMessageAck",value:function(e,t){var n=new Yh(e.options);(n.isInvitation()||n.isPeerMessage())&&t.sendPacket("Ack",{code:0,dialogue:e.dialogue,instance:e.instance,sequence:e.sequence})}}]),t}(Dd());E(Pq,"genTimeoutErrorWithoutNotice",(function(e,t,n){return Wb(void 0).pipe(mf(void 0===t?1e4:t),Wa((function(){if("JOIN"!==n)throw new Pc(["Request timed out after %ds",(void 0===t?1e4:t)/1e3],e)})))})),E(Pq,"genTimeoutError",(function(e,t){return Wb(void 0).pipe(mf(void 0===t?1e4:t),Wa((function(){throw new Pc(["Request timed out after %ds",(void 0===t?1e4:t)/1e3],e)})))}));var EA,Qq,Rq=0,Sq=0;gj.v1=function(e,t,n){n=t&&n||0;var r=t||[],i=(e=e||{}).node||EA,o=void 0!==e.clockseq?e.clockseq:Qq;if(null==i||null==o){var a=ow();null==i&&(i=EA=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==o&&(o=Qq=16383&(a[6]<<8|a[7]))}a=void 0!==e.msecs?e.msecs:(new Date).getTime();var s=void 0!==e.nsecs?e.nsecs:Sq+1,c=a-Rq+(s-Sq)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||a>Rq)&&void 0===e.nsecs&&(s=0),1e4<=s)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(Rq=a,Sq=s,Qq=o,e=(1e4*(268435455&(a+=122192928e5))+s)%4294967296,r[n++]=e>>>24&255,r[n++]=e>>>16&255,r[n++]=e>>>8&255,r[n++]=255&e,e=a/4294967296*1e4&268435455,r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=o>>>8|128,r[n++]=255&o,o=0;6>o;++o)r[n+o]=i[o];return t||pw(r)},gj.v4=gj;var Tq=il(),Sf,ai=Oa.LocalInvitationFailureReason,Fb=Oa.LocalInvitationState,EP=(Sf=function(e){function t(e,r,i){ab(this,t);var o=n.call(this,i,"RtmLocalInvitation",!0);return E(L(o),"state",Fb.IDLE),E(L(o),"localInvitationEnd$",bb(Bc(L(o),"LocalInvitationAccepted"),Bc(L(o),"LocalInvitationRefused"),Bc(L(o),"LocalInvitationFailure"),Bc(L(o),"LocalInvitationCanceled")).pipe(Xb(1))),E(L(o),"callId",gj.v4()),E(L(o),"_content",""),E(L(o),"_channelId",""),E(L(o),"_response",""),E(L(o),"calleeId",void 0),E(L(o),"logger",void 0),E(L(o),"getSession",void 0),o.calleeId=e,o.getSession=r,o.logger=i,o}nb(t,e);var n=ob(t);return Qb(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){this.state!==Fb.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=e)}},{key:"content",get:function(){return this._content},set:function(e){this.log("set content for %s",this.callId),this._content=e}},{key:"response",get:function(){return this._response},set:function(e){throw new ja('Cannot set the "response" of the LocalInvitation instance.',ve)}},{key:"send",value:function(){var e,t=this;if(this.state===Fb.SENT_TO_REMOTE||this.state===Fb.RECEIVED_BY_REMOTE)throw new ia("The local invitation send failure. The call invitation has already been sent.",AI);if(this.isLocalInvitationEnd())throw new ia("The local invitation send failure. The call invitation has ended.",$k);if(0<this._channelId.length&&!yb(this._channelId))throw new ja("Illegal invitation channel ID",ve);if(!yb(this.calleeId))throw new ja("Illegal invitation callee user ID",ve);if(8192<Wj(this._content))throw new ja('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',ve);this.state=Fb.SENT_TO_REMOTE,lf(za(W.mark((function n(){var r,i,o;return W.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getSession().sendInvitationMessage({peerId:t.calleeId,callId:t.callId,extra:t._content,type:"CallInvite",channelId:t._channelId});case 2:if(r=n.sent,i=r.hasPeerReceived,o=r.hasReSent,!t.isLocalInvitationEnd()){n.next=7;break}throw new Pc("send invitation timeout");case 7:if(t.log("The local invitation has sent to the callee"),i||o){n.next=11;break}throw e=new Tq({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(i){n.next=14;break}throw e=new Tq({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}}),n)})))).pipe(Zg((function(e){return e.pipe(Ka((function(e){if(!(e instanceof Tq))throw e})),mf(2e3))})),Oc(3e4),Rb((function(e){return uc(e)&&t.warn("local invitation ack timed out"),Va(e)})),he(this.localInvitationEnd$)).subscribe({next:function(){t.state===Fb.RECEIVED_BY_REMOTE?t.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):t.state!==Fb.SENT_TO_REMOTE?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(t.info("The peer received the local invitation %s.",t.callId),t.state=Fb.RECEIVED_BY_REMOTE,t.emit("LocalInvitationReceivedByPeer"),t.localInvitationEnd$.pipe(Oc(6e4),Rb((function(e){return uc(e)&&t.warn("local invitation expired"),Va(e)}))).subscribe({error:function(){t.state=Fb.FAILURE,t.emit("LocalInvitationFailure",ai.INVITATION_EXPIRE)}}))},error:function(n){t.isLocalInvitationEnd()?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(t.state=Fb.FAILURE,uc(n)&&e?"PEER_NOT_ONLINE"===e.code?t.emit("LocalInvitationFailure",ai.PEER_OFFLINE):"RESENT_AND_OFFLINE"===e.code&&t.emit("LocalInvitationFailure",ai.PEER_NO_RESPONSE):uc(n)?t.emit("LocalInvitationFailure",ai.PEER_NO_RESPONSE):"RtmInvalidStatusError"===n.name?t.emit("LocalInvitationFailure",ai.NOT_LOGGEDIN):t.emit("LocalInvitationFailure",ai.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new ia("The local invitation cancel failure",$k);if(this.state===Fb.IDLE)throw new ia("The local invitation has not been sent",zI);if(8192<Wj(this._content))throw new ja('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',ve);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Fb.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(e){if(this.isLocalInvitationEnd()&&this.state!==Fb.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Fb.IDLE)throw new ia("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Fb.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Fb.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Fb.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Fb.ACCEPTED_BY_REMOTE,this._response=e,this.emit("LocalInvitationAccepted",e))}}},{key:"onRefuseReceived",value:function(e){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Fb.IDLE)throw new ia("the local have not sent the invitation, how can remote refuse it?");this.state===Fb.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Fb.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=e,this.state=Fb.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",e)}}},{key:"isLocalInvitationEnd",value:function(){return[Fb.CANCELED,Fb.FAILURE,Fb.ACCEPTED_BY_REMOTE,Fb.REFUSED_BY_REMOTE].includes(this.state)}}]),t}(Dd()),Na(Sf.prototype,"send",[je],Object.getOwnPropertyDescriptor(Sf.prototype,"send"),Sf.prototype),Na(Sf.prototype,"cancel",[je],Object.getOwnPropertyDescriptor(Sf.prototype,"cancel"),Sf.prototype),Sf),cm=Oa.RemoteInvitationFailureReason,Ic=Oa.RemoteInvitationState,FP=function(e){function t(e){var r=e.invitationChannel,i=e.extraContent,o=e.callId,a=e.callerId,s=e.logger;e=e.getSession,ab(this,t);var c=n.call(this,s,"RtmRemoteInvitation",!0);return E(L(c),"state",Ic.INVITATION_RECEIVED),E(L(c),"remoteInvitationEnd$",bb(Bc(L(c),"RemoteInvitationCanceled"),Bc(L(c),"RemoteInvitationRefused"),Bc(L(c),"RemoteInvitationAccepted"),Bc(L(c),"RemoteInvitationFailure")).pipe(Xb(1))),E(L(c),"callerId",void 0),E(L(c),"callId",void 0),E(L(c),"_getSession",void 0),E(L(c),"logger",void 0),E(L(c),"_content",void 0),E(L(c),"_channelId",void 0),E(L(c),"_response",""),c._channelId=r,c._content=i,c.callId=o,c.callerId=a,c._getSession=e,c.logger=s,c.remoteInvitationEnd$.pipe(Oc(6e4),Rb((function(e){return uc(e)&&c.warn("Remote invitation expired"),Va(e)}))).subscribe({error:function(){c.state=Ic.FAILURE,c.emit("RemoteInvitationFailure",cm.INVITATION_EXPIRE)}}),c}nb(t,e);var n=ob(t);return Qb(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){throw new ja('Cannot set the "response" of the RemoteInvitation instance.',ve)}},{key:"content",get:function(){return this._content},set:function(e){throw new ja('Cannot set the "content" of the RemoteInvitation instance.',ve)}},{key:"response",get:function(){return this._response},set:function(e){this._response=e}},{key:"accept",value:function(){var e,t=this;if(this.isRemoteInvitationEnd())throw new ia("The local invitation has ended. Cannot accept.",$k);if(this.state===Ic.ACCEPT_SENT_TO_LOCAL)throw new ia("The remote invitation is accepting. Cannot do the operation.",vw);if(8192<Wj(this._response))throw new ja('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',ve);this.state=Ic.ACCEPT_SENT_TO_LOCAL,Nc(Yg(1e3).pipe(Ac((function(){return lf(za(W.mark((function e(){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getSession().sendInvitationMessage({peerId:t.callerId,callId:t.callId,extra:t.response,type:"CallAccept",isAcceptAck:!1,channelId:t.channelId}));case 1:case"end":return e.stop()}}),e)}))))})),sc((function(t){return e=t.hasPeerReceived})),Xb(1)),Bc(this,"RemoteInvitationAccepted")).pipe(Oc(5e3),he(this.remoteInvitationEnd$)).subscribe({error:function(n){if(t.logError(n),t.state=Ic.FAILURE,uc(n))switch(e){case void 0:case!0:return void t.emit("RemoteInvitationFailure",cm.ACCEPT_FAILURE);case!1:return void t.emit("RemoteInvitationFailure",cm.PEER_OFFLINE)}t.emit("RemoteInvitationFailure",cm.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===Ic.ACCEPT_SENT_TO_LOCAL)throw new ia("The remote invitation is accepting. Cannot do the operation.",vw);if(this.isRemoteInvitationEnd())throw new ia("The invitation is end. Cannot refuse",$k);if(8192<Wj(this._response))throw new ja('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',ve);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=Ic.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(e){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===Ic.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=e,this.state=Ic.CANCELED,this.emit("RemoteInvitationCanceled",e))}},{key:"onAcceptAckReceived",value:function(){this.state!==Ic.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=Ic.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[Ic.ACCEPTED,Ic.REFUSED,Ic.CANCELED,Ic.FAILURE].includes(this.state)}}]),t}(Dd()),GP=function(e){function t(e,r){ab(this,t);var i=n.call(this,r,"InvitationManager");return E(L(i),"getSession",void 0),E(L(i),"invitationDispatcher",new kb.EventEmitter),E(L(i),"outgoingLocalInvitations",new Map),E(L(i),"receivedRemoteInvitations",new ue(void 0,{maxlen:1e4})),E(L(i),"logger",void 0),i.getSession=Hs(e),i.logger=r,i.invitationDispatcher.on("remoteInvitationToManager",(function(e){var t=e.callId,n=e.extra,o=e.callerId;e=e.channelId,i.receivedRemoteInvitations.has(t)||((n=new FP({callerId:o,callId:t,getSession:i.getSession,logger:r,extraContent:n,invitationChannel:e})).remoteInvitationEnd$.subscribe((function(){i.receivedRemoteInvitations.delete(t)})),i.receivedRemoteInvitations.set(t,n),i.emit("remoteInvitationInstance",n))})),i.invitationDispatcher.on("acceptAckToRemoteInvitation",(function(e){(e=i.receivedRemoteInvitations.get(e.callId))&&e.onAcceptAckReceived()})),i.invitationDispatcher.on("cancelToRemoteInvitation",(function(e){var t=e.extra;(e=i.receivedRemoteInvitations.get(e.callId))&&e.onCancelReceived(t)})),i.invitationDispatcher.on("acceptToLocalInvitation",(function(e){var t=e.extra;(e=i.outgoingLocalInvitations.get(e.callId))&&e.onAcceptReceived(t)})),i.invitationDispatcher.on("refuseToLocalInvitation",(function(e){var t=e.extra;(e=i.outgoingLocalInvitations.get(e.callId))&&e.onRefuseReceived(t)})),i}nb(t,e);var n=ob(t);return Qb(t,[{key:"invitationMessageHandler",value:function(e){var t=e.body,n=t.callId,r=t.extra;r=void 0===r?"":r;var i=t.type,o=void 0===(t=t.channel)?"":t,a=e.type;switch(t=e.peerId,e=e.serverReceivedTs,a){case"CallAccept":"ack"===i?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===i&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:r});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:t,extra:r,channelId:o});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(o,"_").concat(r),this.getSession().emit("peerTextMessage",{peerId:t,properties:{serverReceivedTs:e},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:r});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:r});break;default:throw ps("invitationType",a)}}},{key:"genLocalInvitation",value:function(e){var t=this,n=new EP(e,this.getSession,this.logger);return n.localInvitationEnd$.subscribe((function(){t.outgoingLocalInvitations.delete(n.callId)})),this.outgoingLocalInvitations.set(n.callId,n),n}}]),t}(Dd()),HP=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Kc(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),LK(e,t,{leading:r,maxWait:t,trailing:i})},lb,bi;!function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"}(bi||(bi={}));var Ld=Oa.ConnectionState,IP=(lb=function(e){function t(e,n,i,o){ab(this,t);var a=r.call(this,o,"RtmChannel",!0);return E(L(a),"onMemberCountUpdated",HP((function(e){e!==a.memberCount&&(a.memberCount=e,a.emit("MemberCountUpdated",e))}),1e3)),E(L(a),"onMetadataUpdated",(function(e){a.emit("MetaDataUpdated",e)})),E(L(a),"getSession",void 0),E(L(a),"memberCount",0),E(L(a),"joinState","LEFT"),E(L(a),"joinPromise",void 0),E(L(a),"memberJoinedLru",new ue(void 0,{maxlen:1e4})),E(L(a),"memberLeftLru",new ue(void 0,{maxlen:1e4})),E(L(a),"memberJoinStateLru",new ue(void 0,{maxlen:1e4})),E(L(a),"attributesSeqLru",new ue(void 0,{maxlen:1e4})),E(L(a),"channelId",void 0),E(L(a),"client",void 0),E(L(a),"onChannelMetaDataUpdated",(function(e){var t=e.data;a.channelId===e.channelId&&a.onMetadataUpdated(t)})),E(L(a),"onChannelMemberCountUpdated",(function(e,t){a.channelId===e&&a.onMemberCountUpdated(t)})),E(L(a),"onLogout",(function(){try{a.clearChannel(a.getSession())}catch(e){}})),E(L(a),"onAttributesUpdated",(function(e){var t=e.channelId,n=e.attributeMaps,r=e.seq;e=e.instance.toString();var i=a.attributesSeqLru.get(e);if((!i||r.greaterThan(i))&&(a.attributesSeqLru.set(e,r),t===a.channelId)){for(t={},r=0;r<n.length;r++){var o=n[r];e=o.key,i=o.ms;var s=o.value;if(o=o.origin,"string"!=typeof e||!D.isLong(i)||"string"!=typeof s||!yb(o))break;t[e]={value:s,lastUpdateUserId:o,lastUpdateTs:i.toNumber()}}a.emit("AttributesUpdated",t)}})),E(L(a),"onChannelTextMessage",(function(e){var t=e.memberId,n=e.text,r=e.properties;e.channelId===a.channelId&&a.emit("ChannelMessage",{text:n,messageType:Oa.MessageType.TEXT},t,r)})),E(L(a),"onChannelRawMessage",(function(e){var t=e.desc,n=e.raw,r=e.memberId,i=e.properties;e.channelId===a.channelId&&a.emit("ChannelMessage",{messageType:Oa.MessageType.RAW,rawMessage:n,description:t},r,i)})),E(L(a),"onMemberNotice",(function(e){var t=e.memberId,n=e.type,r=e.size;if(e.channelId===a.channelId){var i=e.instance.toString();e=e.seq.toString();var o={MemberLeft:a.memberLeftLru,MemberJoined:a.memberJoinedLru,MemberCountUpdated:void 0}[n];if(o){if(o.has(i+e))return void a.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,e,wb(a.channelId),wb(t||""));if(o.set(i+e,void 0),"string"!=typeof t)return;if(t!==a.getSession().context.uid){if((i=a.memberJoinStateLru.get(t))===bi.JOINED&&"MemberJoined"===n)return void a.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,wb(a.channelId),wb(t||""));if(i===bi.LEFT&&"MemberLeft"===n)return void a.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,wb(a.channelId),wb(t||""))}a.memberJoinStateLru.set(t,"MemberJoined"===n?bi.JOINED:bi.LEFT)}a.info("Channel %s - %s, memberId: %s",n,wb(a.channelId),"MemberCountUpdated"===n?"[unknown]":wb(t||"")),i=t===a.getSession().context.uid,"MemberLeft"===n&&yb(t)||"MemberJoined"===n&&yb(t)?(i||a.emit(n,t),a.onMemberCountUpdated(r)):"MemberCountUpdated"===n&&"number"==typeof r&&a.onMemberCountUpdated(r)}})),a.getSession=Hs(n),a.channelId=e,a.client=i,a.info("A channel created, id %s",wb(e)),a}nb(t,e);var n,r=ob(t);return Qb(t,[{key:"join",value:(n=za(W.mark((function e(){var t,n,r,i,o,a,s,c=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.connectionState===Ld.CONNECTED){e.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:e.prev=2,t=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new ia("The client is not logged in. Cannot do the operation",Aw);case 9:if(e.prev=9,yb(this.channelId)){e.next=12;break}throw new ja(["The %s in the arguments is invalid","channelId"],BI);case 12:if("LEFT"===this.joinState){e.next=15;break}throw $a("ChnJoin",{cname:this.channelId,lts:D.fromNumber(Date.now()),userId:t.context.uid,elapse:Nb(t.startTime),errCode:zw,sid:fc(t.instanceId)},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),new ia("The channel has joined. Cannot rejoin",zw);case 15:if(!t.usedChannelIds.includes(this.channelId)){e.next=18;break}throw $a("ChnJoin",{cname:this.channelId,lts:D.fromNumber(Date.now()),userId:t.context.uid,elapse:Nb(t.startTime),errCode:Bw,sid:fc(t.instanceId)},null!==(o=this.client.context.config.enableCloudProxy)&&void 0!==o&&o),new ia("A channel of the same channel ID has already joined. Cannot rejoin",Bw);case 18:if(!(20<=t.usedChannelIds.length)){e.next=21;break}throw $a("ChnJoin",{cname:this.channelId,lts:D.fromNumber(Date.now()),userId:t.context.uid,elapse:Nb(t.startTime),errCode:yw,sid:fc(t.instanceId)},null!==(a=this.client.context.config.enableCloudProxy)&&void 0!==a&&a),new Dc("The joined channels has exceeded the limit of 20",yw);case 21:return $a("ChnJoin",{cname:this.channelId,lts:D.fromNumber(Date.now()),userId:t.context.uid,elapse:Nb(t.startTime),errCode:0,sid:fc(t.instanceId)},null!==(n=this.client.context.config.enableCloudProxy)&&void 0!==n&&n),this.log("Joining the channel %s",wb(this.channelId)),this.joinState="JOINING",t.usedChannelIds.push(this.channelId),this.joinPromise=t.requestChannelJoin(this.channelId).then((function(){c.joinState="JOINED",t.requestSubscribeChannelMetadata(c.channelId,"JOIN").toPromise()})),e.next=28,this.joinPromise;case 28:$a("ChnJoinRes",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb(t.startTime),errCode:0,sid:fc(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),this.info("The channel %s joined successfully",wb(this.channelId)),t.on("channelTextMessage",this.onChannelTextMessage),t.on("channelRawMessage",this.onChannelRawMessage),t.on("memberNotice",this.onMemberNotice),t.on("channelAttributesUpdated",this.onAttributesUpdated),t.on("channelMetaDataUpdated",this.onChannelMetaDataUpdated),this.client.internalEmitter.on("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.once("LOGOUT",this.onLogout),e.next=49;break;case 39:if(e.prev=39,e.t1=e.catch(9),"JOINING"===this.joinState&&(this.joinState="LEFT"),this.logError(e.t1),!Sa(e.t1)){e.next=45;break}throw e.t1;case 45:if(!uc(e.t1)){e.next=48;break}throw $a("ChnJoinRes",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb(t.startTime),errCode:xw,sid:fc(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(s=this.client.context.config.enableCloudProxy)&&void 0!==s&&s),new Pc(["Join channel %s timed out",wb(this.channelId)],xw);case 48:throw new id(["The channel %s join failure",wb(this.channelId)],{code:ww,originalError:e.t1});case 49:case"end":return e.stop()}}),e,this,[[2,6],[9,39]])}))),function(){return n.apply(this,arguments)})},{key:"leave",value:function(){var e=za(W.mark((function e(){var t,n,r,i;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.connectionState===Ld.CONNECTED){e.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:e.prev=2,n=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new ia("The client is not logged in. Cannot do the operation",DI);case 9:if("LEFT"!==this.joinState){e.next=11;break}throw new ia("The channel does not join. Cannot do the operation",CI);case 11:return e.prev=11,n.requestChannelLeave(this.channelId),e.next=15,n.requestUnsubscribeChannelMetadata(this.channelId);case 15:return e.next=17,this.clearChannel(n);case 17:e.next=28;break;case 19:if(e.prev=19,e.t1=e.catch(11),this.logError(e.t1),!Sa(e.t1)){e.next=26;break}throw void 0===e.t1.code&&(e.t1.code=Dw),$a("ChnLeave",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb(n.startTime),errCode:Dw,sid:fc(n.instanceId),userId:n.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),e.t1;case 26:throw $a("ChnLeave",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb(n.startTime),errCode:Cw,sid:fc(n.instanceId),userId:n.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),new id("The channel leave failure",{code:Cw,originalError:e.t1});case 28:$a("ChnLeave",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb(n.startTime),errCode:0,sid:fc(n.instanceId),userId:n.context.uid},null!==(t=this.client.context.config.enableCloudProxy)&&void 0!==t&&t);case 29:case"end":return e.stop()}}),e,this,[[2,6],[11,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=za(W.mark((function e(t){var n,r=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(vs(t,fp),this.client.connectionState!==Ld.CONNECTED||"JOINED"===this.joinState){e.next=3;break}throw new ia("The channel does not join. Cannot do the operation",rI);case 3:if(this.client.connectionState!==Ld.RECONNECTING){e.next=8;break}return n=Date.now(),e.next=7,new Promise((function(e,i){var o,a=(o=za(W.mark((function o(){var a;return W.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return a=Date.now()-n,o.prev=1,o.next=4,Uj({message:t,peerId:r.channelId,toPeer:!1,session:r.getSession(),errorCodes:{NOT_LOGGED_IN:gp,TOO_OFTEN:rw},diff:a,logger:r.logger});case 4:e(),o.next=12;break;case 7:o.prev=7,o.t0=o.catch(1),uc(o.t0)&&i(new Pc(vg(r.name,"sendMessageToPeer",1e4),ep)),Sa(o.t0)&&i(o.t0),i(new Pa("Channel message send failure",{code:Zk,originalError:o.t0}));case 12:return o.prev=12,clearTimeout(s),o.finish(12);case 15:case"end":return o.stop()}}),o,null,[[1,7,12,15]])}))),function(){return o.apply(this,arguments)});r.client.internalEmitter.once("RECONNECTED",a);var s=setTimeout((function(){r.client.internalEmitter.off("RECONNECTED",a),i(new Pc(vg(r.name,"sendMessageToPeer",1e4),ep))}),9e3)}));case 7:return e.abrupt("return");case 8:if(this.client.connectionState===Ld.CONNECTED){e.next=10;break}throw new ia("The client is not logged in. Cannot do the operation",gp);case 10:return e.prev=10,e.next=13,Uj({message:t,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:gp,TOO_OFTEN:rw},diff:0,logger:this.logger});case 13:e.next=23;break;case 15:if(e.prev=15,e.t0=e.catch(10),!uc(e.t0)){e.next=19;break}throw new Pc(vg(this.name,"sendMessage",1e4),ep);case 19:if(!Sa(e.t0)){e.next=22;break}throw this.logError(e.t0),e.t0;case 22:throw new id("The channel message send failure",Zk);case 23:case"end":return e.stop()}}),e,this,[[10,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelMetadata",value:function(){var e=za(W.mark((function e(){var t,n;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.connectionState===Ld.CONNECTED){e.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:return e.prev=2,t=this.getSession().requestGetChannelMetaData(this.channelId),e.next=6,t.pipe(Wa((function(e){return Wm(e)}))).toPromise();case 6:return n=e.sent,e.abrupt("return",n);case 10:if(e.prev=10,e.t0=e.catch(2),!Sa(e.t0)){e.next=15;break}throw this.logError(e.t0),e.t0;case 15:throw new id("The channel metadata get failure",lp);case 16:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"setChannelMetadata",value:function(){var e=za(W.mark((function e(t,n){var r;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.connectionState===Ld.CONNECTED){e.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if("JOINED"===this.joinState){e.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return e.prev=4,r=this.getSession().requestSetChannelMetadata(t,n,this.channelId).toPromise(),e.next=8,r;case 8:e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(4),!Sa(e.t0)){e.next=15;break}throw this.logError(e.t0),e.t0;case 15:throw new id("The channel metadata set failure",He);case 16:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearChannelMetadata",value:function(){var e=za(W.mark((function e(t){var n;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.connectionState===Ld.CONNECTED){e.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if("JOINED"===this.joinState){e.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return e.prev=4,n=this.getSession().requestClearChannelMetadata(t,this.channelId).toPromise(),e.next=8,n;case 8:e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(4),!Sa(e.t0)){e.next=15;break}throw this.logError(e.t0),e.t0;case 15:throw new id("The channel metadata clear failure",He);case 16:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addChannelMetadata",value:function(){var e=za(W.mark((function e(t,n){var r;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.connectionState===Ld.CONNECTED){e.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if("JOINED"===this.joinState){e.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return e.prev=4,r=this.getSession().requestAddChannelMetadata(t,n,this.channelId).toPromise(),e.next=8,r;case 8:e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(4),!Sa(e.t0)){e.next=15;break}throw this.logError(e.t0),e.t0;case 15:throw new id("The channel metadata clear failure",He);case 16:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateChannelMetadata",value:function(){var e=za(W.mark((function e(t,n){var r;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.connectionState===Ld.CONNECTED){e.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if("JOINED"===this.joinState){e.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return e.prev=4,r=this.getSession().requestUpdateChannelMetadata(t,n,this.channelId).toPromise(),e.next=8,r;case 8:e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(4),!Sa(e.t0)){e.next=15;break}throw this.logError(e.t0),e.t0;case 15:throw new id("The channel metadata clear failure",He);case 16:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteChannelMetadata",value:function(){var e=za(W.mark((function e(t,n){var r;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.connectionState===Ld.CONNECTED){e.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if("JOINED"===this.joinState){e.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return e.prev=4,r=this.getSession().requestDeleteChannelMetadata(t,n,this.channelId).toPromise(),e.next=8,r;case 8:e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(4),!Sa(e.t0)){e.next=15;break}throw this.logError(e.t0),e.t0;case 15:throw new id("The channel metadata clear failure",He);case 16:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMembers",value:function(){var e=za(W.mark((function e(){var t,n;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.client.connectionState===Ld.CONNECTED){e.next=3;break}throw new ia("The client is not logged in. Cannot do the operation",yI);case 3:if("JOINED"===this.joinState){e.next=5;break}throw new ia("The channel does not join. Cannot do the operation",xI);case 5:return t=this.getSession().requestChannelMemberList(this.channelId),e.next=8,t.pipe(Wa((function(e){return e.memberInfos.map((function(e){return e.account}))}))).toPromise();case 8:return n=e.sent,this.info("Channel %s - get members success, %o",wb(this.channelId),n.map(wb)),e.abrupt("return",n);case 13:if(e.prev=13,e.t0=e.catch(0),!Sa(e.t0)){e.next=18;break}throw this.logError(e.t0),e.t0;case 18:throw new id("The channel members get failure",vI);case 19:case"end":return e.stop()}}),e,this,[[0,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannel",value:function(){var e=za(W.mark((function e(t){var n=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.emit("channelLeft",this.channelId),"JOINING"!==this.joinState){e.next=4;break}return e.next=4,this.joinPromise;case 4:this.joinState="LEFT",this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,t.removeListener("channelTextMessage",this.onChannelTextMessage),t.removeListener("channelRawMessage",this.onChannelRawMessage),t.removeListener("memberNotice",this.onMemberNotice),t.removeListener("channelAttributesUpdated",this.onAttributesUpdated),t.removeListener("channelMetaDataUpdated",this.onChannelMetaDataUpdated),this.client.internalEmitter.removeListener("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.removeListener("LOGOUT",this.onLogout),t.usedChannelIds=t.usedChannelIds.filter((function(e){return e!==n.channelId}));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(Dd()),Na(lb.prototype,"join",[je],Object.getOwnPropertyDescriptor(lb.prototype,"join"),lb.prototype),Na(lb.prototype,"leave",[je],Object.getOwnPropertyDescriptor(lb.prototype,"leave"),lb.prototype),Na(lb.prototype,"sendMessage",[je],Object.getOwnPropertyDescriptor(lb.prototype,"sendMessage"),lb.prototype),Na(lb.prototype,"getChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"getChannelMetadata"),lb.prototype),Na(lb.prototype,"setChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"setChannelMetadata"),lb.prototype),Na(lb.prototype,"clearChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"clearChannelMetadata"),lb.prototype),Na(lb.prototype,"addChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"addChannelMetadata"),lb.prototype),Na(lb.prototype,"updateChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"updateChannelMetadata"),lb.prototype),Na(lb.prototype,"deleteChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"deleteChannelMetadata"),lb.prototype),Na(lb.prototype,"getMembers",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"getMembers"),lb.prototype),lb),ka,Jc=Oa.ConnectionChangeReason,Ea=Oa.ConnectionState,FA={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},JP={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8,TOKEN_EXPIRED:9},KP=(ka=function(e){function t(e,n,i,o){ab(this,t);var a=r.call(this,n,"RtmClient",!0);return E(L(a),"connectionState",Ea.DISCONNECTED),E(L(a),"internalEmitter",new kb),E(L(a),"context",void 0),E(L(a),"attributes",{}),E(L(a),"loginPromise",void 0),E(L(a),"attributeDrafts",new Set),E(L(a),"session",void 0),E(L(a),"lastLoginTime",void 0),E(L(a),"reconnId",0),E(L(a),"channelAttributesCacheLru",new ue(void 0,{maxlen:1e4})),E(L(a),"invitationManager",void 0),E(L(a),"subscribedPeerStatusCache",{}),E(L(a),"subscribedUserMetaCache",{}),E(L(a),"pendingPeerStatusSubCount",0),E(L(a),"peerStatusSeqLru",new ue(void 0,{maxlen:1e4})),E(L(a),"peerUnreachableTimers",{}),E(L(a),"setParameters",void 0),E(L(a),"updateConfig",void 0),E(L(a),"blacklistedIP",{}),E(L(a),"TokenPrivilegeWillExpireHandler",(function(){a.emit("TokenPrivilegeWillExpire")})),E(L(a),"userMetaDataUpdatedHandler",(function(e){var t=e.uid;e=e.data,a.subscribedUserMetaCache[t]&&a.emit("UserMetaDataUpdated",t,e)})),E(L(a),"userDropHandler",(function(e){if(a.connectionState!==Ea.ABORTED)switch(e){case 2:a.logError("Server banned because of token is expired"),a.onConnectionStateChanged(Ea.ABORTED,Jc.TOKEN_EXPIRED),a.emit("TokenExpired");break;case 11:a.logError("Kicked off by remote session"),a.onConnectionStateChanged(Ea.ABORTED,Jc.REMOTE_LOGIN);break;case 14:case 15:case 16:a.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[e])),a.onConnectionStateChanged(Ea.ABORTED,Jc.BANNED_BY_SERVER);break;case 10019:a.logError("Kicked off by authorization"),a.onConnectionStateChanged(Ea.ABORTED,Jc.BANNED_BY_SERVER);break;default:a.logError("User kicked off for unknown code: ".concat(e)),a.onConnectionStateChanged(Ea.ABORTED,Jc.INTERRUPTED)}})),a.context=new yL(e,i,n),a.context.config=i,a.setParameters=o.bind(L(a)),a.updateConfig=o.bind(L(a)),a.invitationManager=new GP((function(){return a.session}),n),a.invitationManager.on("remoteInvitationInstance",(function(e){a.emit("RemoteInvitationReceived",e)})),a.setMaxListeners(512),a.internalEmitter.setMaxListeners(512),a}nb(t,e);var n,r=ob(t);return Qb(t,[{key:"renewToken",value:(n=za(W.mark((function e(t){var n,r,i,o,a=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&0!==t.length){e.next=2;break}throw new ja("Invalid argument",KI);case 2:if(this.connectionState!==Ea.ABORTED){e.next=5;break}return e.next=5,new Promise((function(){}));case 5:if(this.connectionState===Ea.CONNECTED||this.connectionState===Ea.RECONNECTING){e.next=7;break}throw new ia("The client is not logged in",Mw);case 7:if(void 0!==this.session){e.next=9;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,n=this.context.token,this.context.token=t,e.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Zf((function(){return Error("No available edge address to connect")})),Zg((function(e){return e.pipe(Ka((function(e){if(Sa(e))throw e})),mf(2500),Xb(4))})),Xb(1),Oc(2e4),Rb((function(e){return uc(e)&&a.warn("renewToken timed out"),Va(e)}))).toPromise();case 14:r=e.sent,i=r.ticket,e.next=27;break;case 18:if(e.prev=18,e.t0=e.catch(9),this.context.token=n,e.t0.code!==Fw&&e.t0.code!==Gw){e.next=23;break}throw new Gh("Invalid token",MI);case 23:if(e.t0.code!==bl){e.next=25;break}throw new Gh("The token expired",LI);case 25:if(!uc(e.t0)){e.next=27;break}throw new Pc("Renew token timed out",jp);case 27:o=this.session,this.session.requestUpdateEdgeTicket(i).toPromise().then((function(e){if(0!==e.code)throw new Pa(["RenewToken failure. The response code is %d",e.code],jp);o.curLoginSockets.filter((function(e){return void 0!==e})).forEach((function(e){return e.ticket=i}))}));case 29:case"end":return e.stop()}}),e,this,[[9,18]])}))),function(e){return n.apply(this,arguments)})},{key:"queryPeersOnlineStatus",value:function(){var e=za(W.mark((function e(t){var n,r,i=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",JI);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(t)||0===t.length||t.some((function(e){return!yb(e)}))||256<t.length)){e.next=6;break}throw new ja("invalid arguments",Lw);case 6:return e.next=8,this.session.requestPeersOnlineStatus(t).toPromise();case 8:return n=e.sent,r=Pe(Ro(n.userInfos,"account"),(function(e){return!!e.ts})),Object.keys(r).forEach((function(e){if(e in i.subscribedPeerStatusCache&&i.subscribedPeerStatusCache[e]!==Oa.PeerOnlineState.UNREACHABLE){var t=r[e]?Oa.PeerOnlineState.ONLINE:Oa.PeerOnlineState.OFFLINE;i.emit("PeersOnlineStatusChanged",E({},e,t)),i.subscribedPeerStatusCache[e]=t}})),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=za(W.mark((function e(t){var n,r,i,o,a,s,c,u,l;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",uI);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&t.every((function(e){return"string"==typeof e}))&&0!==t.length){e.next=6;break}throw new ja("Invalid arguments: channelIds",tw);case 6:if(!(32<t.length)){e.next=8;break}throw new ja("getChannelMemberCount exceed limit of 32 channelIds",tI);case 8:n=0;case 9:if(!(n<t.length)){e.next=16;break}if(yb(r=t[n])){e.next=13;break}throw new ja(["getChannelMemberCount channel id %s is invalid",r],tw);case 13:n++,e.next=9;break;case 16:return e.next=18,this.session.requestGetChannelMemberCount(t).toPromise();case 18:for(i=e.sent,o=i.groupInfos,a={},s=0;s<o.length;s++)c=o[s],u=c.group,l=c.memberCount,yb(u)&&"number"==typeof l&&(this.internalEmitter.emit("channelMemberCountUpdated",u,l),a[u]=l);return e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var e=za(W.mark((function e(t){var n,r;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ri({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===Ea.CONNECTED){e.next=3;break}throw new ia("The client is not logged in",Cd);case 3:if(void 0!==this.session){e.next=5;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(t).toPromise(),r={attribute:t,promise:n},this.attributeDrafts.add(r),e.prev=8,e.next=11,n;case 11:this.attributes=t,e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(8),!Sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new ja("arguments is not valid",Ub);case 19:return e.prev=19,this.attributeDrafts.delete(r),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[8,14,19,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var e=za(W.mark((function e(t,n){var r,i,o,a,s,c=arguments;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<c.length&&void 0!==c[2]?c[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,ri({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===Ea.CONNECTED){e.next=4;break}throw new ia("The client is not logged in",Cd);case 4:if(void 0!==this.session){e.next=6;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return a=this.session.requestSetChannelAttributes(t,n,o).toPromise(),e.prev=7,e.next=10,a;case 10:s=Pe(n,(function(e){return new Blob([e]).size})),this.channelAttributesCacheLru.set(t,s),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(7),!Sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new ja("arguments is not valid",Ub);case 19:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var e=za(W.mark((function e(t){var n,r,i;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=tb(tb({},this.attributes),t),ri({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),ri({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===Ea.CONNECTED){e.next=5;break}throw new ia("The client is not logged in",Cd);case 5:if(void 0!==this.session){e.next=7;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return r=this.session.requestAddOrUpdateLocalUserAttributes(t).toPromise(),i={attribute:n,promise:r},this.attributeDrafts.add(i),e.prev=10,e.next=13,r;case 13:this.attributes=n,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!Sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new ja("arguments is not valid",Lw);case 21:return e.prev=21,this.attributeDrafts.delete(i),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[10,16,21,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var e=za(W.mark((function e(t,n){var r,i,o,a,s,c,u,l=arguments;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,a=this.channelAttributesCacheLru.get(t,{}),s=Pe(n,(function(e){return new Blob([e]).size})),c=tb(tb({},a),s),ri({attributes:n,attrSizeMap:c,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===Ea.CONNECTED){e.next=7;break}throw new ia("The client is not logged in",Cd);case 7:if(void 0!==this.session){e.next=9;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return u=this.session.requestAddOrUpdateChannelAttributes(t,n,o).toPromise(),e.prev=10,e.next=13,u;case 13:this.channelAttributesCacheLru.set(t,c),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!Sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new ja("arguments is not valid",Ub);case 21:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var e=za(W.mark((function e(t){var n,r,i,o;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&0!==t.length&&!t.some((function(e){return 0===e.length}))){e.next=2;break}throw new ia("arguments is not valid",Ub);case 2:if(this.connectionState===Ea.CONNECTED){e.next=4;break}throw new ia("The client is not logged in",Cd);case 4:if(void 0!==this.session){e.next=6;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(t).toPromise(),r={attribute:Oo(this.attributes,t),promise:n},this.attributeDrafts.add(r),e.prev=9,e.next=12,n;case 12:for(i=0;i<t.length;i++)o=t[i],delete this.attributes[o];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(9),!Sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new ja("arguments is not valid",Ub);case 20:return e.prev=20,this.attributeDrafts.delete(r),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[9,15,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var e=za(W.mark((function e(t,n){var r,i,o,a,s,c,u,l=arguments;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,Array.isArray(n)&&0!==n.length&&yb(t)&&!n.some((function(e){return 0===e.length||512<e.length}))){e.next=3;break}throw new ia("arguments is not valid",Ub);case 3:if(this.connectionState===Ea.CONNECTED){e.next=5;break}throw new ia("The client is not logged in",Cd);case 5:if(void 0!==this.session){e.next=7;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return a=this.session.requestDeleteChannelAttributesByKeys(t,n,o).toPromise(),e.prev=8,e.next=11,a;case 11:if(s=this.channelAttributesCacheLru.get(t))for(c=0;c<n.length;c++)u=n[c],delete s[u];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(8),!Sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new ja("arguments is not valid",Ub);case 20:case"end":return e.stop()}}),e,this,[[8,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var e=za(W.mark((function e(){var t,n;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",Cd);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return t=this.session.requestClearLocalUserAttributes().toPromise(),n={attribute:{},promise:t},this.attributeDrafts.add(n),e.prev=7,e.next=10,t;case 10:this.attributes={},e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(7),!Sa(e.t0)){e.next=17;break}throw e.t0;case 17:throw new ja("arguments is not valid",Ub);case 18:return e.prev=18,this.attributeDrafts.delete(n),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[7,13,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var e=za(W.mark((function e(t){var n,r,i,o,a=arguments;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<a.length&&void 0!==a[1]?a[1]:{},r=n.enableNotificationToChannelMembers,i=void 0!==r&&r,this.connectionState===Ea.CONNECTED){e.next=3;break}throw new ia("The client is not logged in",Cd);case 3:if(void 0!==this.session){e.next=5;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return o=this.session.requestClearChannelAttributes(t,i).toPromise(),e.prev=6,e.next=9,o;case 9:this.channelAttributesCacheLru.delete(t),e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(6),!Sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new ja("arguments is not valid",Ub);case 17:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var e=za(W.mark((function e(t){var n,r,i;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yb(t)){e.next=2;break}throw new ja("Not a valid user ID",Ub);case 2:if(this.connectionState===Ea.CONNECTED){e.next=4;break}throw new ia("The client is not logged in",Cd);case 4:if(void 0!==this.session){e.next=6;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetUserAttributeKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetUserAttributesByKeys(t,r.slice(0,512)).toPromise();case 13:i=e.sent,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!Sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new ja("arguments is not valid",Ub);case 21:return e.abrupt("return",Dv(i.attributeInfos.map((function(e){return[e.key,e.value]}))));case 22:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var e=za(W.mark((function e(t){var n,r,i,o,a,s,c,u,l,f,d;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yb(t)){e.next=2;break}throw new ja("Not a valid channel ID",Ub);case 2:if(this.connectionState===Ea.CONNECTED){e.next=4;break}throw new ia("The client is not logged in",Cd);case 4:if(void 0!==this.session){e.next=6;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetChannelAttributesKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetChannelAttributesByKeys(t,r).toPromise();case 13:i=e.sent,o=i.attributeMaps,e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(6),!Sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new ja("arguments is not valid",Ub);case 22:a={},s=0;case 24:if(!(s<o.length)){e.next=32;break}if(c=o[s],u=c.key,l=c.ms,f=c.value,d=c.origin,"string"==typeof u&&D.isLong(l)&&"string"==typeof f&&yb(d)){e.next=28;break}return e.abrupt("break",32);case 28:a[u]={value:f,lastUpdateUserId:d,lastUpdateTs:l.toNumber()};case 29:s++,e.next=24;break;case 32:return this.channelAttributesCacheLru.set(t,Pe(a,(function(e){return new Blob([e.value]).size}))),e.abrupt("return",a);case 34:case"end":return e.stop()}}),e,this,[[6,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var e=za(W.mark((function e(t,n){var r,i,o,a,s,c,u,l,f,d;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",Cd);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return os(t,n),e.prev=5,e.next=8,this.session.requestGetChannelAttributesByKeys(t,n).toPromise();case 8:r=e.sent,i=r.attributeMaps,e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(5),!Sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new ja("arguments is not valid",Ub);case 17:o={},a=this.channelAttributesCacheLru.get(t,{}),s=0;case 20:if(!(s<i.length)){e.next=29;break}if(c=i[s],u=c.key,l=c.ms,f=c.value,d=c.origin,"string"==typeof u&&D.isLong(l)&&"string"==typeof f&&yb(d)){e.next=24;break}return e.abrupt("break",29);case 24:a[u]=new Blob([f]).size,o[u]={value:f,lastUpdateUserId:d,lastUpdateTs:l.toNumber()};case 26:s++,e.next=20;break;case 29:return this.channelAttributesCacheLru.set(t,a),e.abrupt("return",o);case 31:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var e=za(W.mark((function e(t,n){var r;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",Cd);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return os(t,n),e.prev=5,e.next=8,this.session.requestGetUserAttributesByKeys(t,n).toPromise();case 8:r=e.sent,e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(5),!Sa(e.t0)){e.next=15;break}throw e.t0;case 15:throw new ja("arguments is not valid",Ub);case 16:return e.abrupt("return",Dv(r.attributeInfos.map((function(e){return[e.key,e.value]}))));case 17:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserMetadata",value:function(){var e=za(W.mark((function e(t){var n,r;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!t.split("").includes(".")){e.next=6;break}throw new ja("The uid cannot contain the character .",Mb);case 6:return e.prev=6,e.next=9,this.session.requestGetLocalMetaData(t).toPromise();case 9:return n=e.sent,r=Wm(n),e.abrupt("return",r);case 14:if(e.prev=14,e.t0=e.catch(6),!Sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new ja("arguments is not valid",Mb);case 19:case"end":return e.stop()}}),e,this,[[6,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setLocalUserMetadata",value:function(){var e=za(W.mark((function e(t,n){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return e.prev=4,e.next=7,this.session.requestSetLocalMetadata(t,n).toPromise();case 7:e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(4),!Sa(e.t0)){e.next=13;break}throw e.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLocalUserMetadata",value:function(){var e=za(W.mark((function e(t){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return e.prev=4,e.next=7,this.session.requestClearLocalMetadata(t).toPromise();case 7:e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(4),!Sa(e.t0)){e.next=13;break}throw e.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addLocalUserMetadata",value:function(){var e=za(W.mark((function e(t,n){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return e.prev=4,e.next=7,this.session.requestAddLocalMetadata(t,n).toPromise();case 7:e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(4),!Sa(e.t0)){e.next=13;break}throw e.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateLocalUserMetadata",value:function(){var e=za(W.mark((function e(t,n){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return e.prev=4,e.next=7,this.session.requestUpdateLocalMetadata(t,n).toPromise();case 7:e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(4),!Sa(e.t0)){e.next=13;break}throw e.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteLocalUserMetadata",value:function(){var e=za(W.mark((function e(t,n){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return e.prev=4,e.next=7,this.session.requestDeleteLocalMetadata(t,n).toPromise();case 7:e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(4),!Sa(e.t0)){e.next=13;break}throw e.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"subscribeUserMetadata",value:function(){var e=za(W.mark((function e(t){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(yb(t)){e.next=6;break}throw new ja("Not a valid user ID",dl);case 6:if(!t.split("").includes(".")){e.next=8;break}throw new ja("The uid cannot contain the character .",dl);case 8:if(!(51<=Object.values(this.subscribedUserMetaCache).filter((function(e){return e===Oa.subscribedState.SUBSCRIBED})).length)){e.next=10;break}throw new Dc("Subscribed user metadata overflows",OI);case 10:return e.prev=10,e.next=13,this.session.requestSubscribeUserMetadata(t,"NORMAL").toPromise();case 13:this.subscribedUserMetaCache[t]=Oa.subscribedState.SUBSCRIBED,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!Sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new ja("arguments is not valid",Mb);case 21:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribeUserMetadata",value:function(){var e=za(W.mark((function e(t){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(yb(t)){e.next=6;break}throw new ja("Not a valid user ID",dl);case 6:if(!t.split("").includes(".")){e.next=8;break}throw new ja("The uid cannot contain the character .",dl);case 8:if(this.subscribedUserMetaCache[t]&&this.subscribedUserMetaCache[t]!==Oa.subscribedState.UNSUBSCRIBED){e.next=10;break}throw new ia("The user can not be unsubscribed",PI);case 10:return e.prev=10,e.next=13,this.session.requestUnsubscribeUserMetadata(t);case 13:this.subscribedUserMetaCache[t]=Oa.subscribedState.UNSUBSCRIBED,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!Sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new ja("arguments is not valid",Mb);case 21:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=za(W.mark((function e(t){var n,r,i,o,a,s;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Zr(!0),r=Rj(),i=t.token,t.token===this.context.appId&&(i=void 0),$a("Session",{appId:this.context.appId,did:navigator.userAgent,elapse:Nb(this.session&&this.session.startTime),index:{index1:t.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},installId:hj,lts:D.fromNumber(Date.now()),os:7,sid:fc(r),token:i||"",userId:t.uid,ver:"1.6.0-205",buildno:928,subVersion:228,version:7},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n,!0),Lg(t)&&yb(t.uid)){e.next=7;break}throw new ja("not a valid user id",al);case 7:if("string"!=typeof i||!i){e.next=11;break}this.context.token=i,e.next=13;break;case 11:if("string"==typeof i||null==i){e.next=13;break}throw new ja('The "token" is not a valid string.',al);case 13:return o=Date.now(),this.context.sid=fc(r),this.loginPromise=this.loginImpl({uid:t.uid,instanceId:r}),this.info("RTM Client logging in as ".concat(wb(t.uid))),e.prev=17,e.next=20,this.loginPromise;case 20:return e.next=22,null===(a=this.session)||void 0===a?void 0:a.requestSubscribeUserMetadata(t.uid,"JOIN").toPromise();case 22:this.subscribedUserMetaCache[t.uid]=Oa.subscribedState.SUBSCRIBED,e.next=31;break;case 25:throw e.prev=25,e.t0=e.catch(17),Sa(e.t0)&&$a("Link",{ackedServerIp:"",destServerIp:"",ec:e.t0.code||1,sc:e.t0.serverCode,elapse:Nb(this.session&&this.session.startTime),lts:D.fromNumber(Date.now()),responseTime:Date.now()-o,sid:fc(r),userId:t.uid},null!==(s=this.context.config.enableCloudProxy)&&void 0!==s&&s),this.context.token=void 0,this.context.socketUseProxy=!1,e.t0;case 31:return e.prev=31,this.loginPromise=void 0,e.finish(31);case 34:this.context.socketUseProxy&&this.emit("FallbackProxyConnected"),Zr(!1);case 36:case"end":return e.stop()}}),e,this,[[17,25,31,34]])})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=za(W.mark((function e(){var t;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loginPromise){e.next=3;break}return e.next=3,this.loginPromise;case 3:if(this.connectionState!==Ea.DISCONNECTED){e.next=6;break}throw this.logError("Already in logout state"),new ia("Logout failure. The client has already been logged out",Hw);case 6:if(this.internalEmitter.emit("LOGOUT"),this.connectionState!==Ea.ABORTED){e.next=11;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGOUT),e.abrupt("return");case 11:if(void 0!==this.session){e.next=14;break}return this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGOUT),e.abrupt("return");case 14:return $a("Logout",{elapse:Nb(this.session.startTime),lts:D.fromNumber(Date.now()),sid:fc(this.session.instanceId),userId:this.context.uid},null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),e.next=17,this.session.logoutHandler();case 17:this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGOUT),this.log("Log out success");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var e,t=this;if(this.connectionState===Ea.DISCONNECTED)throw this.logError("Already in logout state"),new ia("Logout failure. The client has already been logged out",Hw);this.connectionState===Ea.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&($a("Logout",{elapse:Nb(this.session.startTime),lts:D.fromNumber(Date.now()),sid:fc(this.session.instanceId),userId:this.context.uid},null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),this.session.logoutHandler().then((function(){t.log("Log out success")}))),this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var e=za(W.mark((function e(t,n){var r,i,o=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(vs(t,si),r="TEXT"===t.messageType?vb.P2pSMsgNoOfflineFlag:vb.P2pRMsgNoOfflineFlag,this.connectionState!==Ea.RECONNECTING){e.next=5;break}return i=Date.now(),e.abrupt("return",new Promise((function(e,a){var s,c=(s=za(W.mark((function s(){var c;return W.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(void 0!==o.session){s.next=2;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return c=Date.now()-i,s.prev=3,s.t0=e,s.next=7,Uj({message:t,peerId:n,toPeer:!0,session:o.session,errorCodes:{NOT_LOGGED_IN:ip,TOO_OFTEN:Jw},diff:c,logger:o.logger});case 7:s.t1=s.sent,(0,s.t0)(s.t1),s.next=18;break;case 11:s.prev=11,s.t2=s.catch(3),uc(s.t2)&&(o.session.emit("messageCount",{messageCategory:r,type:"common",key:"sentcount"}),o.session.emit("messageCount",{messageCategory:r,type:"common",key:"timeoutcount"}),a(new Pc(vg(o.name,"sendMessageToPeer",1e4),hp))),Sa(s.t2)&&a(s.t2),o.session.emit("messageCount",{messageCategory:r,type:"common",key:"sentcount"}),o.session.emit("messageCount",{messageCategory:r,type:"common",key:"unknowerrorcount"}),a(new Pa("Peer-to-peer message send failure",{code:Iw,originalError:s.t2}));case 18:return s.prev=18,clearTimeout(u),s.finish(18);case 21:case"end":return s.stop()}}),s,null,[[3,11,18,21]])}))),function(){return s.apply(this,arguments)});o.internalEmitter.once("RECONNECTED",c);var u=setTimeout((function(){o.internalEmitter.off("RECONNECTED",c),a(new Pc(vg(o.name,"sendMessageToPeer",1e4),hp))}),9e3)})));case 5:if(this.connectionState===Ea.CONNECTED){e.next=7;break}throw new ia("Failed to send the peer-to-peer message. The client is not logged in",ip);case 7:if(void 0!==this.session){e.next=9;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,e.next=12,Uj({message:t,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:ip,TOO_OFTEN:Jw},diff:0,logger:this.logger});case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),!uc(e.t0)){e.next=21;break}throw this.session.emit("messageCount",{messageCategory:r,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:r,type:"common",key:"timeoutcount"}),new Pc(vg(this.name,"sendMessageToPeer",1e4),hp);case 21:if(!Sa(e.t0)){e.next=23;break}throw e.t0;case 23:throw this.session.emit("messageCount",{messageCategory:r,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:r,type:"common",key:"unknowerrorcount"}),new Pa("Peer-to-peer message send failure",{code:Iw,originalError:e.t0});case 26:case"end":return e.stop()}}),e,this,[[9,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(e){var t=this;if(!yb(e))throw new ja(["The %s in the arguments is invalid",Object.keys({channelId:e})[0]],sI);return new IP(e,(function(){return t.session}),this,this.logger)}},{key:"createMetadataItem",value:function(){return new Fs}},{key:"createLocalInvitation",value:function(e){if(!yb(e))throw new ja(["The %s in the arguments is invalid",Object.keys({calleeId:e})[0]],ve);return this.invitationManager.genLocalInvitation(e)}},{key:"subscribePeersOnlineStatus",value:function(){var e=za(W.mark((function e(t){var n,r,i,o,a,s,c,u,l,f,d,p,h,v=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",kp);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new ja("Invalid arguments: peerIds",jj);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(yb(r=t[n])){e.next=11;break}throw new ja(["subscribePeersOnlineStatus peer id %s is invalid",r],jj);case 11:n++,e.next=7;break;case 14:if(!(512<(i=t&&t.length?Do(t):[]).length+Object.keys(this.subscribedPeerStatusCache).length+this.pendingPeerStatusSubCount)){e.next=17;break}throw new Dc("Subscribed peers overflows",Ow);case 17:return this.pendingPeerStatusSubCount+=i.length,e.next=20,this.session.requestSubscribePeersOnlineStatus(i).toPromise();case 20:o=e.sent,a=o.errors,this.pendingPeerStatusSubCount-=i.length,s=[],c=[],u=0;case 26:if(!(u<a.length)){e.next=34;break}if(l=a[u],f=l.code,"string"==typeof(d=l.account)){e.next=30;break}throw new Pa("Returned account is invalid",Nw);case 30:0!==f&&s.push(d);case 31:u++,e.next=26;break;case 34:for(p=0;p<i.length;p++)h=i[p],s.includes(h)||(c.push(h),this.subscribedPeerStatusCache[h]=void 0);if(this.session.requestPeersOnlineStatus(c).pipe(Wa((function(e){return Pe(Ro(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=Pe(e,(function(e,t){return e=e?Oa.PeerOnlineState.ONLINE:Oa.PeerOnlineState.OFFLINE,v.subscribedPeerStatusCache[t]=e})),v.emit("PeersOnlineStatusChanged",e)})),0===s.length){e.next=38;break}throw new Pa("Subscription failed",Nw);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var e=za(W.mark((function e(t){var n,r,i,o,a;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",kp);case 2:if(void 0!==this.session){e.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new ja("Invalid arguments: peerIds",jj);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(yb(r=t[n])){e.next=11;break}throw new ja(["subscribePeersOnlineStatus peer id %s is invalid",r],jj);case 11:n++,e.next=7;break;case 14:if(!(512<t.length)){e.next=16;break}throw new Dc("Unsubscribed peers overflows",Ow);case 16:for(i=t&&t.length?Do(t):[],this.session.requestUnsubscribePeersOnlineStatus(i),o=0;o<i.length;o++)a=i[o],delete this.subscribedPeerStatusCache[a];case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var e=za(W.mark((function e(t){return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===Ea.CONNECTED){e.next=2;break}throw new ia("The client is not logged in",kp);case 2:if(t!==Oa.PeerSubscriptionOption.ONLINE_STATUS){e.next=4;break}return e.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new ja("Subscription option not supported",jj);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createMessage",value:function(e){return e}},{key:"loginImpl",value:function(){var e=za(W.mark((function e(t){var n,r,i,o,a,s,c,u,l=this;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uid,r=t.instanceId,i=t.forceLoginTime,o=void 0===i?0:i,a=r,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){e.next=4;break}throw new Fc(["The frequency of login exceeded the limit of %d queries per second",2],HI);case 4:if(this.connectionState===Ea.DISCONNECTED||0!==o){e.next=6;break}throw new ia("The SDK is either logging in or has logged in the Agora RTM system",FI);case 6:e.prev=6,this.context.uid=n,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(6),new ja(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],al);case 13:return 0===o&&this.onConnectionStateChanged(Ea.CONNECTING,Jc.LOGIN),(s=new Gx(this.context,this.logger,!1)).blacklistedIP=this.blacklistedIP,this.session=c=new Pq(this.context,s,a,this.logger),u=function(){l.connectionState===Ea.CONNECTED&&(l.onConnectionStateChanged(Ea.RECONNECTING,Jc.INTERRUPTED),l.session)&&l.session.once("userJoined",(function(){l.onConnectionStateChanged(Ea.CONNECTED,Jc.LOGIN_SUCCESS)}))},c.on("connectionLost",u),c.on("tokenExpired",(function(){l.emit("TokenExpired")})),c.on("tokenPrivilegeWillExpire",this.TokenPrivilegeWillExpireHandler),c.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(function(e){l.emit("MessageFromPeer",{text:e.text,messageType:Oa.MessageType.TEXT},e.peerId,e.properties)})),this.session.on("peerRawMessage",(function(e){l.emit("MessageFromPeer",{rawMessage:e.raw,description:e.desc,messageType:Oa.MessageType.RAW},e.peerId,e.properties)})),c.on("instanceChanged",(function(e){return a=e})),c.on("peerOnlineStatusChanged",(function(e){var t=e.instance.toString()+e.state,n=l.peerStatusSeqLru.get(t);!n||e.seq.greaterThan(n)?(l.peerStatusSeqLru.set(t,e.seq),e.state!==l.subscribedPeerStatusCache[e.peerId]&&l.emit("PeersOnlineStatusChanged",E({},e.peerId,e.state)),l.subscribedPeerStatusCache[e.peerId]=e.state,clearTimeout(l.peerUnreachableTimers[t]),e.state===Oa.PeerOnlineState.UNREACHABLE&&(l.peerUnreachableTimers[t]=setTimeout((function(){l.subscribedPeerStatusCache[e.peerId]===Oa.PeerOnlineState.UNREACHABLE&&(l.subscribedPeerStatusCache[e.peerId]=Oa.PeerOnlineState.ONLINE,l.emit("PeersOnlineStatusChanged",E({},e.peerId,Oa.PeerOnlineState.ONLINE)))}),3e4))):l.log("peerOnlineStatusChanged dedup for %s, %d",t,e.seq.toNumber())})),c.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),c.on("channelAttributesUpdated",(function(e){var t=e.channelId;e=e.attributeMaps;for(var n={},r=0;r<e.length;r++){var i=e[r],o=i.key,a=i.ms,s=i.value;if(i=i.origin,"string"!=typeof o||!D.isLong(a)||"string"!=typeof s||!yb(i))break;n[o]=new Blob([s]).size}l.channelAttributesCacheLru.set(t,n)})),c.on("userJoined",(function(e){if(0!==Object.keys(l.attributes).length){if(void 0===l.session)return;l.session.requestSetLocalUserAttributes(l.attributes,e).toPromise()}if(0!==l.attributeDrafts.size)for(var t=function(t,n){var r=(t=n[t]).attribute;t.promise.then((function(){void 0!==l.session&&l.session.requestSetLocalUserAttributes(r,e).toPromise()}))},n=0,r=Array.from(l.attributeDrafts);n<r.length;n++)t(n,r);0!==Object.keys(l.subscribedPeerStatusCache).length&&c.requestSubscribePeersOnlineStatus(Object.keys(l.subscribedPeerStatusCache))})),c.on("banEdgeIP",(function(e){l.banIP(e)})),c.on("userMetaDataUpdated",this.userMetaDataUpdatedHandler),this.lastLoginTime=Date.now(),e.prev=33,e.next=36,c.loginHandler().toPromise();case 36:e.next=54;break;case 38:if(e.prev=38,e.t1=e.catch(33),!("loginRespTimeout"===e.t1.name&&2>o)){e.next=47;break}return c.removeAllListeners(),e.next=44,this.loginImpl({uid:n,instanceId:r,forceLoginTime:o+1});case 44:return e.abrupt("return");case 47:if(!uc(e.t1)){e.next=50;break}throw this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGIN_TIMEOUT),new Pc(vg(this.name,"login",12e3),GI);case 50:if(this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGIN_FAILURE),!Sa(e.t1)){e.next=53;break}throw e.t1;case 53:throw new Pa("Login failure",{code:Ew,originalError:e.t1});case 54:this.onConnectionStateChanged(Ea.CONNECTED,Jc.LOGIN_SUCCESS);case 55:case"end":return e.stop()}}),e,this,[[6,10],[33,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"rennectSubscribeduserMetadata",value:function(){var e=za(W.mark((function e(t){var n,r;return W.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=10;break}if(r=t[n],!this.session){e.next=7;break}return e.next=6,this.session.requestSubscribeUserMetadata(r,"RECONNECTED").toPromise();case 6:this.subscribedUserMetaCache[r]=Oa.subscribedState.SUBSCRIBED;case 7:n++,e.next=1;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(e,t){var n,r,i,o=this;e===Ea.RECONNECTING&&(this.reconnId+=1),$a("ConnectionStateChange",{elapse:Nb(this.session&&this.session.startTime),lts:D.fromNumber(Date.now()),newState:FA[e],oldState:FA[this.connectionState],reason:JP[t],sid:fc(this.session&&this.session.instanceId||D.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),this.connectionState===Ea.RECONNECTING&&e===Ea.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(Wa((function(e){return Pe(Ro(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=Pe(e,(function(e,t){return e=e?Oa.PeerOnlineState.ONLINE:Oa.PeerOnlineState.OFFLINE,o.subscribedPeerStatusCache[t]=e})),o.emit("PeersOnlineStatusChanged",e)})),0!==Object.keys(this.subscribedUserMetaCache).length&&void 0!==this.session&&this.rennectSubscribeduserMetadata(Object.keys(this.subscribedUserMetaCache)),null!==(r=this.session)&&void 0!==r&&r.usedChannelIds&&0<(null===(i=this.session)||void 0===i?void 0:i.usedChannelIds.length)&&this.session.usedChannelIds.map((function(e){var t;return null===(t=o.session)||void 0===t?void 0:t.requestSubscribeChannelMetadata(e,"RECONNECTED")})),this.internalEmitter.emit("RECONNECTED")),this.connectionState=e,e!==Ea.ABORTED&&e!==Ea.DISCONNECTED||(this.pendingPeerStatusSubCount=this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.subscribedUserMetaCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.emit("ConnectionStateChanged",e,t)}},{key:"banIP",value:function(e){var t;this.log("ip banned",e);var n=null!==(t=this.blacklistedIP[e])&&void 0!==t?t:0;this.blacklistedIP[e]=n+1}}]),t}(Dd()),Na(ka.prototype,"renewToken",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"renewToken"),ka.prototype),Na(ka.prototype,"queryPeersOnlineStatus",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"queryPeersOnlineStatus"),ka.prototype),Na(ka.prototype,"getChannelMemberCount",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getChannelMemberCount"),ka.prototype),Na(ka.prototype,"setLocalUserAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"setLocalUserAttributes"),ka.prototype),Na(ka.prototype,"setChannelAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"setChannelAttributes"),ka.prototype),Na(ka.prototype,"addOrUpdateLocalUserAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"addOrUpdateLocalUserAttributes"),ka.prototype),Na(ka.prototype,"addOrUpdateChannelAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"addOrUpdateChannelAttributes"),ka.prototype),Na(ka.prototype,"deleteLocalUserAttributesByKeys",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"deleteLocalUserAttributesByKeys"),ka.prototype),Na(ka.prototype,"deleteChannelAttributesByKeys",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"deleteChannelAttributesByKeys"),ka.prototype),Na(ka.prototype,"clearLocalUserAttributes",[je],Object.getOwnPropertyDescriptor(ka.prototype,"clearLocalUserAttributes"),ka.prototype),Na(ka.prototype,"clearChannelAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"clearChannelAttributes"),ka.prototype),Na(ka.prototype,"getUserAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getUserAttributes"),ka.prototype),Na(ka.prototype,"getChannelAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getChannelAttributes"),ka.prototype),Na(ka.prototype,"getChannelAttributesByKeys",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getChannelAttributesByKeys"),ka.prototype),Na(ka.prototype,"getUserAttributesByKeys",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getUserAttributesByKeys"),ka.prototype),Na(ka.prototype,"getUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getUserMetadata"),ka.prototype),Na(ka.prototype,"setLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"setLocalUserMetadata"),ka.prototype),Na(ka.prototype,"clearLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"clearLocalUserMetadata"),ka.prototype),Na(ka.prototype,"addLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"addLocalUserMetadata"),ka.prototype),Na(ka.prototype,"updateLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"updateLocalUserMetadata"),ka.prototype),Na(ka.prototype,"deleteLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"deleteLocalUserMetadata"),ka.prototype),Na(ka.prototype,"subscribeUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"subscribeUserMetadata"),ka.prototype),Na(ka.prototype,"login",[je],Object.getOwnPropertyDescriptor(ka.prototype,"login"),ka.prototype),Na(ka.prototype,"logout",[je],Object.getOwnPropertyDescriptor(ka.prototype,"logout"),ka.prototype),Na(ka.prototype,"logoutSync",[je],Object.getOwnPropertyDescriptor(ka.prototype,"logoutSync"),ka.prototype),Na(ka.prototype,"sendMessageToPeer",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"sendMessageToPeer"),ka.prototype),Na(ka.prototype,"createChannel",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"createChannel"),ka.prototype),Na(ka.prototype,"createMetadataItem",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"createMetadataItem"),ka.prototype),Na(ka.prototype,"createLocalInvitation",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"createLocalInvitation"),ka.prototype),Na(ka.prototype,"subscribePeersOnlineStatus",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"subscribePeersOnlineStatus"),ka.prototype),Na(ka.prototype,"unsubscribePeersOnlineStatus",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"unsubscribePeersOnlineStatus"),ka.prototype),Na(ka.prototype,"queryPeersBySubscriptionOption",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"queryPeersBySubscriptionOption"),ka.prototype),Na(ka.prototype,"createMessage",[je],Object.getOwnPropertyDescriptor(ka.prototype,"createMessage"),ka.prototype),ka),Uq,Vq,Wq,Xq,GA=null===(Uq=/Chrome\/([0-9.]+)/.exec(null===(Wq=window)||void 0===Wq||null===(Xq=Wq.navigator)||void 0===Xq?void 0:Xq.userAgent))||void 0===Uq||null===(Vq=Uq[1])||void 0===Vq?void 0:Vq.split(".")[0];if(GA&&88<=parseInt(GA,10)&&!Kg()){var Yq,Hg=document.createElement("video"),Ig=document.createElement("canvas");Hg.setAttribute("style","display:none"),Hg.setAttribute("muted",""),Hg.muted=!0,Hg.setAttribute("autoplay",""),Hg.autoplay=!0,Hg.setAttribute("playsinline",""),Ig.setAttribute("style","display:none"),Ig.setAttribute("width","2"),Ig.setAttribute("height","2"),null===(Yq=Ig.getContext("2d"))||void 0===Yq||Yq.fillRect(0,0,1,1),Hg.srcObject=null==Ig?void 0:Ig.captureStream()}var HA={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},IA={enableLogUpload:!1,logFilter:HA.LOG_FILTER_INFO,enableCloudProxy:!1},wg=tb(tb({createInstance:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new ja(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],sw);var r=Object.keys(t).filter((function(e){return!(e in IA)}));if(0!==r.length)throw new ja("Invalid RTM config: ".concat(r.join(", ")),sw);var i=tb(tb({},IA),t);if(void 0!==n&&(!Array.isArray(n)||0===n.length))throw new ja("Invalid area config");if(null!=n){if(!n.every((function(e){return e in Oa.LegacyAreaCode})))throw new ja("Invalid area codes: ".concat(n.filter((function(e){return!(e in Oa)})).join(", ")));Ba=eh(n.map((function(e){return SK[e]})))}n=qp=qb.__global_unique_id__=(qb.__global_unique_id__||0)+1;var o=WK(i);r=XK(i);var a=YK(i),s=ZK(n,i),c=zx(n,i),u=c("RTM:DEBUG","<Entry> ");return sx.rtmConfig=i,o("The Agora RTM Web SDK version is %s","1.6.0-205"),t.enableCloudProxy&&o("RTM cloud proxy enabled"),t.enableLogUpload&&o("Log upload enabled"),Ba&&u("Area is set to %s",Array.from(Ba.CODES).map((function(e){return vi(oa).find((function(t){return oa[t]===e}))})).join(", ")),u("Creating an RtmClient instance"),u('The Git commit ID is "'.concat("v1.5.1-67-g0f6d3600",'"')),u("The App ID is %s",ws(e,4,10,"*".repeat(6))),o("The process ID is %s",hj),u("The build is %s","v1.5.1-67-g0f6d3600"),u("NODE_ENV is %s","production"),new KP(e,{genLogger:c,genTracker:s,info:o,warn:r,logError:a,loggerId:n},i,(function(e){for(var t=0,n=vi(e);t<n.length;t++){var r=n[t];try{var a=e[r];null!=a&&(e.enableCloudProxy&&o("RTM cloud proxy enabled"),e.enableLogUpload&&o("Log upload enabled"),i[r]=a)}catch(e){throw new ja(["The %s in the arguments is invalid",r],void 0)}}}))},BUILD:"v1.5.1-67-g0f6d3600",VERSION:"1.6.0-205",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:hj,ConnectionChangeReason:Oa.ConnectionChangeReason,ConnectionState:Oa.ConnectionState,LocalInvitationFailureReason:Oa.LocalInvitationFailureReason,LocalInvitationState:Oa.LocalInvitationState,RemoteInvitationFailureReason:Oa.RemoteInvitationFailureReason,RemoteInvitationState:Oa.RemoteInvitationState,MessageType:Oa.MessageType,PeerOnlineState:Oa.PeerOnlineState,PeerSubscriptionOption:Oa.PeerSubscriptionOption},HA),{},{setParameter:function(e,t){Object.keys(Yd).includes(e)&&(Yd[e]=t)},getParameter:function(e){return Yd[e]},setArea:function(e){var t=e.areaCodes;if(e=e.excludedArea,!Array.isArray(t)||0===t.length||!t.every((function(e){return e in Oa.AreaCode})))throw new ja("Invalid area config");if(void 0!==e&&e===Oa.AreaCode.GLOBAL)throw new ja("Excluded area cannot be global");if(void 0===e)Ba=eh(t.map((function(e){return oa[e]})));else{if(t.includes(e))throw new ja("Excluded area cannot be in areaCodes");if(!(e in oa))throw new ja("Invalid excludedArea:",e);Ba=tC({areas:t.map((function(e){return oa[e]})),excludedArea:oa[e]})}}});return wg},module.exports=t()},4802:function(e,t,n){var r,i,o;i=[],void 0===(o="function"===typeof(r=function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function r(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){c(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,s=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,t,n){var s=a.URL||a.webkitURL,c=document.createElement("a");t=t||e.name||"download",c.download=t,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?o(c):i(c.href)?r(e,t,n):o(c,c.target="_blank")):(c.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(c.href)}),4e4),setTimeout((function(){o(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,a){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),n);else if(i(e))r(e,n,a);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){o(s)}))}}:function(e,t,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return r(e,t,n);var o="application/octet-stream"===e.type,c=/constructor/i.test(a.HTMLElement)||a.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||o&&c||s)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},l.readAsDataURL(e)}else{var f=a.URL||a.webkitURL,d=f.createObjectURL(e);i?i.location=d:location.href=d,i=null,setTimeout((function(){f.revokeObjectURL(d)}),4e4)}});a.saveAs=c.saveAs=c,e.exports=c})?r.apply(t,i):r)||(e.exports=o)},8617:function(e,t,n){"use strict";n.d(t,{yFZ:function(){return i}});var r=n(9983);function i(e){return(0,r.w_)({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"}}]})(e)}},9983:function(e,t,n){"use strict";n.d(t,{w_:function(){return u}});var r=n(2791),i={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},o=r.createContext&&r.createContext(i),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)},s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function c(e){return e&&e.map((function(e,t){return r.createElement(e.tag,a({key:t},e.attr),c(e.child))}))}function u(e){return function(t){return r.createElement(l,a({attr:a({},e.attr)},t),c(e.child))}}function l(e){var t=function(t){var n,i=e.attr,o=e.size,c=e.title,u=s(e,["attr","size","title"]),l=o||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),r.createElement("svg",a({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,u,{className:n,style:a(a({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),c&&r.createElement("title",null,c),e.children)};return void 0!==o?r.createElement(o.Consumer,null,(function(e){return t(e)})):t(i)}},3897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},5372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},3405:function(e,t,n){var r=n(3897);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},6115:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},7156:function(e){function t(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,c,"next",e)}function c(e){t(a,i,o,s,c,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},6690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},3515:function(e,t,n){var r=n(6015),i=n(9617);function o(t,n,a){return i()?(e.exports=o=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=o=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o},e.exports.__esModule=!0,e.exports.default=e.exports),o.apply(null,arguments)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},9728:function(e,t,n){var r=n(4062);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},4704:function(e,t,n){var r=n(6116);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}},e.exports.__esModule=!0,e.exports.default=e.exports},6389:function(e,t,n){var r=n(3808),i=n(9617),o=n(4993);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},8416:function(e,t,n){var r=n(4062);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},1588:function(e,t,n){var r=n(1753);function i(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3808:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},1655:function(e,t,n){var r=n(6015);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},6035:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},9617:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},9498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},8872:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(l){u=!0,i=l}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},2218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},2281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},4993:function(e,t,n){var r=n(8698).default,i=n(6115);e.exports=function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},7061:function(e,t,n){var r=n(8698).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(N){f=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),s=new A(r||[]);return a(o,"_invoke",{value:w(e,n,s)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(N){return{type:"throw",arg:N}}}t.wrap=d;var h={};function v(){}function m(){}function g(){}var E={};f(E,c,(function(){return this}));var _=Object.getPrototypeOf,b=_&&_(_(k([])));b&&b!==n&&o.call(b,c)&&(E=b);var y=g.prototype=v.prototype=Object.create(E);function T(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,a,s,c){var u=p(e[i],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return C()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=R(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function R(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function k(e){if(e){var t=e[c];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:C}}function C(){return{value:void 0,done:!0}}return m.prototype=g,a(y,"constructor",{value:g,configurable:!0}),a(g,"constructor",{value:m,configurable:!0}),m.displayName=f(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,f(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},t.awrap=function(e){return{__await:e}},T(S.prototype),f(S.prototype,u,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new S(d(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(y),f(y,l,"Generator"),f(y,c,(function(){return this})),f(y,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=k,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},6015:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},7424:function(e,t,n){var r=n(5372),i=n(8872),o=n(6116),a=n(2218);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},1753:function(e,t,n){var r=n(3808);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,n){var r=n(3405),i=n(9498),o=n(6116),a=n(2281);e.exports=function(e){return r(e)||i(e)||o(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},5036:function(e,t,n){var r=n(8698).default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},4062:function(e,t,n){var r=n(8698).default,i=n(5036);e.exports=function(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},8698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},6116:function(e,t,n){var r=n(3897);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},3496:function(e,t,n){var r=n(3808),i=n(6015),o=n(6035),a=n(3515);function s(t){var n="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},2893:function(e,t,n){"use strict";n.d(t,{U:function(){return s}});var r=n(1413),i=n(5232),o=n(7872),a=n(184),s=(0,o.G)((function(e,t){return(0,a.jsx)(i.K,(0,r.Z)((0,r.Z)({align:"center"},e),{},{direction:"row",ref:t}))}));s.displayName="HStack"},4045:function(e,t,n){"use strict";n.d(t,{P6:function(){return Us},cW:function(){return Rs}});var r={version:"0.18.5"},i=1200,o=1252,a=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],s={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},c=function(e){-1!=a.indexOf(e)&&(o=s[0]=e)};var u=function(e){i=e,c(e)};function l(){u(1200),c(1252)}function f(e){for(var t=[],n=0;n<e.length>>1;++n)t[n]=String.fromCharCode(e.charCodeAt(2*n+1)+(e.charCodeAt(2*n)<<8));return t.join("")}var d,p=function(e){return String.fromCharCode(e)},h=function(e){return String.fromCharCode(e)};var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function m(e){for(var t="",n=0,r=0,i=0,o=0,a=0,s=0,c=0,u=0;u<e.length;)o=(n=e.charCodeAt(u++))>>2,a=(3&n)<<4|(r=e.charCodeAt(u++))>>4,s=(15&r)<<2|(i=e.charCodeAt(u++))>>6,c=63&i,isNaN(r)?s=c=64:isNaN(i)&&(c=64),t+=v.charAt(o)+v.charAt(a)+v.charAt(s)+v.charAt(c);return t}function g(e){var t="",n=0,r=0,i=0,o=0,a=0,s=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var c=0;c<e.length;)n=v.indexOf(e.charAt(c++))<<2|(o=v.indexOf(e.charAt(c++)))>>4,t+=String.fromCharCode(n),r=(15&o)<<4|(a=v.indexOf(e.charAt(c++)))>>2,64!==a&&(t+=String.fromCharCode(r)),i=(3&a)<<6|(s=v.indexOf(e.charAt(c++))),64!==s&&(t+=String.fromCharCode(i));return t}var E=function(){return"undefined"!==typeof Buffer&&"undefined"!==typeof process&&"undefined"!==typeof process.versions&&!!process.versions.node}(),_=function(){if("undefined"!==typeof Buffer){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch(t){e=!0}return e?function(e,t){return t?new Buffer(e,t):new Buffer(e)}:Buffer.from.bind(Buffer)}return function(){}}();function b(e){return E?Buffer.alloc?Buffer.alloc(e):new Buffer(e):"undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)}function y(e){return E?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):"undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)}var T=function(e){return E?_(e,"binary"):e.split("").map((function(e){return 255&e.charCodeAt(0)}))};function S(e){if("undefined"===typeof ArrayBuffer)return T(e);for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r!=e.length;++r)n[r]=255&e.charCodeAt(r);return t}function w(e){if(Array.isArray(e))return e.map((function(e){return String.fromCharCode(e)})).join("");for(var t=[],n=0;n<e.length;++n)t[n]=String.fromCharCode(e[n]);return t.join("")}var R=E?function(e){return Buffer.concat(e.map((function(e){return Buffer.isBuffer(e)?e:_(e)})))}:function(e){if("undefined"!==typeof Uint8Array){var t=0,n=0;for(t=0;t<e.length;++t)n+=e[t].length;var r=new Uint8Array(n),i=0;for(t=0,n=0;t<e.length;n+=i,++t)if(i=e[t].length,e[t]instanceof Uint8Array)r.set(e[t],n);else{if("string"==typeof e[t])throw"wtf";r.set(new Uint8Array(e[t]),n)}return r}return[].concat.apply([],e.map((function(e){return Array.isArray(e)?e:[].slice.call(e)})))};var O=/\u0000/g,I=/[\u0001-\u0006]/g;function A(e){for(var t="",n=e.length-1;n>=0;)t+=e.charAt(n--);return t}function k(e,t){var n=""+e;return n.length>=t?n:Ge("0",t-n.length)+n}function C(e,t){var n=""+e;return n.length>=t?n:Ge(" ",t-n.length)+n}function N(e,t){var n=""+e;return n.length>=t?n:n+Ge(" ",t-n.length)}var x=Math.pow(2,32);function D(e,t){return e>x||e<-x?function(e,t){var n=""+Math.round(e);return n.length>=t?n:Ge("0",t-n.length)+n}(e,t):function(e,t){var n=""+e;return n.length>=t?n:Ge("0",t-n.length)+n}(Math.round(e),t)}function P(e,t){return t=t||0,e.length>=7+t&&103===(32|e.charCodeAt(t))&&101===(32|e.charCodeAt(t+1))&&110===(32|e.charCodeAt(t+2))&&101===(32|e.charCodeAt(t+3))&&114===(32|e.charCodeAt(t+4))&&97===(32|e.charCodeAt(t+5))&&108===(32|e.charCodeAt(t+6))}var L=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],M=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];var U={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "'},j={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},F={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function B(e,t,n){for(var r=e<0?-1:1,i=e*r,o=0,a=1,s=0,c=1,u=0,l=0,f=Math.floor(i);u<t&&(s=(f=Math.floor(i))*a+o,l=f*u+c,!(i-f<5e-8));)i=1/(i-f),o=a,a=s,c=u,u=l;if(l>t&&(u>t?(l=c,s=o):(l=u,s=a)),!n)return[0,r*s,l];var d=Math.floor(r*s/l);return[d,r*s-d*l,l]}function V(e,t,n){if(e>2958465||e<0)return null;var r=0|e,i=Math.floor(86400*(e-r)),o=0,a=[],s={D:r,T:i,u:86400*(e-r)-i,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(s.u)<1e-6&&(s.u=0),t&&t.date1904&&(r+=1462),s.u>.9999&&(s.u=0,86400==++i&&(s.T=i=0,++r,++s.D)),60===r)a=n?[1317,10,29]:[1900,2,29],o=3;else if(0===r)a=n?[1317,8,29]:[1900,1,0],o=6;else{r>60&&--r;var c=new Date(1900,0,1);c.setDate(c.getDate()+r-1),a=[c.getFullYear(),c.getMonth()+1,c.getDate()],o=c.getDay(),r<60&&(o=(o+6)%7),n&&(o=function(e,t){t[0]-=581;var n=e.getDay();e<60&&(n=(n+6)%7);return n}(c,a))}return s.y=a[0],s.m=a[1],s.d=a[2],s.S=i%60,i=Math.floor(i/60),s.M=i%60,i=Math.floor(i/60),s.H=i,s.q=o,s}var G=new Date(1899,11,31,0,0,0),W=G.getTime(),q=new Date(1900,2,1,0,0,0);function H(e,t){var n=e.getTime();return t?n-=1262304e5:e>=q&&(n+=864e5),(n-(W+6e4*(e.getTimezoneOffset()-G.getTimezoneOffset())))/864e5}function K(e){return-1==e.indexOf(".")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function z(e){var t,n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E);return t=n>=-4&&n<=-1?e.toPrecision(10+n):Math.abs(n)<=9?function(e){var t=e<0?12:11,n=K(e.toFixed(12));return n.length<=t||(n=e.toPrecision(10)).length<=t?n:e.toExponential(5)}(e):10===n?e.toFixed(10).substr(0,12):function(e){var t=K(e.toFixed(11));return t.length>(e<0?12:11)||"0"===t||"-0"===t?e.toPrecision(6):t}(e),K(function(e){return-1==e.indexOf("E")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}(t.toUpperCase()))}function Y(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(0|e)===e?e.toString(10):z(e);case"undefined":return"";case"object":if(null==e)return"";if(e instanceof Date)return me(14,H(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function J(e,t,n,r){var i,o="",a=0,s=0,c=n.y,u=0;switch(e){case 98:c=n.y+543;case 121:switch(t.length){case 1:case 2:i=c%100,u=2;break;default:i=c%1e4,u=4}break;case 109:switch(t.length){case 1:case 2:i=n.m,u=t.length;break;case 3:return M[n.m-1][1];case 5:return M[n.m-1][0];default:return M[n.m-1][2]}break;case 100:switch(t.length){case 1:case 2:i=n.d,u=t.length;break;case 3:return L[n.q][0];default:return L[n.q][1]}break;case 104:switch(t.length){case 1:case 2:i=1+(n.H+11)%12,u=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:i=n.H,u=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:i=n.M,u=t.length;break;default:throw"bad minute format: "+t}break;case 115:if("s"!=t&&"ss"!=t&&".0"!=t&&".00"!=t&&".000"!=t)throw"bad second format: "+t;return 0!==n.u||"s"!=t&&"ss"!=t?(s=r>=2?3===r?1e3:100:1===r?10:1,(a=Math.round(s*(n.S+n.u)))>=60*s&&(a=0),"s"===t?0===a?"0":""+a/s:(o=k(a,2+r),"ss"===t?o.substr(0,2):"."+o.substr(2,t.length-1))):k(n.S,t.length);case 90:switch(t){case"[h]":case"[hh]":i=24*n.D+n.H;break;case"[m]":case"[mm]":i=60*(24*n.D+n.H)+n.M;break;case"[s]":case"[ss]":i=60*(60*(24*n.D+n.H)+n.M)+Math.round(n.S+n.u);break;default:throw"bad abstime format: "+t}u=3===t.length?1:2;break;case 101:i=c,u=1}return u>0?k(i,u):""}function X(e){if(e.length<=3)return e;for(var t=e.length%3,n=e.substr(0,t);t!=e.length;t+=3)n+=(n.length>0?",":"")+e.substr(t,3);return n}var Q=/%/g;function Z(e,t){var n,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==t)return"0.0E+0";if(t<0)return"-"+Z(e,-t);var i=e.indexOf(".");-1===i&&(i=e.indexOf("E"));var o=Math.floor(Math.log(t)*Math.LOG10E)%i;if(o<0&&(o+=i),-1===(n=(t/Math.pow(10,o)).toPrecision(r+1+(i+o)%i)).indexOf("e")){var a=Math.floor(Math.log(t)*Math.LOG10E);for(-1===n.indexOf(".")?n=n.charAt(0)+"."+n.substr(1)+"E+"+(a-n.length+o):n+="E+"+(a-o);"0."===n.substr(0,2);)n=(n=n.charAt(0)+n.substr(2,i)+"."+n.substr(2+i)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");n=n.replace(/\+-/,"-")}n=n.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(e,t,n,r){return t+n+r.substr(0,(i+o)%i)+"."+r.substr(o)+"E"}))}else n=t.toExponential(r);return e.match(/E\+00$/)&&n.match(/e[+-]\d$/)&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),e.match(/E\-/)&&n.match(/e\+/)&&(n=n.replace(/e\+/,"e")),n.replace("e","E")}var ee=/# (\?+)( ?)\/( ?)(\d+)/;var te=/^#*0*\.([0#]+)/,ne=/\).*[0#]/,re=/\(###\) ###\\?-####/;function ie(e){for(var t,n="",r=0;r!=e.length;++r)switch(t=e.charCodeAt(r)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(t)}return n}function oe(e,t){var n=Math.pow(10,t);return""+Math.round(e*n)/n}function ae(e,t){var n=e-Math.floor(e),r=Math.pow(10,t);return t<(""+Math.round(n*r)).length?0:Math.round(n*r)}function se(e,t,n){if(40===e.charCodeAt(0)&&!t.match(ne)){var r=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return n>=0?se("n",r,n):"("+se("n",r,-n)+")"}if(44===t.charCodeAt(t.length-1))return function(e,t,n){for(var r=t.length-1;44===t.charCodeAt(r-1);)--r;return le(e,t.substr(0,r),n/Math.pow(10,3*(t.length-r)))}(e,t,n);if(-1!==t.indexOf("%"))return function(e,t,n){var r=t.replace(Q,""),i=t.length-r.length;return le(e,r,n*Math.pow(10,2*i))+Ge("%",i)}(e,t,n);if(-1!==t.indexOf("E"))return Z(t,n);if(36===t.charCodeAt(0))return"$"+se(e,t.substr(" "==t.charAt(1)?2:1),n);var i,o,a,s,c=Math.abs(n),u=n<0?"-":"";if(t.match(/^00+$/))return u+D(c,t.length);if(t.match(/^[#?]+$/))return"0"===(i=D(n,0))&&(i=""),i.length>t.length?i:ie(t.substr(0,t.length-i.length))+i;if(o=t.match(ee))return function(e,t,n){var r=parseInt(e[4],10),i=Math.round(t*r),o=Math.floor(i/r),a=i-o*r,s=r;return n+(0===o?"":""+o)+" "+(0===a?Ge(" ",e[1].length+1+e[4].length):C(a,e[1].length)+e[2]+"/"+e[3]+k(s,e[4].length))}(o,c,u);if(t.match(/^#+0+$/))return u+D(c,t.length-t.indexOf("0"));if(o=t.match(te))return i=oe(n,o[1].length).replace(/^([^\.]+)$/,"$1."+ie(o[1])).replace(/\.$/,"."+ie(o[1])).replace(/\.(\d*)$/,(function(e,t){return"."+t+Ge("0",ie(o[1]).length-t.length)})),-1!==t.indexOf("0.")?i:i.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),o=t.match(/^(0*)\.(#*)$/))return u+oe(c,o[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,o[1].length?"0.":".");if(o=t.match(/^#{1,3},##0(\.?)$/))return u+X(D(c,0));if(o=t.match(/^#,##0\.([#0]*0)$/))return n<0?"-"+se(e,t,-n):X(""+(Math.floor(n)+function(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}(n,o[1].length)))+"."+k(ae(n,o[1].length),o[1].length);if(o=t.match(/^#,#*,#0/))return se(e,t.replace(/^#,#*,/,""),n);if(o=t.match(/^([0#]+)(\\?-([0#]+))+$/))return i=A(se(e,t.replace(/[\\-]/g,""),n)),a=0,A(A(t.replace(/\\/g,"")).replace(/[0#]/g,(function(e){return a<i.length?i.charAt(a++):"0"===e?"0":""})));if(t.match(re))return"("+(i=se(e,"##########",n)).substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var l="";if(o=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return a=Math.min(o[4].length,7),s=B(c,Math.pow(10,a)-1,!1),i=""+u," "==(l=le("n",o[1],s[1])).charAt(l.length-1)&&(l=l.substr(0,l.length-1)+"0"),i+=l+o[2]+"/"+o[3],(l=N(s[2],a)).length<o[4].length&&(l=ie(o[4].substr(o[4].length-l.length))+l),i+=l;if(o=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return a=Math.min(Math.max(o[1].length,o[4].length),7),u+((s=B(c,Math.pow(10,a)-1,!0))[0]||(s[1]?"":"0"))+" "+(s[1]?C(s[1],a)+o[2]+"/"+o[3]+N(s[2],a):Ge(" ",2*a+1+o[2].length+o[3].length));if(o=t.match(/^[#0?]+$/))return i=D(n,0),t.length<=i.length?i:ie(t.substr(0,t.length-i.length))+i;if(o=t.match(/^([#0?]+)\.([#0]+)$/)){i=""+n.toFixed(Math.min(o[2].length,10)).replace(/([^0])0+$/,"$1"),a=i.indexOf(".");var f=t.indexOf(".")-a,d=t.length-i.length-f;return ie(t.substr(0,f)+i+t.substr(t.length-d))}if(o=t.match(/^00,000\.([#0]*0)$/))return a=ae(n,o[1].length),n<0?"-"+se(e,t,-n):X(function(e){return e<2147483647&&e>-2147483648?""+(e>=0?0|e:e-1|0):""+Math.floor(e)}(n)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(e){return"00,"+(e.length<3?k(0,3-e.length):"")+e}))+"."+k(a,o[1].length);switch(t){case"###,##0.00":return se(e,"#,##0.00",n);case"###,###":case"##,###":case"#,###":var p=X(D(c,0));return"0"!==p?u+p:"";case"###,###.00":return se(e,"###,##0.00",n).replace(/^0\./,".");case"#,###.00":return se(e,"#,##0.00",n).replace(/^0\./,".")}throw new Error("unsupported format |"+t+"|")}function ce(e,t){var n,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==t)return"0.0E+0";if(t<0)return"-"+ce(e,-t);var i=e.indexOf(".");-1===i&&(i=e.indexOf("E"));var o=Math.floor(Math.log(t)*Math.LOG10E)%i;if(o<0&&(o+=i),!(n=(t/Math.pow(10,o)).toPrecision(r+1+(i+o)%i)).match(/[Ee]/)){var a=Math.floor(Math.log(t)*Math.LOG10E);-1===n.indexOf(".")?n=n.charAt(0)+"."+n.substr(1)+"E+"+(a-n.length+o):n+="E+"+(a-o),n=n.replace(/\+-/,"-")}n=n.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(e,t,n,r){return t+n+r.substr(0,(i+o)%i)+"."+r.substr(o)+"E"}))}else n=t.toExponential(r);return e.match(/E\+00$/)&&n.match(/e[+-]\d$/)&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),e.match(/E\-/)&&n.match(/e\+/)&&(n=n.replace(/e\+/,"e")),n.replace("e","E")}function ue(e,t,n){if(40===e.charCodeAt(0)&&!t.match(ne)){var r=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return n>=0?ue("n",r,n):"("+ue("n",r,-n)+")"}if(44===t.charCodeAt(t.length-1))return function(e,t,n){for(var r=t.length-1;44===t.charCodeAt(r-1);)--r;return le(e,t.substr(0,r),n/Math.pow(10,3*(t.length-r)))}(e,t,n);if(-1!==t.indexOf("%"))return function(e,t,n){var r=t.replace(Q,""),i=t.length-r.length;return le(e,r,n*Math.pow(10,2*i))+Ge("%",i)}(e,t,n);if(-1!==t.indexOf("E"))return ce(t,n);if(36===t.charCodeAt(0))return"$"+ue(e,t.substr(" "==t.charAt(1)?2:1),n);var i,o,a,s,c=Math.abs(n),u=n<0?"-":"";if(t.match(/^00+$/))return u+k(c,t.length);if(t.match(/^[#?]+$/))return i=""+n,0===n&&(i=""),i.length>t.length?i:ie(t.substr(0,t.length-i.length))+i;if(o=t.match(ee))return function(e,t,n){return n+(0===t?"":""+t)+Ge(" ",e[1].length+2+e[4].length)}(o,c,u);if(t.match(/^#+0+$/))return u+k(c,t.length-t.indexOf("0"));if(o=t.match(te))return i=(i=(""+n).replace(/^([^\.]+)$/,"$1."+ie(o[1])).replace(/\.$/,"."+ie(o[1]))).replace(/\.(\d*)$/,(function(e,t){return"."+t+Ge("0",ie(o[1]).length-t.length)})),-1!==t.indexOf("0.")?i:i.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),o=t.match(/^(0*)\.(#*)$/))return u+(""+c).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,o[1].length?"0.":".");if(o=t.match(/^#{1,3},##0(\.?)$/))return u+X(""+c);if(o=t.match(/^#,##0\.([#0]*0)$/))return n<0?"-"+ue(e,t,-n):X(""+n)+"."+Ge("0",o[1].length);if(o=t.match(/^#,#*,#0/))return ue(e,t.replace(/^#,#*,/,""),n);if(o=t.match(/^([0#]+)(\\?-([0#]+))+$/))return i=A(ue(e,t.replace(/[\\-]/g,""),n)),a=0,A(A(t.replace(/\\/g,"")).replace(/[0#]/g,(function(e){return a<i.length?i.charAt(a++):"0"===e?"0":""})));if(t.match(re))return"("+(i=ue(e,"##########",n)).substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var l="";if(o=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return a=Math.min(o[4].length,7),s=B(c,Math.pow(10,a)-1,!1),i=""+u," "==(l=le("n",o[1],s[1])).charAt(l.length-1)&&(l=l.substr(0,l.length-1)+"0"),i+=l+o[2]+"/"+o[3],(l=N(s[2],a)).length<o[4].length&&(l=ie(o[4].substr(o[4].length-l.length))+l),i+=l;if(o=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return a=Math.min(Math.max(o[1].length,o[4].length),7),u+((s=B(c,Math.pow(10,a)-1,!0))[0]||(s[1]?"":"0"))+" "+(s[1]?C(s[1],a)+o[2]+"/"+o[3]+N(s[2],a):Ge(" ",2*a+1+o[2].length+o[3].length));if(o=t.match(/^[#0?]+$/))return i=""+n,t.length<=i.length?i:ie(t.substr(0,t.length-i.length))+i;if(o=t.match(/^([#0]+)\.([#0]+)$/)){i=""+n.toFixed(Math.min(o[2].length,10)).replace(/([^0])0+$/,"$1"),a=i.indexOf(".");var f=t.indexOf(".")-a,d=t.length-i.length-f;return ie(t.substr(0,f)+i+t.substr(t.length-d))}if(o=t.match(/^00,000\.([#0]*0)$/))return n<0?"-"+ue(e,t,-n):X(""+n).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(e){return"00,"+(e.length<3?k(0,3-e.length):"")+e}))+"."+k(0,o[1].length);switch(t){case"###,###":case"##,###":case"#,###":var p=X(""+c);return"0"!==p?u+p:"";default:if(t.match(/\.[0#?]*$/))return ue(e,t.slice(0,t.lastIndexOf(".")),n)+ie(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function le(e,t,n){return(0|n)===n?ue(e,t,n):se(e,t,n)}var fe=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function de(e){for(var t=0,n="",r="";t<e.length;)switch(n=e.charAt(t)){case"G":P(e,t)&&(t+=6),t++;break;case'"':for(;34!==e.charCodeAt(++t)&&t<e.length;);++t;break;case"\\":case"_":t+=2;break;case"@":++t;break;case"B":case"b":if("1"===e.charAt(t+1)||"2"===e.charAt(t+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4e0a":if("A/P"===e.substr(t,3).toUpperCase())return!0;if("AM/PM"===e.substr(t,5).toUpperCase())return!0;if("\u4e0a\u5348/\u4e0b\u5348"===e.substr(t,5).toUpperCase())return!0;++t;break;case"[":for(r=n;"]"!==e.charAt(t++)&&t<e.length;)r+=e.charAt(t);if(r.match(fe))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(n=e.charAt(++t))>-1||"\\"==n&&"-"==e.charAt(t+1)&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===n;);break;case"*":++t," "!=e.charAt(t)&&"*"!=e.charAt(t)||++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;default:++t}return!1}var pe=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function he(e,t){if(null==t)return!1;var n=parseFloat(t[2]);switch(t[1]){case"=":if(e==n)return!0;break;case">":if(e>n)return!0;break;case"<":if(e<n)return!0;break;case"<>":if(e!=n)return!0;break;case">=":if(e>=n)return!0;break;case"<=":if(e<=n)return!0}return!1}function ve(e,t){var n=function(e){for(var t=[],n=!1,r=0,i=0;r<e.length;++r)switch(e.charCodeAt(r)){case 34:n=!n;break;case 95:case 42:case 92:++r;break;case 59:t[t.length]=e.substr(i,r-i),i=r+1}if(t[t.length]=e.substr(i),!0===n)throw new Error("Format |"+e+"| unterminated string ");return t}(e),r=n.length,i=n[r-1].indexOf("@");if(r<4&&i>-1&&--r,n.length>4)throw new Error("cannot find right format for |"+n.join("|")+"|");if("number"!==typeof t)return[4,4===n.length||i>-1?n[n.length-1]:"@"];switch(n.length){case 1:n=i>-1?["General","General","General",n[0]]:[n[0],n[0],n[0],"@"];break;case 2:n=i>-1?[n[0],n[0],n[0],n[1]]:[n[0],n[1],n[0],"@"];break;case 3:n=i>-1?[n[0],n[1],n[0],n[2]]:[n[0],n[1],n[2],"@"]}var o=t>0?n[0]:t<0?n[1]:n[2];if(-1===n[0].indexOf("[")&&-1===n[1].indexOf("["))return[r,o];if(null!=n[0].match(/\[[=<>]/)||null!=n[1].match(/\[[=<>]/)){var a=n[0].match(pe),s=n[1].match(pe);return he(t,a)?[r,n[0]]:he(t,s)?[r,n[1]]:[r,n[null!=a&&null!=s?2:1]]}return[r,o]}function me(e,t,n){null==n&&(n={});var r="";switch(typeof e){case"string":r="m/d/yy"==e&&n.dateNF?n.dateNF:e;break;case"number":null==(r=14==e&&n.dateNF?n.dateNF:(null!=n.table?n.table:U)[e])&&(r=n.table&&n.table[j[e]]||U[j[e]]),null==r&&(r=F[e]||"General")}if(P(r,0))return Y(t,n);t instanceof Date&&(t=H(t,n.date1904));var i=ve(r,t);if(P(i[1]))return Y(t,n);if(!0===t)t="TRUE";else if(!1===t)t="FALSE";else if(""===t||null==t)return"";return function(e,t,n,r){for(var i,o,a,s=[],c="",u=0,l="",f="t",d="H";u<e.length;)switch(l=e.charAt(u)){case"G":if(!P(e,u))throw new Error("unrecognized character "+l+" in "+e);s[s.length]={t:"G",v:"General"},u+=7;break;case'"':for(c="";34!==(a=e.charCodeAt(++u))&&u<e.length;)c+=String.fromCharCode(a);s[s.length]={t:"t",v:c},++u;break;case"\\":var p=e.charAt(++u),h="("===p||")"===p?p:"t";s[s.length]={t:h,v:p},++u;break;case"_":s[s.length]={t:"t",v:" "},u+=2;break;case"@":s[s.length]={t:"T",v:t},++u;break;case"B":case"b":if("1"===e.charAt(u+1)||"2"===e.charAt(u+1)){if(null==i&&null==(i=V(t,n,"2"===e.charAt(u+1))))return"";s[s.length]={t:"X",v:e.substr(u,2)},f=l,u+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":l=l.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0)return"";if(null==i&&null==(i=V(t,n)))return"";for(c=l;++u<e.length&&e.charAt(u).toLowerCase()===l;)c+=l;"m"===l&&"h"===f.toLowerCase()&&(l="M"),"h"===l&&(l=d),s[s.length]={t:l,v:c},f=l;break;case"A":case"a":case"\u4e0a":var v={t:l,v:l};if(null==i&&(i=V(t,n)),"A/P"===e.substr(u,3).toUpperCase()?(null!=i&&(v.v=i.H>=12?"P":"A"),v.t="T",d="h",u+=3):"AM/PM"===e.substr(u,5).toUpperCase()?(null!=i&&(v.v=i.H>=12?"PM":"AM"),v.t="T",u+=5,d="h"):"\u4e0a\u5348/\u4e0b\u5348"===e.substr(u,5).toUpperCase()?(null!=i&&(v.v=i.H>=12?"\u4e0b\u5348":"\u4e0a\u5348"),v.t="T",u+=5,d="h"):(v.t="t",++u),null==i&&"T"===v.t)return"";s[s.length]=v,f=l;break;case"[":for(c=l;"]"!==e.charAt(u++)&&u<e.length;)c+=e.charAt(u);if("]"!==c.slice(-1))throw'unterminated "[" block: |'+c+"|";if(c.match(fe)){if(null==i&&null==(i=V(t,n)))return"";s[s.length]={t:"Z",v:c.toLowerCase()},f=c.charAt(1)}else c.indexOf("$")>-1&&(c=(c.match(/\$([^-\[\]]*)/)||[])[1]||"$",de(e)||(s[s.length]={t:"t",v:c}));break;case".":if(null!=i){for(c=l;++u<e.length&&"0"===(l=e.charAt(u));)c+=l;s[s.length]={t:"s",v:c};break}case"0":case"#":for(c=l;++u<e.length&&"0#?.,E+-%".indexOf(l=e.charAt(u))>-1;)c+=l;s[s.length]={t:"n",v:c};break;case"?":for(c=l;e.charAt(++u)===l;)c+=l;s[s.length]={t:l,v:c},f=l;break;case"*":++u," "!=e.charAt(u)&&"*"!=e.charAt(u)||++u;break;case"(":case")":s[s.length]={t:1===r?"t":l,v:l},++u;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(c=l;u<e.length&&"0123456789".indexOf(e.charAt(++u))>-1;)c+=e.charAt(u);s[s.length]={t:"D",v:c};break;case" ":s[s.length]={t:l,v:l},++u;break;case"$":s[s.length]={t:"t",v:"$"},++u;break;default:if(-1===",$-+/():!^&'~{}<>=\u20acacfijklopqrtuvwxzP".indexOf(l))throw new Error("unrecognized character "+l+" in "+e);s[s.length]={t:"t",v:l},++u}var m,g=0,E=0;for(u=s.length-1,f="t";u>=0;--u)switch(s[u].t){case"h":case"H":s[u].t=d,f="h",g<1&&(g=1);break;case"s":(m=s[u].v.match(/\.0+$/))&&(E=Math.max(E,m[0].length-1)),g<3&&(g=3);case"d":case"y":case"M":case"e":f=s[u].t;break;case"m":"s"===f&&(s[u].t="M",g<2&&(g=2));break;case"X":break;case"Z":g<1&&s[u].v.match(/[Hh]/)&&(g=1),g<2&&s[u].v.match(/[Mm]/)&&(g=2),g<3&&s[u].v.match(/[Ss]/)&&(g=3)}switch(g){case 0:break;case 1:i.u>=.5&&(i.u=0,++i.S),i.S>=60&&(i.S=0,++i.M),i.M>=60&&(i.M=0,++i.H);break;case 2:i.u>=.5&&(i.u=0,++i.S),i.S>=60&&(i.S=0,++i.M)}var _,b="";for(u=0;u<s.length;++u)switch(s[u].t){case"t":case"T":case" ":case"D":break;case"X":s[u].v="",s[u].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":s[u].v=J(s[u].t.charCodeAt(0),s[u].v,i,E),s[u].t="t";break;case"n":case"?":for(_=u+1;null!=s[_]&&("?"===(l=s[_].t)||"D"===l||(" "===l||"t"===l)&&null!=s[_+1]&&("?"===s[_+1].t||"t"===s[_+1].t&&"/"===s[_+1].v)||"("===s[u].t&&(" "===l||"n"===l||")"===l)||"t"===l&&("/"===s[_].v||" "===s[_].v&&null!=s[_+1]&&"?"==s[_+1].t));)s[u].v+=s[_].v,s[_]={v:"",t:";"},++_;b+=s[u].v,u=_-1;break;case"G":s[u].t="t",s[u].v=Y(t,n)}var y,T,S="";if(b.length>0){40==b.charCodeAt(0)?(y=t<0&&45===b.charCodeAt(0)?-t:t,T=le("n",b,y)):(T=le("n",b,y=t<0&&r>1?-t:t),y<0&&s[0]&&"t"==s[0].t&&(T=T.substr(1),s[0].v="-"+s[0].v)),_=T.length-1;var w=s.length;for(u=0;u<s.length;++u)if(null!=s[u]&&"t"!=s[u].t&&s[u].v.indexOf(".")>-1){w=u;break}var R=s.length;if(w===s.length&&-1===T.indexOf("E")){for(u=s.length-1;u>=0;--u)null!=s[u]&&-1!=="n?".indexOf(s[u].t)&&(_>=s[u].v.length-1?(_-=s[u].v.length,s[u].v=T.substr(_+1,s[u].v.length)):_<0?s[u].v="":(s[u].v=T.substr(0,_+1),_=-1),s[u].t="t",R=u);_>=0&&R<s.length&&(s[R].v=T.substr(0,_+1)+s[R].v)}else if(w!==s.length&&-1===T.indexOf("E")){for(_=T.indexOf(".")-1,u=w;u>=0;--u)if(null!=s[u]&&-1!=="n?".indexOf(s[u].t)){for(o=s[u].v.indexOf(".")>-1&&u===w?s[u].v.indexOf(".")-1:s[u].v.length-1,S=s[u].v.substr(o+1);o>=0;--o)_>=0&&("0"===s[u].v.charAt(o)||"#"===s[u].v.charAt(o))&&(S=T.charAt(_--)+S);s[u].v=S,s[u].t="t",R=u}for(_>=0&&R<s.length&&(s[R].v=T.substr(0,_+1)+s[R].v),_=T.indexOf(".")+1,u=w;u<s.length;++u)if(null!=s[u]&&(-1!=="n?(".indexOf(s[u].t)||u===w)){for(o=s[u].v.indexOf(".")>-1&&u===w?s[u].v.indexOf(".")+1:0,S=s[u].v.substr(0,o);o<s[u].v.length;++o)_<T.length&&(S+=T.charAt(_++));s[u].v=S,s[u].t="t",R=u}}}for(u=0;u<s.length;++u)null!=s[u]&&"n?".indexOf(s[u].t)>-1&&(y=r>1&&t<0&&u>0&&"-"===s[u-1].v?-t:t,s[u].v=le(s[u].t,s[u].v,y),s[u].t="t");var O="";for(u=0;u!==s.length;++u)null!=s[u]&&(O+=s[u].v);return O}(i[1],t,n,i[0])}function ge(e,t){if("number"!=typeof t){t=+t||-1;for(var n=0;n<392;++n)if(void 0!=U[n]){if(U[n]==e){t=n;break}}else t<0&&(t=n);t<0&&(t=391)}return U[t]=e,t}function Ee(e){for(var t=0;392!=t;++t)void 0!==e[t]&&ge(e[t],t)}function _e(){var e;e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "',U=e}var be=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;var ye=function(){var e={};e.version="1.2.0";var t=function(){for(var e=0,t=new Array(256),n=0;256!=n;++n)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=n)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[n]=e;return"undefined"!==typeof Int32Array?new Int32Array(t):t}();var n=function(e){var t=0,n=0,r=0,i="undefined"!==typeof Int32Array?new Int32Array(4096):new Array(4096);for(r=0;256!=r;++r)i[r]=e[r];for(r=0;256!=r;++r)for(n=e[r],t=256+r;t<4096;t+=256)n=i[t]=n>>>8^e[255&n];var o=[];for(r=1;16!=r;++r)o[r-1]="undefined"!==typeof Int32Array?i.subarray(256*r,256*r+256):i.slice(256*r,256*r+256);return o}(t),r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],f=n[8],d=n[9],p=n[10],h=n[11],v=n[12],m=n[13],g=n[14];return e.table=t,e.bstr=function(e,n){for(var r=-1^n,i=0,o=e.length;i<o;)r=r>>>8^t[255&(r^e.charCodeAt(i++))];return~r},e.buf=function(e,n){for(var E=-1^n,_=e.length-15,b=0;b<_;)E=g[e[b++]^255&E]^m[e[b++]^E>>8&255]^v[e[b++]^E>>16&255]^h[e[b++]^E>>>24]^p[e[b++]]^d[e[b++]]^f[e[b++]]^l[e[b++]]^u[e[b++]]^c[e[b++]]^s[e[b++]]^a[e[b++]]^o[e[b++]]^i[e[b++]]^r[e[b++]]^t[e[b++]];for(_+=15;b<_;)E=E>>>8^t[255&(E^e[b++])];return~E},e.str=function(e,n){for(var r=-1^n,i=0,o=e.length,a=0,s=0;i<o;)(a=e.charCodeAt(i++))<128?r=r>>>8^t[255&(r^a)]:a<2048?r=(r=r>>>8^t[255&(r^(192|a>>6&31))])>>>8^t[255&(r^(128|63&a))]:a>=55296&&a<57344?(a=64+(1023&a),s=1023&e.charCodeAt(i++),r=(r=(r=(r=r>>>8^t[255&(r^(240|a>>8&7))])>>>8^t[255&(r^(128|a>>2&63))])>>>8^t[255&(r^(128|s>>6&15|(3&a)<<4))])>>>8^t[255&(r^(128|63&s))]):r=(r=(r=r>>>8^t[255&(r^(224|a>>12&15))])>>>8^t[255&(r^(128|a>>6&63))])>>>8^t[255&(r^(128|63&a))];return~r},e}(),Te=function(){var e,t={};function n(e){if("/"==e.charAt(e.length-1))return-1===e.slice(0,-1).indexOf("/")?e:n(e.slice(0,-1));var t=e.lastIndexOf("/");return-1===t?e:e.slice(0,t+1)}function r(e){if("/"==e.charAt(e.length-1))return r(e.slice(0,-1));var t=e.lastIndexOf("/");return-1===t?e:e.slice(t+1)}function i(e,t){"string"===typeof t&&(t=new Date(t));var n=t.getHours();n=(n=n<<6|t.getMinutes())<<5|t.getSeconds()>>>1,e.write_shift(2,n);var r=t.getFullYear()-1980;r=(r=r<<4|t.getMonth()+1)<<5|t.getDate(),e.write_shift(2,r)}function o(e){mn(e,0);for(var t={},n=0;e.l<=e.length-4;){var r=e.read_shift(2),i=e.read_shift(2),o=e.l+i,a={};if(21589===r)1&(n=e.read_shift(1))&&(a.mtime=e.read_shift(4)),i>5&&(2&n&&(a.atime=e.read_shift(4)),4&n&&(a.ctime=e.read_shift(4))),a.mtime&&(a.mt=new Date(1e3*a.mtime));e.l=o,t[r]=a}return t}function a(){return e||(e={})}function s(e,t){if(80==e[0]&&75==e[1])return pe(e,t);if(109==(32|e[0])&&105==(32|e[1]))return function(e,t){if("mime-version:"!=x(e.slice(0,13)).toLowerCase())throw new Error("Unsupported MAD header");var n=t&&t.root||"",r=(E&&Buffer.isBuffer(e)?e.toString("binary"):x(e)).split("\r\n"),i=0,o="";for(i=0;i<r.length;++i)if(o=r[i],/^Content-Location:/i.test(o)&&(o=o.slice(o.indexOf("file")),n||(n=o.slice(0,o.lastIndexOf("/")+1)),o.slice(0,n.length)!=n))for(;n.length>0&&(n=(n=n.slice(0,n.length-1)).slice(0,n.lastIndexOf("/")+1),o.slice(0,n.length)!=n););var a=(r[1]||"").match(/boundary="(.*?)"/);if(!a)throw new Error("MAD cannot find boundary");var s="--"+(a[1]||""),c=[],u=[],l={FileIndex:c,FullPaths:u};d(l);var f,p=0;for(i=0;i<r.length;++i){var h=r[i];h!==s&&h!==s+"--"||(p++&&_e(l,r.slice(f,i),n),f=i)}return l}(e,t);if(e.length<512)throw new Error("CFB file size "+e.length+" < 512");var n,r,i,o,a,s,p=512,h=[],v=e.slice(0,512);mn(v,0);var m=function(e){if(80==e[e.l]&&75==e[e.l+1])return[0,0];e.chk(A,"Header Signature: "),e.l+=16;var t=e.read_shift(2,"u");return[e.read_shift(2,"u"),t]}(v);switch(n=m[0]){case 3:p=512;break;case 4:p=4096;break;case 0:if(0==m[1])return pe(e,t);default:throw new Error("Major Version: Expected 3 or 4 saw "+n)}512!==p&&mn(v=e.slice(0,p),28);var g=e.slice(0,p);!function(e,t){var n=9;switch(e.l+=2,n=e.read_shift(2)){case 9:if(3!=t)throw new Error("Sector Shift: Expected 9 saw "+n);break;case 12:if(4!=t)throw new Error("Sector Shift: Expected 12 saw "+n);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+n)}e.chk("0600","Mini Sector Shift: "),e.chk("000000000000","Reserved: ")}(v,n);var _=v.read_shift(4,"i");if(3===n&&0!==_)throw new Error("# Directory Sectors: Expected 0 saw "+_);v.l+=4,o=v.read_shift(4,"i"),v.l+=4,v.chk("00100000","Mini Stream Cutoff Size: "),a=v.read_shift(4,"i"),r=v.read_shift(4,"i"),s=v.read_shift(4,"i"),i=v.read_shift(4,"i");for(var b=-1,y=0;y<109&&!((b=v.read_shift(4,"i"))<0);++y)h[y]=b;var T=function(e,t){for(var n=Math.ceil(e.length/t)-1,r=[],i=1;i<n;++i)r[i-1]=e.slice(i*t,(i+1)*t);return r[n-1]=e.slice(n*t),r}(e,p);u(s,i,T,p,h);var S=function(e,t,n,r){var i=e.length,o=[],a=[],s=[],c=[],u=r-1,l=0,f=0,d=0,p=0;for(l=0;l<i;++l)if(s=[],(d=l+t)>=i&&(d-=i),!a[d]){c=[];var h=[];for(f=d;f>=0;){h[f]=!0,a[f]=!0,s[s.length]=f,c.push(e[f]);var v=n[Math.floor(4*f/r)];if(r<4+(p=4*f&u))throw new Error("FAT boundary crossed: "+f+" 4 "+r);if(!e[v])break;if(h[f=ln(e[v],p)])break}o[d]={nodes:s,data:jt([c])}}return o}(T,o,h,p);S[o].name="!Directory",r>0&&a!==w&&(S[a].name="!MiniFAT"),S[h[0]].name="!FAT",S.fat_addrs=h,S.ssz=p;var R=[],O=[],I=[];!function(e,t,n,r,i,o,a,s){for(var u,d=0,p=r.length?2:0,h=t[e].data,v=0,m=0;v<h.length;v+=128){var g=h.slice(v,v+128);mn(g,64),m=g.read_shift(2),u=Bt(g,0,m-p),r.push(u);var E={name:u,type:g.read_shift(1),color:g.read_shift(1),L:g.read_shift(4,"i"),R:g.read_shift(4,"i"),C:g.read_shift(4,"i"),clsid:g.read_shift(16),state:g.read_shift(4,"i"),start:0,size:0};0!==g.read_shift(2)+g.read_shift(2)+g.read_shift(2)+g.read_shift(2)&&(E.ct=f(g,g.l-8)),0!==g.read_shift(2)+g.read_shift(2)+g.read_shift(2)+g.read_shift(2)&&(E.mt=f(g,g.l-8)),E.start=g.read_shift(4,"i"),E.size=g.read_shift(4,"i"),E.size<0&&E.start<0&&(E.size=E.type=0,E.start=w,E.name=""),5===E.type?(d=E.start,i>0&&d!==w&&(t[d].name="!StreamData")):E.size>=4096?(E.storage="fat",void 0===t[E.start]&&(t[E.start]=l(n,E.start,t.fat_addrs,t.ssz)),t[E.start].name=E.name,E.content=t[E.start].data.slice(0,E.size)):(E.storage="minifat",E.size<0?E.size=0:d!==w&&E.start!==w&&t[d]&&(E.content=c(E,t[d].data,(t[s]||{}).data))),E.content&&mn(E.content,0),o[u]=E,a.push(E)}}(o,S,T,R,r,{},O,a),function(e,t,n){for(var r=0,i=0,o=0,a=0,s=0,c=n.length,u=[],l=[];r<c;++r)u[r]=l[r]=r,t[r]=n[r];for(;s<l.length;++s)i=e[r=l[s]].L,o=e[r].R,a=e[r].C,u[r]===r&&(-1!==i&&u[i]!==i&&(u[r]=u[i]),-1!==o&&u[o]!==o&&(u[r]=u[o])),-1!==a&&(u[a]=r),-1!==i&&r!=u[r]&&(u[i]=u[r],l.lastIndexOf(i)<s&&l.push(i)),-1!==o&&r!=u[r]&&(u[o]=u[r],l.lastIndexOf(o)<s&&l.push(o));for(r=1;r<c;++r)u[r]===r&&(-1!==o&&u[o]!==o?u[r]=u[o]:-1!==i&&u[i]!==i&&(u[r]=u[i]));for(r=1;r<c;++r)if(0!==e[r].type){if((s=r)!=u[s])do{s=u[s],t[r]=t[s]+"/"+t[r]}while(0!==s&&-1!==u[s]&&s!=u[s]);u[r]=-1}for(t[0]+="/",r=1;r<c;++r)2!==e[r].type&&(t[r]+="/")}(O,I,R),R.shift();var k={FileIndex:O,FullPaths:I};return t&&t.raw&&(k.raw={header:g,sectors:T}),k}function c(e,t,n){for(var r=e.start,i=e.size,o=[],a=r;n&&i>0&&a>=0;)o.push(t.slice(a*S,a*S+S)),i-=S,a=ln(n,4*a);return 0===o.length?En(0):R(o).slice(0,e.size)}function u(e,t,n,r,i){var o=w;if(e===w){if(0!==t)throw new Error("DIFAT chain shorter than expected")}else if(-1!==e){var a=n[e],s=(r>>>2)-1;if(!a)return;for(var c=0;c<s&&(o=ln(a,4*c))!==w;++c)i.push(o);u(ln(a,r-4),t-1,n,r,i)}}function l(e,t,n,r,i){var o=[],a=[];i||(i=[]);var s=r-1,c=0,u=0;for(c=t;c>=0;){i[c]=!0,o[o.length]=c,a.push(e[c]);var l=n[Math.floor(4*c/r)];if(r<4+(u=4*c&s))throw new Error("FAT boundary crossed: "+c+" 4 "+r);if(!e[l])break;c=ln(e[l],u)}return{nodes:o,data:jt([a])}}function f(e,t){return new Date(1e3*(un(e,t+4)/1e7*Math.pow(2,32)+un(e,t)/1e7-11644473600))}function d(e,t){var n=t||{},r=n.root||"Root Entry";if(e.FullPaths||(e.FullPaths=[]),e.FileIndex||(e.FileIndex=[]),e.FullPaths.length!==e.FileIndex.length)throw new Error("inconsistent CFB structure");0===e.FullPaths.length&&(e.FullPaths[0]=r+"/",e.FileIndex[0]={name:r,type:5}),n.CLSID&&(e.FileIndex[0].clsid=n.CLSID),function(e){var t="\x01Sh33tJ5";if(Te.find(e,"/"+t))return;var n=En(4);n[0]=55,n[1]=n[3]=50,n[2]=54,e.FileIndex.push({name:t,type:2,content:n,size:4,L:69,R:69,C:69}),e.FullPaths.push(e.FullPaths[0]+t),p(e)}(e)}function p(e,t){d(e);for(var i=!1,o=!1,a=e.FullPaths.length-1;a>=0;--a){var s=e.FileIndex[a];switch(s.type){case 0:o?i=!0:(e.FileIndex.pop(),e.FullPaths.pop());break;case 1:case 2:case 5:o=!0,isNaN(s.R*s.L*s.C)&&(i=!0),s.R>-1&&s.L>-1&&s.R==s.L&&(i=!0);break;default:i=!0}}if(i||t){var c=new Date(1987,1,19),u=0,l=Object.create?Object.create(null):{},f=[];for(a=0;a<e.FullPaths.length;++a)l[e.FullPaths[a]]=!0,0!==e.FileIndex[a].type&&f.push([e.FullPaths[a],e.FileIndex[a]]);for(a=0;a<f.length;++a){var p=n(f[a][0]);(o=l[p])||(f.push([p,{name:r(p).replace("/",""),type:1,clsid:C,ct:c,mt:c,content:null}]),l[p]=!0)}for(f.sort((function(e,t){return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0,o=0,a=Math.min(n.length,r.length);i<a;++i){if(o=n[i].length-r[i].length)return o;if(n[i]!=r[i])return n[i]<r[i]?-1:1}return n.length-r.length}(e[0],t[0])})),e.FullPaths=[],e.FileIndex=[],a=0;a<f.length;++a)e.FullPaths[a]=f[a][0],e.FileIndex[a]=f[a][1];for(a=0;a<f.length;++a){var h=e.FileIndex[a],v=e.FullPaths[a];if(h.name=r(v).replace("/",""),h.L=h.R=h.C=-(h.color=1),h.size=h.content?h.content.length:0,h.start=0,h.clsid=h.clsid||C,0===a)h.C=f.length>1?1:-1,h.size=0,h.type=5;else if("/"==v.slice(-1)){for(u=a+1;u<f.length&&n(e.FullPaths[u])!=v;++u);for(h.C=u>=f.length?-1:u,u=a+1;u<f.length&&n(e.FullPaths[u])!=n(v);++u);h.R=u>=f.length?-1:u,h.type=1}else n(e.FullPaths[a+1]||"")==n(v)&&(h.R=a+1),h.type=2}}}function h(e,t){var n=t||{};if("mad"==n.fileType)return function(e,t){for(var n=t||{},r=n.boundary||"SheetJS",i=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+(r="------="+r).slice(2)+'"',"","",""],o=e.FullPaths[0],a=o,s=e.FileIndex[0],c=1;c<e.FullPaths.length;++c)if(a=e.FullPaths[c].slice(o.length),(s=e.FileIndex[c]).size&&s.content&&"\x01Sh33tJ5"!=a){a=a.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,(function(e){return"_x"+e.charCodeAt(0).toString(16)+"_"})).replace(/[\u0080-\uFFFF]/g,(function(e){return"_u"+e.charCodeAt(0).toString(16)+"_"}));for(var u=s.content,l=E&&Buffer.isBuffer(u)?u.toString("binary"):x(u),f=0,d=Math.min(1024,l.length),p=0,h=0;h<=d;++h)(p=l.charCodeAt(h))>=32&&p<128&&++f;var v=f>=4*d/5;i.push(r),i.push("Content-Location: "+(n.root||"file:///C:/SheetJS/")+a),i.push("Content-Transfer-Encoding: "+(v?"quoted-printable":"base64")),i.push("Content-Type: "+me(s,a)),i.push(""),i.push(v?Ee(l):ge(l))}return i.push(r+"--\r\n"),i.join("\r\n")}(e,n);if(p(e),"zip"===n.fileType)return function(e,t){var n=t||{},r=[],o=[],a=En(1),s=n.compression?8:0,c=0;0;var u=0,l=0,f=0,d=0,p=e.FullPaths[0],h=p,v=e.FileIndex[0],m=[],g=0;for(u=1;u<e.FullPaths.length;++u)if(h=e.FullPaths[u].slice(p.length),(v=e.FileIndex[u]).size&&v.content&&"\x01Sh33tJ5"!=h){var E=f,_=En(h.length);for(l=0;l<h.length;++l)_.write_shift(1,127&h.charCodeAt(l));_=_.slice(0,_.l),m[d]=ye.buf(v.content,0);var b=v.content;8==s&&(b=D(b)),(a=En(30)).write_shift(4,67324752),a.write_shift(2,20),a.write_shift(2,c),a.write_shift(2,s),v.mt?i(a,v.mt):a.write_shift(4,0),a.write_shift(-4,8&c?0:m[d]),a.write_shift(4,8&c?0:b.length),a.write_shift(4,8&c?0:v.content.length),a.write_shift(2,_.length),a.write_shift(2,0),f+=a.length,r.push(a),f+=_.length,r.push(_),f+=b.length,r.push(b),8&c&&((a=En(12)).write_shift(-4,m[d]),a.write_shift(4,b.length),a.write_shift(4,v.content.length),f+=a.l,r.push(a)),(a=En(46)).write_shift(4,33639248),a.write_shift(2,0),a.write_shift(2,20),a.write_shift(2,c),a.write_shift(2,s),a.write_shift(4,0),a.write_shift(-4,m[d]),a.write_shift(4,b.length),a.write_shift(4,v.content.length),a.write_shift(2,_.length),a.write_shift(2,0),a.write_shift(2,0),a.write_shift(2,0),a.write_shift(2,0),a.write_shift(4,0),a.write_shift(4,E),g+=a.l,o.push(a),g+=_.length,o.push(_),++d}return a=En(22),a.write_shift(4,101010256),a.write_shift(2,0),a.write_shift(2,0),a.write_shift(2,d),a.write_shift(2,d),a.write_shift(4,g),a.write_shift(4,f),a.write_shift(2,0),R([R(r),R(o),a])}(e,n);var r=function(e){for(var t=0,n=0,r=0;r<e.FileIndex.length;++r){var i=e.FileIndex[r];if(i.content){var o=i.content.length;o>0&&(o<4096?t+=o+63>>6:n+=o+511>>9)}}for(var a=e.FullPaths.length+3>>2,s=t+127>>7,c=(t+7>>3)+n+a+s,u=c+127>>7,l=u<=109?0:Math.ceil((u-109)/127);c+u+l+127>>7>u;)l=++u<=109?0:Math.ceil((u-109)/127);var f=[1,l,u,s,a,n,t,0];return e.FileIndex[0].size=t<<6,f[7]=(e.FileIndex[0].start=f[0]+f[1]+f[2]+f[3]+f[4]+f[5])+(f[6]+7>>3),f}(e),o=En(r[7]<<9),a=0,s=0;for(a=0;a<8;++a)o.write_shift(1,k[a]);for(a=0;a<8;++a)o.write_shift(2,0);for(o.write_shift(2,62),o.write_shift(2,3),o.write_shift(2,65534),o.write_shift(2,9),o.write_shift(2,6),a=0;a<3;++a)o.write_shift(2,0);for(o.write_shift(4,0),o.write_shift(4,r[2]),o.write_shift(4,r[0]+r[1]+r[2]+r[3]-1),o.write_shift(4,0),o.write_shift(4,4096),o.write_shift(4,r[3]?r[0]+r[1]+r[2]-1:w),o.write_shift(4,r[3]),o.write_shift(-4,r[1]?r[0]-1:w),o.write_shift(4,r[1]),a=0;a<109;++a)o.write_shift(-4,a<r[2]?r[1]+a:-1);if(r[1])for(s=0;s<r[1];++s){for(;a<236+127*s;++a)o.write_shift(-4,a<r[2]?r[1]+a:-1);o.write_shift(-4,s===r[1]-1?w:s+1)}var c=function(e){for(s+=e;a<s-1;++a)o.write_shift(-4,a+1);e&&(++a,o.write_shift(-4,w))};for(s=a=0,s+=r[1];a<s;++a)o.write_shift(-4,N.DIFSECT);for(s+=r[2];a<s;++a)o.write_shift(-4,N.FATSECT);c(r[3]),c(r[4]);for(var u=0,l=0,f=e.FileIndex[0];u<e.FileIndex.length;++u)(f=e.FileIndex[u]).content&&((l=f.content.length)<4096||(f.start=s,c(l+511>>9)));for(c(r[6]+7>>3);511&o.l;)o.write_shift(-4,N.ENDOFCHAIN);for(s=a=0,u=0;u<e.FileIndex.length;++u)(f=e.FileIndex[u]).content&&(!(l=f.content.length)||l>=4096||(f.start=s,c(l+63>>6)));for(;511&o.l;)o.write_shift(-4,N.ENDOFCHAIN);for(a=0;a<r[4]<<2;++a){var d=e.FullPaths[a];if(d&&0!==d.length){f=e.FileIndex[a],0===a&&(f.start=f.size?f.start-1:w);var h=0===a&&n.root||f.name;if(l=2*(h.length+1),o.write_shift(64,h,"utf16le"),o.write_shift(2,l),o.write_shift(1,f.type),o.write_shift(1,f.color),o.write_shift(-4,f.L),o.write_shift(-4,f.R),o.write_shift(-4,f.C),f.clsid)o.write_shift(16,f.clsid,"hex");else for(u=0;u<4;++u)o.write_shift(4,0);o.write_shift(4,f.state||0),o.write_shift(4,0),o.write_shift(4,0),o.write_shift(4,0),o.write_shift(4,0),o.write_shift(4,f.start),o.write_shift(4,f.size),o.write_shift(4,0)}else{for(u=0;u<17;++u)o.write_shift(4,0);for(u=0;u<3;++u)o.write_shift(4,-1);for(u=0;u<12;++u)o.write_shift(4,0)}}for(a=1;a<e.FileIndex.length;++a)if((f=e.FileIndex[a]).size>=4096)if(o.l=f.start+1<<9,E&&Buffer.isBuffer(f.content))f.content.copy(o,o.l,0,f.size),o.l+=f.size+511&-512;else{for(u=0;u<f.size;++u)o.write_shift(1,f.content[u]);for(;511&u;++u)o.write_shift(1,0)}for(a=1;a<e.FileIndex.length;++a)if((f=e.FileIndex[a]).size>0&&f.size<4096)if(E&&Buffer.isBuffer(f.content))f.content.copy(o,o.l,0,f.size),o.l+=f.size+63&-64;else{for(u=0;u<f.size;++u)o.write_shift(1,f.content[u]);for(;63&u;++u)o.write_shift(1,0)}if(E)o.l=o.length;else for(;o.l<o.length;)o.write_shift(1,0);return o}t.version="1.2.1";var v,S=64,w=-2,A="d0cf11e0a1b11ae1",k=[208,207,17,224,161,177,26,225],C="00000000000000000000000000000000",N={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:w,FREESECT:-1,HEADER_SIGNATURE:A,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:C,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function x(e){for(var t=new Array(e.length),n=0;n<e.length;++n)t[n]=String.fromCharCode(e[n]);return t.join("")}function D(e){return v?v.deflateRawSync(e):ie(e)}var P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],L=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function U(e){var t=139536&(e<<1|e<<11)|558144&(e<<5|e<<15);return 255&(t>>16|t>>8|t)}for(var j="undefined"!==typeof Uint8Array,F=j?new Uint8Array(256):[],B=0;B<256;++B)F[B]=U(B);function V(e,t){var n=F[255&e];return t<=8?n>>>8-t:(n=n<<8|F[e>>8&255],t<=16?n>>>16-t:(n=n<<8|F[e>>16&255])>>>24-t)}function G(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=6?0:e[r+1]<<8))>>>n&3}function W(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=5?0:e[r+1]<<8))>>>n&7}function q(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=3?0:e[r+1]<<8))>>>n&31}function H(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=1?0:e[r+1]<<8))>>>n&127}function K(e,t,n){var r=7&t,i=t>>>3,o=(1<<n)-1,a=e[i]>>>r;return n<8-r?a&o:(a|=e[i+1]<<8-r,n<16-r?a&o:(a|=e[i+2]<<16-r,n<24-r?a&o:(a|=e[i+3]<<24-r)&o))}function z(e,t,n){var r=7&t,i=t>>>3;return r<=5?e[i]|=(7&n)<<r:(e[i]|=n<<r&255,e[i+1]=(7&n)>>8-r),t+3}function Y(e,t,n){return n=(1&n)<<(7&t),e[t>>>3]|=n,t+1}function J(e,t,n){var r=t>>>3;return n<<=7&t,e[r]|=255&n,n>>>=8,e[r+1]=n,t+8}function X(e,t,n){var r=t>>>3;return n<<=7&t,e[r]|=255&n,n>>>=8,e[r+1]=255&n,e[r+2]=n>>>8,t+16}function Q(e,t){var n=e.length,r=2*n>t?2*n:t+5,i=0;if(n>=t)return e;if(E){var o=y(r);if(e.copy)e.copy(o);else for(;i<e.length;++i)o[i]=e[i];return o}if(j){var a=new Uint8Array(r);if(a.set)a.set(e);else for(;i<n;++i)a[i]=e[i];return a}return e.length=r,e}function $(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=0;return t}function Z(e,t,n){var r=1,i=0,o=0,a=0,s=0,c=e.length,u=j?new Uint16Array(32):$(32);for(o=0;o<32;++o)u[o]=0;for(o=c;o<n;++o)e[o]=0;c=e.length;var l=j?new Uint16Array(c):$(c);for(o=0;o<c;++o)u[i=e[o]]++,r<i&&(r=i),l[o]=0;for(u[0]=0,o=1;o<=r;++o)u[o+16]=s=s+u[o-1]<<1;for(o=0;o<c;++o)0!=(s=e[o])&&(l[o]=u[s+16]++);var f=0;for(o=0;o<c;++o)if(0!=(f=e[o]))for(s=V(l[o],r)>>r-f,a=(1<<r+4-f)-1;a>=0;--a)t[s|a<<f]=15&f|o<<4;return r}var ee=j?new Uint16Array(512):$(512),te=j?new Uint16Array(32):$(32);if(!j){for(var ne=0;ne<512;++ne)ee[ne]=0;for(ne=0;ne<32;++ne)te[ne]=0}!function(){for(var e=[],t=0;t<32;t++)e.push(5);Z(e,te,32);var n=[];for(t=0;t<=143;t++)n.push(8);for(;t<=255;t++)n.push(9);for(;t<=279;t++)n.push(7);for(;t<=287;t++)n.push(8);Z(n,ee,288)}();var re=function(){for(var e=j?new Uint8Array(32768):[],t=0,n=0;t<M.length-1;++t)for(;n<M[t+1];++n)e[n]=t;for(;n<32768;++n)e[n]=29;var r=j?new Uint8Array(259):[];for(t=0,n=0;t<L.length-1;++t)for(;n<L[t+1];++n)r[n]=t;return function(t,n){return t.length<8?function(e,t){for(var n=0;n<e.length;){var r=Math.min(65535,e.length-n),i=n+r==e.length;for(t.write_shift(1,+i),t.write_shift(2,r),t.write_shift(2,65535&~r);r-- >0;)t[t.l++]=e[n++]}return t.l}(t,n):function(t,n){for(var i=0,o=0,a=j?new Uint16Array(32768):[];o<t.length;){var s=Math.min(65535,t.length-o);if(s<10){for(7&(i=z(n,i,+!(o+s!=t.length)))&&(i+=8-(7&i)),n.l=i/8|0,n.write_shift(2,s),n.write_shift(2,65535&~s);s-- >0;)n[n.l++]=t[o++];i=8*n.l}else{i=z(n,i,+!(o+s!=t.length)+2);for(var c=0;s-- >0;){var u=t[o],l=-1,f=0;if((l=a[c=32767&(c<<5^u)])&&((l|=-32768&o)>o&&(l-=32768),l<o))for(;t[l+f]==t[o+f]&&f<250;)++f;if(f>2){(u=r[f])<=22?i=J(n,i,F[u+1]>>1)-1:(J(n,i,3),J(n,i+=5,F[u-23]>>5),i+=3);var d=u<8?0:u-4>>2;d>0&&(X(n,i,f-L[u]),i+=d),u=e[o-l],i=J(n,i,F[u]>>3),i-=3;var p=u<4?0:u-2>>1;p>0&&(X(n,i,o-l-M[u]),i+=p);for(var h=0;h<f;++h)a[c]=32767&o,c=32767&(c<<5^t[o]),++o;s-=f-1}else u<=143?u+=48:i=Y(n,i,1),i=J(n,i,F[u]),a[c]=32767&o,++o}i=J(n,i,0)-1}}return n.l=(i+7)/8|0,n.l}(t,n)}}();function ie(e){var t=En(50+Math.floor(1.1*e.length)),n=re(e,t);return t.slice(0,n)}var oe=j?new Uint16Array(32768):$(32768),ae=j?new Uint16Array(32768):$(32768),se=j?new Uint16Array(128):$(128),ce=1,ue=1;function le(e,t){var n=q(e,t)+257,r=q(e,t+=5)+1,i=function(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=4?0:e[r+1]<<8))>>>n&15}(e,t+=5)+4;t+=4;for(var o=0,a=j?new Uint8Array(19):$(19),s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=1,u=j?new Uint8Array(8):$(8),l=j?new Uint8Array(8):$(8),f=a.length,d=0;d<i;++d)a[P[d]]=o=W(e,t),c<o&&(c=o),u[o]++,t+=3;var p=0;for(u[0]=0,d=1;d<=c;++d)l[d]=p=p+u[d-1]<<1;for(d=0;d<f;++d)0!=(p=a[d])&&(s[d]=l[p]++);var h=0;for(d=0;d<f;++d)if(0!=(h=a[d])){p=F[s[d]]>>8-h;for(var v=(1<<7-h)-1;v>=0;--v)se[p|v<<h]=7&h|d<<3}var m=[];for(c=1;m.length<n+r;)switch(t+=7&(p=se[H(e,t)]),p>>>=3){case 16:for(o=3+G(e,t),t+=2,p=m[m.length-1];o-- >0;)m.push(p);break;case 17:for(o=3+W(e,t),t+=3;o-- >0;)m.push(0);break;case 18:for(o=11+H(e,t),t+=7;o-- >0;)m.push(0);break;default:m.push(p),c<p&&(c=p)}var g=m.slice(0,n),E=m.slice(n);for(d=n;d<286;++d)g[d]=0;for(d=r;d<30;++d)E[d]=0;return ce=Z(g,oe,286),ue=Z(E,ae,30),t}function fe(e,t){var n=function(e,t){if(3==e[0]&&!(3&e[1]))return[b(t),2];for(var n=0,r=0,i=y(t||1<<18),o=0,a=i.length>>>0,s=0,c=0;0==(1&r);)if(r=W(e,n),n+=3,r>>>1!=0)for(r>>1==1?(s=9,c=5):(n=le(e,n),s=ce,c=ue);;){!t&&a<o+32767&&(a=(i=Q(i,o+32767)).length);var u=K(e,n,s),l=r>>>1==1?ee[u]:oe[u];if(n+=15&l,0===((l>>>=4)>>>8&255))i[o++]=l;else{if(256==l)break;var f=(l-=257)<8?0:l-4>>2;f>5&&(f=0);var d=o+L[l];f>0&&(d+=K(e,n,f),n+=f),u=K(e,n,c),n+=15&(l=r>>>1==1?te[u]:ae[u]);var p=(l>>>=4)<4?0:l-2>>1,h=M[l];for(p>0&&(h+=K(e,n,p),n+=p),!t&&a<d&&(a=(i=Q(i,d+100)).length);o<d;)i[o]=i[o-h],++o}}else{7&n&&(n+=8-(7&n));var v=e[n>>>3]|e[1+(n>>>3)]<<8;if(n+=32,v>0)for(!t&&a<o+v&&(a=(i=Q(i,o+v)).length);v-- >0;)i[o++]=e[n>>>3],n+=8}return t?[i,n+7>>>3]:[i.slice(0,o),n+7>>>3]}(e.slice(e.l||0),t);return e.l+=n[1],n[0]}function de(e,t){if(!e)throw new Error(t);"undefined"!==typeof console&&console.error(t)}function pe(e,t){var n=e;mn(n,0);var r={FileIndex:[],FullPaths:[]};d(r,{root:t.root});for(var i=n.length-4;(80!=n[i]||75!=n[i+1]||5!=n[i+2]||6!=n[i+3])&&i>=0;)--i;n.l=i+4,n.l+=4;var a=n.read_shift(2);n.l+=6;var s=n.read_shift(4);for(n.l=s,i=0;i<a;++i){n.l+=20;var c=n.read_shift(4),u=n.read_shift(4),l=n.read_shift(2),f=n.read_shift(2),p=n.read_shift(2);n.l+=8;var h=n.read_shift(4),v=o(n.slice(n.l+l,n.l+l+f));n.l+=l+f+p;var m=n.l;n.l=h+4,he(n,c,u,r,v),n.l=m}return r}function he(e,t,n,r,i){e.l+=2;var a=e.read_shift(2),s=e.read_shift(2),c=function(e){var t=65535&e.read_shift(2),n=65535&e.read_shift(2),r=new Date,i=31&n,o=15&(n>>>=5);n>>>=4,r.setMilliseconds(0),r.setFullYear(n+1980),r.setMonth(o-1),r.setDate(i);var a=31&t,s=63&(t>>>=5);return t>>>=6,r.setHours(t),r.setMinutes(s),r.setSeconds(a<<1),r}(e);if(8257&a)throw new Error("Unsupported ZIP encryption");e.read_shift(4);for(var u=e.read_shift(4),l=e.read_shift(4),f=e.read_shift(2),d=e.read_shift(2),p="",h=0;h<f;++h)p+=String.fromCharCode(e[e.l++]);if(d){var m=o(e.slice(e.l,e.l+d));(m[21589]||{}).mt&&(c=m[21589].mt),((i||{})[21589]||{}).mt&&(c=i[21589].mt)}e.l+=d;var g=e.slice(e.l,e.l+u);switch(s){case 8:g=function(e,t){if(!v)return fe(e,t);var n=new(0,v.InflateRaw),r=n._processChunk(e.slice(e.l),n._finishFlushFlag);return e.l+=n.bytesRead,r}(e,l);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+s)}var E=!1;8&a&&(134695760==e.read_shift(4)&&(e.read_shift(4),E=!0),u=e.read_shift(4),l=e.read_shift(4)),u!=t&&de(E,"Bad compressed size: "+t+" != "+u),l!=n&&de(E,"Bad uncompressed size: "+n+" != "+l),be(r,p,g,{unsafe:!0,mt:c})}var ve={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function me(e,t){if(e.ctype)return e.ctype;var n=e.name||"",r=n.match(/\.([^\.]+)$/);return r&&ve[r[1]]||t&&(r=(n=t).match(/[\.\\]([^\.\\])+$/))&&ve[r[1]]?ve[r[1]]:"application/octet-stream"}function ge(e){for(var t=m(e),n=[],r=0;r<t.length;r+=76)n.push(t.slice(r,r+76));return n.join("\r\n")+"\r\n"}function Ee(e){var t=e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,(function(e){var t=e.charCodeAt(0).toString(16).toUpperCase();return"="+(1==t.length?"0"+t:t)}));"\n"==(t=t.replace(/ $/gm,"=20").replace(/\t$/gm,"=09")).charAt(0)&&(t="=0D"+t.slice(1));for(var n=[],r=(t=t.replace(/\r(?!\n)/gm,"=0D").replace(/\n\n/gm,"\n=0A").replace(/([^\r\n])\n/gm,"$1=0A")).split("\r\n"),i=0;i<r.length;++i){var o=r[i];if(0!=o.length)for(var a=0;a<o.length;){var s=76,c=o.slice(a,a+s);"="==c.charAt(s-1)?s--:"="==c.charAt(s-2)?s-=2:"="==c.charAt(s-3)&&(s-=3),c=o.slice(a,a+s),(a+=s)<o.length&&(c+="="),n.push(c)}else n.push("")}return n.join("\r\n")}function _e(e,t,n){for(var r,i="",o="",a="",s=0;s<10;++s){var c=t[s];if(!c||c.match(/^\s*$/))break;var u=c.match(/^(.*?):\s*([^\s].*)$/);if(u)switch(u[1].toLowerCase()){case"content-location":i=u[2].trim();break;case"content-type":a=u[2].trim();break;case"content-transfer-encoding":o=u[2].trim()}}switch(++s,o.toLowerCase()){case"base64":r=T(g(t.slice(s).join("")));break;case"quoted-printable":r=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n];n<=e.length&&"="==r.charAt(r.length-1);)r=r.slice(0,r.length-1)+e[++n];t.push(r)}for(var i=0;i<t.length;++i)t[i]=t[i].replace(/[=][0-9A-Fa-f]{2}/g,(function(e){return String.fromCharCode(parseInt(e.slice(1),16))}));return T(t.join("\r\n"))}(t.slice(s));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+o)}var l=be(e,i.slice(n.length),r,{unsafe:!0});a&&(l.ctype=a)}function be(e,t,n,i){var o=i&&i.unsafe;o||d(e);var a=!o&&Te.find(e,t);if(!a){var s=e.FullPaths[0];t.slice(0,s.length)==s?s=t:("/"!=s.slice(-1)&&(s+="/"),s=(s+t).replace("//","/")),a={name:r(t),type:2},e.FileIndex.push(a),e.FullPaths.push(s),o||Te.utils.cfb_gc(e)}return a.content=n,a.size=n?n.length:0,i&&(i.CLSID&&(a.clsid=i.CLSID),i.mt&&(a.mt=i.mt),i.ct&&(a.ct=i.ct)),a}return t.find=function(e,t){var n=e.FullPaths.map((function(e){return e.toUpperCase()})),r=n.map((function(e){var t=e.split("/");return t[t.length-("/"==e.slice(-1)?2:1)]})),i=!1;47===t.charCodeAt(0)?(i=!0,t=n[0].slice(0,-1)+t):i=-1!==t.indexOf("/");var o=t.toUpperCase(),a=!0===i?n.indexOf(o):r.indexOf(o);if(-1!==a)return e.FileIndex[a];var s=!o.match(I);for(o=o.replace(O,""),s&&(o=o.replace(I,"!")),a=0;a<n.length;++a){if((s?n[a].replace(I,"!"):n[a]).replace(O,"")==o)return e.FileIndex[a];if((s?r[a].replace(I,"!"):r[a]).replace(O,"")==o)return e.FileIndex[a]}return null},t.read=function(t,n){var r=n&&n.type;switch(r||E&&Buffer.isBuffer(t)&&(r="buffer"),r||"base64"){case"file":return function(t,n){return a(),s(e.readFileSync(t),n)}(t,n);case"base64":return s(T(g(t)),n);case"binary":return s(T(t),n)}return s(t,n)},t.parse=s,t.write=function(t,n){var r=h(t,n);switch(n&&n.type||"buffer"){case"file":return a(),e.writeFileSync(n.filename,r),r;case"binary":return"string"==typeof r?r:x(r);case"base64":return m("string"==typeof r?r:x(r));case"buffer":if(E)return Buffer.isBuffer(r)?r:_(r);case"array":return"string"==typeof r?T(r):r}return r},t.writeFile=function(t,n,r){a();var i=h(t,r);e.writeFileSync(n,i)},t.utils={cfb_new:function(e){var t={};return d(t,e),t},cfb_add:be,cfb_del:function(e,t){d(e);var n=Te.find(e,t);if(n)for(var r=0;r<e.FileIndex.length;++r)if(e.FileIndex[r]==n)return e.FileIndex.splice(r,1),e.FullPaths.splice(r,1),!0;return!1},cfb_mov:function(e,t,n){d(e);var i=Te.find(e,t);if(i)for(var o=0;o<e.FileIndex.length;++o)if(e.FileIndex[o]==i)return e.FileIndex[o].name=r(n),e.FullPaths[o]=n,!0;return!1},cfb_gc:function(e){p(e,!0)},ReadShift:dn,CheckField:vn,prep_blob:mn,bconcat:R,use_zlib:function(e){try{var t=new(0,e.InflateRaw);if(t._processChunk(new Uint8Array([3,0]),t._finishFlushFlag),!t.bytesRead)throw new Error("zlib does not expose bytesRead");v=e}catch(n){console.error("cannot use native zlib: "+(n.message||n))}},_deflateRaw:ie,_inflateRaw:fe,consts:N},t}(),Se=void 0;function we(e){return"string"===typeof e?S(e):Array.isArray(e)?function(e){if("undefined"===typeof Uint8Array)throw new Error("Unsupported");return new Uint8Array(e)}(e):e}function Re(e,t,n){if("undefined"!==typeof Se&&Se.writeFileSync)return n?Se.writeFileSync(e,t,n):Se.writeFileSync(e,t);if("undefined"!==typeof Deno){if(n&&"string"==typeof t)switch(n){case"utf8":t=new TextEncoder(n).encode(t);break;case"binary":t=S(t);break;default:throw new Error("Unsupported encoding "+n)}return Deno.writeFileSync(e,t)}var r="utf8"==n?ut(t):t;if("undefined"!==typeof IE_SaveFile)return IE_SaveFile(r,e);if("undefined"!==typeof Blob){var i=new Blob([we(r)],{type:"application/octet-stream"});if("undefined"!==typeof navigator&&navigator.msSaveBlob)return navigator.msSaveBlob(i,e);if("undefined"!==typeof saveAs)return saveAs(i,e);if("undefined"!==typeof URL&&"undefined"!==typeof document&&document.createElement&&URL.createObjectURL){var o=URL.createObjectURL(i);if("object"===typeof chrome&&"function"==typeof(chrome.downloads||{}).download)return URL.revokeObjectURL&&"undefined"!==typeof setTimeout&&setTimeout((function(){URL.revokeObjectURL(o)}),6e4),chrome.downloads.download({url:o,filename:e,saveAs:!0});var a=document.createElement("a");if(null!=a.download)return a.download=e,a.href=o,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL&&"undefined"!==typeof setTimeout&&setTimeout((function(){URL.revokeObjectURL(o)}),6e4),o}}if("undefined"!==typeof $&&"undefined"!==typeof File&&"undefined"!==typeof Folder)try{var s=File(e);return s.open("w"),s.encoding="binary",Array.isArray(t)&&(t=w(t)),s.write(t),s.close(),t}catch(c){if(!c.message||!c.message.match(/onstruct/))throw c}throw new Error("cannot save file "+e)}function Oe(e){for(var t=Object.keys(e),n=[],r=0;r<t.length;++r)Object.prototype.hasOwnProperty.call(e,t[r])&&n.push(t[r]);return n}function Ie(e,t){for(var n=[],r=Oe(e),i=0;i!==r.length;++i)null==n[e[r[i]][t]]&&(n[e[r[i]][t]]=r[i]);return n}function Ae(e){for(var t=[],n=Oe(e),r=0;r!==n.length;++r)t[e[n[r]]]=n[r];return t}function ke(e){for(var t=[],n=Oe(e),r=0;r!==n.length;++r)t[e[n[r]]]=parseInt(n[r],10);return t}var Ce=new Date(1899,11,30,0,0,0);function Ne(e,t){var n=e.getTime();return t&&(n-=1263168e5),(n-(Ce.getTime()+6e4*(e.getTimezoneOffset()-Ce.getTimezoneOffset())))/864e5}var xe=new Date,De=Ce.getTime()+6e4*(xe.getTimezoneOffset()-Ce.getTimezoneOffset()),Pe=xe.getTimezoneOffset();function Le(e){var t=new Date;return t.setTime(24*e*60*60*1e3+De),t.getTimezoneOffset()!==Pe&&t.setTime(t.getTime()+6e4*(t.getTimezoneOffset()-Pe)),t}var Me=new Date("2017-02-19T19:06:09.000Z"),Ue=isNaN(Me.getFullYear())?new Date("2/19/17"):Me,je=2017==Ue.getFullYear();function Fe(e,t){var n=new Date(e);if(je)return t>0?n.setTime(n.getTime()+60*n.getTimezoneOffset()*1e3):t<0&&n.setTime(n.getTime()-60*n.getTimezoneOffset()*1e3),n;if(e instanceof Date)return e;if(1917==Ue.getFullYear()&&!isNaN(n.getFullYear())){var r=n.getFullYear();return e.indexOf(""+r)>-1||n.setFullYear(n.getFullYear()+100),n}var i=e.match(/\d+/g)||["2017","2","19","0","0","0"],o=new Date(+i[0],+i[1]-1,+i[2],+i[3]||0,+i[4]||0,+i[5]||0);return e.indexOf("Z")>-1&&(o=new Date(o.getTime()-60*o.getTimezoneOffset()*1e3)),o}function Be(e,t){if(E&&Buffer.isBuffer(e)){if(t){if(255==e[0]&&254==e[1])return ut(e.slice(2).toString("utf16le"));if(254==e[1]&&255==e[2])return ut(f(e.slice(2).toString("binary")))}return e.toString("binary")}if("undefined"!==typeof TextDecoder)try{if(t){if(255==e[0]&&254==e[1])return ut(new TextDecoder("utf-16le").decode(e.slice(2)));if(254==e[0]&&255==e[1])return ut(new TextDecoder("utf-16be").decode(e.slice(2)))}var n={"\u20ac":"\x80","\u201a":"\x82","\u0192":"\x83","\u201e":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87","\u02c6":"\x88","\u2030":"\x89","\u0160":"\x8a","\u2039":"\x8b","\u0152":"\x8c","\u017d":"\x8e","\u2018":"\x91","\u2019":"\x92","\u201c":"\x93","\u201d":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02dc":"\x98","\u2122":"\x99","\u0161":"\x9a","\u203a":"\x9b","\u0153":"\x9c","\u017e":"\x9e","\u0178":"\x9f"};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[\u20ac\u201a\u0192\u201e\u2026\u2020\u2021\u02c6\u2030\u0160\u2039\u0152\u017d\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u02dc\u2122\u0161\u203a\u0153\u017e\u0178]/g,(function(e){return n[e]||e}))}catch(o){}for(var r=[],i=0;i!=e.length;++i)r.push(String.fromCharCode(e[i]));return r.join("")}function Ve(e){if("undefined"!=typeof JSON&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if("object"!=typeof e||null==e)return e;if(e instanceof Date)return new Date(e.getTime());var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=Ve(e[n]));return t}function Ge(e,t){for(var n="";n.length<t;)n+=e;return n}function We(e){var t=Number(e);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(e))return t;var n=1,r=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,(function(){return n*=100,""}));return isNaN(t=Number(r))?(r=r.replace(/[(](.*)[)]/,(function(e,t){return n=-n,t})),isNaN(t=Number(r))?t:t/n):t/n}var qe=["january","february","march","april","may","june","july","august","september","october","november","december"];function He(e){var t=new Date(e),n=new Date(NaN),r=t.getYear(),i=t.getMonth(),o=t.getDate();if(isNaN(o))return n;var a=e.toLowerCase();if(a.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if((a=a.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,"")).length>3&&-1==qe.indexOf(a))return n}else if(a.match(/[a-z]/))return n;return r<0||r>8099?n:(i>0||o>1)&&101!=r?t:e.match(/[^-0-9:,\/\\]/)?n:t}function Ke(e,t,n){if(e.FullPaths){var r;if("string"==typeof n)return r=E?_(n):function(e){for(var t=[],n=0,r=e.length+250,i=b(e.length+255),o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a<128)i[n++]=a;else if(a<2048)i[n++]=192|a>>6&31,i[n++]=128|63&a;else if(a>=55296&&a<57344){a=64+(1023&a);var s=1023&e.charCodeAt(++o);i[n++]=240|a>>8&7,i[n++]=128|a>>2&63,i[n++]=128|s>>6&15|(3&a)<<4,i[n++]=128|63&s}else i[n++]=224|a>>12&15,i[n++]=128|a>>6&63,i[n++]=128|63&a;n>r&&(t.push(i.slice(0,n)),n=0,i=b(65535),r=65530)}return t.push(i.slice(0,n)),R(t)}(n),Te.utils.cfb_add(e,t,r);Te.utils.cfb_add(e,t,n)}else e.file(t,n)}function ze(){return Te.utils.cfb_new()}var Ye='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n';var Je={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},Xe=Ae(Je),Qe=/[&<>'"]/g,$e=/[\u0000-\u0008\u000b-\u001f]/g;function Ze(e){return(e+"").replace(Qe,(function(e){return Xe[e]})).replace($e,(function(e){return"_x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+"_"}))}function et(e){return Ze(e).replace(/ /g,"_x0020_")}var tt=/[\u0000-\u001f]/g;function nt(e){return(e+"").replace(Qe,(function(e){return Xe[e]})).replace(/\n/g,"<br/>").replace(tt,(function(e){return"&#x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+";"}))}function rt(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function it(e){for(var t="",n=0,r=0,i=0,o=0,a=0,s=0;n<e.length;)(r=e.charCodeAt(n++))<128?t+=String.fromCharCode(r):(i=e.charCodeAt(n++),r>191&&r<224?(a=(31&r)<<6,a|=63&i,t+=String.fromCharCode(a)):(o=e.charCodeAt(n++),r<240?t+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o):(s=((7&r)<<18|(63&i)<<12|(63&o)<<6|63&(a=e.charCodeAt(n++)))-65536,t+=String.fromCharCode(55296+(s>>>10&1023)),t+=String.fromCharCode(56320+(1023&s)))));return t}function ot(e){var t,n,r,i=b(2*e.length),o=1,a=0,s=0;for(n=0;n<e.length;n+=o)o=1,(r=e.charCodeAt(n))<128?t=r:r<224?(t=64*(31&r)+(63&e.charCodeAt(n+1)),o=2):r<240?(t=4096*(15&r)+64*(63&e.charCodeAt(n+1))+(63&e.charCodeAt(n+2)),o=3):(o=4,t=262144*(7&r)+4096*(63&e.charCodeAt(n+1))+64*(63&e.charCodeAt(n+2))+(63&e.charCodeAt(n+3)),s=55296+((t-=65536)>>>10&1023),t=56320+(1023&t)),0!==s&&(i[a++]=255&s,i[a++]=s>>>8,s=0),i[a++]=t%256,i[a++]=t>>>8;return i.slice(0,a).toString("ucs2")}function at(e){return _(e,"binary").toString("utf8")}var st="foo bar baz\xe2\x98\x83\xf0\x9f\x8d\xa3",ct=E&&(at(st)==it(st)&&at||ot(st)==it(st)&&ot)||it,ut=E?function(e){return _(e,"utf8").toString("binary")}:function(e){for(var t=[],n=0,r=0,i=0;n<e.length;)switch(r=e.charCodeAt(n++),!0){case r<128:t.push(String.fromCharCode(r));break;case r<2048:t.push(String.fromCharCode(192+(r>>6))),t.push(String.fromCharCode(128+(63&r)));break;case r>=55296&&r<57344:r-=55296,i=e.charCodeAt(n++)-56320+(r<<10),t.push(String.fromCharCode(240+(i>>18&7))),t.push(String.fromCharCode(144+(i>>12&63))),t.push(String.fromCharCode(128+(i>>6&63))),t.push(String.fromCharCode(128+(63&i)));break;default:t.push(String.fromCharCode(224+(r>>12))),t.push(String.fromCharCode(128+(r>>6&63))),t.push(String.fromCharCode(128+(63&r)))}return t.join("")},lt=function(){var e=[["nbsp"," "],["middot","\xb7"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map((function(e){return[new RegExp("&"+e[0]+";","ig"),e[1]]}));return function(t){for(var n=t.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,"\n").replace(/<[^>]*>/g,""),r=0;r<e.length;++r)n=n.replace(e[r][0],e[r][1]);return n}}();var ft=/(^\s|\s$|\n)/;function dt(e,t){return"<"+e+(t.match(ft)?' xml:space="preserve"':"")+">"+t+"</"+e+">"}function pt(e){return Oe(e).map((function(t){return" "+t+'="'+e[t]+'"'})).join("")}function ht(e,t,n){return"<"+e+(null!=n?pt(n):"")+(null!=t?(t.match(ft)?' xml:space="preserve"':"")+">"+t+"</"+e:"/")+">"}function vt(e,t){try{return e.toISOString().replace(/\.\d*/,"")}catch(n){if(t)throw n}return""}var mt="http://schemas.openxmlformats.org/package/2006/metadata/core-properties",gt="http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",Et="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",_t="http://schemas.openxmlformats.org/package/2006/content-types",bt="http://schemas.openxmlformats.org/package/2006/relationships",yt="http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",Tt="http://purl.org/dc/elements/1.1/",St="http://purl.org/dc/terms/",wt="http://purl.org/dc/dcmitype/",Rt="http://schemas.openxmlformats.org/officeDocument/2006/relationships",Ot="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",It="http://www.w3.org/2001/XMLSchema-instance",At="http://www.w3.org/2001/XMLSchema",kt=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],Ct="urn:schemas-microsoft-com:office:office",Nt="urn:schemas-microsoft-com:office:excel",xt="urn:schemas-microsoft-com:office:spreadsheet",Dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",Pt="http://macVmlSchemaUri",Lt="urn:schemas-microsoft-com:vml",Mt="http://www.w3.org/TR/REC-html40";var Ut=function(e){for(var t=[],n=0;n<e[0].length;++n)if(e[0][n])for(var r=0,i=e[0][n].length;r<i;r+=10240)t.push.apply(t,e[0][n].slice(r,r+10240));return t},jt=E?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map((function(e){return Buffer.isBuffer(e)?e:_(e)}))):Ut(e)}:Ut,Ft=function(e,t,n){for(var r=[],i=t;i<n;i+=2)r.push(String.fromCharCode(sn(e,i)));return r.join("").replace(O,"")},Bt=E?function(e,t,n){return Buffer.isBuffer(e)?e.toString("utf16le",t,n).replace(O,""):Ft(e,t,n)}:Ft,Vt=function(e,t,n){for(var r=[],i=t;i<t+n;++i)r.push(("0"+e[i].toString(16)).slice(-2));return r.join("")},Gt=E?function(e,t,n){return Buffer.isBuffer(e)?e.toString("hex",t,t+n):Vt(e,t,n)}:Vt,Wt=function(e,t,n){for(var r=[],i=t;i<n;i++)r.push(String.fromCharCode(an(e,i)));return r.join("")},qt=E?function(e,t,n){return Buffer.isBuffer(e)?e.toString("utf8",t,n):Wt(e,t,n)}:Wt,Ht=function(e,t){var n=un(e,t);return n>0?qt(e,t+4,t+4+n-1):""},Kt=Ht,zt=function(e,t){var n=un(e,t);return n>0?qt(e,t+4,t+4+n-1):""},Yt=zt,Jt=function(e,t){var n=2*un(e,t);return n>0?qt(e,t+4,t+4+n-1):""},Xt=Jt,Qt=function(e,t){var n=un(e,t);return n>0?Bt(e,t+4,t+4+n):""},$t=Qt,Zt=function(e,t){var n=un(e,t);return n>0?qt(e,t+4,t+4+n):""},en=Zt,tn=function(e,t){return function(e,t){for(var n=1-2*(e[t+7]>>>7),r=((127&e[t+7])<<4)+(e[t+6]>>>4&15),i=15&e[t+6],o=5;o>=0;--o)i=256*i+e[t+o];return 2047==r?0==i?n*(1/0):NaN:(0==r?r=-1022:(r-=1023,i+=Math.pow(2,52)),n*Math.pow(2,r-52)*i)}(e,t)},nn=tn,rn=function(e){return Array.isArray(e)||"undefined"!==typeof Uint8Array&&e instanceof Uint8Array};function on(){Bt=function(e,t,n){return d.utils.decode(1200,e.slice(t,n)).replace(O,"")},qt=function(e,t,n){return d.utils.decode(65001,e.slice(t,n))},Kt=function(e,t){var n=un(e,t);return n>0?d.utils.decode(o,e.slice(t+4,t+4+n-1)):""},Yt=function(e,t){var n=un(e,t);return n>0?d.utils.decode(i,e.slice(t+4,t+4+n-1)):""},Xt=function(e,t){var n=2*un(e,t);return n>0?d.utils.decode(1200,e.slice(t+4,t+4+n-1)):""},$t=function(e,t){var n=un(e,t);return n>0?d.utils.decode(1200,e.slice(t+4,t+4+n)):""},en=function(e,t){var n=un(e,t);return n>0?d.utils.decode(65001,e.slice(t+4,t+4+n)):""}}E&&(Kt=function(e,t){if(!Buffer.isBuffer(e))return Ht(e,t);var n=e.readUInt32LE(t);return n>0?e.toString("utf8",t+4,t+4+n-1):""},Yt=function(e,t){if(!Buffer.isBuffer(e))return zt(e,t);var n=e.readUInt32LE(t);return n>0?e.toString("utf8",t+4,t+4+n-1):""},Xt=function(e,t){if(!Buffer.isBuffer(e))return Jt(e,t);var n=2*e.readUInt32LE(t);return e.toString("utf16le",t+4,t+4+n-1)},$t=function(e,t){if(!Buffer.isBuffer(e))return Qt(e,t);var n=e.readUInt32LE(t);return e.toString("utf16le",t+4,t+4+n)},en=function(e,t){if(!Buffer.isBuffer(e))return Zt(e,t);var n=e.readUInt32LE(t);return e.toString("utf8",t+4,t+4+n)},nn=function(e,t){return Buffer.isBuffer(e)?e.readDoubleLE(t):tn(e,t)},rn=function(e){return Buffer.isBuffer(e)||Array.isArray(e)||"undefined"!==typeof Uint8Array&&e instanceof Uint8Array}),"undefined"!==typeof d&&on();var an=function(e,t){return e[t]},sn=function(e,t){return 256*e[t+1]+e[t]},cn=function(e,t){var n=256*e[t+1]+e[t];return n<32768?n:-1*(65535-n+1)},un=function(e,t){return e[t+3]*(1<<24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]},ln=function(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]},fn=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]};function dn(e,t){var n,r,o,a,s,c,u="",l=[];switch(t){case"dbcs":if(c=this.l,E&&Buffer.isBuffer(this))u=this.slice(this.l,this.l+2*e).toString("utf16le");else for(s=0;s<e;++s)u+=String.fromCharCode(sn(this,c)),c+=2;e*=2;break;case"utf8":u=qt(this,this.l,this.l+e);break;case"utf16le":e*=2,u=Bt(this,this.l,this.l+e);break;case"wstr":if("undefined"===typeof d)return dn.call(this,e,"dbcs");u=d.utils.decode(i,this.slice(this.l,this.l+2*e)),e*=2;break;case"lpstr-ansi":u=Kt(this,this.l),e=4+un(this,this.l);break;case"lpstr-cp":u=Yt(this,this.l),e=4+un(this,this.l);break;case"lpwstr":u=Xt(this,this.l),e=4+2*un(this,this.l);break;case"lpp4":e=4+un(this,this.l),u=$t(this,this.l),2&e&&(e+=2);break;case"8lpp4":e=4+un(this,this.l),u=en(this,this.l),3&e&&(e+=4-(3&e));break;case"cstr":for(e=0,u="";0!==(o=an(this,this.l+e++));)l.push(p(o));u=l.join("");break;case"_wstr":for(e=0,u="";0!==(o=sn(this,this.l+e));)l.push(p(o)),e+=2;e+=2,u=l.join("");break;case"dbcs-cont":for(u="",c=this.l,s=0;s<e;++s){if(this.lens&&-1!==this.lens.indexOf(c))return o=an(this,c),this.l=c+1,a=dn.call(this,e-s,o?"dbcs-cont":"sbcs-cont"),l.join("")+a;l.push(p(sn(this,c))),c+=2}u=l.join(""),e*=2;break;case"cpstr":if("undefined"!==typeof d){u=d.utils.decode(i,this.slice(this.l,this.l+e));break}case"sbcs-cont":for(u="",c=this.l,s=0;s!=e;++s){if(this.lens&&-1!==this.lens.indexOf(c))return o=an(this,c),this.l=c+1,a=dn.call(this,e-s,o?"dbcs-cont":"sbcs-cont"),l.join("")+a;l.push(p(an(this,c))),c+=1}u=l.join("");break;default:switch(e){case 1:return n=an(this,this.l),this.l++,n;case 2:return n=("i"===t?cn:sn)(this,this.l),this.l+=2,n;case 4:case-4:return"i"===t||0===(128&this[this.l+3])?(n=(e>0?ln:fn)(this,this.l),this.l+=4,n):(r=un(this,this.l),this.l+=4,r);case 8:case-8:if("f"===t)return r=8==e?nn(this,this.l):nn([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,r;e=8;case 16:u=Gt(this,this.l,e)}}return this.l+=e,u}var pn=function(e,t,n){e[n]=255&t,e[n+1]=t>>>8&255};function hn(e,t,n){var r=0,i=0;if("dbcs"===n){for(i=0;i!=t.length;++i)pn(this,t.charCodeAt(i),this.l+2*i);r=2*t.length}else if("sbcs"===n){if("undefined"!==typeof d&&874==o)for(i=0;i!=t.length;++i){var a=d.utils.encode(o,t.charAt(i));this[this.l+i]=a[0]}else for(t=t.replace(/[^\x00-\x7F]/g,"_"),i=0;i!=t.length;++i)this[this.l+i]=255&t.charCodeAt(i);r=t.length}else{if("hex"===n){for(;i<e;++i)this[this.l++]=parseInt(t.slice(2*i,2*i+2),16)||0;return this}if("utf16le"===n){var s=Math.min(this.l+e,this.length);for(i=0;i<Math.min(t.length,e);++i){var c=t.charCodeAt(i);this[this.l++]=255&c,this[this.l++]=c>>8}for(;this.l<s;)this[this.l++]=0;return this}switch(e){case 1:r=1,this[this.l]=255&t;break;case 2:r=2,this[this.l]=255&t,t>>>=8,this[this.l+1]=255&t;break;case 3:r=3,this[this.l]=255&t,t>>>=8,this[this.l+1]=255&t,t>>>=8,this[this.l+2]=255&t;break;case 4:r=4,function(e,t,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24&255}(this,t,this.l);break;case 8:if(r=8,"f"===n){!function(e,t,n){var r=(t<0||1/t==-1/0?1:0)<<7,i=0,o=0,a=r?-t:t;isFinite(a)?0==a?i=o=0:(i=Math.floor(Math.log(a)/Math.LN2),o=a*Math.pow(2,52-i),i<=-1023&&(!isFinite(o)||o<Math.pow(2,52))?i=-1022:(o-=Math.pow(2,52),i+=1023)):(i=2047,o=isNaN(t)?26985:0);for(var s=0;s<=5;++s,o/=256)e[n+s]=255&o;e[n+6]=(15&i)<<4|15&o,e[n+7]=i>>4|r}(this,t,this.l);break}case 16:break;case-4:r=4,function(e,t,n){e[n]=255&t,e[n+1]=t>>8&255,e[n+2]=t>>16&255,e[n+3]=t>>24&255}(this,t,this.l)}}return this.l+=r,this}function vn(e,t){var n=Gt(this,this.l,e.length>>1);if(n!==e)throw new Error(t+"Expected "+e+" saw "+n);this.l+=e.length>>1}function mn(e,t){e.l=t,e.read_shift=dn,e.chk=vn,e.write_shift=hn}function gn(e,t){e.l+=t}function En(e){var t=b(e);return mn(t,0),t}function _n(){var e=[],t=E?256:2048,n=function(e){var t=En(e);return mn(t,0),t},r=n(t),i=function(){r&&(r.length>r.l&&((r=r.slice(0,r.l)).l=r.length),r.length>0&&e.push(r),r=null)},o=function(e){return r&&e<r.length-r.l?r:(i(),r=n(Math.max(e+1,t)))};return{next:o,push:function(e){i(),null==(r=e).l&&(r.l=r.length),o(t)},end:function(){return i(),R(e)},_bufs:e}}function bn(e,t,n,r){var i,o=+t;if(!isNaN(o)){r||(r=Na[o].p||(n||[]).length||0),i=1+(o>=128?1:0)+1,r>=128&&++i,r>=16384&&++i,r>=2097152&&++i;var a=e.next(i);o<=127?a.write_shift(1,o):(a.write_shift(1,128+(127&o)),a.write_shift(1,o>>7));for(var s=0;4!=s;++s){if(!(r>=128)){a.write_shift(1,r);break}a.write_shift(1,128+(127&r)),r>>=7}r>0&&rn(n)&&e.push(n)}}function yn(e,t,n){var r=Ve(e);if(t.s?(r.cRel&&(r.c+=t.s.c),r.rRel&&(r.r+=t.s.r)):(r.cRel&&(r.c+=t.c),r.rRel&&(r.r+=t.r)),!n||n.biff<12){for(;r.c>=256;)r.c-=256;for(;r.r>=65536;)r.r-=65536}return r}function Tn(e,t,n){var r=Ve(e);return r.s=yn(r.s,t.s,n),r.e=yn(r.e,t.s,n),r}function Sn(e,t){if(e.cRel&&e.c<0)for(e=Ve(e);e.c<0;)e.c+=t>8?16384:256;if(e.rRel&&e.r<0)for(e=Ve(e);e.r<0;)e.r+=t>8?1048576:t>5?65536:16384;var n=Cn(e);return e.cRel||null==e.cRel||(n=n.replace(/^([A-Z])/,"$$$1")),e.rRel||null==e.rRel||(n=function(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}(n)),n}function wn(e,t){return 0!=e.s.r||e.s.rRel||e.e.r!=(t.biff>=12?1048575:t.biff>=8?65536:16384)||e.e.rRel?0!=e.s.c||e.s.cRel||e.e.c!=(t.biff>=12?16383:255)||e.e.cRel?Sn(e.s,t.biff)+":"+Sn(e.e,t.biff):(e.s.rRel?"":"$")+On(e.s.r)+":"+(e.e.rRel?"":"$")+On(e.e.r):(e.s.cRel?"":"$")+An(e.s.c)+":"+(e.e.cRel?"":"$")+An(e.e.c)}function Rn(e){return parseInt(e.replace(/\$(\d+)$/,"$1"),10)-1}function On(e){return""+(e+1)}function In(e){for(var t=e.replace(/^\$([A-Z])/,"$1"),n=0,r=0;r!==t.length;++r)n=26*n+t.charCodeAt(r)-64;return n-1}function An(e){if(e<0)throw new Error("invalid column "+e);var t="";for(++e;e;e=Math.floor((e-1)/26))t=String.fromCharCode((e-1)%26+65)+t;return t}function kn(e){for(var t=0,n=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);i>=48&&i<=57?t=10*t+(i-48):i>=65&&i<=90&&(n=26*n+(i-64))}return{c:n-1,r:t-1}}function Cn(e){for(var t=e.c+1,n="";t;t=(t-1)/26|0)n=String.fromCharCode((t-1)%26+65)+n;return n+(e.r+1)}function Nn(e){var t=e.indexOf(":");return-1==t?{s:kn(e),e:kn(e)}:{s:kn(e.slice(0,t)),e:kn(e.slice(t+1))}}function xn(e,t){return"undefined"===typeof t||"number"===typeof t?xn(e.s,e.e):("string"!==typeof e&&(e=Cn(e)),"string"!==typeof t&&(t=Cn(t)),e==t?e:e+":"+t)}function Dn(e){var t={s:{c:0,r:0},e:{c:0,r:0}},n=0,r=0,i=0,o=e.length;for(n=0;r<o&&!((i=e.charCodeAt(r)-64)<1||i>26);++r)n=26*n+i;for(t.s.c=--n,n=0;r<o&&!((i=e.charCodeAt(r)-48)<0||i>9);++r)n=10*n+i;if(t.s.r=--n,r===o||10!=i)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++r,n=0;r!=o&&!((i=e.charCodeAt(r)-64)<1||i>26);++r)n=26*n+i;for(t.e.c=--n,n=0;r!=o&&!((i=e.charCodeAt(r)-48)<0||i>9);++r)n=10*n+i;return t.e.r=--n,t}function Pn(e,t){var n="d"==e.t&&t instanceof Date;if(null!=e.z)try{return e.w=me(e.z,n?Ne(t):t)}catch(r){}try{return e.w=me((e.XF||{}).numFmtId||(n?14:0),n?Ne(t):t)}catch(r){return""+t}}function Ln(e,t,n){return null==e||null==e.t||"z"==e.t?"":void 0!==e.w?e.w:("d"==e.t&&!e.z&&n&&n.dateNF&&(e.z=n.dateNF),"e"==e.t?mr[e.v]||e.v:Pn(e,void 0==t?e.v:t))}function Mn(e,t){var n=t&&t.sheet?t.sheet:"Sheet1",r={};return r[n]=e,{SheetNames:[n],Sheets:r}}function Un(e,t,n){var r=n||{},i=e?Array.isArray(e):r.dense;var o=e||(i?[]:{}),a=0,s=0;if(o&&null!=r.origin){if("number"==typeof r.origin)a=r.origin;else{var c="string"==typeof r.origin?kn(r.origin):r.origin;a=c.r,s=c.c}o["!ref"]||(o["!ref"]="A1:A1")}var u={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(o["!ref"]){var l=Dn(o["!ref"]);u.s.c=l.s.c,u.s.r=l.s.r,u.e.c=Math.max(u.e.c,l.e.c),u.e.r=Math.max(u.e.r,l.e.r),-1==a&&(u.e.r=a=l.e.r+1)}for(var f=0;f!=t.length;++f)if(t[f]){if(!Array.isArray(t[f]))throw new Error("aoa_to_sheet expects an array of arrays");for(var d=0;d!=t[f].length;++d)if("undefined"!==typeof t[f][d]){var p={v:t[f][d]},h=a+f,v=s+d;if(u.s.r>h&&(u.s.r=h),u.s.c>v&&(u.s.c=v),u.e.r<h&&(u.e.r=h),u.e.c<v&&(u.e.c=v),!t[f][d]||"object"!==typeof t[f][d]||Array.isArray(t[f][d])||t[f][d]instanceof Date)if(Array.isArray(p.v)&&(p.f=t[f][d][1],p.v=p.v[0]),null===p.v)if(p.f)p.t="n";else if(r.nullError)p.t="e",p.v=0;else{if(!r.sheetStubs)continue;p.t="z"}else"number"===typeof p.v?p.t="n":"boolean"===typeof p.v?p.t="b":p.v instanceof Date?(p.z=r.dateNF||U[14],r.cellDates?(p.t="d",p.w=me(p.z,Ne(p.v))):(p.t="n",p.v=Ne(p.v),p.w=me(p.z,p.v))):p.t="s";else p=t[f][d];if(i)o[h]||(o[h]=[]),o[h][v]&&o[h][v].z&&(p.z=o[h][v].z),o[h][v]=p;else{var m=Cn({c:v,r:h});o[m]&&o[m].z&&(p.z=o[m].z),o[m]=p}}}return u.s.c<1e7&&(o["!ref"]=xn(u)),o}function jn(e,t){return Un(null,e,t)}function Fn(e,t){return t||(t=En(4)),t.write_shift(4,e),t}function Bn(e){var t=e.read_shift(4);return 0===t?"":e.read_shift(t,"dbcs")}function Vn(e,t){var n=!1;return null==t&&(n=!0,t=En(4+2*e.length)),t.write_shift(4,e.length),e.length>0&&t.write_shift(0,e,"dbcs"),n?t.slice(0,t.l):t}function Gn(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function Wn(e,t){var n=e.l,r=e.read_shift(1),i=Bn(e),o=[],a={t:i,h:i};if(0!==(1&r)){for(var s=e.read_shift(4),c=0;c!=s;++c)o.push(Gn(e));a.r=o}else a.r=[{ich:0,ifnt:0}];return e.l=n+t,a}var qn=Wn;function Hn(e,t){var n=!1;return null==t&&(n=!0,t=En(23+4*e.t.length)),t.write_shift(1,1),Vn(e.t,t),t.write_shift(4,1),function(e,t){t||(t=En(4)),t.write_shift(2,e.ich||0),t.write_shift(2,e.ifnt||0)}({ich:0,ifnt:0},t),n?t.slice(0,t.l):t}function Kn(e){var t=e.read_shift(4),n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:t,iStyleRef:n}}function zn(e,t){return null==t&&(t=En(8)),t.write_shift(-4,e.c),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}function Yn(e){var t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:t}}function Jn(e,t){return null==t&&(t=En(4)),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}var Xn=Bn,Qn=Vn;function $n(e){var t=e.read_shift(4);return 0===t||4294967295===t?"":e.read_shift(t,"dbcs")}function Zn(e,t){var n=!1;return null==t&&(n=!0,t=En(127)),t.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&t.write_shift(0,e,"dbcs"),n?t.slice(0,t.l):t}var er=Bn,tr=$n,nr=Zn;function rr(e){var t=e.slice(e.l,e.l+4),n=1&t[0],r=2&t[0];e.l+=4;var i=0===r?nn([0,0,0,0,252&t[0],t[1],t[2],t[3]],0):ln(t,0)>>2;return n?i/100:i}function ir(e,t){null==t&&(t=En(4));var n=0,r=0,i=100*e;if(e==(0|e)&&e>=-(1<<29)&&e<1<<29?r=1:i==(0|i)&&i>=-(1<<29)&&i<1<<29&&(r=1,n=1),!r)throw new Error("unsupported RkNumber "+e);t.write_shift(-4,((n?i:e)<<2)+(n+2))}function or(e){var t={s:{},e:{}};return t.s.r=e.read_shift(4),t.e.r=e.read_shift(4),t.s.c=e.read_shift(4),t.e.c=e.read_shift(4),t}var ar=or,sr=function(e,t){return t||(t=En(16)),t.write_shift(4,e.s.r),t.write_shift(4,e.e.r),t.write_shift(4,e.s.c),t.write_shift(4,e.e.c),t};function cr(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function ur(e,t){return(t||En(8)).write_shift(8,e,"f")}function lr(e,t){if(t||(t=En(8)),!e||e.auto)return t.write_shift(4,0),t.write_shift(4,0),t;null!=e.index?(t.write_shift(1,2),t.write_shift(1,e.index)):null!=e.theme?(t.write_shift(1,6),t.write_shift(1,e.theme)):(t.write_shift(1,5),t.write_shift(1,0));var n=e.tint||0;if(n>0?n*=32767:n<0&&(n*=32768),t.write_shift(2,n),e.rgb&&null==e.theme){var r=e.rgb||"FFFFFF";"number"==typeof r&&(r=("000000"+r.toString(16)).slice(-6)),t.write_shift(1,parseInt(r.slice(0,2),16)),t.write_shift(1,parseInt(r.slice(2,4),16)),t.write_shift(1,parseInt(r.slice(4,6),16)),t.write_shift(1,255)}else t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);return t}var fr=80,dr={1:{n:"CodePage",t:2},2:{n:"Category",t:fr},3:{n:"PresentationFormat",t:fr},4:{n:"ByteCount",t:3},5:{n:"LineCount",t:3},6:{n:"ParagraphCount",t:3},7:{n:"SlideCount",t:3},8:{n:"NoteCount",t:3},9:{n:"HiddenCount",t:3},10:{n:"MultimediaClipCount",t:3},11:{n:"ScaleCrop",t:11},12:{n:"HeadingPairs",t:4108},13:{n:"TitlesOfParts",t:4126},14:{n:"Manager",t:fr},15:{n:"Company",t:fr},16:{n:"LinksUpToDate",t:11},17:{n:"CharacterCount",t:3},19:{n:"SharedDoc",t:11},22:{n:"HyperlinksChanged",t:11},23:{n:"AppVersion",t:3,p:"version"},24:{n:"DigSig",t:65},26:{n:"ContentType",t:fr},27:{n:"ContentStatus",t:fr},28:{n:"Language",t:fr},29:{n:"Version",t:fr},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}},pr={1:{n:"CodePage",t:2},2:{n:"Title",t:fr},3:{n:"Subject",t:fr},4:{n:"Author",t:fr},5:{n:"Keywords",t:fr},6:{n:"Comments",t:fr},7:{n:"Template",t:fr},8:{n:"LastAuthor",t:fr},9:{n:"RevNumber",t:fr},10:{n:"EditTime",t:64},11:{n:"LastPrinted",t:64},12:{n:"CreatedDate",t:64},13:{n:"ModifiedDate",t:64},14:{n:"PageCount",t:3},15:{n:"WordCount",t:3},16:{n:"CharCount",t:3},17:{n:"Thumbnail",t:71},18:{n:"Application",t:fr},19:{n:"DocSecurity",t:3},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}};function hr(e){return e.map((function(e){return[e>>16&255,e>>8&255,255&e]}))}var vr=Ve(hr([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),mr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},gr={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},Er={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function _r(e,t){var n,r=function(e){for(var t=[],n=Oe(e),r=0;r!==n.length;++r)null==t[e[n[r]]]&&(t[e[n[r]]]=[]),t[e[n[r]]].push(n[r]);return t}(gr),i=[];i[i.length]=Ye,i[i.length]=ht("Types",null,{xmlns:_t,"xmlns:xsd":At,"xmlns:xsi":It}),i=i.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map((function(e){return ht("Default",null,{Extension:e[0],ContentType:e[1]})})));var o=function(r){e[r]&&e[r].length>0&&(n=e[r][0],i[i.length]=ht("Override",null,{PartName:("/"==n[0]?"":"/")+n,ContentType:Er[r][t.bookType]||Er[r].xlsx}))},a=function(n){(e[n]||[]).forEach((function(e){i[i.length]=ht("Override",null,{PartName:("/"==e[0]?"":"/")+e,ContentType:Er[n][t.bookType]||Er[n].xlsx})}))},s=function(t){(e[t]||[]).forEach((function(e){i[i.length]=ht("Override",null,{PartName:("/"==e[0]?"":"/")+e,ContentType:r[t][0]})}))};return o("workbooks"),a("sheets"),a("charts"),s("themes"),["strs","styles"].forEach(o),["coreprops","extprops","custprops"].forEach(s),s("vba"),s("comments"),s("threadedcomments"),s("drawings"),a("metadata"),s("people"),i.length>2&&(i[i.length]="</Types>",i[1]=i[1].replace("/>",">")),i.join("")}var br={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function yr(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)+"_rels/"+e.slice(t+1)+".rels"}function Tr(e){var t=[Ye,ht("Relationships",null,{xmlns:bt})];return Oe(e["!id"]).forEach((function(n){t[t.length]=ht("Relationship",null,e["!id"][n])})),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function Sr(e,t,n,r,i,o){if(i||(i={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),t<0)for(t=e["!idx"];e["!id"]["rId"+t];++t);if(e["!idx"]=t+1,i.Id="rId"+t,i.Type=r,i.Target=n,o?i.TargetMode=o:[br.HLINK,br.XPATH,br.XMISS].indexOf(i.Type)>-1&&(i.TargetMode="External"),e["!id"][i.Id])throw new Error("Cannot rewrite rId "+t);return e["!id"][i.Id]=i,e[("/"+i.Target).replace("//","/")]=i,t}function wr(e,t,n){return['  <rdf:Description rdf:about="'+e+'">\n','    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(n||"odf")+"#"+t+'"/>\n',"  </rdf:Description>\n"].join("")}function Rr(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+r.version+"</meta:generator></office:meta></office:document-meta>"}var Or=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function Ir(e,t,n,r,i){null==i[e]&&null!=t&&""!==t&&(i[e]=t,t=Ze(t),r[r.length]=n?ht(e,t,n):dt(e,t))}function Ar(e,t){var n=t||{},r=[Ye,ht("cp:coreProperties",null,{"xmlns:cp":mt,"xmlns:dc":Tt,"xmlns:dcterms":St,"xmlns:dcmitype":wt,"xmlns:xsi":It})],i={};if(!e&&!n.Props)return r.join("");e&&(null!=e.CreatedDate&&Ir("dcterms:created","string"===typeof e.CreatedDate?e.CreatedDate:vt(e.CreatedDate,n.WTF),{"xsi:type":"dcterms:W3CDTF"},r,i),null!=e.ModifiedDate&&Ir("dcterms:modified","string"===typeof e.ModifiedDate?e.ModifiedDate:vt(e.ModifiedDate,n.WTF),{"xsi:type":"dcterms:W3CDTF"},r,i));for(var o=0;o!=Or.length;++o){var a=Or[o],s=n.Props&&null!=n.Props[a[1]]?n.Props[a[1]]:e?e[a[1]]:null;!0===s?s="1":!1===s?s="0":"number"==typeof s&&(s=String(s)),null!=s&&Ir(a[0],s,null,r,i)}return r.length>2&&(r[r.length]="</cp:coreProperties>",r[1]=r[1].replace("/>",">")),r.join("")}var kr=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],Cr=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function Nr(e){var t=[],n=ht;return e||(e={}),e.Application="SheetJS",t[t.length]=Ye,t[t.length]=ht("Properties",null,{xmlns:Et,"xmlns:vt":Ot}),kr.forEach((function(r){if(void 0!==e[r[1]]){var i;switch(r[2]){case"string":i=Ze(String(e[r[1]]));break;case"bool":i=e[r[1]]?"true":"false"}void 0!==i&&(t[t.length]=n(r[0],i))}})),t[t.length]=n("HeadingPairs",n("vt:vector",n("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+n("vt:variant",n("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=n("TitlesOfParts",n("vt:vector",e.SheetNames.map((function(e){return"<vt:lpstr>"+Ze(e)+"</vt:lpstr>"})).join(""),{size:e.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}function xr(e){var t=[Ye,ht("Properties",null,{xmlns:gt,"xmlns:vt":Ot})];if(!e)return t.join("");var n=1;return Oe(e).forEach((function(r){++n,t[t.length]=ht("property",function(e,t){switch(typeof e){case"string":var n=ht("vt:lpwstr",Ze(e));return t&&(n=n.replace(/&quot;/g,"_x0022_")),n;case"number":return ht((0|e)==e?"vt:i4":"vt:r8",Ze(String(e)));case"boolean":return ht("vt:bool",e?"true":"false")}if(e instanceof Date)return ht("vt:filetime",vt(e));throw new Error("Unable to serialize "+e)}(e[r],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:n,name:Ze(r)})})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var Dr={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function Pr(e,t){var n=En(4),r=En(4);switch(n.write_shift(4,80==e?31:e),e){case 3:r.write_shift(-4,t);break;case 5:(r=En(8)).write_shift(8,t,"f");break;case 11:r.write_shift(4,t?1:0);break;case 64:r=function(e){var t=("string"==typeof e?new Date(Date.parse(e)):e).getTime()/1e3+11644473600,n=t%Math.pow(2,32),r=(t-n)/Math.pow(2,32);r*=1e7;var i=(n*=1e7)/Math.pow(2,32)|0;i>0&&(n%=Math.pow(2,32),r+=i);var o=En(8);return o.write_shift(4,n),o.write_shift(4,r),o}(t);break;case 31:case 80:for((r=En(4+2*(t.length+1)+(t.length%2?0:2))).write_shift(4,t.length+1),r.write_shift(0,t,"dbcs");r.l!=r.length;)r.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+t)}return R([n,r])}var Lr=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function Mr(e){switch(typeof e){case"boolean":return 11;case"number":return(0|e)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64}return-1}function Ur(e,t,n){var r=En(8),i=[],o=[],a=8,s=0,c=En(8),u=En(8);if(c.write_shift(4,2),c.write_shift(4,1200),u.write_shift(4,1),o.push(c),i.push(u),a+=8+c.length,!t){(u=En(8)).write_shift(4,0),i.unshift(u);var l=[En(4)];for(l[0].write_shift(4,e.length),s=0;s<e.length;++s){var f=e[s][0];for((c=En(8+2*(f.length+1)+(f.length%2?0:2))).write_shift(4,s+2),c.write_shift(4,f.length+1),c.write_shift(0,f,"dbcs");c.l!=c.length;)c.write_shift(1,0);l.push(c)}c=R(l),o.unshift(c),a+=8+c.length}for(s=0;s<e.length;++s)if((!t||t[e[s][0]])&&!(Lr.indexOf(e[s][0])>-1||Cr.indexOf(e[s][0])>-1)&&null!=e[s][1]){var d=e[s][1],p=0;if(t){var h=n[p=+t[e[s][0]]];if("version"==h.p&&"string"==typeof d){var v=d.split(".");d=(+v[0]<<16)+(+v[1]||0)}c=Pr(h.t,d)}else{var m=Mr(d);-1==m&&(m=31,d=String(d)),c=Pr(m,d)}o.push(c),(u=En(8)).write_shift(4,t?p:2+s),i.push(u),a+=8+c.length}var g=8*(o.length+1);for(s=0;s<o.length;++s)i[s].write_shift(4,g),g+=o[s].length;return r.write_shift(4,a),r.write_shift(4,o.length),R([r].concat(i).concat(o))}function jr(e,t,n,r,i,o){var a=En(i?68:48),s=[a];a.write_shift(2,65534),a.write_shift(2,0),a.write_shift(4,842412599),a.write_shift(16,Te.utils.consts.HEADER_CLSID,"hex"),a.write_shift(4,i?2:1),a.write_shift(16,t,"hex"),a.write_shift(4,i?68:48);var c=Ur(e,n,r);if(s.push(c),i){var u=Ur(i,null,null);a.write_shift(16,o,"hex"),a.write_shift(4,68+c.length),s.push(u)}return R(s)}function Fr(e,t){return 1===e.read_shift(t)}function Br(e,t){return t||(t=En(2)),t.write_shift(2,+!!e),t}function Vr(e){return e.read_shift(2,"u")}function Gr(e,t){return t||(t=En(2)),t.write_shift(2,e),t}function Wr(e,t,n){return n||(n=En(2)),n.write_shift(1,"e"==t?+e:+!!e),n.write_shift(1,"e"==t?1:0),n}function qr(e,t,n){var r=e.read_shift(n&&n.biff>=12?2:1),o="sbcs-cont",a=i;(n&&n.biff>=8&&(i=1200),n&&8!=n.biff)?12==n.biff&&(o="wstr"):e.read_shift(1)&&(o="dbcs-cont");n.biff>=2&&n.biff<=5&&(o="cpstr");var s=r?e.read_shift(r,o):"";return i=a,s}function Hr(e){var t=e.t||"",n=En(3);n.write_shift(2,t.length),n.write_shift(1,1);var r=En(2*t.length);return r.write_shift(2*t.length,t,"utf16le"),R([n,r])}function Kr(e,t,n){if(n){if(n.biff>=2&&n.biff<=5)return e.read_shift(t,"cpstr");if(n.biff>=12)return e.read_shift(t,"dbcs-cont")}return 0===e.read_shift(1)?e.read_shift(t,"sbcs-cont"):e.read_shift(t,"dbcs-cont")}function zr(e,t,n){var r=e.read_shift(n&&2==n.biff?1:2);return 0===r?(e.l++,""):Kr(e,r,n)}function Yr(e,t,n){if(n.biff>5)return zr(e,0,n);var r=e.read_shift(1);return 0===r?(e.l++,""):e.read_shift(r,n.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function Jr(e,t,n){return n||(n=En(3+2*e.length)),n.write_shift(2,e.length),n.write_shift(1,1),n.write_shift(31,e,"utf16le"),n}function Xr(e,t){t||(t=En(6+2*e.length)),t.write_shift(4,1+e.length);for(var n=0;n<e.length;++n)t.write_shift(2,e.charCodeAt(n));return t.write_shift(2,0),t}function Qr(e){var t=En(512),n=0,r=e.Target;"file://"==r.slice(0,7)&&(r=r.slice(7));var i=r.indexOf("#"),o=i>-1?31:23;switch(r.charAt(0)){case"#":o=28;break;case".":o&=-3}t.write_shift(4,2),t.write_shift(4,o);var a=[8,6815827,6619237,4849780,83];for(n=0;n<a.length;++n)t.write_shift(4,a[n]);if(28==o)Xr(r=r.slice(1),t);else if(2&o){for(a="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),n=0;n<a.length;++n)t.write_shift(1,parseInt(a[n],16));var s=i>-1?r.slice(0,i):r;for(t.write_shift(4,2*(s.length+1)),n=0;n<s.length;++n)t.write_shift(2,s.charCodeAt(n));t.write_shift(2,0),8&o&&Xr(i>-1?r.slice(i+1):"",t)}else{for(a="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),n=0;n<a.length;++n)t.write_shift(1,parseInt(a[n],16));for(var c=0;"../"==r.slice(3*c,3*c+3)||"..\\"==r.slice(3*c,3*c+3);)++c;for(t.write_shift(2,c),t.write_shift(4,r.length-3*c+1),n=0;n<r.length-3*c;++n)t.write_shift(1,255&r.charCodeAt(n+3*c));for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),n=0;n<6;++n)t.write_shift(4,0)}return t.slice(0,t.l)}function $r(e,t,n,r){return r||(r=En(6)),r.write_shift(2,e),r.write_shift(2,t),r.write_shift(2,n||0),r}function Zr(e,t,n){var r=n.biff>8?4:2;return[e.read_shift(r),e.read_shift(r,"i"),e.read_shift(r,"i")]}function ei(e){var t=e.read_shift(2),n=e.read_shift(2);return{s:{c:e.read_shift(2),r:t},e:{c:e.read_shift(2),r:n}}}function ti(e,t){return t||(t=En(8)),t.write_shift(2,e.s.r),t.write_shift(2,e.e.r),t.write_shift(2,e.s.c),t.write_shift(2,e.e.c),t}function ni(e,t,n){var r=1536,i=16;switch(n.bookType){case"biff8":case"xla":break;case"biff5":r=1280,i=8;break;case"biff4":r=4,i=6;break;case"biff3":r=3,i=6;break;case"biff2":r=2,i=4;break;default:throw new Error("unsupported BIFF version")}var o=En(i);return o.write_shift(2,r),o.write_shift(2,t),i>4&&o.write_shift(2,29282),i>6&&o.write_shift(2,1997),i>8&&(o.write_shift(2,49161),o.write_shift(2,1),o.write_shift(2,1798),o.write_shift(2,0)),o}function ri(e,t){var n=!t||t.biff>=8?2:1,r=En(8+n*e.name.length);r.write_shift(4,e.pos),r.write_shift(1,e.hs||0),r.write_shift(1,e.dt),r.write_shift(1,e.name.length),t.biff>=8&&r.write_shift(1,1),r.write_shift(n*e.name.length,e.name,t.biff<8?"sbcs":"utf16le");var i=r.slice(0,r.l);return i.l=r.l,i}function ii(e,t,n,r){var i=n&&5==n.biff;r||(r=En(i?3+t.length:5+2*t.length)),r.write_shift(2,e),r.write_shift(i?1:2,t.length),i||r.write_shift(1,1),r.write_shift((i?1:2)*t.length,t,i?"sbcs":"utf16le");var o=r.length>r.l?r.slice(0,r.l):r;return null==o.l&&(o.l=o.length),o}function oi(e,t,n,r){var i=n&&5==n.biff;r||(r=En(i?16:20)),r.write_shift(2,0),e.style?(r.write_shift(2,e.numFmtId||0),r.write_shift(2,65524)):(r.write_shift(2,e.numFmtId||0),r.write_shift(2,t<<4));var o=0;return e.numFmtId>0&&i&&(o|=1024),r.write_shift(4,o),r.write_shift(4,0),i||r.write_shift(4,0),r.write_shift(2,0),r}function ai(e,t,n){if(n.biff<8)return function(e,t,n){3==e[e.l+1]&&e[e.l]++;var r=qr(e,0,n);return 3==r.charCodeAt(0)?r.slice(1):r}(e,0,n);for(var r=[],i=e.l+t,o=e.read_shift(n.biff>8?4:2);0!==o--;)r.push(Zr(e,n.biff,n));if(e.l!=i)throw new Error("Bad ExternSheet: "+e.l+" != "+i);return r}function si(e){var t=En(24),n=kn(e[0]);t.write_shift(2,n.r),t.write_shift(2,n.r),t.write_shift(2,n.c),t.write_shift(2,n.c);for(var r="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),i=0;i<16;++i)t.write_shift(1,parseInt(r[i],16));return R([t,Qr(e[1])])}function ci(e){var t=e[1].Tooltip,n=En(10+2*(t.length+1));n.write_shift(2,2048);var r=kn(e[0]);n.write_shift(2,r.r),n.write_shift(2,r.r),n.write_shift(2,r.c),n.write_shift(2,r.c);for(var i=0;i<t.length;++i)n.write_shift(2,t.charCodeAt(i));return n.write_shift(2,0),n}function ui(e,t,n){if(!n.cellStyles)return gn(e,t);var r=n&&n.biff>=12?4:2,i=e.read_shift(r),o=e.read_shift(r),a=e.read_shift(r),s=e.read_shift(r),c=e.read_shift(2);2==r&&(e.l+=2);var u={s:i,e:o,w:a,ixfe:s,flags:c};return(n.biff>=5||!n.biff)&&(u.level=c>>8&7),u}var li=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=Ae({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function n(t,n){var r=n||{};r.dateNF||(r.dateNF="yyyymmdd");var i=jn(function(t,n){var r=[],i=b(1);switch(n.type){case"base64":i=T(g(t));break;case"binary":i=T(t);break;case"buffer":case"array":i=t}mn(i,0);var o=i.read_shift(1),a=!!(136&o),s=!1,c=!1;switch(o){case 2:case 3:case 131:case 139:case 245:break;case 48:case 49:s=!0,a=!0;break;case 140:c=!0;break;default:throw new Error("DBF Unsupported Version: "+o.toString(16))}var u=0,l=521;2==o&&(u=i.read_shift(2)),i.l+=3,2!=o&&(u=i.read_shift(4)),u>1048576&&(u=1e6),2!=o&&(l=i.read_shift(2));var f=i.read_shift(2),p=n.codepage||1252;2!=o&&(i.l+=16,i.read_shift(1),0!==i[i.l]&&(p=e[i[i.l]]),i.l+=1,i.l+=2),c&&(i.l+=36);for(var h=[],v={},m=Math.min(i.length,2==o?521:l-10-(s?264:0)),E=c?32:11;i.l<m&&13!=i[i.l];)switch((v={}).name=d.utils.decode(p,i.slice(i.l,i.l+E)).replace(/[\u0000\r\n].*$/g,""),i.l+=E,v.type=String.fromCharCode(i.read_shift(1)),2==o||c||(v.offset=i.read_shift(4)),v.len=i.read_shift(1),2==o&&(v.offset=i.read_shift(2)),v.dec=i.read_shift(1),v.name.length&&h.push(v),2!=o&&(i.l+=c?13:14),v.type){case"B":s&&8==v.len||!n.WTF||console.log("Skipping "+v.name+":"+v.type);break;case"G":case"P":n.WTF&&console.log("Skipping "+v.name+":"+v.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+v.type)}if(13!==i[i.l]&&(i.l=l-1),13!==i.read_shift(1))throw new Error("DBF Terminator not found "+i.l+" "+i[i.l]);i.l=l;var _=0,y=0;for(r[0]=[],y=0;y!=h.length;++y)r[0][y]=h[y].name;for(;u-- >0;)if(42!==i[i.l])for(++i.l,r[++_]=[],y=0,y=0;y!=h.length;++y){var S=i.slice(i.l,i.l+h[y].len);i.l+=h[y].len,mn(S,0);var w=d.utils.decode(p,S);switch(h[y].type){case"C":w.trim().length&&(r[_][y]=w.replace(/\s+$/,""));break;case"D":8===w.length?r[_][y]=new Date(+w.slice(0,4),+w.slice(4,6)-1,+w.slice(6,8)):r[_][y]=w;break;case"F":r[_][y]=parseFloat(w.trim());break;case"+":case"I":r[_][y]=c?2147483648^S.read_shift(-4,"i"):S.read_shift(4,"i");break;case"L":switch(w.trim().toUpperCase()){case"Y":case"T":r[_][y]=!0;break;case"N":case"F":r[_][y]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+w+"|")}break;case"M":if(!a)throw new Error("DBF Unexpected MEMO for type "+o.toString(16));r[_][y]="##MEMO##"+(c?parseInt(w.trim(),10):S.read_shift(4));break;case"N":(w=w.replace(/\u0000/g,"").trim())&&"."!=w&&(r[_][y]=+w||0);break;case"@":r[_][y]=new Date(S.read_shift(-8,"f")-621356832e5);break;case"T":r[_][y]=new Date(864e5*(S.read_shift(4)-2440588)+S.read_shift(4));break;case"Y":r[_][y]=S.read_shift(4,"i")/1e4+S.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":r[_][y]=-S.read_shift(-8,"f");break;case"B":if(s&&8==h[y].len){r[_][y]=S.read_shift(8,"f");break}case"G":case"P":S.l+=h[y].len;break;case"0":if("_NullFlags"===h[y].name)break;default:throw new Error("DBF Unsupported data type "+h[y].type)}}else i.l+=f;if(2!=o&&i.l<i.length&&26!=i[i.l++])throw new Error("DBF EOF Marker missing "+(i.l-1)+" of "+i.length+" "+i[i.l-1].toString(16));return n&&n.sheetRows&&(r=r.slice(0,n.sheetRows)),n.DBF=h,r}(t,r),r);return i["!cols"]=r.DBF.map((function(e){return{wch:e.len,DBF:e}})),delete r.DBF,i}var r={B:8,C:250,L:1,D:8,"?":0,"":0};return{to_workbook:function(e,t){try{return Mn(n(e,t),t)}catch(r){if(t&&t.WTF)throw r}return{SheetNames:[],Sheets:{}}},to_sheet:n,from_sheet:function(e,n){var i=n||{};if(+i.codepage>=0&&u(+i.codepage),"string"==i.type)throw new Error("Cannot write DBF to JS string");var a=_n(),s=Is(e,{header:1,raw:!0,cellDates:!0}),c=s[0],l=s.slice(1),f=e["!cols"]||[],d=0,p=0,h=0,v=1;for(d=0;d<c.length;++d)if(((f[d]||{}).DBF||{}).name)c[d]=f[d].DBF.name,++h;else if(null!=c[d]){if(++h,"number"===typeof c[d]&&(c[d]=c[d].toString(10)),"string"!==typeof c[d])throw new Error("DBF Invalid column name "+c[d]+" |"+typeof c[d]+"|");if(c.indexOf(c[d])!==d)for(p=0;p<1024;++p)if(-1==c.indexOf(c[d]+"_"+p)){c[d]+="_"+p;break}}var m=Dn(e["!ref"]),g=[],E=[],_=[];for(d=0;d<=m.e.c-m.s.c;++d){var b="",y="",T=0,S=[];for(p=0;p<l.length;++p)null!=l[p][d]&&S.push(l[p][d]);if(0!=S.length&&null!=c[d]){for(p=0;p<S.length;++p){switch(typeof S[p]){case"number":y="B";break;case"string":default:y="C";break;case"boolean":y="L";break;case"object":y=S[p]instanceof Date?"D":"C"}T=Math.max(T,String(S[p]).length),b=b&&b!=y?"C":y}T>250&&(T=250),"C"==(y=((f[d]||{}).DBF||{}).type)&&f[d].DBF.len>T&&(T=f[d].DBF.len),"B"==b&&"N"==y&&(b="N",_[d]=f[d].DBF.dec,T=f[d].DBF.len),E[d]="C"==b||"N"==y?T:r[b]||0,v+=E[d],g[d]=b}else g[d]="?"}var w=a.next(32);for(w.write_shift(4,318902576),w.write_shift(4,l.length),w.write_shift(2,296+32*h),w.write_shift(2,v),d=0;d<4;++d)w.write_shift(4,0);for(w.write_shift(4,0|(+t[o]||3)<<8),d=0,p=0;d<c.length;++d)if(null!=c[d]){var R=a.next(32),O=(c[d].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);R.write_shift(1,O,"sbcs"),R.write_shift(1,"?"==g[d]?"C":g[d],"sbcs"),R.write_shift(4,p),R.write_shift(1,E[d]||r[g[d]]||0),R.write_shift(1,_[d]||0),R.write_shift(1,2),R.write_shift(4,0),R.write_shift(1,0),R.write_shift(4,0),R.write_shift(4,0),p+=E[d]||r[g[d]]||0}var I=a.next(264);for(I.write_shift(4,13),d=0;d<65;++d)I.write_shift(4,0);for(d=0;d<l.length;++d){var A=a.next(v);for(A.write_shift(1,0),p=0;p<c.length;++p)if(null!=c[p])switch(g[p]){case"L":A.write_shift(1,null==l[d][p]?63:l[d][p]?84:70);break;case"B":A.write_shift(8,l[d][p]||0,"f");break;case"N":var k="0";for("number"==typeof l[d][p]&&(k=l[d][p].toFixed(_[p]||0)),h=0;h<E[p]-k.length;++h)A.write_shift(1,32);A.write_shift(1,k,"sbcs");break;case"D":l[d][p]?(A.write_shift(4,("0000"+l[d][p].getFullYear()).slice(-4),"sbcs"),A.write_shift(2,("00"+(l[d][p].getMonth()+1)).slice(-2),"sbcs"),A.write_shift(2,("00"+l[d][p].getDate()).slice(-2),"sbcs")):A.write_shift(8,"00000000","sbcs");break;case"C":var C=String(null!=l[d][p]?l[d][p]:"").slice(0,E[p]);for(A.write_shift(1,C,"sbcs"),h=0;h<E[p]-C.length;++h)A.write_shift(1,32)}}return a.next(1).write_shift(1,26),a.end()}}}(),fi=function(){var e={AA:"\xc0",BA:"\xc1",CA:"\xc2",DA:195,HA:"\xc4",JA:197,AE:"\xc8",BE:"\xc9",CE:"\xca",HE:"\xcb",AI:"\xcc",BI:"\xcd",CI:"\xce",HI:"\xcf",AO:"\xd2",BO:"\xd3",CO:"\xd4",DO:213,HO:"\xd6",AU:"\xd9",BU:"\xda",CU:"\xdb",HU:"\xdc",Aa:"\xe0",Ba:"\xe1",Ca:"\xe2",Da:227,Ha:"\xe4",Ja:229,Ae:"\xe8",Be:"\xe9",Ce:"\xea",He:"\xeb",Ai:"\xec",Bi:"\xed",Ci:"\xee",Hi:"\xef",Ao:"\xf2",Bo:"\xf3",Co:"\xf4",Do:245,Ho:"\xf6",Au:"\xf9",Bu:"\xfa",Cu:"\xfb",Hu:"\xfc",KC:"\xc7",Kc:"\xe7",q:"\xe6",z:"\u0153",a:"\xc6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("\x1bN("+Oe(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),n=function(t,n){var r=e[n];return"number"==typeof r?h(r):r},r=function(e,t,n){var r=t.charCodeAt(0)-32<<4|n.charCodeAt(0)-48;return 59==r?e:h(r)};function i(e,i){var o,a=e.split(/[\n\r]+/),s=-1,c=-1,l=0,f=0,p=[],h=[],v=null,m={},g=[],E=[],_=[],b=0;for(+i.codepage>=0&&u(+i.codepage);l!==a.length;++l){b=0;var y,T=a[l].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,r).replace(t,n),S=T.replace(/;;/g,"\0").split(";").map((function(e){return e.replace(/\u0000/g,";")})),w=S[0];if(T.length>0)switch(w){case"ID":case"E":case"B":case"O":case"W":break;case"P":"P"==S[1].charAt(0)&&h.push(T.slice(3).replace(/;;/g,";"));break;case"C":var R=!1,O=!1,I=!1,A=!1,k=-1,C=-1;for(f=1;f<S.length;++f)switch(S[f].charAt(0)){case"A":case"G":break;case"X":c=parseInt(S[f].slice(1))-1,O=!0;break;case"Y":for(s=parseInt(S[f].slice(1))-1,O||(c=0),o=p.length;o<=s;++o)p[o]=[];break;case"K":'"'===(y=S[f].slice(1)).charAt(0)?y=y.slice(1,y.length-1):"TRUE"===y?y=!0:"FALSE"===y?y=!1:isNaN(We(y))?isNaN(He(y).getDate())||(y=Fe(y)):(y=We(y),null!==v&&de(v)&&(y=Le(y))),"undefined"!==typeof d&&"string"==typeof y&&"string"!=(i||{}).type&&(i||{}).codepage&&(y=d.utils.decode(i.codepage,y)),R=!0;break;case"E":A=!0;var N=to(S[f].slice(1),{r:s,c:c});p[s][c]=[p[s][c],N];break;case"S":I=!0,p[s][c]=[p[s][c],"S5S"];break;case"R":k=parseInt(S[f].slice(1))-1;break;case"C":C=parseInt(S[f].slice(1))-1;break;default:if(i&&i.WTF)throw new Error("SYLK bad record "+T)}if(R&&(p[s][c]&&2==p[s][c].length?p[s][c][0]=y:p[s][c]=y,v=null),I){if(A)throw new Error("SYLK shared formula cannot have own formula");var x=k>-1&&p[k][C];if(!x||!x[1])throw new Error("SYLK shared formula cannot find base");p[s][c][1]=io(x[1],{r:s-k,c:c-C})}break;case"F":var D=0;for(f=1;f<S.length;++f)switch(S[f].charAt(0)){case"X":c=parseInt(S[f].slice(1))-1,++D;break;case"Y":for(s=parseInt(S[f].slice(1))-1,o=p.length;o<=s;++o)p[o]=[];break;case"M":b=parseInt(S[f].slice(1))/20;break;case"F":case"G":case"S":case"D":case"N":break;case"P":v=h[parseInt(S[f].slice(1))];break;case"W":for(_=S[f].slice(1).split(" "),o=parseInt(_[0],10);o<=parseInt(_[1],10);++o)b=parseInt(_[2],10),E[o-1]=0===b?{hidden:!0}:{wch:b},Ai(E[o-1]);break;case"C":E[c=parseInt(S[f].slice(1))-1]||(E[c]={});break;case"R":g[s=parseInt(S[f].slice(1))-1]||(g[s]={}),b>0?(g[s].hpt=b,g[s].hpx=Ci(b)):0===b&&(g[s].hidden=!0);break;default:if(i&&i.WTF)throw new Error("SYLK bad record "+T)}D<1&&(v=null);break;default:if(i&&i.WTF)throw new Error("SYLK bad record "+T)}}return g.length>0&&(m["!rows"]=g),E.length>0&&(m["!cols"]=E),i&&i.sheetRows&&(p=p.slice(0,i.sheetRows)),[p,m]}function o(e,t){var n=function(e,t){switch(t.type){case"base64":return i(g(e),t);case"binary":return i(e,t);case"buffer":return i(E&&Buffer.isBuffer(e)?e.toString("binary"):w(e),t);case"array":return i(Be(e),t)}throw new Error("Unrecognized type "+t.type)}(e,t),r=n[0],o=n[1],a=jn(r,t);return Oe(o).forEach((function(e){a[e]=o[e]})),a}function a(e,t,n,r){var i="C;Y"+(n+1)+";X"+(r+1)+";K";switch(e.t){case"n":i+=e.v||0,e.f&&!e.F&&(i+=";E"+ro(e.f,{r:n,c:r}));break;case"b":i+=e.v?"TRUE":"FALSE";break;case"e":i+=e.w||e.v;break;case"d":i+='"'+(e.w||e.v)+'"';break;case"s":i+='"'+e.v.replace(/"/g,"").replace(/;/g,";;")+'"'}return i}return e["|"]=254,{to_workbook:function(e,t){return Mn(o(e,t),t)},to_sheet:o,from_sheet:function(e,t){var n,r,i=["ID;PWXL;N;E"],o=[],s=Dn(e["!ref"]),c=Array.isArray(e),u="\r\n";i.push("P;PGeneral"),i.push("F;P0;DG0G8;M255"),e["!cols"]&&(r=i,e["!cols"].forEach((function(e,t){var n="F;W"+(t+1)+" "+(t+1)+" ";e.hidden?n+="0":("number"!=typeof e.width||e.wpx||(e.wpx=Ri(e.width)),"number"!=typeof e.wpx||e.wch||(e.wch=Oi(e.wpx)),"number"==typeof e.wch&&(n+=Math.round(e.wch)))," "!=n.charAt(n.length-1)&&r.push(n)}))),e["!rows"]&&function(e,t){t.forEach((function(t,n){var r="F;";t.hidden?r+="M0;":t.hpt?r+="M"+20*t.hpt+";":t.hpx&&(r+="M"+20*ki(t.hpx)+";"),r.length>2&&e.push(r+"R"+(n+1))}))}(i,e["!rows"]),i.push("B;Y"+(s.e.r-s.s.r+1)+";X"+(s.e.c-s.s.c+1)+";D"+[s.s.c,s.s.r,s.e.c,s.e.r].join(" "));for(var l=s.s.r;l<=s.e.r;++l)for(var f=s.s.c;f<=s.e.c;++f){var d=Cn({r:l,c:f});(n=c?(e[l]||[])[f]:e[d])&&(null!=n.v||n.f&&!n.F)&&o.push(a(n,0,l,f))}return i.join(u)+u+o.join(u)+u+"E"+u}}}(),di=function(){function e(e,t){for(var n=e.split("\n"),r=-1,i=-1,o=0,a=[];o!==n.length;++o)if("BOT"!==n[o].trim()){if(!(r<0)){for(var s=n[o].trim().split(","),c=s[0],u=s[1],l=n[++o]||"";1&(l.match(/["]/g)||[]).length&&o<n.length-1;)l+="\n"+n[++o];switch(l=l.trim(),+c){case-1:if("BOT"===l){a[++r]=[],i=0;continue}if("EOD"!==l)throw new Error("Unrecognized DIF special command "+l);break;case 0:"TRUE"===l?a[r][i]=!0:"FALSE"===l?a[r][i]=!1:isNaN(We(u))?isNaN(He(u).getDate())?a[r][i]=u:a[r][i]=Fe(u):a[r][i]=We(u),++i;break;case 1:(l=(l=l.slice(1,l.length-1)).replace(/""/g,'"'))&&l.match(/^=".*"$/)&&(l=l.slice(2,-1)),a[r][i++]=""!==l?l:null}if("EOD"===l)break}}else a[++r]=[],i=0;return t&&t.sheetRows&&(a=a.slice(0,t.sheetRows)),a}function t(t,n){return jn(function(t,n){switch(n.type){case"base64":return e(g(t),n);case"binary":return e(t,n);case"buffer":return e(E&&Buffer.isBuffer(t)?t.toString("binary"):w(t),n);case"array":return e(Be(t),n)}throw new Error("Unrecognized type "+n.type)}(t,n),n)}return{to_workbook:function(e,n){return Mn(t(e,n),n)},to_sheet:t,from_sheet:function(){var e=function(e,t,n,r,i){e.push(t),e.push(n+","+r),e.push('"'+i.replace(/"/g,'""')+'"')},t=function(e,t,n,r){e.push(t+","+n),e.push(1==t?'"'+r.replace(/"/g,'""')+'"':r)};return function(n){var r,i=[],o=Dn(n["!ref"]),a=Array.isArray(n);e(i,"TABLE",0,1,"sheetjs"),e(i,"VECTORS",0,o.e.r-o.s.r+1,""),e(i,"TUPLES",0,o.e.c-o.s.c+1,""),e(i,"DATA",0,0,"");for(var s=o.s.r;s<=o.e.r;++s){t(i,-1,0,"BOT");for(var c=o.s.c;c<=o.e.c;++c){var u=Cn({r:s,c:c});if(r=a?(n[s]||[])[c]:n[u])switch(r.t){case"n":var l=r.w;l||null==r.v||(l=r.v),null==l?r.f&&!r.F?t(i,1,0,"="+r.f):t(i,1,0,""):t(i,0,l,"V");break;case"b":t(i,0,r.v?1:0,r.v?"TRUE":"FALSE");break;case"s":t(i,1,0,isNaN(r.v)?r.v:'="'+r.v+'"');break;case"d":r.w||(r.w=me(r.z||U[14],Ne(Fe(r.v)))),t(i,0,r.w,"V");break;default:t(i,1,0,"")}else t(i,1,0,"")}}t(i,-1,0,"EOD");return i.join("\r\n")}}()}}(),pi=function(){function e(e){return e.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function t(e,t){return jn(function(e,t){for(var n=e.split("\n"),r=-1,i=-1,o=0,a=[];o!==n.length;++o){var s=n[o].trim().split(":");if("cell"===s[0]){var c=kn(s[1]);if(a.length<=c.r)for(r=a.length;r<=c.r;++r)a[r]||(a[r]=[]);switch(r=c.r,i=c.c,s[2]){case"t":a[r][i]=s[3].replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,"\n");break;case"v":a[r][i]=+s[3];break;case"vtf":var u=s[s.length-1];case"vtc":"nl"===s[3]?a[r][i]=!!+s[4]:a[r][i]=+s[4],"vtf"==s[2]&&(a[r][i]=[a[r][i],u])}}}return t&&t.sheetRows&&(a=a.slice(0,t.sheetRows)),a}(e,t),t)}var n=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join("\n"),r=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join("\n")+"\n",i=["# SocialCalc Spreadsheet Control Save","part:sheet"].join("\n"),o="--SocialCalcSpreadsheetControlSave--";function a(t){if(!t||!t["!ref"])return"";for(var n,r=[],i=[],o="",a=Nn(t["!ref"]),s=Array.isArray(t),c=a.s.r;c<=a.e.r;++c)for(var u=a.s.c;u<=a.e.c;++u)if(o=Cn({r:c,c:u}),(n=s?(t[c]||[])[u]:t[o])&&null!=n.v&&"z"!==n.t){switch(i=["cell",o,"t"],n.t){case"s":case"str":i.push(e(n.v));break;case"n":n.f?(i[2]="vtf",i[3]="n",i[4]=n.v,i[5]=e(n.f)):(i[2]="v",i[3]=n.v);break;case"b":i[2]="vt"+(n.f?"f":"c"),i[3]="nl",i[4]=n.v?"1":"0",i[5]=e(n.f||(n.v?"TRUE":"FALSE"));break;case"d":var l=Ne(Fe(n.v));i[2]="vtc",i[3]="nd",i[4]=""+l,i[5]=n.w||me(n.z||U[14],l);break;case"e":continue}r.push(i.join(":"))}return r.push("sheet:c:"+(a.e.c-a.s.c+1)+":r:"+(a.e.r-a.s.r+1)+":tvf:1"),r.push("valueformat:1:text-wiki"),r.join("\n")}return{to_workbook:function(e,n){return Mn(t(e,n),n)},to_sheet:t,from_sheet:function(e){return[n,r,i,r,a(e),o].join("\n")}}}(),hi=function(){function e(e,t,n,r,i){i.raw?t[n][r]=e:""===e||("TRUE"===e?t[n][r]=!0:"FALSE"===e?t[n][r]=!1:isNaN(We(e))?isNaN(He(e).getDate())?t[n][r]=e:t[n][r]=Fe(e):t[n][r]=We(e))}var t={44:",",9:"\t",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function r(e){for(var r={},i=!1,o=0,a=0;o<e.length;++o)34==(a=e.charCodeAt(o))?i=!i:!i&&a in t&&(r[a]=(r[a]||0)+1);for(o in a=[],r)Object.prototype.hasOwnProperty.call(r,o)&&a.push([r[o],o]);if(!a.length)for(o in r=n)Object.prototype.hasOwnProperty.call(r,o)&&a.push([r[o],o]);return a.sort((function(e,t){return e[0]-t[0]||n[e[1]]-n[t[1]]})),t[a.pop()[1]]||44}function i(e,t){var n=t||{},i="";var o=n.dense?[]:{},a={s:{c:0,r:0},e:{c:0,r:0}};"sep="==e.slice(0,4)?13==e.charCodeAt(5)&&10==e.charCodeAt(6)?(i=e.charAt(4),e=e.slice(7)):13==e.charCodeAt(5)||10==e.charCodeAt(5)?(i=e.charAt(4),e=e.slice(6)):i=r(e.slice(0,1024)):i=n&&n.FS?n.FS:r(e.slice(0,1024));var s=0,c=0,u=0,l=0,f=0,d=i.charCodeAt(0),p=!1,h=0,v=e.charCodeAt(0);e=e.replace(/\r\n/gm,"\n");var m=null!=n.dateNF?function(e){var t="number"==typeof e?U[e]:e;return t=t.replace(be,"(\\d+)"),new RegExp("^"+t+"$")}(n.dateNF):null;function g(){var t=e.slice(l,f),r={};if('"'==t.charAt(0)&&'"'==t.charAt(t.length-1)&&(t=t.slice(1,-1).replace(/""/g,'"')),0===t.length)r.t="z";else if(n.raw)r.t="s",r.v=t;else if(0===t.trim().length)r.t="s",r.v=t;else if(61==t.charCodeAt(0))34==t.charCodeAt(1)&&34==t.charCodeAt(t.length-1)?(r.t="s",r.v=t.slice(2,-1).replace(/""/g,'"')):1!=t.length?(r.t="n",r.f=t.slice(1)):(r.t="s",r.v=t);else if("TRUE"==t)r.t="b",r.v=!0;else if("FALSE"==t)r.t="b",r.v=!1;else if(isNaN(u=We(t)))if(!isNaN(He(t).getDate())||m&&t.match(m)){r.z=n.dateNF||U[14];var i=0;m&&t.match(m)&&(t=function(e,t,n){var r=-1,i=-1,o=-1,a=-1,s=-1,c=-1;(t.match(be)||[]).forEach((function(e,t){var u=parseInt(n[t+1],10);switch(e.toLowerCase().charAt(0)){case"y":r=u;break;case"d":o=u;break;case"h":a=u;break;case"s":c=u;break;case"m":a>=0?s=u:i=u}})),c>=0&&-1==s&&i>=0&&(s=i,i=-1);var u=(""+(r>=0?r:(new Date).getFullYear())).slice(-4)+"-"+("00"+(i>=1?i:1)).slice(-2)+"-"+("00"+(o>=1?o:1)).slice(-2);7==u.length&&(u="0"+u),8==u.length&&(u="20"+u);var l=("00"+(a>=0?a:0)).slice(-2)+":"+("00"+(s>=0?s:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2);return-1==a&&-1==s&&-1==c?u:-1==r&&-1==i&&-1==o?l:u+"T"+l}(0,n.dateNF,t.match(m)||[]),i=1),n.cellDates?(r.t="d",r.v=Fe(t,i)):(r.t="n",r.v=Ne(Fe(t,i))),!1!==n.cellText&&(r.w=me(r.z,r.v instanceof Date?Ne(r.v):r.v)),n.cellNF||delete r.z}else r.t="s",r.v=t;else r.t="n",!1!==n.cellText&&(r.w=t),r.v=u;if("z"==r.t||(n.dense?(o[s]||(o[s]=[]),o[s][c]=r):o[Cn({c:c,r:s})]=r),l=f+1,v=e.charCodeAt(l),a.e.c<c&&(a.e.c=c),a.e.r<s&&(a.e.r=s),h==d)++c;else if(c=0,++s,n.sheetRows&&n.sheetRows<=s)return!0}e:for(;f<e.length;++f)switch(h=e.charCodeAt(f)){case 34:34===v&&(p=!p);break;case d:case 10:case 13:if(!p&&g())break e}return f-l>0&&g(),o["!ref"]=xn(a),o}function o(t,n){return n&&n.PRN?n.FS||"sep="==t.slice(0,4)||t.indexOf("\t")>=0||t.indexOf(",")>=0||t.indexOf(";")>=0?i(t,n):jn(function(t,n){var r=n||{},i=[];if(!t||0===t.length)return i;for(var o=t.split(/[\r\n]/),a=o.length-1;a>=0&&0===o[a].length;)--a;for(var s=10,c=0,u=0;u<=a;++u)-1==(c=o[u].indexOf(" "))?c=o[u].length:c++,s=Math.max(s,c);for(u=0;u<=a;++u){i[u]=[];var l=0;for(e(o[u].slice(0,s).trim(),i,u,l,r),l=1;l<=(o[u].length-s)/10+1;++l)e(o[u].slice(s+10*(l-1),s+10*l).trim(),i,u,l,r)}return r.sheetRows&&(i=i.slice(0,r.sheetRows)),i}(t,n),n):i(t,n)}function a(e,t){var n="",r="string"==t.type?[0,0,0,0]:bs(e,t);switch(t.type){case"base64":n=g(e);break;case"binary":case"string":n=e;break;case"buffer":n=65001==t.codepage?e.toString("utf8"):t.codepage&&"undefined"!==typeof d?d.utils.decode(t.codepage,e):E&&Buffer.isBuffer(e)?e.toString("binary"):w(e);break;case"array":n=Be(e);break;default:throw new Error("Unrecognized type "+t.type)}return 239==r[0]&&187==r[1]&&191==r[2]?n=ct(n.slice(3)):"string"!=t.type&&"buffer"!=t.type&&65001==t.codepage?n=ct(n):"binary"==t.type&&"undefined"!==typeof d&&t.codepage&&(n=d.utils.decode(t.codepage,d.utils.encode(28591,n))),"socialcalc:version:"==n.slice(0,19)?pi.to_sheet("string"==t.type?n:ct(n),t):o(n,t)}return{to_workbook:function(e,t){return Mn(a(e,t),t)},to_sheet:a,from_sheet:function(e){for(var t,n=[],r=Dn(e["!ref"]),i=Array.isArray(e),o=r.s.r;o<=r.e.r;++o){for(var a=[],s=r.s.c;s<=r.e.c;++s){var c=Cn({r:o,c:s});if((t=i?(e[o]||[])[s]:e[c])&&null!=t.v){for(var u=(t.w||(Ln(t),t.w)||"").slice(0,10);u.length<10;)u+=" ";a.push(u+(0===s?" ":""))}else a.push("          ")}n.push(a.join(""))}return n.join("\n")}}}();var vi=function(){function e(e,t,n){if(e){mn(e,e.l||0);for(var r=n.Enum||_;e.l<e.length;){var i=e.read_shift(2),o=r[i]||r[65535],a=e.read_shift(2),s=e.l+a,c=o.f&&o.f(e,a,n);if(e.l=s,t(c,o,i))return}}}function t(t,n){if(!t)return t;var r=n||{};var i=r.dense?[]:{},o="Sheet1",a="",s=0,c={},u=[],l=[],f={s:{r:0,c:0},e:{r:0,c:0}},d=r.sheetRows||0;if(0==t[2]&&(8==t[3]||9==t[3])&&t.length>=16&&5==t[14]&&108===t[15])throw new Error("Unsupported Works 3 for Mac file");if(2==t[2])r.Enum=_,e(t,(function(e,t,n){switch(n){case 0:r.vers=e,e>=4096&&(r.qpro=!0);break;case 6:f=e;break;case 204:e&&(a=e);break;case 222:a=e;break;case 15:case 51:r.qpro||(e[1].v=e[1].v.slice(1));case 13:case 14:case 16:14==n&&112==(112&e[2])&&(15&e[2])>1&&(15&e[2])<15&&(e[1].z=r.dateNF||U[14],r.cellDates&&(e[1].t="d",e[1].v=Le(e[1].v))),r.qpro&&e[3]>s&&(i["!ref"]=xn(f),c[o]=i,u.push(o),i=r.dense?[]:{},f={s:{r:0,c:0},e:{r:0,c:0}},s=e[3],o=a||"Sheet"+(s+1),a="");var l=r.dense?(i[e[0].r]||[])[e[0].c]:i[Cn(e[0])];if(l){l.t=e[1].t,l.v=e[1].v,null!=e[1].z&&(l.z=e[1].z),null!=e[1].f&&(l.f=e[1].f);break}r.dense?(i[e[0].r]||(i[e[0].r]=[]),i[e[0].r][e[0].c]=e[1]):i[Cn(e[0])]=e[1]}}),r);else{if(26!=t[2]&&14!=t[2])throw new Error("Unrecognized LOTUS BOF "+t[2]);r.Enum=b,14==t[2]&&(r.qpro=!0,t.l=0),e(t,(function(e,t,n){switch(n){case 204:o=e;break;case 22:e[1].v=e[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(e[3]>s&&(i["!ref"]=xn(f),c[o]=i,u.push(o),i=r.dense?[]:{},f={s:{r:0,c:0},e:{r:0,c:0}},s=e[3],o="Sheet"+(s+1)),d>0&&e[0].r>=d)break;r.dense?(i[e[0].r]||(i[e[0].r]=[]),i[e[0].r][e[0].c]=e[1]):i[Cn(e[0])]=e[1],f.e.c<e[0].c&&(f.e.c=e[0].c),f.e.r<e[0].r&&(f.e.r=e[0].r);break;case 27:e[14e3]&&(l[e[14e3][0]]=e[14e3][1]);break;case 1537:l[e[0]]=e[1],e[0]==s&&(o=e[1])}}),r)}if(i["!ref"]=xn(f),c[a||o]=i,u.push(a||o),!l.length)return{SheetNames:u,Sheets:c};for(var p={},h=[],v=0;v<l.length;++v)c[u[v]]?(h.push(l[v]||u[v]),p[l[v]]=c[l[v]]||c[u[v]]):(h.push(l[v]),p[l[v]]={"!ref":"A1"});return{SheetNames:h,Sheets:p}}function n(e,t,n){var r=[{c:0,r:0},{t:"n",v:0},0,0];return n.qpro&&20768!=n.vers?(r[0].c=e.read_shift(1),r[3]=e.read_shift(1),r[0].r=e.read_shift(2),e.l+=2):(r[2]=e.read_shift(1),r[0].c=e.read_shift(2),r[0].r=e.read_shift(2)),r}function r(e,t,r){var i=e.l+t,o=n(e,0,r);if(o[1].t="s",20768==r.vers){e.l++;var a=e.read_shift(1);return o[1].v=e.read_shift(a,"utf8"),o}return r.qpro&&e.l++,o[1].v=e.read_shift(i-e.l,"cstr"),o}function i(e,t,n){var r=En(7+n.length);r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(1,39);for(var i=0;i<r.length;++i){var o=n.charCodeAt(i);r.write_shift(1,o>=128?95:o)}return r.write_shift(1,0),r}function o(e,t,n){var r=En(7);return r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(2,n,"i"),r}function a(e,t,n){var r=En(13);return r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(8,n,"f"),r}function s(e,t,n){var r=32768&t;return t=(r?e:0)+((t&=-32769)>=8192?t-16384:t),(r?"":"$")+(n?An(t):On(t))}var c={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},l=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function f(e){var t=[{c:0,r:0},{t:"n",v:0},0];return t[0].r=e.read_shift(2),t[3]=e[e.l++],t[0].c=e[e.l++],t}function d(e,t,n,r){var i=En(6+r.length);i.write_shift(2,e),i.write_shift(1,n),i.write_shift(1,t),i.write_shift(1,39);for(var o=0;o<r.length;++o){var a=r.charCodeAt(o);i.write_shift(1,a>=128?95:a)}return i.write_shift(1,0),i}function p(e,t){var n=f(e),r=e.read_shift(4),i=e.read_shift(4),o=e.read_shift(2);if(65535==o)return 0===r&&3221225472===i?(n[1].t="e",n[1].v=15):0===r&&3489660928===i?(n[1].t="e",n[1].v=42):n[1].v=0,n;var a=32768&o;return o=(32767&o)-16446,n[1].v=(1-2*a)*(i*Math.pow(2,o+32)+r*Math.pow(2,o)),n}function h(e,t,n,r){var i=En(14);if(i.write_shift(2,e),i.write_shift(1,n),i.write_shift(1,t),0==r)return i.write_shift(4,0),i.write_shift(4,0),i.write_shift(2,65535),i;var o,a=0,s=0,c=0;return r<0&&(a=1,r=-r),s=0|Math.log2(r),0==(2147483648&(c=(r/=Math.pow(2,s-31))>>>0))&&(++s,c=(r/=2)>>>0),r-=c,c|=2147483648,c>>>=0,o=(r*=Math.pow(2,32))>>>0,i.write_shift(4,o),i.write_shift(4,c),s+=16383+(a?32768:0),i.write_shift(2,s),i}function v(e,t){var n=f(e),r=e.read_shift(8,"f");return n[1].v=r,n}function m(e,t){return 0==e[e.l+t-1]?e.read_shift(t,"cstr"):""}function E(e,t){var n=En(5+e.length);n.write_shift(2,14e3),n.write_shift(2,t);for(var r=0;r<e.length;++r){var i=e.charCodeAt(r);n[n.l++]=i>127?95:i}return n[n.l++]=0,n}var _={0:{n:"BOF",f:Vr},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:function(e,t,n){var r={s:{c:0,r:0},e:{c:0,r:0}};return 8==t&&n.qpro?(r.s.c=e.read_shift(1),e.l++,r.s.r=e.read_shift(2),r.e.c=e.read_shift(1),e.l++,r.e.r=e.read_shift(2),r):(r.s.c=e.read_shift(2),r.s.r=e.read_shift(2),12==t&&n.qpro&&(e.l+=2),r.e.c=e.read_shift(2),r.e.r=e.read_shift(2),12==t&&n.qpro&&(e.l+=2),65535==r.s.c&&(r.s.c=r.e.c=r.s.r=r.e.r=0),r)}},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:function(e,t,r){var i=n(e,0,r);return i[1].v=e.read_shift(2,"i"),i}},14:{n:"NUMBER",f:function(e,t,r){var i=n(e,0,r);return i[1].v=e.read_shift(8,"f"),i}},15:{n:"LABEL",f:r},16:{n:"FORMULA",f:function(e,t,r){var i=e.l+t,o=n(e,0,r);if(o[1].v=e.read_shift(8,"f"),r.qpro)e.l=i;else{var a=e.read_shift(2);!function(e,t){mn(e,0);var n=[],r=0,i="",o="",a="",u="";for(;e.l<e.length;){var f=e[e.l++];switch(f){case 0:n.push(e.read_shift(8,"f"));break;case 1:o=s(t[0].c,e.read_shift(2),!0),i=s(t[0].r,e.read_shift(2),!1),n.push(o+i);break;case 2:var d=s(t[0].c,e.read_shift(2),!0),p=s(t[0].r,e.read_shift(2),!1);o=s(t[0].c,e.read_shift(2),!0),i=s(t[0].r,e.read_shift(2),!1),n.push(d+p+":"+o+i);break;case 3:if(e.l<e.length)return void console.error("WK1 premature formula end");break;case 4:n.push("("+n.pop()+")");break;case 5:n.push(e.read_shift(2));break;case 6:for(var h="";f=e[e.l++];)h+=String.fromCharCode(f);n.push('"'+h.replace(/"/g,'""')+'"');break;case 8:n.push("-"+n.pop());break;case 23:n.push("+"+n.pop());break;case 22:n.push("NOT("+n.pop()+")");break;case 20:case 21:u=n.pop(),a=n.pop(),n.push(["AND","OR"][f-20]+"("+a+","+u+")");break;default:if(f<32&&l[f])u=n.pop(),a=n.pop(),n.push(a+l[f]+u);else{if(!c[f])return f<=7?console.error("WK1 invalid opcode "+f.toString(16)):f<=24?console.error("WK1 unsupported op "+f.toString(16)):f<=30?console.error("WK1 invalid opcode "+f.toString(16)):f<=115?console.error("WK1 unsupported function opcode "+f.toString(16)):console.error("WK1 unrecognized opcode "+f.toString(16));if(69==(r=c[f][1])&&(r=e[e.l++]),r>n.length)return void console.error("WK1 bad formula parse 0x"+f.toString(16)+":|"+n.join("|")+"|");var v=n.slice(-r);n.length-=r,n.push(c[f][0]+"("+v.join(",")+")")}}}1==n.length?t[1].f=""+n[0]:console.error("WK1 bad formula parse |"+n.join("|")+"|")}(e.slice(e.l,e.l+a),o),e.l+=a}return o}},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:r},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:m},222:{n:"SHEETNAMELP",f:function(e,t){var n=e[e.l++];n>t-1&&(n=t-1);for(var r="";r.length<n;)r+=String.fromCharCode(e[e.l++]);return r}},65535:{n:""}},b={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:function(e,t){var n=f(e);return n[1].t="s",n[1].v=e.read_shift(t-4,"cstr"),n}},23:{n:"NUMBER17",f:p},24:{n:"NUMBER18",f:function(e,t){var n=f(e);n[1].v=e.read_shift(2);var r=n[1].v>>1;if(1&n[1].v)switch(7&r){case 0:r=5e3*(r>>3);break;case 1:r=500*(r>>3);break;case 2:r=(r>>3)/20;break;case 3:r=(r>>3)/200;break;case 4:r=(r>>3)/2e3;break;case 5:r=(r>>3)/2e4;break;case 6:r=(r>>3)/16;break;case 7:r=(r>>3)/64}return n[1].v=r,n}},25:{n:"FORMULA19",f:function(e,t){var n=p(e);return e.l+=t-14,n}},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:function(e,t){for(var n={},r=e.l+t;e.l<r;){var i=e.read_shift(2);if(14e3==i){for(n[i]=[0,""],n[i][0]=e.read_shift(2);e[e.l];)n[i][1]+=String.fromCharCode(e[e.l]),e.l++;e.l++}}return n}},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:function(e,t){var n=f(e),r=e.read_shift(4);return n[1].v=r>>6,n}},38:{n:"??"},39:{n:"NUMBER27",f:v},40:{n:"FORMULA28",f:function(e,t){var n=v(e);return e.l+=t-10,n}},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:m},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:function(e,t,n){if(n.qpro&&!(t<21)){var r=e.read_shift(1);return e.l+=17,e.l+=1,e.l+=2,[r,e.read_shift(t-21,"cstr")]}}},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:function(e,t){var n=t||{};if(+n.codepage>=0&&u(+n.codepage),"string"==n.type)throw new Error("Cannot write WK1 to JS string");var r=_n(),s=Dn(e["!ref"]),c=Array.isArray(e),l=[];xa(r,0,function(e){var t=En(2);return t.write_shift(2,e),t}(1030)),xa(r,6,function(e){var t=En(8);return t.write_shift(2,e.s.c),t.write_shift(2,e.s.r),t.write_shift(2,e.e.c),t.write_shift(2,e.e.r),t}(s));for(var f=Math.min(s.e.r,8191),d=s.s.r;d<=f;++d)for(var p=On(d),h=s.s.c;h<=s.e.c;++h){d===s.s.r&&(l[h]=An(h));var v=l[h]+p,m=c?(e[d]||[])[h]:e[v];if(m&&"z"!=m.t)if("n"==m.t)(0|m.v)==m.v&&m.v>=-32768&&m.v<=32767?xa(r,13,o(d,h,m.v)):xa(r,14,a(d,h,m.v));else xa(r,15,i(d,h,Ln(m).slice(0,239)))}return xa(r,1),r.end()},book_to_wk3:function(e,t){var n=t||{};if(+n.codepage>=0&&u(+n.codepage),"string"==n.type)throw new Error("Cannot write WK3 to JS string");var r=_n();xa(r,0,function(e){var t=En(26);t.write_shift(2,4096),t.write_shift(2,4),t.write_shift(4,0);for(var n=0,r=0,i=0,o=0;o<e.SheetNames.length;++o){var a=e.SheetNames[o],s=e.Sheets[a];if(s&&s["!ref"]){++i;var c=Nn(s["!ref"]);n<c.e.r&&(n=c.e.r),r<c.e.c&&(r=c.e.c)}}n>8191&&(n=8191);return t.write_shift(2,n),t.write_shift(1,i),t.write_shift(1,r),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(1,1),t.write_shift(1,2),t.write_shift(4,0),t.write_shift(4,0),t}(e));for(var i=0,o=0;i<e.SheetNames.length;++i)(e.Sheets[e.SheetNames[i]]||{})["!ref"]&&xa(r,27,E(e.SheetNames[i],o++));var a=0;for(i=0;i<e.SheetNames.length;++i){var s=e.Sheets[e.SheetNames[i]];if(s&&s["!ref"]){for(var c=Dn(s["!ref"]),l=Array.isArray(s),f=[],p=Math.min(c.e.r,8191),v=c.s.r;v<=p;++v)for(var m=On(v),g=c.s.c;g<=c.e.c;++g){v===c.s.r&&(f[g]=An(g));var _=f[g]+m,b=l?(s[v]||[])[g]:s[_];if(b&&"z"!=b.t)if("n"==b.t)xa(r,23,h(v,g,a,b.v));else xa(r,22,d(v,g,a,Ln(b).slice(0,239)))}++a}}return xa(r,1),r.end()},to_workbook:function(e,n){switch(n.type){case"base64":return t(T(g(e)),n);case"binary":return t(T(e),n);case"buffer":case"array":return t(e,n)}throw"Unsupported type "+n.type}}}();var mi=/^\s|\s$|[\t\n\r]/;function gi(e,t){if(!t.bookSST)return"";var n=[Ye];n[n.length]=ht("sst",null,{xmlns:kt[0],count:e.Count,uniqueCount:e.Unique});for(var r=0;r!=e.length;++r)if(null!=e[r]){var i=e[r],o="<si>";i.r?o+=i.r:(o+="<t",i.t||(i.t=""),i.t.match(mi)&&(o+=' xml:space="preserve"'),o+=">"+Ze(i.t)+"</t>"),o+="</si>",n[n.length]=o}return n.length>2&&(n[n.length]="</sst>",n[1]=n[1].replace("/>",">")),n.join("")}var Ei=function(e,t){var n=!1;return null==t&&(n=!0,t=En(15+4*e.t.length)),t.write_shift(1,0),Vn(e.t,t),n?t.slice(0,t.l):t};function _i(e){var t=_n();bn(t,159,function(e,t){return t||(t=En(8)),t.write_shift(4,e.Count),t.write_shift(4,e.Unique),t}(e));for(var n=0;n<e.length;++n)bn(t,19,Ei(e[n]));return bn(t,160),t.end()}function bi(e){if("undefined"!==typeof d)return d.utils.encode(o,e);for(var t=[],n=e.split(""),r=0;r<n.length;++r)t[r]=n[r].charCodeAt(0);return t}function yi(e){var t,n,r=0,i=bi(e),o=i.length+1;for((t=b(o))[0]=i.length,n=1;n!=o;++n)t[n]=i[n-1];for(n=o-1;n>=0;--n)r=((0===(16384&r)?0:1)|r<<1&32767)^t[n];return 52811^r}var Ti=function(){function e(e,n){switch(n.type){case"base64":return t(g(e),n);case"binary":return t(e,n);case"buffer":return t(E&&Buffer.isBuffer(e)?e.toString("binary"):w(e),n);case"array":return t(Be(e),n)}throw new Error("Unrecognized type "+n.type)}function t(e,t){var n=(t||{}).dense?[]:{},r=e.match(/\\trowd.*?\\row\b/g);if(!r.length)throw new Error("RTF missing table");var i={s:{c:0,r:0},e:{c:0,r:r.length-1}};return r.forEach((function(e,t){Array.isArray(n)&&(n[t]=[]);for(var r,o=/\\\w+\b/g,a=0,s=-1;r=o.exec(e);){if("\\cell"===r[0]){var c=e.slice(a,o.lastIndex-r[0].length);if(" "==c[0]&&(c=c.slice(1)),++s,c.length){var u={v:c,t:"s"};Array.isArray(n)?n[t][s]=u:n[Cn({r:t,c:s})]=u}}a=o.lastIndex}s>i.e.c&&(i.e.c=s)})),n["!ref"]=xn(i),n}return{to_workbook:function(t,n){return Mn(e(t,n),n)},to_sheet:e,from_sheet:function(e){for(var t,n=["{\\rtf1\\ansi"],r=Dn(e["!ref"]),i=Array.isArray(e),o=r.s.r;o<=r.e.r;++o){n.push("\\trowd\\trautofit1");for(var a=r.s.c;a<=r.e.c;++a)n.push("\\cellx"+(a+1));for(n.push("\\pard\\intbl"),a=r.s.c;a<=r.e.c;++a){var s=Cn({r:o,c:a});(t=i?(e[o]||[])[a]:e[s])&&(null!=t.v||t.f&&!t.F)&&(n.push(" "+(t.w||(Ln(t),t.w))),n.push("\\cell"))}n.push("\\pard\\intbl\\row")}return n.join("")+"}"}}}();function Si(e){for(var t=0,n=1;3!=t;++t)n=256*n+(e[t]>255?255:e[t]<0?0:e[t]);return n.toString(16).toUpperCase().slice(1)}var wi=6;function Ri(e){return Math.floor((e+Math.round(128/wi)/256)*wi)}function Oi(e){return Math.floor((e-5)/wi*100+.5)/100}function Ii(e){return Math.round((e*wi+5)/wi*256)/256}function Ai(e){e.width?(e.wpx=Ri(e.width),e.wch=Oi(e.wpx),e.MDW=wi):e.wpx?(e.wch=Oi(e.wpx),e.width=Ii(e.wch),e.MDW=wi):"number"==typeof e.wch&&(e.width=Ii(e.wch),e.wpx=Ri(e.width),e.MDW=wi),e.customWidth&&delete e.customWidth}function ki(e){return 96*e/96}function Ci(e){return 96*e/96}function Ni(e,t){var n,r=[Ye,ht("styleSheet",null,{xmlns:kt[0],"xmlns:vt":Ot})];return e.SSF&&null!=(n=function(e){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach((function(n){for(var r=n[0];r<=n[1];++r)null!=e[r]&&(t[t.length]=ht("numFmt",null,{numFmtId:r,formatCode:Ze(e[r])}))})),1===t.length?"":(t[t.length]="</numFmts>",t[0]=ht("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}(e.SSF))&&(r[r.length]=n),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(n=function(e){var t=[];return t[t.length]=ht("cellXfs",null),e.forEach((function(e){t[t.length]=ht("xf",null,e)})),t[t.length]="</cellXfs>",2===t.length?"":(t[0]=ht("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}(t.cellXfs))&&(r[r.length]=n),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function xi(e,t,n){n||(n=En(6+4*t.length)),n.write_shift(2,e),Vn(t,n);var r=n.length>n.l?n.slice(0,n.l):n;return null==n.l&&(n.l=n.length),r}function Di(e,t){t||(t=En(153)),t.write_shift(2,20*e.sz),function(e,t){t||(t=En(2));var n=(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0);t.write_shift(1,n),t.write_shift(1,0)}(e,t),t.write_shift(2,e.bold?700:400);var n=0;"superscript"==e.vertAlign?n=1:"subscript"==e.vertAlign&&(n=2),t.write_shift(2,n),t.write_shift(1,e.underline||0),t.write_shift(1,e.family||0),t.write_shift(1,e.charset||0),t.write_shift(1,0),lr(e.color,t);var r=0;return"major"==e.scheme&&(r=1),"minor"==e.scheme&&(r=2),t.write_shift(1,r),Vn(e.name,t),t.length>t.l?t.slice(0,t.l):t}var Pi,Li=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],Mi=gn;function Ui(e,t){t||(t=En(84)),Pi||(Pi=Ae(Li));var n=Pi[e.patternType];null==n&&(n=40),t.write_shift(4,n);var r=0;if(40!=n)for(lr({auto:1},t),lr({auto:1},t);r<12;++r)t.write_shift(4,0);else{for(;r<4;++r)t.write_shift(4,0);for(;r<12;++r)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function ji(e,t,n){n||(n=En(16)),n.write_shift(2,t||0),n.write_shift(2,e.numFmtId||0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(1,0),n.write_shift(1,0);return n.write_shift(1,0),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(1,0),n}function Fi(e,t){return t||(t=En(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var Bi=gn;function Vi(e){var t;bn(e,613,Fn(1)),bn(e,46,(t||(t=En(51)),t.write_shift(1,0),Fi(0,t),Fi(0,t),Fi(0,t),Fi(0,t),Fi(0,t),t.length>t.l?t.slice(0,t.l):t)),bn(e,614)}function Gi(e){var t,n;bn(e,619,Fn(1)),bn(e,48,(t={xfId:0,builtinId:0,name:"Normal"},n||(n=En(52)),n.write_shift(4,t.xfId),n.write_shift(2,1),n.write_shift(1,+t.builtinId),n.write_shift(1,0),Zn(t.name||"",n),n.length>n.l?n.slice(0,n.l):n)),bn(e,620)}function Wi(e){bn(e,508,function(e,t,n){var r=En(2052);return r.write_shift(4,e),Zn(t,r),Zn(n,r),r.length>r.l?r.slice(0,r.l):r}(0,"TableStyleMedium9","PivotStyleMedium4")),bn(e,509)}function qi(e,t){var n=_n();return bn(n,278),function(e,t){if(t){var n=0;[[5,8],[23,26],[41,44],[50,392]].forEach((function(e){for(var r=e[0];r<=e[1];++r)null!=t[r]&&++n})),0!=n&&(bn(e,615,Fn(n)),[[5,8],[23,26],[41,44],[50,392]].forEach((function(n){for(var r=n[0];r<=n[1];++r)null!=t[r]&&bn(e,44,xi(r,t[r]))})),bn(e,616))}}(n,e.SSF),function(e){bn(e,611,Fn(1)),bn(e,43,Di({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),bn(e,612)}(n),function(e){bn(e,603,Fn(2)),bn(e,45,Ui({patternType:"none"})),bn(e,45,Ui({patternType:"gray125"})),bn(e,604)}(n),Vi(n),function(e){bn(e,626,Fn(1)),bn(e,47,ji({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),bn(e,627)}(n),function(e,t){bn(e,617,Fn(t.length)),t.forEach((function(t){bn(e,47,ji(t,0))})),bn(e,618)}(n,t.cellXfs),Gi(n),function(e){bn(e,505,Fn(0)),bn(e,506)}(n),Wi(n),bn(n,279),n.end()}function Hi(e,t){if(t&&t.themeXLSX)return t.themeXLSX;if(e&&"string"==typeof e.raw)return e.raw;var n=[Ye];return n[n.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',n[n.length]="<a:themeElements>",n[n.length]='<a:clrScheme name="Office">',n[n.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',n[n.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',n[n.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',n[n.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',n[n.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',n[n.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',n[n.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',n[n.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',n[n.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',n[n.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',n[n.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',n[n.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',n[n.length]="</a:clrScheme>",n[n.length]='<a:fontScheme name="Office">',n[n.length]="<a:majorFont>",n[n.length]='<a:latin typeface="Cambria"/>',n[n.length]='<a:ea typeface=""/>',n[n.length]='<a:cs typeface=""/>',n[n.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',n[n.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',n[n.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',n[n.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',n[n.length]='<a:font script="Arab" typeface="Times New Roman"/>',n[n.length]='<a:font script="Hebr" typeface="Times New Roman"/>',n[n.length]='<a:font script="Thai" typeface="Tahoma"/>',n[n.length]='<a:font script="Ethi" typeface="Nyala"/>',n[n.length]='<a:font script="Beng" typeface="Vrinda"/>',n[n.length]='<a:font script="Gujr" typeface="Shruti"/>',n[n.length]='<a:font script="Khmr" typeface="MoolBoran"/>',n[n.length]='<a:font script="Knda" typeface="Tunga"/>',n[n.length]='<a:font script="Guru" typeface="Raavi"/>',n[n.length]='<a:font script="Cans" typeface="Euphemia"/>',n[n.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',n[n.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',n[n.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',n[n.length]='<a:font script="Thaa" typeface="MV Boli"/>',n[n.length]='<a:font script="Deva" typeface="Mangal"/>',n[n.length]='<a:font script="Telu" typeface="Gautami"/>',n[n.length]='<a:font script="Taml" typeface="Latha"/>',n[n.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',n[n.length]='<a:font script="Orya" typeface="Kalinga"/>',n[n.length]='<a:font script="Mlym" typeface="Kartika"/>',n[n.length]='<a:font script="Laoo" typeface="DokChampa"/>',n[n.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',n[n.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',n[n.length]='<a:font script="Viet" typeface="Times New Roman"/>',n[n.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',n[n.length]='<a:font script="Geor" typeface="Sylfaen"/>',n[n.length]="</a:majorFont>",n[n.length]="<a:minorFont>",n[n.length]='<a:latin typeface="Calibri"/>',n[n.length]='<a:ea typeface=""/>',n[n.length]='<a:cs typeface=""/>',n[n.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',n[n.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',n[n.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',n[n.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',n[n.length]='<a:font script="Arab" typeface="Arial"/>',n[n.length]='<a:font script="Hebr" typeface="Arial"/>',n[n.length]='<a:font script="Thai" typeface="Tahoma"/>',n[n.length]='<a:font script="Ethi" typeface="Nyala"/>',n[n.length]='<a:font script="Beng" typeface="Vrinda"/>',n[n.length]='<a:font script="Gujr" typeface="Shruti"/>',n[n.length]='<a:font script="Khmr" typeface="DaunPenh"/>',n[n.length]='<a:font script="Knda" typeface="Tunga"/>',n[n.length]='<a:font script="Guru" typeface="Raavi"/>',n[n.length]='<a:font script="Cans" typeface="Euphemia"/>',n[n.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',n[n.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',n[n.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',n[n.length]='<a:font script="Thaa" typeface="MV Boli"/>',n[n.length]='<a:font script="Deva" typeface="Mangal"/>',n[n.length]='<a:font script="Telu" typeface="Gautami"/>',n[n.length]='<a:font script="Taml" typeface="Latha"/>',n[n.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',n[n.length]='<a:font script="Orya" typeface="Kalinga"/>',n[n.length]='<a:font script="Mlym" typeface="Kartika"/>',n[n.length]='<a:font script="Laoo" typeface="DokChampa"/>',n[n.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',n[n.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',n[n.length]='<a:font script="Viet" typeface="Arial"/>',n[n.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',n[n.length]='<a:font script="Geor" typeface="Sylfaen"/>',n[n.length]="</a:minorFont>",n[n.length]="</a:fontScheme>",n[n.length]='<a:fmtScheme name="Office">',n[n.length]="<a:fillStyleLst>",n[n.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:lin ang="16200000" scaled="1"/>',n[n.length]="</a:gradFill>",n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:lin ang="16200000" scaled="0"/>',n[n.length]="</a:gradFill>",n[n.length]="</a:fillStyleLst>",n[n.length]="<a:lnStyleLst>",n[n.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]="</a:lnStyleLst>",n[n.length]="<a:effectStyleLst>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]="</a:effectStyle>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]="</a:effectStyle>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',n[n.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',n[n.length]="</a:effectStyle>",n[n.length]="</a:effectStyleLst>",n[n.length]="<a:bgFillStyleLst>",n[n.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',n[n.length]="</a:gradFill>",n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',n[n.length]="</a:gradFill>",n[n.length]="</a:bgFillStyleLst>",n[n.length]="</a:fmtScheme>",n[n.length]="</a:themeElements>",n[n.length]="<a:objectDefaults>",n[n.length]="<a:spDef>",n[n.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',n[n.length]="</a:spDef>",n[n.length]="<a:lnDef>",n[n.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',n[n.length]="</a:lnDef>",n[n.length]="</a:objectDefaults>",n[n.length]="<a:extraClrSchemeLst/>",n[n.length]="</a:theme>",n.join("")}function Ki(){var e=_n();return bn(e,332),bn(e,334,Fn(1)),bn(e,335,function(e){var t=En(12+2*e.name.length);return t.write_shift(4,e.flags),t.write_shift(4,e.version),Vn(e.name,t),t.slice(0,t.l)}({name:"XLDAPR",version:12e4,flags:3496657072})),bn(e,336),bn(e,339,function(e,t){var n=En(8+2*t.length);return n.write_shift(4,e),Vn(t,n),n.slice(0,n.l)}(1,"XLDAPR")),bn(e,52),bn(e,35,Fn(514)),bn(e,4096,Fn(0)),bn(e,4097,Gr(1)),bn(e,36),bn(e,53),bn(e,340),bn(e,337,function(e,t){var n=En(8);return n.write_shift(4,e),n.write_shift(4,t?1:0),n}(1,!0)),bn(e,51,function(e){var t=En(4+8*e.length);t.write_shift(4,e.length);for(var n=0;n<e.length;++n)t.write_shift(4,e[n][0]),t.write_shift(4,e[n][1]);return t}([[1,0]])),bn(e,338),bn(e,333),e.end()}function zi(){var e=[Ye];return e.push('<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">\n  <metadataTypes count="1">\n    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>\n  </metadataTypes>\n  <futureMetadata name="XLDAPR" count="1">\n    <bk>\n      <extLst>\n        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">\n          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>\n        </ext>\n      </extLst>\n    </bk>\n  </futureMetadata>\n  <cellMetadata count="1">\n    <bk>\n      <rc t="1" v="0"/>\n    </bk>\n  </cellMetadata>\n</metadata>'),e.join("")}var Yi=1024;function Ji(e,t){for(var n=[21600,21600],r=["m0,0l0",n[1],n[0],n[1],n[0],"0xe"].join(","),i=[ht("xml",null,{"xmlns:v":Lt,"xmlns:o":Ct,"xmlns:x":Nt,"xmlns:mv":Pt}).replace(/\/>/,">"),ht("o:shapelayout",ht("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),ht("v:shapetype",[ht("v:stroke",null,{joinstyle:"miter"}),ht("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:n.join(","),path:r})];Yi<1e3*e;)Yi+=1e3;return t.forEach((function(e){var t=kn(e[0]),n={color2:"#BEFF82",type:"gradient"};"gradient"==n.type&&(n.angle="-180");var r="gradient"==n.type?ht("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,o=ht("v:fill",r,n);++Yi,i=i.concat(["<v:shape"+pt({id:"_x0000_s"+Yi,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(e[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",o,ht("v:shadow",null,{on:"t",obscured:"t"}),ht("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",dt("x:Anchor",[t.c+1,0,t.r+1,0,t.c+3,20,t.r+5,20].join(",")),dt("x:AutoFill","False"),dt("x:Row",String(t.r)),dt("x:Column",String(t.c)),e[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])})),i.push("</xml>"),i.join("")}function Xi(e){var t=[Ye,ht("comments",null,{xmlns:kt[0]})],n=[];return t.push("<authors>"),e.forEach((function(e){e[1].forEach((function(e){var r=Ze(e.a);-1==n.indexOf(r)&&(n.push(r),t.push("<author>"+r+"</author>")),e.T&&e.ID&&-1==n.indexOf("tc="+e.ID)&&(n.push("tc="+e.ID),t.push("<author>tc="+e.ID+"</author>"))}))})),0==n.length&&(n.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),e.forEach((function(e){var r=0,i=[];if(e[1][0]&&e[1][0].T&&e[1][0].ID?r=n.indexOf("tc="+e[1][0].ID):e[1].forEach((function(e){e.a&&(r=n.indexOf(Ze(e.a))),i.push(e.t||"")})),t.push('<comment ref="'+e[0]+'" authorId="'+r+'"><text>'),i.length<=1)t.push(dt("t",Ze(i[0]||"")));else{for(var o="Comment:\n    "+i[0]+"\n",a=1;a<i.length;++a)o+="Reply:\n    "+i[a]+"\n";t.push(dt("t",Ze(o)))}t.push("</text></comment>")})),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function Qi(e,t,n){var r=[Ye,ht("ThreadedComments",null,{xmlns:yt}).replace(/[\/]>/,">")];return e.forEach((function(e){var i="";(e[1]||[]).forEach((function(o,a){if(o.T){o.a&&-1==t.indexOf(o.a)&&t.push(o.a);var s={ref:e[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+n.tcid++).slice(-12)+"}"};0==a?i=s.id:s.parentId=i,o.ID=s.id,o.a&&(s.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(o.a)).slice(-12)+"}"),r.push(ht("threadedComment",dt("text",o.t||""),s))}else delete o.ID}))})),r.push("</ThreadedComments>"),r.join("")}var $i=Bn;function Zi(e){var t=_n(),n=[];return bn(t,628),bn(t,630),e.forEach((function(e){e[1].forEach((function(e){n.indexOf(e.a)>-1||(n.push(e.a.slice(0,54)),bn(t,632,function(e){return Vn(e.slice(0,54))}(e.a)))}))})),bn(t,631),bn(t,633),e.forEach((function(e){e[1].forEach((function(r){r.iauthor=n.indexOf(r.a);var i={s:kn(e[0]),e:kn(e[0])};bn(t,635,function(e,t){return null==t&&(t=En(36)),t.write_shift(4,e[1].iauthor),sr(e[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}([i,r])),r.t&&r.t.length>0&&bn(t,637,Hn(r)),bn(t,636),delete r.iauthor}))})),bn(t,634),bn(t,629),t.end()}var eo=["xlsb","xlsm","xlam","biff8","xla"];var to=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function n(e,n,r,i){var o=!1,a=!1;0==r.length?a=!0:"["==r.charAt(0)&&(a=!0,r=r.slice(1,-1)),0==i.length?o=!0:"["==i.charAt(0)&&(o=!0,i=i.slice(1,-1));var s=r.length>0?0|parseInt(r,10):0,c=i.length>0?0|parseInt(i,10):0;return o?c+=t.c:--c,a?s+=t.r:--s,n+(o?"":"$")+An(c)+(a?"":"$")+On(s)}return function(r,i){return t=i,r.replace(e,n)}}(),no=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,ro=function(){return function(e,t){return e.replace(no,(function(e,n,r,i,o,a){var s=In(i)-(r?0:t.c),c=Rn(a)-(o?0:t.r);return n+"R"+(0==c?"":o?c+1:"["+c+"]")+"C"+(0==s?"":r?s+1:"["+s+"]")}))}}();function io(e,t){return e.replace(no,(function(e,n,r,i,o,a){return n+("$"==r?r+i:An(In(i)+t.c))+("$"==o?o+a:On(Rn(a)+t.r))}))}function oo(e){e.l+=1}function ao(e,t){var n=e.read_shift(1==t?1:2);return[16383&n,n>>14&1,n>>15&1]}function so(e,t,n){var r=2;if(n){if(n.biff>=2&&n.biff<=5)return co(e);12==n.biff&&(r=4)}var i=e.read_shift(r),o=e.read_shift(r),a=ao(e,2),s=ao(e,2);return{s:{r:i,c:a[0],cRel:a[1],rRel:a[2]},e:{r:o,c:s[0],cRel:s[1],rRel:s[2]}}}function co(e){var t=ao(e,2),n=ao(e,2),r=e.read_shift(1),i=e.read_shift(1);return{s:{r:t[0],c:r,cRel:t[1],rRel:t[2]},e:{r:n[0],c:i,cRel:n[1],rRel:n[2]}}}function uo(e,t,n){if(n&&n.biff>=2&&n.biff<=5)return function(e){var t=ao(e,2),n=e.read_shift(1);return{r:t[0],c:n,cRel:t[1],rRel:t[2]}}(e);var r=e.read_shift(n&&12==n.biff?4:2),i=ao(e,2);return{r:r,c:i[0],cRel:i[1],rRel:i[2]}}function lo(e){var t=e.read_shift(2),n=e.read_shift(2);return{r:t,c:255&n,fQuoted:!!(16384&n),cRel:n>>15,rRel:n>>15}}function fo(e){var t=1&e[e.l+1];return e.l+=4,[t,1]}function po(e){return[e.read_shift(1),e.read_shift(1)]}function ho(e,t){var n=[e.read_shift(1)];if(12==t)switch(n[0]){case 2:n[0]=4;break;case 4:n[0]=16;break;case 0:n[0]=1;break;case 1:n[0]=2}switch(n[0]){case 4:n[1]=Fr(e,1)?"TRUE":"FALSE",12!=t&&(e.l+=7);break;case 37:case 16:n[1]=mr[e[e.l]],e.l+=12==t?4:8;break;case 0:e.l+=8;break;case 1:n[1]=cr(e);break;case 2:n[1]=Yr(e,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+n[0])}return n}function vo(e,t,n){for(var r=e.read_shift(12==n.biff?4:2),i=[],o=0;o!=r;++o)i.push((12==n.biff?ar:ei)(e,8));return i}function mo(e,t,n){var r=0,i=0;12==n.biff?(r=e.read_shift(4),i=e.read_shift(4)):(i=1+e.read_shift(1),r=1+e.read_shift(2)),n.biff>=2&&n.biff<8&&(--r,0==--i&&(i=256));for(var o=0,a=[];o!=r&&(a[o]=[]);++o)for(var s=0;s!=i;++s)a[o][s]=ho(e,n.biff);return a}function go(e,t,n){return e.l+=2,[lo(e)]}function Eo(e){return e.l+=6,[]}function _o(e){return e.l+=2,[Vr(e),1&e.read_shift(2)]}var bo=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];var yo={1:{n:"PtgExp",f:function(e,t,n){return e.l++,n&&12==n.biff?[e.read_shift(4,"i"),0]:[e.read_shift(2),e.read_shift(n&&2==n.biff?1:2)]}},2:{n:"PtgTbl",f:gn},3:{n:"PtgAdd",f:oo},4:{n:"PtgSub",f:oo},5:{n:"PtgMul",f:oo},6:{n:"PtgDiv",f:oo},7:{n:"PtgPower",f:oo},8:{n:"PtgConcat",f:oo},9:{n:"PtgLt",f:oo},10:{n:"PtgLe",f:oo},11:{n:"PtgEq",f:oo},12:{n:"PtgGe",f:oo},13:{n:"PtgGt",f:oo},14:{n:"PtgNe",f:oo},15:{n:"PtgIsect",f:oo},16:{n:"PtgUnion",f:oo},17:{n:"PtgRange",f:oo},18:{n:"PtgUplus",f:oo},19:{n:"PtgUminus",f:oo},20:{n:"PtgPercent",f:oo},21:{n:"PtgParen",f:oo},22:{n:"PtgMissArg",f:oo},23:{n:"PtgStr",f:function(e,t,n){return e.l++,qr(e,0,n)}},26:{n:"PtgSheet",f:function(e,t,n){return e.l+=5,e.l+=2,e.l+=2==n.biff?1:4,["PTGSHEET"]}},27:{n:"PtgEndSheet",f:function(e,t,n){return e.l+=2==n.biff?4:5,["PTGENDSHEET"]}},28:{n:"PtgErr",f:function(e){return e.l++,mr[e.read_shift(1)]}},29:{n:"PtgBool",f:function(e){return e.l++,0!==e.read_shift(1)}},30:{n:"PtgInt",f:function(e){return e.l++,e.read_shift(2)}},31:{n:"PtgNum",f:function(e){return e.l++,cr(e)}},32:{n:"PtgArray",f:function(e,t,n){var r=(96&e[e.l++])>>5;return e.l+=2==n.biff?6:12==n.biff?14:7,[r]}},33:{n:"PtgFunc",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var i=e.read_shift(n&&n.biff<=3?1:2);return[Bo[i],Fo[i],r]}},34:{n:"PtgFuncVar",f:function(e,t,n){var r=e[e.l++],i=e.read_shift(1),o=n&&n.biff<=3?[88==r?-1:0,e.read_shift(1)]:function(e){return[e[e.l+1]>>7,32767&e.read_shift(2)]}(e);return[i,(0===o[0]?Fo:jo)[o[1]]]}},35:{n:"PtgName",f:function(e,t,n){var r=e.read_shift(1)>>>5&3,i=!n||n.biff>=8?4:2,o=e.read_shift(i);switch(n.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12}return[r,0,o]}},36:{n:"PtgRef",f:function(e,t,n){var r=(96&e[e.l])>>5;return e.l+=1,[r,uo(e,0,n)]}},37:{n:"PtgArea",f:function(e,t,n){return[(96&e[e.l++])>>5,so(e,n.biff>=2&&n.biff,n)]}},38:{n:"PtgMemArea",f:function(e,t,n){var r=e.read_shift(1)>>>5&3;return e.l+=n&&2==n.biff?3:4,[r,e.read_shift(n&&2==n.biff?1:2)]}},39:{n:"PtgMemErr",f:gn},40:{n:"PtgMemNoMem",f:gn},41:{n:"PtgMemFunc",f:function(e,t,n){return[e.read_shift(1)>>>5&3,e.read_shift(n&&2==n.biff?1:2)]}},42:{n:"PtgRefErr",f:function(e,t,n){var r=e.read_shift(1)>>>5&3;return e.l+=4,n.biff<8&&e.l--,12==n.biff&&(e.l+=2),[r]}},43:{n:"PtgAreaErr",f:function(e,t,n){var r=(96&e[e.l++])>>5;return e.l+=n&&n.biff>8?12:n.biff<8?6:8,[r]}},44:{n:"PtgRefN",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var i=function(e,t,n){var r=n&&n.biff?n.biff:8;if(r>=2&&r<=5)return function(e){var t=e.read_shift(2),n=e.read_shift(1),r=(32768&t)>>15,i=(16384&t)>>14;return t&=16383,1==r&&t>=8192&&(t-=16384),1==i&&n>=128&&(n-=256),{r:t,c:n,cRel:i,rRel:r}}(e);var i=e.read_shift(r>=12?4:2),o=e.read_shift(2),a=(16384&o)>>14,s=(32768&o)>>15;if(o&=16383,1==s)for(;i>524287;)i-=1048576;if(1==a)for(;o>8191;)o-=16384;return{r:i,c:o,cRel:a,rRel:s}}(e,0,n);return[r,i]}},45:{n:"PtgAreaN",f:function(e,t,n){var r=(96&e[e.l++])>>5,i=function(e,t,n){if(n.biff<8)return co(e);var r=e.read_shift(12==n.biff?4:2),i=e.read_shift(12==n.biff?4:2),o=ao(e,2),a=ao(e,2);return{s:{r:r,c:o[0],cRel:o[1],rRel:o[2]},e:{r:i,c:a[0],cRel:a[1],rRel:a[2]}}}(e,0,n);return[r,i]}},46:{n:"PtgMemAreaN",f:function(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},47:{n:"PtgMemNoMemN",f:function(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},57:{n:"PtgNameX",f:function(e,t,n){return 5==n.biff?function(e){var t=e.read_shift(1)>>>5&3,n=e.read_shift(2,"i");e.l+=8;var r=e.read_shift(2);return e.l+=12,[t,n,r]}(e):[e.read_shift(1)>>>5&3,e.read_shift(2),e.read_shift(4)]}},58:{n:"PtgRef3d",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var i=e.read_shift(2);return n&&5==n.biff&&(e.l+=12),[r,i,uo(e,0,n)]}},59:{n:"PtgArea3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,i=e.read_shift(2,"i");if(n)switch(n.biff){case 5:e.l+=12,6;break;case 12:12}return[r,i,so(e,0,n)]}},60:{n:"PtgRefErr3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,i=e.read_shift(2),o=4;if(n)switch(n.biff){case 5:o=15;break;case 12:o=6}return e.l+=o,[r,i]}},61:{n:"PtgAreaErr3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,i=e.read_shift(2),o=8;if(n)switch(n.biff){case 5:e.l+=12,o=6;break;case 12:o=12}return e.l+=o,[r,i]}},255:{}},To={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},So={1:{n:"PtgElfLel",f:_o},2:{n:"PtgElfRw",f:go},3:{n:"PtgElfCol",f:go},6:{n:"PtgElfRwV",f:go},7:{n:"PtgElfColV",f:go},10:{n:"PtgElfRadical",f:go},11:{n:"PtgElfRadicalS",f:Eo},13:{n:"PtgElfColS",f:Eo},15:{n:"PtgElfColSV",f:Eo},16:{n:"PtgElfRadicalLel",f:_o},25:{n:"PtgList",f:function(e){e.l+=2;var t=e.read_shift(2),n=e.read_shift(2),r=e.read_shift(4),i=e.read_shift(2),o=e.read_shift(2);return{ixti:t,coltype:3&n,rt:bo[n>>2&31],idx:r,c:i,C:o}}},29:{n:"PtgSxName",f:function(e){return e.l+=2,[e.read_shift(4)]}},255:{}},wo={0:{n:"PtgAttrNoop",f:function(e){return e.l+=4,[0,0]}},1:{n:"PtgAttrSemi",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=n&&2==n.biff?3:4,[r]}},2:{n:"PtgAttrIf",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(n&&2==n.biff?1:2)]}},4:{n:"PtgAttrChoose",f:function(e,t,n){e.l+=2;for(var r=e.read_shift(n&&2==n.biff?1:2),i=[],o=0;o<=r;++o)i.push(e.read_shift(n&&2==n.biff?1:2));return i}},8:{n:"PtgAttrGoto",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(n&&2==n.biff?1:2)]}},16:{n:"PtgAttrSum",f:function(e,t,n){e.l+=n&&2==n.biff?3:4}},32:{n:"PtgAttrBaxcel",f:fo},33:{n:"PtgAttrBaxcel",f:fo},64:{n:"PtgAttrSpace",f:function(e){return e.read_shift(2),po(e)}},65:{n:"PtgAttrSpaceSemi",f:function(e){return e.read_shift(2),po(e)}},128:{n:"PtgAttrIfError",f:function(e){var t=255&e[e.l+1]?1:0;return e.l+=2,[t,e.read_shift(2)]}},255:{}};function Ro(e,t,n,r){if(r.biff<8)return gn(e,t);for(var i=e.l+t,o=[],a=0;a!==n.length;++a)switch(n[a][0]){case"PtgArray":n[a][1]=mo(e,0,r),o.push(n[a][1]);break;case"PtgMemArea":n[a][2]=vo(e,n[a][1],r),o.push(n[a][2]);break;case"PtgExp":r&&12==r.biff&&(n[a][1][1]=e.read_shift(4),o.push(n[a][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+n[a][0]}return 0!==(t=i-e.l)&&o.push(gn(e,t)),o}function Oo(e,t,n){for(var r,i,o=e.l+t,a=[];o!=e.l;)t=o-e.l,i=e[e.l],r=yo[i]||yo[To[i]],24!==i&&25!==i||(r=(24===i?So:wo)[e[e.l+1]]),r&&r.f?a.push([r.n,r.f(e,t,n)]):gn(e,t);return a}function Io(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],i=[],o=0;o<r.length;++o){var a=r[o];if(a)if(2===a[0])i.push('"'+a[1].replace(/"/g,'""')+'"');else i.push(a[1]);else i.push("")}t.push(i.join(","))}return t.join(";")}var Ao={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function ko(e,t,n){if(!e)return"SH33TJSERR0";if(n.biff>8&&(!e.XTI||!e.XTI[t]))return e.SheetNames[t];if(!e.XTI)return"SH33TJSERR6";var r=e.XTI[t];if(n.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),0==t?"":e.XTI[t-1];if(!r)return"SH33TJSERR1";var i="";if(n.biff>8)switch(e[r[0]][0]){case 357:return i=-1==r[1]?"#REF":e.SheetNames[r[1]],r[1]==r[2]?i:i+":"+e.SheetNames[r[2]];case 358:return null!=n.SID?e.SheetNames[n.SID]:"SH33TJSSAME"+e[r[0]][0];default:return"SH33TJSSRC"+e[r[0]][0]}switch(e[r[0]][0][0]){case 1025:return i=-1==r[1]?"#REF":e.SheetNames[r[1]]||"SH33TJSERR3",r[1]==r[2]?i:i+":"+e.SheetNames[r[2]];case 14849:return e[r[0]].slice(1).map((function(e){return e.Name})).join(";;");default:return e[r[0]][0][3]?(i=-1==r[1]?"#REF":e[r[0]][0][3][r[1]]||"SH33TJSERR4",r[1]==r[2]?i:i+":"+e[r[0]][0][3][r[2]]):"SH33TJSERR2"}}function Co(e,t,n){var r=ko(e,t,n);return"#REF"==r?r:function(e,t){if(!e&&!(t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}(r,n)}function No(e,t,n,r,i){var o,a,s,c,u=i&&i.biff||8,l={s:{c:0,r:0},e:{c:0,r:0}},f=[],d=0,p=0,h="";if(!e[0]||!e[0][0])return"";for(var v=-1,m="",g=0,E=e[0].length;g<E;++g){var _=e[0][g];switch(_[0]){case"PtgUminus":f.push("-"+f.pop());break;case"PtgUplus":f.push("+"+f.pop());break;case"PtgPercent":f.push(f.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(o=f.pop(),a=f.pop(),v>=0){switch(e[0][v][1][0]){case 0:m=Ge(" ",e[0][v][1][1]);break;case 1:m=Ge("\r",e[0][v][1][1]);break;default:if(m="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][v][1][0])}a+=m,v=-1}f.push(a+Ao[_[0]]+o);break;case"PtgIsect":o=f.pop(),a=f.pop(),f.push(a+" "+o);break;case"PtgUnion":o=f.pop(),a=f.pop(),f.push(a+","+o);break;case"PtgRange":o=f.pop(),a=f.pop(),f.push(a+":"+o);break;case"PtgAttrChoose":case"PtgAttrGoto":case"PtgAttrIf":case"PtgAttrIfError":case"PtgAttrBaxcel":case"PtgAttrSemi":case"PtgMemArea":case"PtgTbl":case"PtgMemErr":case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":case"PtgMemFunc":case"PtgMemNoMem":break;case"PtgRef":s=yn(_[1][1],l,i),f.push(Sn(s,u));break;case"PtgRefN":s=n?yn(_[1][1],n,i):_[1][1],f.push(Sn(s,u));break;case"PtgRef3d":d=_[1][1],s=yn(_[1][2],l,i);h=Co(r,d,i);f.push(h+"!"+Sn(s,u));break;case"PtgFunc":case"PtgFuncVar":var b=_[1][0],y=_[1][1];b||(b=0);var T=0==(b&=127)?[]:f.slice(-b);f.length-=b,"User"===y&&(y=T.shift()),f.push(y+"("+T.join(",")+")");break;case"PtgBool":f.push(_[1]?"TRUE":"FALSE");break;case"PtgInt":case"PtgErr":f.push(_[1]);break;case"PtgNum":f.push(String(_[1]));break;case"PtgStr":f.push('"'+_[1].replace(/"/g,'""')+'"');break;case"PtgAreaN":c=Tn(_[1][1],n?{s:n}:l,i),f.push(wn(c,i));break;case"PtgArea":c=Tn(_[1][1],l,i),f.push(wn(c,i));break;case"PtgArea3d":d=_[1][1],c=_[1][2],h=Co(r,d,i),f.push(h+"!"+wn(c,i));break;case"PtgAttrSum":f.push("SUM("+f.pop()+")");break;case"PtgName":p=_[1][2];var S=(r.names||[])[p-1]||(r[0]||[])[p],w=S?S.Name:"SH33TJSNAME"+String(p);w&&"_xlfn."==w.slice(0,6)&&!i.xlfn&&(w=w.slice(6)),f.push(w);break;case"PtgNameX":var R,O=_[1][1];if(p=_[1][2],!(i.biff<=5)){var I="";if(14849==((r[O]||[])[0]||[])[0]||(1025==((r[O]||[])[0]||[])[0]?r[O][p]&&r[O][p].itab>0&&(I=r.SheetNames[r[O][p].itab-1]+"!"):I=r.SheetNames[p-1]+"!"),r[O]&&r[O][p])I+=r[O][p].Name;else if(r[0]&&r[0][p])I+=r[0][p].Name;else{var A=(ko(r,O,i)||"").split(";;");A[p-1]?I=A[p-1]:I+="SH33TJSERRX"}f.push(I);break}O<0&&(O=-O),r[O]&&(R=r[O][p]),R||(R={Name:"SH33TJSERRY"}),f.push(R.Name);break;case"PtgParen":var k="(",C=")";if(v>=0){switch(m="",e[0][v][1][0]){case 2:k=Ge(" ",e[0][v][1][1])+k;break;case 3:k=Ge("\r",e[0][v][1][1])+k;break;case 4:C=Ge(" ",e[0][v][1][1])+C;break;case 5:C=Ge("\r",e[0][v][1][1])+C;break;default:if(i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][v][1][0])}v=-1}f.push(k+f.pop()+C);break;case"PtgRefErr":case"PtgRefErr3d":case"PtgAreaErr":case"PtgAreaErr3d":f.push("#REF!");break;case"PtgExp":s={c:_[1][1],r:_[1][0]};var N={c:n.c,r:n.r};if(r.sharedf[Cn(s)]){var x=r.sharedf[Cn(s)];f.push(No(x,l,N,r,i))}else{var D=!1;for(o=0;o!=r.arrayf.length;++o)if(a=r.arrayf[o],!(s.c<a[0].s.c||s.c>a[0].e.c)&&!(s.r<a[0].s.r||s.r>a[0].e.r)){f.push(No(a[1],l,N,r,i)),D=!0;break}D||f.push(_[1])}break;case"PtgArray":f.push("{"+Io(_[1])+"}");break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":v=g;break;case"PtgMissArg":f.push("");break;case"PtgList":f.push("Table"+_[1].idx+"[#"+_[1].rt+"]");break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");default:throw new Error("Unrecognized Formula Token: "+String(_))}if(3!=i.biff&&v>=0&&-1==["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"].indexOf(e[0][g][0])){var P=!0;switch((_=e[0][v])[1][0]){case 4:P=!1;case 0:m=Ge(" ",_[1][1]);break;case 5:P=!1;case 1:m=Ge("\r",_[1][1]);break;default:if(m="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+_[1][0])}f.push((P?m:"")+f.pop()+(P?"":m)),v=-1}}if(f.length>1&&i.WTF)throw new Error("bad formula stack");return f[0]}function xo(e,t,n,r,i){var o=$r(t,n,i),a=function(e){if(null==e){var t=En(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}return ur("number"==typeof e?e:0)}(e.v),s=En(6);s.write_shift(2,33),s.write_shift(4,0);for(var c=En(e.bf.length),u=0;u<e.bf.length;++u)c[u]=e.bf[u];return R([o,a,s,c])}function Do(e,t,n){var r=e.read_shift(4),i=Oo(e,r,n),o=e.read_shift(4);return[i,o>0?Ro(e,o,i,n):null]}var Po=Do,Lo=Do,Mo=Do,Uo=Do,jo={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Fo={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Bo={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};var Vo="undefined"!==typeof Map;function Go(e,t,n){var r=0,i=e.length;if(n){if(Vo?n.has(t):Object.prototype.hasOwnProperty.call(n,t))for(var o=Vo?n.get(t):n[t];r<o.length;++r)if(e[o[r]].t===t)return e.Count++,o[r]}else for(;r<i;++r)if(e[r].t===t)return e.Count++,r;return e[i]={t:t},e.Count++,e.Unique++,n&&(Vo?(n.has(t)||n.set(t,[]),n.get(t).push(i)):(Object.prototype.hasOwnProperty.call(n,t)||(n[t]=[]),n[t].push(i))),i}function Wo(e,t){var n={min:e+1,max:e+1},r=-1;return t.MDW&&(wi=t.MDW),null!=t.width?n.customWidth=1:null!=t.wpx?r=Oi(t.wpx):null!=t.wch&&(r=t.wch),r>-1?(n.width=Ii(r),n.customWidth=1):null!=t.width&&(n.width=t.width),t.hidden&&(n.hidden=!0),null!=t.level&&(n.outlineLevel=n.level=t.level),n}function qo(e,t){if(e){var n=[.7,.7,.75,.75,.3,.3];"xlml"==t&&(n=[1,1,1,1,.5,.5]),null==e.left&&(e.left=n[0]),null==e.right&&(e.right=n[1]),null==e.top&&(e.top=n[2]),null==e.bottom&&(e.bottom=n[3]),null==e.header&&(e.header=n[4]),null==e.footer&&(e.footer=n[5])}}function Ho(e,t,n){var r=n.revssf[null!=t.z?t.z:"General"],i=60,o=e.length;if(null==r&&n.ssf)for(;i<392;++i)if(null==n.ssf[i]){ge(t.z,i),n.ssf[i]=t.z,n.revssf[t.z]=r=i;break}for(i=0;i!=o;++i)if(e[i].numFmtId===r)return i;return e[o]={numFmtId:r,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},o}function Ko(e,t,n){if(e&&e["!ref"]){var r=Dn(e["!ref"]);if(r.e.c<r.s.c||r.e.r<r.s.r)throw new Error("Bad range ("+n+"): "+e["!ref"])}}var zo=["objects","scenarios","selectLockedCells","selectUnlockedCells"],Yo=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function Jo(e,t,n,r){if(e.c&&n["!comments"].push([t,e.c]),void 0===e.v&&"string"!==typeof e.f||"z"===e.t&&!e.f)return"";var i="",o=e.t,a=e.v;if("z"!==e.t)switch(e.t){case"b":i=e.v?"1":"0";break;case"n":i=""+e.v;break;case"e":i=mr[e.v];break;case"d":r&&r.cellDates?i=Fe(e.v,-1).toISOString():((e=Ve(e)).t="n",i=""+(e.v=Ne(Fe(e.v)))),"undefined"===typeof e.z&&(e.z=U[14]);break;default:i=e.v}var s=dt("v",Ze(i)),c={r:t},u=Ho(r.cellXfs,e,r);switch(0!==u&&(c.s=u),e.t){case"n":case"z":break;case"d":c.t="d";break;case"b":c.t="b";break;case"e":c.t="e";break;default:if(null==e.v){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(r&&r.bookSST){s=dt("v",""+Go(r.Strings,e.v,r.revStrings)),c.t="s";break}c.t="str"}if(e.t!=o&&(e.t=o,e.v=a),"string"==typeof e.f&&e.f){var l=e.F&&e.F.slice(0,t.length)==t?{t:"array",ref:e.F}:null;s=ht("f",Ze(e.f),l)+(null!=e.v?s:"")}return e.l&&n["!links"].push([t,e.l]),e.D&&(c.cm=1),ht("c",s,c)}function Xo(e,t,n,r){var i,o=[Ye,ht("worksheet",null,{xmlns:kt[0],"xmlns:r":Rt})],a=n.SheetNames[e],s="",c=n.Sheets[a];null==c&&(c={});var u=c["!ref"]||"A1",l=Dn(u);if(l.e.c>16383||l.e.r>1048575){if(t.WTF)throw new Error("Range "+u+" exceeds format limit A1:XFD1048576");l.e.c=Math.min(l.e.c,16383),l.e.r=Math.min(l.e.c,1048575),u=xn(l)}r||(r={}),c["!comments"]=[];var f=[];!function(e,t,n,r,i){var o=!1,a={},s=null;if("xlsx"!==r.bookType&&t.vbaraw){var c=t.SheetNames[n];try{t.Workbook&&(c=t.Workbook.Sheets[n].CodeName||c)}catch(l){}o=!0,a.codeName=ut(Ze(c))}if(e&&e["!outline"]){var u={summaryBelow:1,summaryRight:1};e["!outline"].above&&(u.summaryBelow=0),e["!outline"].left&&(u.summaryRight=0),s=(s||"")+ht("outlinePr",null,u)}(o||s)&&(i[i.length]=ht("sheetPr",s,a))}(c,n,e,t,o),o[o.length]=ht("dimension",null,{ref:u}),o[o.length]=function(e,t,n,r){var i={workbookViewId:"0"};return(((r||{}).Workbook||{}).Views||[])[0]&&(i.rightToLeft=r.Workbook.Views[0].RTL?"1":"0"),ht("sheetViews",ht("sheetView",null,i),{})}(0,0,0,n),t.sheetFormat&&(o[o.length]=ht("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),null!=c["!cols"]&&c["!cols"].length>0&&(o[o.length]=function(e,t){for(var n,r=["<cols>"],i=0;i!=t.length;++i)(n=t[i])&&(r[r.length]=ht("col",null,Wo(i,n)));return r[r.length]="</cols>",r.join("")}(0,c["!cols"])),o[i=o.length]="<sheetData/>",c["!links"]=[],null!=c["!ref"]&&(s=function(e,t,n,r){var i,o,a=[],s=[],c=Dn(e["!ref"]),u="",l="",f=[],d=0,p=0,h=e["!rows"],v=Array.isArray(e),m={r:l},g=-1;for(p=c.s.c;p<=c.e.c;++p)f[p]=An(p);for(d=c.s.r;d<=c.e.r;++d){for(s=[],l=On(d),p=c.s.c;p<=c.e.c;++p){i=f[p]+l;var E=v?(e[d]||[])[p]:e[i];void 0!==E&&null!=(u=Jo(E,i,e,t))&&s.push(u)}(s.length>0||h&&h[d])&&(m={r:l},h&&h[d]&&((o=h[d]).hidden&&(m.hidden=1),g=-1,o.hpx?g=ki(o.hpx):o.hpt&&(g=o.hpt),g>-1&&(m.ht=g,m.customHeight=1),o.level&&(m.outlineLevel=o.level)),a[a.length]=ht("row",s.join(""),m))}if(h)for(;d<h.length;++d)h&&h[d]&&(m={r:d+1},(o=h[d]).hidden&&(m.hidden=1),g=-1,o.hpx?g=ki(o.hpx):o.hpt&&(g=o.hpt),g>-1&&(m.ht=g,m.customHeight=1),o.level&&(m.outlineLevel=o.level),a[a.length]=ht("row","",m));return a.join("")}(c,t,0,0),s.length>0&&(o[o.length]=s)),o.length>i+1&&(o[o.length]="</sheetData>",o[i]=o[i].replace("/>",">")),c["!protect"]&&(o[o.length]=function(e){var t={sheet:1};return zo.forEach((function(n){null!=e[n]&&e[n]&&(t[n]="1")})),Yo.forEach((function(n){null==e[n]||e[n]||(t[n]="0")})),e.password&&(t.password=yi(e.password).toString(16).toUpperCase()),ht("sheetProtection",null,t)}(c["!protect"])),null!=c["!autofilter"]&&(o[o.length]=function(e,t,n,r){var i="string"==typeof e.ref?e.ref:xn(e.ref);n.Workbook||(n.Workbook={Sheets:[]}),n.Workbook.Names||(n.Workbook.Names=[]);var o=n.Workbook.Names,a=Nn(i);a.s.r==a.e.r&&(a.e.r=Nn(t["!ref"]).e.r,i=xn(a));for(var s=0;s<o.length;++s){var c=o[s];if("_xlnm._FilterDatabase"==c.Name&&c.Sheet==r){c.Ref="'"+n.SheetNames[r]+"'!"+i;break}}return s==o.length&&o.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+n.SheetNames[r]+"'!"+i}),ht("autoFilter",null,{ref:i})}(c["!autofilter"],c,n,e)),null!=c["!merges"]&&c["!merges"].length>0&&(o[o.length]=function(e){if(0===e.length)return"";for(var t='<mergeCells count="'+e.length+'">',n=0;n!=e.length;++n)t+='<mergeCell ref="'+xn(e[n])+'"/>';return t+"</mergeCells>"}(c["!merges"]));var d,p,h=-1,v=-1;return c["!links"].length>0&&(o[o.length]="<hyperlinks>",c["!links"].forEach((function(e){e[1].Target&&(d={ref:e[0]},"#"!=e[1].Target.charAt(0)&&(v=Sr(r,-1,Ze(e[1].Target).replace(/#.*$/,""),br.HLINK),d["r:id"]="rId"+v),(h=e[1].Target.indexOf("#"))>-1&&(d.location=Ze(e[1].Target.slice(h+1))),e[1].Tooltip&&(d.tooltip=Ze(e[1].Tooltip)),o[o.length]=ht("hyperlink",null,d))})),o[o.length]="</hyperlinks>"),delete c["!links"],null!=c["!margins"]&&(o[o.length]=(qo(p=c["!margins"]),ht("pageMargins",null,p))),t&&!t.ignoreEC&&void 0!=t.ignoreEC||(o[o.length]=dt("ignoredErrors",ht("ignoredError",null,{numberStoredAsText:1,sqref:u}))),f.length>0&&(v=Sr(r,-1,"../drawings/drawing"+(e+1)+".xml",br.DRAW),o[o.length]=ht("drawing",null,{"r:id":"rId"+v}),c["!drawing"]=f),c["!comments"].length>0&&(v=Sr(r,-1,"../drawings/vmlDrawing"+(e+1)+".vml",br.VML),o[o.length]=ht("legacyDrawing",null,{"r:id":"rId"+v}),c["!legacy"]=v),o.length>1&&(o[o.length]="</worksheet>",o[1]=o[1].replace("/>",">")),o.join("")}function Qo(e,t,n,r){var i=function(e,t,n){var r=En(145),i=(n["!rows"]||[])[e]||{};r.write_shift(4,e),r.write_shift(4,0);var o=320;i.hpx?o=20*ki(i.hpx):i.hpt&&(o=20*i.hpt),r.write_shift(2,o),r.write_shift(1,0);var a=0;i.level&&(a|=i.level),i.hidden&&(a|=16),(i.hpx||i.hpt)&&(a|=32),r.write_shift(1,a),r.write_shift(1,0);var s=0,c=r.l;r.l+=4;for(var u={r:e,c:0},l=0;l<16;++l)if(!(t.s.c>l+1<<10||t.e.c<l<<10)){for(var f=-1,d=-1,p=l<<10;p<l+1<<10;++p)u.c=p,(Array.isArray(n)?(n[u.r]||[])[u.c]:n[Cn(u)])&&(f<0&&(f=p),d=p);f<0||(++s,r.write_shift(4,f),r.write_shift(4,d))}var h=r.l;return r.l=c,r.write_shift(4,s),r.l=h,r.length>r.l?r.slice(0,r.l):r}(r,n,t);(i.length>17||(t["!rows"]||[])[r])&&bn(e,0,i)}var $o=ar,Zo=sr;function ea(e){return[Yn(e),cr(e),"n"]}var ta=ar,na=sr;var ra=["left","right","top","bottom","header","footer"];function ia(e,t,n,r,i,o,a){if(void 0===t.v)return!1;var s="";switch(t.t){case"b":s=t.v?"1":"0";break;case"d":(t=Ve(t)).z=t.z||U[14],t.v=Ne(Fe(t.v)),t.t="n";break;case"n":case"e":s=""+t.v;break;default:s=t.v}var c={r:n,c:r};switch(c.s=Ho(i.cellXfs,t,i),t.l&&o["!links"].push([Cn(c),t.l]),t.c&&o["!comments"].push([Cn(c),t.c]),t.t){case"s":case"str":return i.bookSST?(s=Go(i.Strings,t.v,i.revStrings),c.t="s",c.v=s,a?bn(e,18,function(e,t,n){return null==n&&(n=En(8)),Jn(t,n),n.write_shift(4,t.v),n}(0,c)):bn(e,7,function(e,t,n){return null==n&&(n=En(12)),zn(t,n),n.write_shift(4,t.v),n}(0,c))):(c.t="str",a?bn(e,17,function(e,t,n){return null==n&&(n=En(8+4*e.v.length)),Jn(t,n),Vn(e.v,n),n.length>n.l?n.slice(0,n.l):n}(t,c)):bn(e,6,function(e,t,n){return null==n&&(n=En(12+4*e.v.length)),zn(t,n),Vn(e.v,n),n.length>n.l?n.slice(0,n.l):n}(t,c))),!0;case"n":return t.v==(0|t.v)&&t.v>-1e3&&t.v<1e3?a?bn(e,13,function(e,t,n){return null==n&&(n=En(8)),Jn(t,n),ir(e.v,n),n}(t,c)):bn(e,2,function(e,t,n){return null==n&&(n=En(12)),zn(t,n),ir(e.v,n),n}(t,c)):a?bn(e,16,function(e,t,n){return null==n&&(n=En(12)),Jn(t,n),ur(e.v,n),n}(t,c)):bn(e,5,function(e,t,n){return null==n&&(n=En(16)),zn(t,n),ur(e.v,n),n}(t,c)),!0;case"b":return c.t="b",a?bn(e,15,function(e,t,n){return null==n&&(n=En(5)),Jn(t,n),n.write_shift(1,e.v?1:0),n}(t,c)):bn(e,4,function(e,t,n){return null==n&&(n=En(9)),zn(t,n),n.write_shift(1,e.v?1:0),n}(t,c)),!0;case"e":return c.t="e",a?bn(e,14,function(e,t,n){return null==n&&(n=En(8)),Jn(t,n),n.write_shift(1,e.v),n.write_shift(2,0),n.write_shift(1,0),n}(t,c)):bn(e,3,function(e,t,n){return null==n&&(n=En(9)),zn(t,n),n.write_shift(1,e.v),n}(t,c)),!0}return a?bn(e,12,function(e,t,n){return null==n&&(n=En(4)),Jn(t,n)}(0,c)):bn(e,1,function(e,t,n){return null==n&&(n=En(8)),zn(t,n)}(0,c)),!0}function oa(e,t){var n,r;t&&t["!merges"]&&(bn(e,177,(n=t["!merges"].length,null==r&&(r=En(4)),r.write_shift(4,n),r)),t["!merges"].forEach((function(t){bn(e,176,na(t))})),bn(e,178))}function aa(e,t){t&&t["!cols"]&&(bn(e,390),t["!cols"].forEach((function(t,n){t&&bn(e,60,function(e,t,n){null==n&&(n=En(18));var r=Wo(e,t);n.write_shift(-4,e),n.write_shift(-4,e),n.write_shift(4,256*(r.width||10)),n.write_shift(4,0);var i=0;return t.hidden&&(i|=1),"number"==typeof r.width&&(i|=2),t.level&&(i|=t.level<<8),n.write_shift(2,i),n}(n,t))})),bn(e,391))}function sa(e,t){t&&t["!ref"]&&(bn(e,648),bn(e,649,function(e){var t=En(24);return t.write_shift(4,4),t.write_shift(4,1),sr(e,t),t}(Dn(t["!ref"]))),bn(e,650))}function ca(e,t,n){t["!links"].forEach((function(t){if(t[1].Target){var r=Sr(n,-1,t[1].Target.replace(/#.*$/,""),br.HLINK);bn(e,494,function(e,t){var n=En(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));sr({s:kn(e[0]),e:kn(e[0])},n),nr("rId"+t,n);var r=e[1].Target.indexOf("#");return Vn((-1==r?"":e[1].Target.slice(r+1))||"",n),Vn(e[1].Tooltip||"",n),Vn("",n),n.slice(0,n.l)}(t,r))}})),delete t["!links"]}function ua(e,t,n){bn(e,133),bn(e,137,function(e,t,n){null==n&&(n=En(30));var r=924;return(((t||{}).Views||[])[0]||{}).RTL&&(r|=32),n.write_shift(2,r),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(2,0),n.write_shift(2,100),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(4,0),n}(0,n)),bn(e,138),bn(e,134)}function la(e,t){var n,r;t["!protect"]&&bn(e,535,(n=t["!protect"],null==r&&(r=En(66)),r.write_shift(2,n.password?yi(n.password):0),r.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach((function(e){e[1]?r.write_shift(4,null==n[e[0]]||n[e[0]]?0:1):r.write_shift(4,null!=n[e[0]]&&n[e[0]]?0:1)})),r))}function fa(e,t,n,r){var i=_n(),o=n.SheetNames[e],a=n.Sheets[o]||{},s=o;try{n&&n.Workbook&&(s=n.Workbook.Sheets[e].CodeName||s)}catch(f){}var c,u,l=Dn(a["!ref"]||"A1");if(l.e.c>16383||l.e.r>1048575){if(t.WTF)throw new Error("Range "+(a["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");l.e.c=Math.min(l.e.c,16383),l.e.r=Math.min(l.e.c,1048575)}return a["!links"]=[],a["!comments"]=[],bn(i,129),(n.vbaraw||a["!outline"])&&bn(i,147,function(e,t,n){null==n&&(n=En(84+4*e.length));var r=192;t&&(t.above&&(r&=-65),t.left&&(r&=-129)),n.write_shift(1,r);for(var i=1;i<3;++i)n.write_shift(1,0);return lr({auto:1},n),n.write_shift(-4,-1),n.write_shift(-4,-1),Qn(e,n),n.slice(0,n.l)}(s,a["!outline"])),bn(i,148,Zo(l)),ua(i,0,n.Workbook),aa(i,a),function(e,t,n,r){var i,o=Dn(t["!ref"]||"A1"),a="",s=[];bn(e,145);var c=Array.isArray(t),u=o.e.r;t["!rows"]&&(u=Math.max(o.e.r,t["!rows"].length-1));for(var l=o.s.r;l<=u;++l){a=On(l),Qo(e,t,o,l);var f=!1;if(l<=o.e.r)for(var d=o.s.c;d<=o.e.c;++d){l===o.s.r&&(s[d]=An(d)),i=s[d]+a;var p=c?(t[l]||[])[d]:t[i];f=!!p&&ia(e,p,l,d,r,t,f)}}bn(e,146)}(i,a,0,t),la(i,a),function(e,t,n,r){if(t["!autofilter"]){var i=t["!autofilter"],o="string"===typeof i.ref?i.ref:xn(i.ref);n.Workbook||(n.Workbook={Sheets:[]}),n.Workbook.Names||(n.Workbook.Names=[]);var a=n.Workbook.Names,s=Nn(o);s.s.r==s.e.r&&(s.e.r=Nn(t["!ref"]).e.r,o=xn(s));for(var c=0;c<a.length;++c){var u=a[c];if("_xlnm._FilterDatabase"==u.Name&&u.Sheet==r){u.Ref="'"+n.SheetNames[r]+"'!"+o;break}}c==a.length&&a.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+n.SheetNames[r]+"'!"+o}),bn(e,161,sr(Dn(o))),bn(e,162)}}(i,a,n,e),oa(i,a),ca(i,a,r),a["!margins"]&&bn(i,476,(c=a["!margins"],null==u&&(u=En(48)),qo(c),ra.forEach((function(e){ur(c[e],u)})),u)),t&&!t.ignoreEC&&void 0!=t.ignoreEC||sa(i,a),function(e,t,n,r){if(t["!comments"].length>0){var i=Sr(r,-1,"../drawings/vmlDrawing"+(n+1)+".vml",br.VML);bn(e,551,nr("rId"+i)),t["!legacy"]=i}}(i,a,e,r),bn(i,130),i.end()}var da=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];var pa="][*?/\\".split("");function ha(e,t){if(e.length>31){if(t)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var n=!0;return pa.forEach((function(r){if(-1!=e.indexOf(r)){if(!t)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");n=!1}})),n}function va(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");var t,n,r,i=e.Workbook&&e.Workbook.Sheets||[];t=e.SheetNames,n=i,r=!!e.vbaraw,t.forEach((function(e,i){ha(e);for(var o=0;o<i;++o)if(e==t[o])throw new Error("Duplicate Sheet Name: "+e);if(r){var a=n&&n[i]&&n[i].CodeName||e;if(95==a.charCodeAt(0)&&a.length>22)throw new Error("Bad Code Name: Worksheet"+a)}}));for(var o=0;o<e.SheetNames.length;++o)Ko(e.Sheets[e.SheetNames[o]],e.SheetNames[o],o)}function ma(e){var t=[Ye];t[t.length]=ht("workbook",null,{xmlns:kt[0],"xmlns:r":Rt});var n=e.Workbook&&(e.Workbook.Names||[]).length>0,r={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(da.forEach((function(t){null!=e.Workbook.WBProps[t[0]]&&e.Workbook.WBProps[t[0]]!=t[1]&&(r[t[0]]=e.Workbook.WBProps[t[0]])})),e.Workbook.WBProps.CodeName&&(r.codeName=e.Workbook.WBProps.CodeName,delete r.CodeName)),t[t.length]=ht("workbookPr",null,r);var i=e.Workbook&&e.Workbook.Sheets||[],o=0;if(i&&i[0]&&i[0].Hidden){for(t[t.length]="<bookViews>",o=0;o!=e.SheetNames.length&&i[o]&&i[o].Hidden;++o);o==e.SheetNames.length&&(o=0),t[t.length]='<workbookView firstSheet="'+o+'" activeTab="'+o+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",o=0;o!=e.SheetNames.length;++o){var a={name:Ze(e.SheetNames[o].slice(0,31))};if(a.sheetId=""+(o+1),a["r:id"]="rId"+(o+1),i[o])switch(i[o].Hidden){case 1:a.state="hidden";break;case 2:a.state="veryHidden"}t[t.length]=ht("sheet",null,a)}return t[t.length]="</sheets>",n&&(t[t.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach((function(e){var n={name:e.Name};e.Comment&&(n.comment=e.Comment),null!=e.Sheet&&(n.localSheetId=""+e.Sheet),e.Hidden&&(n.hidden="1"),e.Ref&&(t[t.length]=ht("definedName",Ze(e.Ref),n))})),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function ga(e,t){if(t.Workbook&&t.Workbook.Sheets){for(var n,r,i=t.Workbook.Sheets,o=0,a=-1,s=-1;o<i.length;++o)!i[o]||!i[o].Hidden&&-1==a?a=o:1==i[o].Hidden&&-1==s&&(s=o);if(!(s>a))bn(e,135),bn(e,158,(n=a,r||(r=En(29)),r.write_shift(-4,0),r.write_shift(-4,460),r.write_shift(4,28800),r.write_shift(4,17600),r.write_shift(4,500),r.write_shift(4,n),r.write_shift(4,n),r.write_shift(1,120),r.length>r.l?r.slice(0,r.l):r)),bn(e,136)}}function Ea(e,t){var n=_n();return bn(n,131),bn(n,128,function(e,t){t||(t=En(127));for(var n=0;4!=n;++n)t.write_shift(4,0);return Vn("SheetJS",t),Vn(r.version,t),Vn(r.version,t),Vn("7262",t),t.length>t.l?t.slice(0,t.l):t}()),bn(n,153,function(e,t){t||(t=En(72));var n=0;return e&&e.filterPrivacy&&(n|=8),t.write_shift(4,n),t.write_shift(4,0),Qn(e&&e.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}(e.Workbook&&e.Workbook.WBProps||null)),ga(n,e),function(e,t){bn(e,143);for(var n=0;n!=t.SheetNames.length;++n){bn(e,156,(r={Hidden:t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[n]&&t.Workbook.Sheets[n].Hidden||0,iTabID:n+1,strRelID:"rId"+(n+1),name:t.SheetNames[n]},(i=void 0)||(i=En(127)),i.write_shift(4,r.Hidden),i.write_shift(4,r.iTabID),nr(r.strRelID,i),Vn(r.name.slice(0,31),i),i.length>i.l?i.slice(0,i.l):i))}var r,i;bn(e,144)}(n,e),bn(n,132),n.end()}function _a(e,t,n,r,i){return(".bin"===t.slice(-4)?fa:Xo)(e,n,r,i)}function ba(e,t,n){return(".bin"===t.slice(-4)?Zi:Xi)(e,n)}function ya(e,t){var n=[];return e.Props&&n.push(function(e,t){var n=[];return Oe(Dr).map((function(e){for(var t=0;t<Or.length;++t)if(Or[t][1]==e)return Or[t];for(t=0;t<kr.length;++t)if(kr[t][1]==e)return kr[t];throw e})).forEach((function(r){if(null!=e[r[1]]){var i=t&&t.Props&&null!=t.Props[r[1]]?t.Props[r[1]]:e[r[1]];"date"===r[2]&&(i=new Date(i).toISOString().replace(/\.\d*Z/,"Z")),"number"==typeof i?i=String(i):!0===i||!1===i?i=i?"1":"0":i instanceof Date&&(i=new Date(i).toISOString().replace(/\.\d*Z/,"")),n.push(dt(Dr[r[1]]||r[1],i))}})),ht("DocumentProperties",n.join(""),{xmlns:Ct})}(e.Props,t)),e.Custprops&&n.push(function(e,t){var n=["Worksheets","SheetNames"],r="CustomDocumentProperties",i=[];return e&&Oe(e).forEach((function(t){if(Object.prototype.hasOwnProperty.call(e,t)){for(var r=0;r<Or.length;++r)if(t==Or[r][1])return;for(r=0;r<kr.length;++r)if(t==kr[r][1])return;for(r=0;r<n.length;++r)if(t==n[r])return;var o=e[t],a="string";"number"==typeof o?(a="float",o=String(o)):!0===o||!1===o?(a="boolean",o=o?"1":"0"):o=String(o),i.push(ht(et(t),o,{"dt:dt":a}))}})),t&&Oe(t).forEach((function(n){if(Object.prototype.hasOwnProperty.call(t,n)&&(!e||!Object.prototype.hasOwnProperty.call(e,n))){var r=t[n],o="string";"number"==typeof r?(o="float",r=String(r)):!0===r||!1===r?(o="boolean",r=r?"1":"0"):r instanceof Date?(o="dateTime.tz",r=r.toISOString()):r=String(r),i.push(ht(et(n),r,{"dt:dt":o}))}})),"<"+r+' xmlns="'+Ct+'">'+i.join("")+"</"+r+">"}(e.Props,e.Custprops)),n.join("")}function Ta(e){return ht("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+ro(e.Ref,{r:0,c:0})})}function Sa(e,t,n,r,i,o,a){if(!e||void 0==e.v&&void 0==e.f)return"";var s={};if(e.f&&(s["ss:Formula"]="="+Ze(ro(e.f,a))),e.F&&e.F.slice(0,t.length)==t){var c=kn(e.F.slice(t.length+1));s["ss:ArrayRange"]="RC:R"+(c.r==a.r?"":"["+(c.r-a.r)+"]")+"C"+(c.c==a.c?"":"["+(c.c-a.c)+"]")}if(e.l&&e.l.Target&&(s["ss:HRef"]=Ze(e.l.Target),e.l.Tooltip&&(s["x:HRefScreenTip"]=Ze(e.l.Tooltip))),n["!merges"])for(var u=n["!merges"],l=0;l!=u.length;++l)u[l].s.c==a.c&&u[l].s.r==a.r&&(u[l].e.c>u[l].s.c&&(s["ss:MergeAcross"]=u[l].e.c-u[l].s.c),u[l].e.r>u[l].s.r&&(s["ss:MergeDown"]=u[l].e.r-u[l].s.r));var f="",d="";switch(e.t){case"z":if(!r.sheetStubs)return"";break;case"n":f="Number",d=String(e.v);break;case"b":f="Boolean",d=e.v?"1":"0";break;case"e":f="Error",d=mr[e.v];break;case"d":f="DateTime",d=new Date(e.v).toISOString(),null==e.z&&(e.z=e.z||U[14]);break;case"s":f="String",d=((e.v||"")+"").replace(Qe,(function(e){return Xe[e]})).replace(tt,(function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}))}var p=Ho(r.cellXfs,e,r);s["ss:StyleID"]="s"+(21+p),s["ss:Index"]=a.c+1;var h=null!=e.v?d:"",v="z"==e.t?"":'<Data ss:Type="'+f+'">'+h+"</Data>";return(e.c||[]).length>0&&(v+=e.c.map((function(e){var t=ht("ss:Data",(e.t||"").replace(/(\r\n|[\r\n])/g,"&#10;"),{xmlns:"http://www.w3.org/TR/REC-html40"});return ht("Comment",t,{"ss:Author":e.a})})).join("")),ht("Cell",v,s)}function wa(e,t){var n='<Row ss:Index="'+(e+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=Ci(t.hpt)),t.hpx&&(n+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(n+=' ss:Hidden="1"')),n+">"}function Ra(e,t,n){var r=[],i=n.SheetNames[e],o=n.Sheets[i],a=o?function(e,t,n,r){if(!e)return"";if(!((r||{}).Workbook||{}).Names)return"";for(var i=r.Workbook.Names,o=[],a=0;a<i.length;++a){var s=i[a];s.Sheet==n&&(s.Name.match(/^_xlfn\./)||o.push(Ta(s)))}return o.join("")}(o,0,e,n):"";return a.length>0&&r.push("<Names>"+a+"</Names>"),a=o?function(e,t,n,r){if(!e["!ref"])return"";var i=Dn(e["!ref"]),o=e["!merges"]||[],a=0,s=[];e["!cols"]&&e["!cols"].forEach((function(e,t){Ai(e);var n=!!e.width,r=Wo(t,e),i={"ss:Index":t+1};n&&(i["ss:Width"]=Ri(r.width)),e.hidden&&(i["ss:Hidden"]="1"),s.push(ht("Column",null,i))}));for(var c=Array.isArray(e),u=i.s.r;u<=i.e.r;++u){for(var l=[wa(u,(e["!rows"]||[])[u])],f=i.s.c;f<=i.e.c;++f){var d=!1;for(a=0;a!=o.length;++a)if(!(o[a].s.c>f)&&!(o[a].s.r>u)&&!(o[a].e.c<f)&&!(o[a].e.r<u)){o[a].s.c==f&&o[a].s.r==u||(d=!0);break}if(!d){var p={r:u,c:f},h=Cn(p),v=c?(e[u]||[])[f]:e[h];l.push(Sa(v,h,e,t,0,0,p))}}l.push("</Row>"),l.length>2&&s.push(l.join(""))}return s.join("")}(o,t):"",a.length>0&&r.push("<Table>"+a+"</Table>"),r.push(function(e,t,n,r){if(!e)return"";var i=[];if(e["!margins"]&&(i.push("<PageSetup>"),e["!margins"].header&&i.push(ht("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&i.push(ht("Footer",null,{"x:Margin":e["!margins"].footer})),i.push(ht("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),i.push("</PageSetup>")),r&&r.Workbook&&r.Workbook.Sheets&&r.Workbook.Sheets[n])if(r.Workbook.Sheets[n].Hidden)i.push(ht("Visible",1==r.Workbook.Sheets[n].Hidden?"SheetHidden":"SheetVeryHidden",{}));else{for(var o=0;o<n&&(!r.Workbook.Sheets[o]||r.Workbook.Sheets[o].Hidden);++o);o==n&&i.push("<Selected/>")}return((((r||{}).Workbook||{}).Views||[])[0]||{}).RTL&&i.push("<DisplayRightToLeft/>"),e["!protect"]&&(i.push(dt("ProtectContents","True")),e["!protect"].objects&&i.push(dt("ProtectObjects","True")),e["!protect"].scenarios&&i.push(dt("ProtectScenarios","True")),null==e["!protect"].selectLockedCells||e["!protect"].selectLockedCells?null==e["!protect"].selectUnlockedCells||e["!protect"].selectUnlockedCells||i.push(dt("EnableSelection","UnlockedCells")):i.push(dt("EnableSelection","NoSelection")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach((function(t){e["!protect"][t[0]]&&i.push("<"+t[1]+"/>")}))),0==i.length?"":ht("WorksheetOptions",i.join(""),{xmlns:Nt})}(o,0,e,n)),r.join("")}function Oa(e,t){t||(t={}),e.SSF||(e.SSF=Ve(U)),e.SSF&&(_e(),Ee(e.SSF),t.revssf=ke(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF,t.cellXfs=[],Ho(t.cellXfs,{},{revssf:{General:0}}));var n=[];n.push(ya(e,t)),n.push(""),n.push(""),n.push("");for(var r=0;r<e.SheetNames.length;++r)n.push(ht("Worksheet",Ra(r,t,e),{"ss:Name":Ze(e.SheetNames[r])}));return n[2]=function(e,t){var n=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach((function(e,t){var r=[];r.push(ht("NumberFormat",null,{"ss:Format":Ze(U[e.numFmtId])}));var i={"ss:ID":"s"+(21+t)};n.push(ht("Style",r.join(""),i))})),ht("Styles",n.join(""))}(0,t),n[3]=function(e){if(!((e||{}).Workbook||{}).Names)return"";for(var t=e.Workbook.Names,n=[],r=0;r<t.length;++r){var i=t[r];null==i.Sheet&&(i.Name.match(/^_xlfn\./)||n.push(Ta(i)))}return ht("Names",n.join(""))}(e),Ye+ht("Workbook",n.join(""),{xmlns:xt,"xmlns:o":Ct,"xmlns:x":Nt,"xmlns:ss":xt,"xmlns:dt":Dt,"xmlns:html":Mt})}var Ia="e0859ff2f94f6810ab9108002b27b3d9",Aa="02d5cdd59c2e1b10939708002b2cf9ae",ka="05d5cdd59c2e1b10939708002b2cf9ae";function Ca(e,t){var n=t||{},r=Te.utils.cfb_new({root:"R"}),i="/Workbook";switch(n.bookType||"xls"){case"xls":n.bookType="biff8";case"xla":n.bookType||(n.bookType="xla");case"biff8":i="/Workbook",n.biff=8;break;case"biff5":i="/Book",n.biff=5;break;default:throw new Error("invalid type "+n.bookType+" for XLS CFB")}return Te.utils.cfb_add(r,i,Va(e,n)),8==n.biff&&(e.Props||e.Custprops)&&function(e,t){var n,r=[],i=[],o=[],a=0,s=Ie(dr,"n"),c=Ie(pr,"n");if(e.Props)for(n=Oe(e.Props),a=0;a<n.length;++a)(Object.prototype.hasOwnProperty.call(s,n[a])?r:Object.prototype.hasOwnProperty.call(c,n[a])?i:o).push([n[a],e.Props[n[a]]]);if(e.Custprops)for(n=Oe(e.Custprops),a=0;a<n.length;++a)Object.prototype.hasOwnProperty.call(e.Props||{},n[a])||(Object.prototype.hasOwnProperty.call(s,n[a])?r:Object.prototype.hasOwnProperty.call(c,n[a])?i:o).push([n[a],e.Custprops[n[a]]]);var u=[];for(a=0;a<o.length;++a)Lr.indexOf(o[a][0])>-1||Cr.indexOf(o[a][0])>-1||null!=o[a][1]&&u.push(o[a]);i.length&&Te.utils.cfb_add(t,"/\x05SummaryInformation",jr(i,Ia,c,pr)),(r.length||u.length)&&Te.utils.cfb_add(t,"/\x05DocumentSummaryInformation",jr(r,Aa,s,dr,u.length?u:null,ka))}(e,r),8==n.biff&&e.vbaraw&&function(e,t){t.FullPaths.forEach((function(n,r){if(0!=r){var i=n.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");"/"!==i.slice(-1)&&Te.utils.cfb_add(e,i,t.FileIndex[r].content)}}))}(r,Te.read(e.vbaraw,{type:"string"==typeof e.vbaraw?"binary":"buffer"})),r}var Na={0:{f:function(e,t){var n={},r=e.l+t;n.r=e.read_shift(4),e.l+=4;var i=e.read_shift(2);e.l+=1;var o=e.read_shift(1);return e.l=r,7&o&&(n.level=7&o),16&o&&(n.hidden=!0),32&o&&(n.hpt=i/20),n}},1:{f:function(e){return[Kn(e)]}},2:{f:function(e){return[Kn(e),rr(e),"n"]}},3:{f:function(e){return[Kn(e),e.read_shift(1),"e"]}},4:{f:function(e){return[Kn(e),e.read_shift(1),"b"]}},5:{f:function(e){return[Kn(e),cr(e),"n"]}},6:{f:function(e){return[Kn(e),Bn(e),"str"]}},7:{f:function(e){return[Kn(e),e.read_shift(4),"s"]}},8:{f:function(e,t,n){var r=e.l+t,i=Kn(e);i.r=n["!row"];var o=[i,Bn(e),"str"];if(n.cellFormula){e.l+=2;var a=Lo(e,r-e.l,n);o[3]=No(a,0,i,n.supbooks,n)}else e.l=r;return o}},9:{f:function(e,t,n){var r=e.l+t,i=Kn(e);i.r=n["!row"];var o=[i,cr(e),"n"];if(n.cellFormula){e.l+=2;var a=Lo(e,r-e.l,n);o[3]=No(a,0,i,n.supbooks,n)}else e.l=r;return o}},10:{f:function(e,t,n){var r=e.l+t,i=Kn(e);i.r=n["!row"];var o=[i,e.read_shift(1),"b"];if(n.cellFormula){e.l+=2;var a=Lo(e,r-e.l,n);o[3]=No(a,0,i,n.supbooks,n)}else e.l=r;return o}},11:{f:function(e,t,n){var r=e.l+t,i=Kn(e);i.r=n["!row"];var o=[i,e.read_shift(1),"e"];if(n.cellFormula){e.l+=2;var a=Lo(e,r-e.l,n);o[3]=No(a,0,i,n.supbooks,n)}else e.l=r;return o}},12:{f:function(e){return[Yn(e)]}},13:{f:function(e){return[Yn(e),rr(e),"n"]}},14:{f:function(e){return[Yn(e),e.read_shift(1),"e"]}},15:{f:function(e){return[Yn(e),e.read_shift(1),"b"]}},16:{f:ea},17:{f:function(e){return[Yn(e),Bn(e),"str"]}},18:{f:function(e){return[Yn(e),e.read_shift(4),"s"]}},19:{f:Wn},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:function(e,t,n){var r=e.l+t;e.l+=4,e.l+=1;var i=e.read_shift(4),o=er(e),a=Mo(e,0,n),s=$n(e);e.l=r;var c={Name:o,Ptg:a};return i<268435455&&(c.Sheet=i),s&&(c.Comment=s),c}},40:{},42:{},43:{f:function(e,t,n){var r={};r.sz=e.read_shift(2)/20;var i=function(e){var t=e.read_shift(1);return e.l++,{fBold:1&t,fItalic:2&t,fUnderline:4&t,fStrikeout:8&t,fOutline:16&t,fShadow:32&t,fCondense:64&t,fExtend:128&t}}(e);switch(i.fItalic&&(r.italic=1),i.fCondense&&(r.condense=1),i.fExtend&&(r.extend=1),i.fShadow&&(r.shadow=1),i.fOutline&&(r.outline=1),i.fStrikeout&&(r.strike=1),700===e.read_shift(2)&&(r.bold=1),e.read_shift(2)){case 1:r.vertAlign="superscript";break;case 2:r.vertAlign="subscript"}var o=e.read_shift(1);0!=o&&(r.underline=o);var a=e.read_shift(1);a>0&&(r.family=a);var s=e.read_shift(1);switch(s>0&&(r.charset=s),e.l++,r.color=function(e){var t={},n=e.read_shift(1)>>>1,r=e.read_shift(1),i=e.read_shift(2,"i"),o=e.read_shift(1),a=e.read_shift(1),s=e.read_shift(1);switch(e.l++,n){case 0:t.auto=1;break;case 1:t.index=r;var c=vr[r];c&&(t.rgb=Si(c));break;case 2:t.rgb=Si([o,a,s]);break;case 3:t.theme=r}return 0!=i&&(t.tint=i>0?i/32767:i/32768),t}(e),e.read_shift(1)){case 1:r.scheme="major";break;case 2:r.scheme="minor"}return r.name=Bn(e),r}},44:{f:function(e,t){return[e.read_shift(2),Bn(e)]}},45:{f:Mi},46:{f:Bi},47:{f:function(e,t){var n=e.l+t,r=e.read_shift(2),i=e.read_shift(2);return e.l=n,{ixfe:r,numFmtId:i}}},48:{},49:{f:function(e){return e.read_shift(4,"i")}},50:{},51:{f:function(e){for(var t=[],n=e.read_shift(4);n-- >0;)t.push([e.read_shift(4),e.read_shift(4)]);return t}},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:ui},62:{f:function(e){return[Kn(e),Wn(e),"is"]}},63:{f:function(e){var t={};t.i=e.read_shift(4);var n={};n.r=e.read_shift(4),n.c=e.read_shift(4),t.r=Cn(n);var r=e.read_shift(1);return 2&r&&(t.l="1"),8&r&&(t.a="1"),t}},64:{f:function(){}},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:gn,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:function(e){var t=e.read_shift(2);return e.l+=28,{RTL:32&t}}},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:function(e,t){var n={},r=e[e.l];return++e.l,n.above=!(64&r),n.left=!(128&r),e.l+=18,n.name=Xn(e,t-19),n}},148:{f:$o,p:16},151:{f:function(){}},152:{},153:{f:function(e,t){var n={},r=e.read_shift(4);n.defaultThemeVersion=e.read_shift(4);var i=t>8?Bn(e):"";return i.length>0&&(n.CodeName=i),n.autoCompressPictures=!!(65536&r),n.backupFile=!!(64&r),n.checkCompatibility=!!(4096&r),n.date1904=!!(1&r),n.filterPrivacy=!!(8&r),n.hidePivotFieldList=!!(1024&r),n.promptedSolutions=!!(16&r),n.publishItems=!!(2048&r),n.refreshAllConnections=!!(262144&r),n.saveExternalLinkValues=!!(128&r),n.showBorderUnselectedTables=!!(4&r),n.showInkAnnotation=!!(32&r),n.showObjects=["all","placeholders","none"][r>>13&3],n.showPivotChartFilter=!!(32768&r),n.updateLinks=["userSet","never","always"][r>>8&3],n}},154:{},155:{},156:{f:function(e,t){var n={};return n.Hidden=e.read_shift(4),n.iTabID=e.read_shift(4),n.strRelID=tr(e,t-8),n.name=Bn(e),n}},157:{},158:{},159:{T:1,f:function(e){return[e.read_shift(4),e.read_shift(4)]}},160:{T:-1},161:{T:1,f:ar},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:ta},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:function(e,t){return{flags:e.read_shift(4),version:e.read_shift(4),name:Bn(e)}}},336:{T:-1},337:{f:function(e){return e.l+=4,0!=e.read_shift(4)},T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:tr},357:{},358:{},359:{},360:{T:1},361:{},362:{f:ai},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:function(e,t,n){var r=e.l+t,i=or(e),o=e.read_shift(1),a=[i];if(a[2]=o,n.cellFormula){var s=Po(e,r-e.l,n);a[1]=s}else e.l=r;return a}},427:{f:function(e,t,n){var r=e.l+t,i=[ar(e,16)];if(n.cellFormula){var o=Uo(e,r-e.l,n);i[1]=o,e.l=r}else e.l=r;return i}},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:function(e){var t={};return ra.forEach((function(n){t[n]=cr(e)})),t}},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:function(){}},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:function(e,t){var n=e.l+t,r=ar(e,16),i=$n(e),o=Bn(e),a=Bn(e),s=Bn(e);e.l=n;var c={rfx:r,relId:i,loc:o,display:s};return a&&(c.Tooltip=a),c}},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:tr},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:$i},633:{T:1},634:{T:-1},635:{T:1,f:function(e){var t={};t.iauthor=e.read_shift(4);var n=ar(e,16);return t.rfx=n.s,t.ref=Cn(n.s),e.l+=16,t}},636:{T:-1},637:{f:qn},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:function(e,t){return e.l+=10,{name:Bn(e)}}},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:function(){}},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function xa(e,t,n,r){var i=t;if(!isNaN(i)){var o=r||(n||[]).length||0,a=e.next(4);a.write_shift(2,i),a.write_shift(2,o),o>0&&rn(n)&&e.push(n)}}function Da(e,t,n){return e||(e=En(7)),e.write_shift(2,t),e.write_shift(2,n),e.write_shift(2,0),e.write_shift(1,0),e}function Pa(e,t,n,r){if(null!=t.v)switch(t.t){case"d":case"n":var i="d"==t.t?Ne(Fe(t.v)):t.v;return void(i==(0|i)&&i>=0&&i<65536?xa(e,2,function(e,t,n){var r=En(9);return Da(r,e,t),r.write_shift(2,n),r}(n,r,i)):xa(e,3,function(e,t,n){var r=En(15);return Da(r,e,t),r.write_shift(8,n,"f"),r}(n,r,i)));case"b":case"e":return void xa(e,5,function(e,t,n,r){var i=En(9);return Da(i,e,t),Wr(n,r||"b",i),i}(n,r,t.v,t.t));case"s":case"str":return void xa(e,4,function(e,t,n){var r=En(8+2*n.length);return Da(r,e,t),r.write_shift(1,n.length),r.write_shift(n.length,n,"sbcs"),r.l<r.length?r.slice(0,r.l):r}(n,r,(t.v||"").slice(0,255)))}xa(e,1,Da(null,n,r))}function La(e,t){var n=t||{};for(var r=_n(),i=0,o=0;o<e.SheetNames.length;++o)e.SheetNames[o]==n.sheet&&(i=o);if(0==i&&n.sheet&&e.SheetNames[0]!=n.sheet)throw new Error("Sheet not found: "+n.sheet);return xa(r,4==n.biff?1033:3==n.biff?521:9,ni(0,16,n)),function(e,t,n,r){var i,o=Array.isArray(t),a=Dn(t["!ref"]||"A1"),s="",c=[];if(a.e.c>255||a.e.r>16383){if(r.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");a.e.c=Math.min(a.e.c,255),a.e.r=Math.min(a.e.c,16383),i=xn(a)}for(var u=a.s.r;u<=a.e.r;++u){s=On(u);for(var l=a.s.c;l<=a.e.c;++l){u===a.s.r&&(c[l]=An(l)),i=c[l]+s;var f=o?(t[u]||[])[l]:t[i];f&&Pa(e,f,u,l)}}}(r,e.Sheets[e.SheetNames[i]],0,n),xa(r,10),r.end()}function Ma(e,t,n){xa(e,49,function(e,t){var n=e.name||"Arial",r=t&&5==t.biff,i=En(r?15+n.length:16+2*n.length);return i.write_shift(2,20*(e.sz||12)),i.write_shift(4,0),i.write_shift(2,400),i.write_shift(4,0),i.write_shift(2,0),i.write_shift(1,n.length),r||i.write_shift(1,1),i.write_shift((r?1:2)*n.length,n,r?"sbcs":"utf16le"),i}({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},n))}function Ua(e,t){if(t){var n=0;t.forEach((function(t,r){++n<=256&&t&&xa(e,125,function(e,t){var n=En(12);n.write_shift(2,t),n.write_shift(2,t),n.write_shift(2,256*e.width),n.write_shift(2,0);var r=0;return e.hidden&&(r|=1),n.write_shift(1,r),r=e.level||0,n.write_shift(1,r),n.write_shift(2,0),n}(Wo(r,t),r))}))}}function ja(e,t,n,r,i){var o=16+Ho(i.cellXfs,t,i);if(null!=t.v||t.bf)if(t.bf)xa(e,6,xo(t,n,r,0,o));else switch(t.t){case"d":case"n":xa(e,515,function(e,t,n,r){var i=En(14);return $r(e,t,r,i),ur(n,i),i}(n,r,"d"==t.t?Ne(Fe(t.v)):t.v,o));break;case"b":case"e":xa(e,517,function(e,t,n,r,i,o){var a=En(8);return $r(e,t,r,a),Wr(n,o,a),a}(n,r,t.v,o,0,t.t));break;case"s":case"str":if(i.bookSST)xa(e,253,function(e,t,n,r){var i=En(10);return $r(e,t,r,i),i.write_shift(4,n),i}(n,r,Go(i.Strings,t.v,i.revStrings),o));else xa(e,516,function(e,t,n,r,i){var o=!i||8==i.biff,a=En(+o+8+(1+o)*n.length);return $r(e,t,r,a),a.write_shift(2,n.length),o&&a.write_shift(1,1),a.write_shift((1+o)*n.length,n,o?"utf16le":"sbcs"),a}(n,r,(t.v||"").slice(0,255),o,i));break;default:xa(e,513,$r(n,r,o))}else xa(e,513,$r(n,r,o))}function Fa(e,t,n){var r,i=_n(),o=n.SheetNames[e],a=n.Sheets[o]||{},s=(n||{}).Workbook||{},c=(s.Sheets||[])[e]||{},u=Array.isArray(a),l=8==t.biff,f="",d=[],p=Dn(a["!ref"]||"A1"),h=l?65536:16384;if(p.e.c>255||p.e.r>=h){if(t.WTF)throw new Error("Range "+(a["!ref"]||"A1")+" exceeds format limit A1:IV16384");p.e.c=Math.min(p.e.c,255),p.e.r=Math.min(p.e.c,h-1)}xa(i,2057,ni(0,16,t)),xa(i,13,Gr(1)),xa(i,12,Gr(100)),xa(i,15,Br(!0)),xa(i,17,Br(!1)),xa(i,16,ur(.001)),xa(i,95,Br(!0)),xa(i,42,Br(!1)),xa(i,43,Br(!1)),xa(i,130,Gr(1)),xa(i,128,function(e){var t=En(8);return t.write_shift(4,0),t.write_shift(2,e[0]?e[0]+1:0),t.write_shift(2,e[1]?e[1]+1:0),t}([0,0])),xa(i,131,Br(!1)),xa(i,132,Br(!1)),l&&Ua(i,a["!cols"]),xa(i,512,function(e,t){var n=8!=t.biff&&t.biff?2:4,r=En(2*n+6);return r.write_shift(n,e.s.r),r.write_shift(n,e.e.r+1),r.write_shift(2,e.s.c),r.write_shift(2,e.e.c+1),r.write_shift(2,0),r}(p,t)),l&&(a["!links"]=[]);for(var v=p.s.r;v<=p.e.r;++v){f=On(v);for(var m=p.s.c;m<=p.e.c;++m){v===p.s.r&&(d[m]=An(m)),r=d[m]+f;var g=u?(a[v]||[])[m]:a[r];g&&(ja(i,g,v,m,t),l&&g.l&&a["!links"].push([r,g.l]))}}var E=c.CodeName||c.name||o;return l&&xa(i,574,function(e){var t=En(18),n=1718;return e&&e.RTL&&(n|=64),t.write_shift(2,n),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}((s.Views||[])[0])),l&&(a["!merges"]||[]).length&&xa(i,229,function(e){var t=En(2+8*e.length);t.write_shift(2,e.length);for(var n=0;n<e.length;++n)ti(e[n],t);return t}(a["!merges"])),l&&function(e,t){for(var n=0;n<t["!links"].length;++n){var r=t["!links"][n];xa(e,440,si(r)),r[1].Tooltip&&xa(e,2048,ci(r))}delete t["!links"]}(i,a),xa(i,442,Jr(E)),l&&function(e,t){var n=En(19);n.write_shift(4,2151),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,3),n.write_shift(1,1),n.write_shift(4,0),xa(e,2151,n),(n=En(39)).write_shift(4,2152),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,3),n.write_shift(1,0),n.write_shift(4,0),n.write_shift(2,1),n.write_shift(4,4),n.write_shift(2,0),ti(Dn(t["!ref"]||"A1"),n),n.write_shift(4,4),xa(e,2152,n)}(i,a),xa(i,10),i.end()}function Ba(e,t,n){var r=_n(),i=(e||{}).Workbook||{},o=i.Sheets||[],a=i.WBProps||{},s=8==n.biff,c=5==n.biff;(xa(r,2057,ni(0,5,n)),"xla"==n.bookType&&xa(r,135),xa(r,225,s?Gr(1200):null),xa(r,193,function(e,t){t||(t=En(e));for(var n=0;n<e;++n)t.write_shift(1,0);return t}(2)),c&&xa(r,191),c&&xa(r,192),xa(r,226),xa(r,92,function(e,t){var n=!t||8==t.biff,r=En(n?112:54);for(r.write_shift(8==t.biff?2:1,7),n&&r.write_shift(1,0),r.write_shift(4,859007059),r.write_shift(4,5458548|(n?0:536870912));r.l<r.length;)r.write_shift(1,n?0:32);return r}(0,n)),xa(r,66,Gr(s?1200:1252)),s&&xa(r,353,Gr(0)),s&&xa(r,448),xa(r,317,function(e){for(var t=En(2*e),n=0;n<e;++n)t.write_shift(2,n+1);return t}(e.SheetNames.length)),s&&e.vbaraw&&xa(r,211),s&&e.vbaraw)&&xa(r,442,Jr(a.CodeName||"ThisWorkbook"));xa(r,156,Gr(17)),xa(r,25,Br(!1)),xa(r,18,Br(!1)),xa(r,19,Gr(0)),s&&xa(r,431,Br(!1)),s&&xa(r,444,Gr(0)),xa(r,61,function(){var e=En(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}()),xa(r,64,Br(!1)),xa(r,141,Gr(0)),xa(r,34,Br("true"==function(e){return e.Workbook&&e.Workbook.WBProps&&rt(e.Workbook.WBProps.date1904)?"true":"false"}(e))),xa(r,14,Br(!0)),s&&xa(r,439,Br(!1)),xa(r,218,Gr(0)),Ma(r,0,n),function(e,t,n){t&&[[5,8],[23,26],[41,44],[50,392]].forEach((function(r){for(var i=r[0];i<=r[1];++i)null!=t[i]&&xa(e,1054,ii(i,t[i],n))}))}(r,e.SSF,n),function(e,t){for(var n=0;n<16;++n)xa(e,224,oi({numFmtId:0,style:!0},0,t));t.cellXfs.forEach((function(n){xa(e,224,oi(n,0,t))}))}(r,n),s&&xa(r,352,Br(!1));var u,l=r.end(),f=_n();s&&xa(f,140,(u||(u=En(4)),u.write_shift(2,1),u.write_shift(2,1),u)),s&&n.Strings&&function(e,t,n,r){var i=r||(n||[]).length||0;if(i<=8224)return xa(e,t,n,i);var o=t;if(!isNaN(o)){for(var a=n.parts||[],s=0,c=0,u=0;u+(a[s]||8224)<=8224;)u+=a[s]||8224,s++;var l=e.next(4);for(l.write_shift(2,o),l.write_shift(2,u),e.push(n.slice(c,c+u)),c+=u;c<i;){for((l=e.next(4)).write_shift(2,60),u=0;u+(a[s]||8224)<=8224;)u+=a[s]||8224,s++;l.write_shift(2,u),e.push(n.slice(c,c+u)),c+=u}}}(f,252,function(e,t){var n=En(8);n.write_shift(4,e.Count),n.write_shift(4,e.Unique);for(var r=[],i=0;i<e.length;++i)r[i]=Hr(e[i]);var o=R([n].concat(r));return o.parts=[n.length].concat(r.map((function(e){return e.length}))),o}(n.Strings)),xa(f,10);var d=f.end(),p=_n(),h=0,v=0;for(v=0;v<e.SheetNames.length;++v)h+=(s?12:11)+(s?2:1)*e.SheetNames[v].length;var m=l.length+h+d.length;for(v=0;v<e.SheetNames.length;++v){xa(p,133,ri({pos:m,hs:(o[v]||{}).Hidden||0,dt:0,name:e.SheetNames[v]},n)),m+=t[v].length}var g=p.end();if(h!=g.length)throw new Error("BS8 "+h+" != "+g.length);var E=[];return l.length&&E.push(l),g.length&&E.push(g),d.length&&E.push(d),R(E)}function Va(e,t){for(var n=0;n<=e.SheetNames.length;++n){var r=e.Sheets[e.SheetNames[n]];if(r&&r["!ref"])Nn(r["!ref"]).e.c>255&&"undefined"!=typeof console&&console.error&&console.error("Worksheet '"+e.SheetNames[n]+"' extends beyond column IV (255).  Data may be lost.")}var i=t||{};switch(i.biff||2){case 8:case 5:return function(e,t){var n=t||{},r=[];e&&!e.SSF&&(e.SSF=Ve(U)),e&&e.SSF&&(_e(),Ee(e.SSF),n.revssf=ke(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF),n.Strings=[],n.Strings.Count=0,n.Strings.Unique=0,gs(n),n.cellXfs=[],Ho(n.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var i=0;i<e.SheetNames.length;++i)r[r.length]=Fa(i,n,e);return r.unshift(Ba(e,r,n)),R(r)}(e,t);case 4:case 3:case 2:return La(e,t)}throw new Error("invalid type "+i.bookType+" for BIFF")}function Ga(e,t,n,r){for(var i=e["!merges"]||[],o=[],a=t.s.c;a<=t.e.c;++a){for(var s=0,c=0,u=0;u<i.length;++u)if(!(i[u].s.r>n||i[u].s.c>a)&&!(i[u].e.r<n||i[u].e.c<a)){if(i[u].s.r<n||i[u].s.c<a){s=-1;break}s=i[u].e.r-i[u].s.r+1,c=i[u].e.c-i[u].s.c+1;break}if(!(s<0)){var l=Cn({r:n,c:a}),f=r.dense?(e[n]||[])[a]:e[l],d=f&&null!=f.v&&(f.h||nt(f.w||(Ln(f),f.w)||""))||"",p={};s>1&&(p.rowspan=s),c>1&&(p.colspan=c),r.editable?d='<span contenteditable="true">'+d+"</span>":f&&(p["data-t"]=f&&f.t||"z",null!=f.v&&(p["data-v"]=f.v),null!=f.z&&(p["data-z"]=f.z),f.l&&"#"!=(f.l.Target||"#").charAt(0)&&(d='<a href="'+f.l.Target+'">'+d+"</a>")),p.id=(r.id||"sjs")+"-"+l,o.push(ht("td",d,p))}}return"<tr>"+o.join("")+"</tr>"}var Wa='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',qa="</body></html>";function Ha(e,t,n){return[].join("")+"<table"+(n&&n.id?' id="'+n.id+'"':"")+">"}function Ka(e,t){var n=t||{},r=null!=n.header?n.header:Wa,i=null!=n.footer?n.footer:qa,o=[r],a=Nn(e["!ref"]);n.dense=Array.isArray(e),o.push(Ha(0,0,n));for(var s=a.s.r;s<=a.e.r;++s)o.push(Ga(e,a,s,n));return o.push("</table>"+i),o.join("")}function za(e,t,n){var r=n||{};var i=0,o=0;if(null!=r.origin)if("number"==typeof r.origin)i=r.origin;else{var a="string"==typeof r.origin?kn(r.origin):r.origin;i=a.r,o=a.c}var s=t.getElementsByTagName("tr"),c=Math.min(r.sheetRows||1e7,s.length),u={s:{r:0,c:0},e:{r:i,c:o}};if(e["!ref"]){var l=Nn(e["!ref"]);u.s.r=Math.min(u.s.r,l.s.r),u.s.c=Math.min(u.s.c,l.s.c),u.e.r=Math.max(u.e.r,l.e.r),u.e.c=Math.max(u.e.c,l.e.c),-1==i&&(u.e.r=i=l.e.r+1)}var f=[],d=0,p=e["!rows"]||(e["!rows"]=[]),h=0,v=0,m=0,g=0,E=0,_=0;for(e["!cols"]||(e["!cols"]=[]);h<s.length&&v<c;++h){var b=s[h];if(Ja(b)){if(r.display)continue;p[v]={hidden:!0}}var y=b.children;for(m=g=0;m<y.length;++m){var T=y[m];if(!r.display||!Ja(T)){var S=T.hasAttribute("data-v")?T.getAttribute("data-v"):T.hasAttribute("v")?T.getAttribute("v"):lt(T.innerHTML),w=T.getAttribute("data-z")||T.getAttribute("z");for(d=0;d<f.length;++d){var R=f[d];R.s.c==g+o&&R.s.r<v+i&&v+i<=R.e.r&&(g=R.e.c+1-o,d=-1)}_=+T.getAttribute("colspan")||1,((E=+T.getAttribute("rowspan")||1)>1||_>1)&&f.push({s:{r:v+i,c:g+o},e:{r:v+i+(E||1)-1,c:g+o+(_||1)-1}});var O={t:"s",v:S},I=T.getAttribute("data-t")||T.getAttribute("t")||"";null!=S&&(0==S.length?O.t=I||"z":r.raw||0==S.trim().length||"s"==I||("TRUE"===S?O={t:"b",v:!0}:"FALSE"===S?O={t:"b",v:!1}:isNaN(We(S))?isNaN(He(S).getDate())||(O={t:"d",v:Fe(S)},r.cellDates||(O={t:"n",v:Ne(O.v)}),O.z=r.dateNF||U[14]):O={t:"n",v:We(S)})),void 0===O.z&&null!=w&&(O.z=w);var A="",k=T.getElementsByTagName("A");if(k&&k.length)for(var C=0;C<k.length&&(!k[C].hasAttribute("href")||"#"==(A=k[C].getAttribute("href")).charAt(0));++C);A&&"#"!=A.charAt(0)&&(O.l={Target:A}),r.dense?(e[v+i]||(e[v+i]=[]),e[v+i][g+o]=O):e[Cn({c:g+o,r:v+i})]=O,u.e.c<g+o&&(u.e.c=g+o),g+=_}}++v}return f.length&&(e["!merges"]=(e["!merges"]||[]).concat(f)),u.e.r=Math.max(u.e.r,v-1+i),e["!ref"]=xn(u),v>=c&&(e["!fullref"]=xn((u.e.r=s.length-h+v-1+i,u))),e}function Ya(e,t){return za((t||{}).dense?[]:{},e,t)}function Ja(e){var t="",n=function(e){return e.ownerDocument.defaultView&&"function"===typeof e.ownerDocument.defaultView.getComputedStyle?e.ownerDocument.defaultView.getComputedStyle:"function"===typeof getComputedStyle?getComputedStyle:null}(e);return n&&(t=n(e).getPropertyValue("display")),t||(t=e.style&&e.style.display),"none"===t}var Xa=function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+pt({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return Ye+t}}(),Qa=function(){var e="          <table:table-cell />\n",t=function(t,n,r){var i=[];i.push('      <table:table table:name="'+Ze(n.SheetNames[r])+'" table:style-name="ta1">\n');var o=0,a=0,s=Nn(t["!ref"]||"A1"),c=t["!merges"]||[],u=0,l=Array.isArray(t);if(t["!cols"])for(a=0;a<=s.e.c;++a)i.push("        <table:table-column"+(t["!cols"][a]?' table:style-name="co'+t["!cols"][a].ods+'"':"")+"></table:table-column>\n");var f="",d=t["!rows"]||[];for(o=0;o<s.s.r;++o)f=d[o]?' table:style-name="ro'+d[o].ods+'"':"",i.push("        <table:table-row"+f+"></table:table-row>\n");for(;o<=s.e.r;++o){for(f=d[o]?' table:style-name="ro'+d[o].ods+'"':"",i.push("        <table:table-row"+f+">\n"),a=0;a<s.s.c;++a)i.push(e);for(;a<=s.e.c;++a){var p=!1,h={},v="";for(u=0;u!=c.length;++u)if(!(c[u].s.c>a)&&!(c[u].s.r>o)&&!(c[u].e.c<a)&&!(c[u].e.r<o)){c[u].s.c==a&&c[u].s.r==o||(p=!0),h["table:number-columns-spanned"]=c[u].e.c-c[u].s.c+1,h["table:number-rows-spanned"]=c[u].e.r-c[u].s.r+1;break}if(p)i.push("          <table:covered-table-cell/>\n");else{var m=Cn({r:o,c:a}),g=l?(t[o]||[])[a]:t[m];if(g&&g.f&&(h["table:formula"]=Ze(("of:="+g.f.replace(no,"$1[.$2$3$4$5]").replace(/\]:\[/g,":")).replace(/;/g,"|").replace(/,/g,";")),g.F&&g.F.slice(0,m.length)==m)){var E=Nn(g.F);h["table:number-matrix-columns-spanned"]=E.e.c-E.s.c+1,h["table:number-matrix-rows-spanned"]=E.e.r-E.s.r+1}if(g){switch(g.t){case"b":v=g.v?"TRUE":"FALSE",h["office:value-type"]="boolean",h["office:boolean-value"]=g.v?"true":"false";break;case"n":v=g.w||String(g.v||0),h["office:value-type"]="float",h["office:value"]=g.v||0;break;case"s":case"str":v=null==g.v?"":g.v,h["office:value-type"]="string";break;case"d":v=g.w||Fe(g.v).toISOString(),h["office:value-type"]="date",h["office:date-value"]=Fe(g.v).toISOString(),h["table:style-name"]="ce1";break;default:i.push(e);continue}var _=Ze(v).replace(/  +/g,(function(e){return'<text:s text:c="'+e.length+'"/>'})).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>");if(g.l&&g.l.Target){var b=g.l.Target;"#"==(b="#"==b.charAt(0)?"#"+b.slice(1).replace(/\./,"!"):b).charAt(0)||b.match(/^\w+:/)||(b="../"+b),_=ht("text:a",_,{"xlink:href":b.replace(/&/g,"&amp;")})}i.push("          "+ht("table:table-cell",ht("text:p",_,{}),h)+"\n")}else i.push(e)}}i.push("        </table:table-row>\n")}return i.push("      </table:table>\n"),i.join("")};return function(e,n){var r=[Ye],i=pt({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),o=pt({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});"fods"==n.bookType?(r.push("<office:document"+i+o+">\n"),r.push(Rr().replace(/office:document-meta/g,"office:meta"))):r.push("<office:document-content"+i+">\n"),function(e,t){e.push(" <office:automatic-styles>\n"),e.push('  <number:date-style style:name="N37" number:automatic-order="true">\n'),e.push('   <number:month number:style="long"/>\n'),e.push("   <number:text>/</number:text>\n"),e.push('   <number:day number:style="long"/>\n'),e.push("   <number:text>/</number:text>\n"),e.push("   <number:year/>\n"),e.push("  </number:date-style>\n");var n=0;t.SheetNames.map((function(e){return t.Sheets[e]})).forEach((function(t){if(t&&t["!cols"])for(var r=0;r<t["!cols"].length;++r)if(t["!cols"][r]){var i=t["!cols"][r];if(null==i.width&&null==i.wpx&&null==i.wch)continue;Ai(i),i.ods=n;var o=t["!cols"][r].wpx+"px";e.push('  <style:style style:name="co'+n+'" style:family="table-column">\n'),e.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+o+'"/>\n'),e.push("  </style:style>\n"),++n}}));var r=0;t.SheetNames.map((function(e){return t.Sheets[e]})).forEach((function(t){if(t&&t["!rows"])for(var n=0;n<t["!rows"].length;++n)if(t["!rows"][n]){t["!rows"][n].ods=r;var i=t["!rows"][n].hpx+"px";e.push('  <style:style style:name="ro'+r+'" style:family="table-row">\n'),e.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+i+'"/>\n'),e.push("  </style:style>\n"),++r}})),e.push('  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">\n'),e.push('   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>\n'),e.push("  </style:style>\n"),e.push('  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>\n'),e.push(" </office:automatic-styles>\n")}(r,e),r.push("  <office:body>\n"),r.push("    <office:spreadsheet>\n");for(var a=0;a!=e.SheetNames.length;++a)r.push(t(e.Sheets[e.SheetNames[a]],e,a));return r.push("    </office:spreadsheet>\n"),r.push("  </office:body>\n"),"fods"==n.bookType?r.push("</office:document>"):r.push("</office:document-content>"),r.join("")}}();function $a(e,t){if("fods"==t.bookType)return Qa(e,t);var n=ze(),r="",i=[],o=[];return Ke(n,r="mimetype","application/vnd.oasis.opendocument.spreadsheet"),Ke(n,r="content.xml",Qa(e,t)),i.push([r,"text/xml"]),o.push([r,"ContentFile"]),Ke(n,r="styles.xml",Xa(e,t)),i.push([r,"text/xml"]),o.push([r,"StylesFile"]),Ke(n,r="meta.xml",Ye+Rr()),i.push([r,"text/xml"]),o.push([r,"MetadataFile"]),Ke(n,r="manifest.rdf",function(e){var t,n,r=[Ye];r.push('<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n');for(var i=0;i!=e.length;++i)r.push(wr(e[i][0],e[i][1])),r.push((t="",n=e[i][0],['  <rdf:Description rdf:about="'+t+'">\n','    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+n+'"/>\n',"  </rdf:Description>\n"].join("")));return r.push(wr("","Document","pkg")),r.push("</rdf:RDF>"),r.join("")}(o)),i.push([r,"application/rdf+xml"]),Ke(n,r="META-INF/manifest.xml",function(e){var t=[Ye];t.push('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">\n'),t.push('  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>\n');for(var n=0;n<e.length;++n)t.push('  <manifest:file-entry manifest:full-path="'+e[n][0]+'" manifest:media-type="'+e[n][1]+'"/>\n');return t.push("</manifest:manifest>"),t.join("")}(i)),n}function Za(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function es(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):T(ut(e))}function ts(e){var t=e.reduce((function(e,t){return e+t.length}),0),n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(e,r),r+=e.length})),n}function ns(e,t){var n=t?t[0]:0,r=127&e[n];e:if(e[n++]>=128){if(r|=(127&e[n])<<7,e[n++]<128)break e;if(r|=(127&e[n])<<14,e[n++]<128)break e;if(r|=(127&e[n])<<21,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,28),++n,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,35),++n,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,42),++n,e[n++]<128)break e}return t&&(t[0]=n),r}function rs(e){var t=new Uint8Array(7);t[0]=127&e;var n=1;e:if(e>127){if(t[n-1]|=128,t[n]=e>>7&127,++n,e<=16383)break e;if(t[n-1]|=128,t[n]=e>>14&127,++n,e<=2097151)break e;if(t[n-1]|=128,t[n]=e>>21&127,++n,e<=268435455)break e;if(t[n-1]|=128,t[n]=e/256>>>21&127,++n,e<=34359738367)break e;if(t[n-1]|=128,t[n]=e/65536>>>21&127,++n,e<=4398046511103)break e;t[n-1]|=128,t[n]=e/16777216>>>21&127,++n}return t.slice(0,n)}function is(e){var t=0,n=127&e[t];e:if(e[t++]>=128){if(n|=(127&e[t])<<7,e[t++]<128)break e;if(n|=(127&e[t])<<14,e[t++]<128)break e;if(n|=(127&e[t])<<21,e[t++]<128)break e;n|=(127&e[t])<<28}return n}function os(e){for(var t=[],n=[0];n[0]<e.length;){var r,i=n[0],o=ns(e,n),a=7&o,s=0;if(0==(o=Math.floor(o/8)))break;switch(a){case 0:for(var c=n[0];e[n[0]++]>=128;);r=e.slice(c,n[0]);break;case 5:s=4,r=e.slice(n[0],n[0]+s),n[0]+=s;break;case 1:s=8,r=e.slice(n[0],n[0]+s),n[0]+=s;break;case 2:s=ns(e,n),r=e.slice(n[0],n[0]+s),n[0]+=s;break;default:throw new Error("PB Type ".concat(a," for Field ").concat(o," at offset ").concat(i))}var u={data:r,type:a};null==t[o]?t[o]=[u]:t[o].push(u)}return t}function as(e){var t=[];return e.forEach((function(e,n){e.forEach((function(e){e.data&&(t.push(rs(8*n+e.type)),2==e.type&&t.push(rs(e.data.length)),t.push(e.data))}))})),ts(t)}function ss(e){for(var t,n=[],r=[0];r[0]<e.length;){var i=ns(e,r),o=os(e.slice(r[0],r[0]+i));r[0]+=i;var a={id:is(o[1][0].data),messages:[]};o[2].forEach((function(t){var n=os(t.data),i=is(n[3][0].data);a.messages.push({meta:n,data:e.slice(r[0],r[0]+i)}),r[0]+=i})),(null==(t=o[3])?void 0:t[0])&&(a.merge=is(o[3][0].data)>>>0>0),n.push(a)}return n}function cs(e){var t=[];return e.forEach((function(e){var n=[];n[1]=[{data:rs(e.id),type:0}],n[2]=[],null!=e.merge&&(n[3]=[{data:rs(+!!e.merge),type:0}]);var r=[];e.messages.forEach((function(e){r.push(e.data),e.meta[3]=[{type:0,data:rs(e.data.length)}],n[2].push({data:as(e.meta),type:2})}));var i=as(n);t.push(rs(i.length)),t.push(i),r.forEach((function(e){return t.push(e)}))})),ts(t)}function us(e,t){if(0!=e)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var n=[0],r=ns(t,n),i=[];n[0]<t.length;){var o=3&t[n[0]];if(0!=o){var a=0,s=0;if(1==o?(s=4+(t[n[0]]>>2&7),a=(224&t[n[0]++])<<3,a|=t[n[0]++]):(s=1+(t[n[0]++]>>2),2==o?(a=t[n[0]]|t[n[0]+1]<<8,n[0]+=2):(a=(t[n[0]]|t[n[0]+1]<<8|t[n[0]+2]<<16|t[n[0]+3]<<24)>>>0,n[0]+=4)),i=[ts(i)],0==a)throw new Error("Invalid offset 0");if(a>i[0].length)throw new Error("Invalid offset beyond length");if(s>=a)for(i.push(i[0].slice(-a)),s-=a;s>=i[i.length-1].length;)i.push(i[i.length-1]),s-=i[i.length-1].length;i.push(i[0].slice(-a,-a+s))}else{var c=t[n[0]++]>>2;if(c<60)++c;else{var u=c-59;c=t[n[0]],u>1&&(c|=t[n[0]+1]<<8),u>2&&(c|=t[n[0]+2]<<16),u>3&&(c|=t[n[0]+3]<<24),c>>>=0,c++,n[0]+=u}i.push(t.slice(n[0],n[0]+c)),n[0]+=c}}var l=ts(i);if(l.length!=r)throw new Error("Unexpected length: ".concat(l.length," != ").concat(r));return l}function ls(e){for(var t=[],n=0;n<e.length;){var r=e[n++],i=e[n]|e[n+1]<<8|e[n+2]<<16;n+=3,t.push(us(r,e.slice(n,n+i))),n+=i}if(n!==e.length)throw new Error("data is not a valid framed stream!");return ts(t)}function fs(e){for(var t=[],n=0;n<e.length;){var r=Math.min(e.length-n,268435455),i=new Uint8Array(4);t.push(i);var o=rs(r),a=o.length;t.push(o),r<=60?(a++,t.push(new Uint8Array([r-1<<2]))):r<=256?(a+=2,t.push(new Uint8Array([240,r-1&255]))):r<=65536?(a+=3,t.push(new Uint8Array([244,r-1&255,r-1>>8&255]))):r<=16777216?(a+=4,t.push(new Uint8Array([248,r-1&255,r-1>>8&255,r-1>>16&255]))):r<=4294967296&&(a+=5,t.push(new Uint8Array([252,r-1&255,r-1>>8&255,r-1>>16&255,r-1>>>24&255]))),t.push(e.slice(n,n+r)),a+=r,i[0]=0,i[1]=255&a,i[2]=a>>8&255,i[3]=a>>16&255,n+=r}return ts(t)}function ds(e,t){var n=new Uint8Array(32),r=Za(n),i=12,o=0;switch(n[0]=5,e.t){case"n":n[1]=2,function(e,t,n){var r=Math.floor(0==n?0:Math.LOG10E*Math.log(Math.abs(n)))+6176-20,i=n/Math.pow(10,r-6176);e[t+15]|=r>>7,e[t+14]|=(127&r)<<1;for(var o=0;i>=1;++o,i/=256)e[t+o]=255&i;e[t+15]|=n>=0?0:128}(n,i,e.v),o|=1,i+=16;break;case"b":n[1]=6,r.setFloat64(i,e.v?1:0,!0),o|=2,i+=8;break;case"s":if(-1==t.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));n[1]=3,r.setUint32(i,t.indexOf(e.v),!0),o|=8,i+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(8,o,!0),n.slice(0,i)}function ps(e,t){var n=new Uint8Array(32),r=Za(n),i=12,o=0;switch(n[0]=3,e.t){case"n":n[2]=2,r.setFloat64(i,e.v,!0),o|=32,i+=8;break;case"b":n[2]=6,r.setFloat64(i,e.v?1:0,!0),o|=32,i+=8;break;case"s":if(-1==t.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));n[2]=3,r.setUint32(i,t.indexOf(e.v),!0),o|=16,i+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(4,o,!0),n.slice(0,i)}function hs(e){return ns(os(e)[1][0].data)}function vs(e,t,n){var r,i,o,a;if(!(null==(r=e[6])?void 0:r[0])||!(null==(i=e[7])?void 0:i[0]))throw"Mutation only works on post-BNC storages!";if((null==(a=null==(o=e[8])?void 0:o[0])?void 0:a.data)&&is(e[8][0].data)>0||!1)throw"Math only works with normal offsets";for(var s=0,c=Za(e[7][0].data),u=0,l=[],f=Za(e[4][0].data),d=0,p=[],h=0;h<t.length;++h)if(null!=t[h]){var v,m;switch(c.setUint16(2*h,u,!0),f.setUint16(2*h,d,!0),typeof t[h]){case"string":v=ds({t:"s",v:t[h]},n),m=ps({t:"s",v:t[h]},n);break;case"number":v=ds({t:"n",v:t[h]},n),m=ps({t:"n",v:t[h]},n);break;case"boolean":v=ds({t:"b",v:t[h]},n),m=ps({t:"b",v:t[h]},n);break;default:throw new Error("Unsupported value "+t[h])}l.push(v),u+=v.length,p.push(m),d+=m.length,++s}else c.setUint16(2*h,65535,!0),f.setUint16(2*h,65535);for(e[2][0].data=rs(s);h<e[7][0].data.length/2;++h)c.setUint16(2*h,65535,!0),f.setUint16(2*h,65535,!0);return e[6][0].data=ts(l),e[3][0].data=ts(p),s}function ms(e){return function(t){for(var n=0;n!=e.length;++n){var r=e[n];void 0===t[r[0]]&&(t[r[0]]=r[1]),"n"===r[2]&&(t[r[0]]=Number(t[r[0]]))}}}function gs(e){ms([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function Es(e,t){return"ods"==t.bookType?$a(e,t):"numbers"==t.bookType?function(e,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var n=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var r=Nn(n["!ref"]);r.s.r=r.s.c=0;var i=!1;r.e.c>9&&(i=!0,r.e.c=9),r.e.r>49&&(i=!0,r.e.r=49),i&&console.error("The Numbers writer is currently limited to ".concat(xn(r)));var o=Is(n,{range:r,header:1}),a=["~Sh33tJ5~"];o.forEach((function(e){return e.forEach((function(e){"string"==typeof e&&a.push(e)}))}));var s={},c=[],u=Te.read(t.numbers,{type:"base64"});u.FileIndex.map((function(e,t){return[e,u.FullPaths[t]]})).forEach((function(e){var t=e[0],n=e[1];2==t.type&&t.name.match(/\.iwa/)&&ss(ls(t.content)).forEach((function(e){c.push(e.id),s[e.id]={deps:[],location:n,type:is(e.messages[0].meta[1][0].data)}}))})),c.sort((function(e,t){return e-t}));var l=c.filter((function(e){return e>1})).map((function(e){return[e,rs(e)]}));u.FileIndex.map((function(e,t){return[e,u.FullPaths[t]]})).forEach((function(e){var t=e[0];e[1],t.name.match(/\.iwa/)&&ss(ls(t.content)).forEach((function(e){e.messages.forEach((function(t){l.forEach((function(t){e.messages.some((function(e){return 11006!=is(e.meta[1][0].data)&&function(e,t){e:for(var n=0;n<=e.length-t.length;++n){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;return!0}return!1}(e.data,t[1])}))&&s[t[0]].deps.push(e.id)}))}))}))}));for(var f,d=Te.find(u,s[1].location),p=ss(ls(d.content)),h=0;h<p.length;++h){var v=p[h];1==v.id&&(f=v)}var m=hs(os(f.messages[0].data)[1][0].data);for(p=ss(ls((d=Te.find(u,s[m].location)).content)),h=0;h<p.length;++h)(v=p[h]).id==m&&(f=v);for(m=hs(os(f.messages[0].data)[2][0].data),p=ss(ls((d=Te.find(u,s[m].location)).content)),h=0;h<p.length;++h)(v=p[h]).id==m&&(f=v);for(m=hs(os(f.messages[0].data)[2][0].data),p=ss(ls((d=Te.find(u,s[m].location)).content)),h=0;h<p.length;++h)(v=p[h]).id==m&&(f=v);var g=os(f.messages[0].data);g[6][0].data=rs(r.e.r+1),g[7][0].data=rs(r.e.c+1);for(var E=hs(g[46][0].data),_=Te.find(u,s[E].location),b=ss(ls(_.content)),y=0;y<b.length&&b[y].id!=E;++y);if(b[y].id!=E)throw"Bad ColumnRowUIDMapArchive";var T=os(b[y].messages[0].data);T[1]=[],T[2]=[],T[3]=[];for(var S=0;S<=r.e.c;++S){var w=[];w[1]=w[2]=[{type:0,data:rs(S+420690)}],T[1].push({type:2,data:as(w)}),T[2].push({type:0,data:rs(S)}),T[3].push({type:0,data:rs(S)})}T[4]=[],T[5]=[],T[6]=[];for(var R=0;R<=r.e.r;++R)(w=[])[1]=w[2]=[{type:0,data:rs(R+726270)}],T[4].push({type:2,data:as(w)}),T[5].push({type:0,data:rs(R)}),T[6].push({type:0,data:rs(R)});b[y].messages[0].data=as(T),_.content=fs(cs(b)),_.size=_.content.length,delete g[46];var O=os(g[4][0].data);O[7][0].data=rs(r.e.r+1);var I=hs(os(O[1][0].data)[2][0].data);if((b=ss(ls((_=Te.find(u,s[I].location)).content)))[0].id!=I)throw"Bad HeaderStorageBucket";var A=os(b[0].messages[0].data);for(R=0;R<o.length;++R){var k=os(A[2][0].data);k[1][0].data=rs(R),k[4][0].data=rs(o[R].length),A[2][R]={type:A[2][0].type,data:as(k)}}b[0].messages[0].data=as(A),_.content=fs(cs(b)),_.size=_.content.length;var C=hs(O[2][0].data);if((b=ss(ls((_=Te.find(u,s[C].location)).content)))[0].id!=C)throw"Bad HeaderStorageBucket";for(A=os(b[0].messages[0].data),S=0;S<=r.e.c;++S)(k=os(A[2][0].data))[1][0].data=rs(S),k[4][0].data=rs(r.e.r+1),A[2][S]={type:A[2][0].type,data:as(k)};b[0].messages[0].data=as(A),_.content=fs(cs(b)),_.size=_.content.length;var N=hs(O[4][0].data);!function(){for(var e,t=Te.find(u,s[N].location),n=ss(ls(t.content)),r=0;r<n.length;++r){var i=n[r];i.id==N&&(e=i)}var o=os(e.messages[0].data);o[3]=[];var c=[];a.forEach((function(e,t){c[1]=[{type:0,data:rs(t)}],c[2]=[{type:0,data:rs(1)}],c[3]=[{type:2,data:es(e)}],o[3].push({type:2,data:as(c)})})),e.messages[0].data=as(o);var l=fs(cs(n));t.content=l,t.size=t.content.length}();var x=os(O[3][0].data),D=x[1][0];delete x[2];var P=os(D.data),L=hs(P[2][0].data);!function(){for(var e,t=Te.find(u,s[L].location),n=ss(ls(t.content)),i=0;i<n.length;++i){var c=n[i];c.id==L&&(e=c)}var l=os(e.messages[0].data);delete l[6],delete x[7];var f=new Uint8Array(l[5][0].data);l[5]=[];for(var d=0,p=0;p<=r.e.r;++p){var h=os(f);d+=vs(h,o[p],a),h[1][0].data=rs(p),l[5].push({data:as(h),type:2})}l[1]=[{type:0,data:rs(r.e.c+1)}],l[2]=[{type:0,data:rs(r.e.r+1)}],l[3]=[{type:0,data:rs(d)}],l[4]=[{type:0,data:rs(r.e.r+1)}],e.messages[0].data=as(l);var v=fs(cs(n));t.content=v,t.size=t.content.length}(),D.data=as(P),O[3][0].data=as(x),g[4][0].data=as(O),f.messages[0].data=as(g);var M=fs(cs(p));return d.content=M,d.size=d.content.length,u}(e,t):"xlsb"==t.bookType?function(e,t){Yi=1024,e&&!e.SSF&&(e.SSF=Ve(U));e&&e.SSF&&(_e(),Ee(e.SSF),t.revssf=ke(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF);t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Vo?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var n="xlsb"==t.bookType?"bin":"xml",r=eo.indexOf(t.bookType)>-1,i={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};gs(t=t||{});var o=ze(),a="",s=0;t.cellXfs=[],Ho(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});if(Ke(o,a="docProps/core.xml",Ar(e.Props,t)),i.coreprops.push(a),Sr(t.rels,2,a,br.CORE_PROPS),a="docProps/app.xml",e.Props&&e.Props.SheetNames);else if(e.Workbook&&e.Workbook.Sheets){for(var c=[],u=0;u<e.SheetNames.length;++u)2!=(e.Workbook.Sheets[u]||{}).Hidden&&c.push(e.SheetNames[u]);e.Props.SheetNames=c}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,Ke(o,a,Nr(e.Props)),i.extprops.push(a),Sr(t.rels,3,a,br.EXT_PROPS),e.Custprops!==e.Props&&Oe(e.Custprops||{}).length>0&&(Ke(o,a="docProps/custom.xml",xr(e.Custprops)),i.custprops.push(a),Sr(t.rels,4,a,br.CUST_PROPS));for(s=1;s<=e.SheetNames.length;++s){var l={"!id":{}},f=e.Sheets[e.SheetNames[s-1]];(f||{})["!type"];if(Ke(o,a="xl/worksheets/sheet"+s+"."+n,_a(s-1,a,t,e,l)),i.sheets.push(a),Sr(t.wbrels,-1,"worksheets/sheet"+s+"."+n,br.WS[0]),f){var d=f["!comments"],p=!1,h="";d&&d.length>0&&(Ke(o,h="xl/comments"+s+"."+n,ba(d,h,t)),i.comments.push(h),Sr(l,-1,"../comments"+s+"."+n,br.CMNT),p=!0),f["!legacy"]&&p&&Ke(o,"xl/drawings/vmlDrawing"+s+".vml",Ji(s,f["!comments"])),delete f["!comments"],delete f["!legacy"]}l["!id"].rId1&&Ke(o,yr(a),Tr(l))}null!=t.Strings&&t.Strings.length>0&&(Ke(o,a="xl/sharedStrings."+n,function(e,t,n){return(".bin"===t.slice(-4)?_i:gi)(e,n)}(t.Strings,a,t)),i.strs.push(a),Sr(t.wbrels,-1,"sharedStrings."+n,br.SST));Ke(o,a="xl/workbook."+n,function(e,t,n){return(".bin"===t.slice(-4)?Ea:ma)(e,n)}(e,a,t)),i.workbooks.push(a),Sr(t.rels,1,a,br.WB),Ke(o,a="xl/theme/theme1.xml",Hi(e.Themes,t)),i.themes.push(a),Sr(t.wbrels,-1,"theme/theme1.xml",br.THEME),Ke(o,a="xl/styles."+n,function(e,t,n){return(".bin"===t.slice(-4)?qi:Ni)(e,n)}(e,a,t)),i.styles.push(a),Sr(t.wbrels,-1,"styles."+n,br.STY),e.vbaraw&&r&&(Ke(o,a="xl/vbaProject.bin",e.vbaraw),i.vba.push(a),Sr(t.wbrels,-1,"vbaProject.bin",br.VBA));return Ke(o,a="xl/metadata."+n,function(e){return(".bin"===e.slice(-4)?Ki:zi)()}(a)),i.metadata.push(a),Sr(t.wbrels,-1,"metadata."+n,br.XLMETA),Ke(o,"[Content_Types].xml",_r(i,t)),Ke(o,"_rels/.rels",Tr(t.rels)),Ke(o,"xl/_rels/workbook."+n+".rels",Tr(t.wbrels)),delete t.revssf,delete t.ssf,o}(e,t):_s(e,t)}function _s(e,t){Yi=1024,e&&!e.SSF&&(e.SSF=Ve(U)),e&&e.SSF&&(_e(),Ee(e.SSF),t.revssf=ke(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Vo?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var n="xml",r=eo.indexOf(t.bookType)>-1,i={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};gs(t=t||{});var o=ze(),a="",s=0;if(t.cellXfs=[],Ho(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),Ke(o,a="docProps/core.xml",Ar(e.Props,t)),i.coreprops.push(a),Sr(t.rels,2,a,br.CORE_PROPS),a="docProps/app.xml",e.Props&&e.Props.SheetNames);else if(e.Workbook&&e.Workbook.Sheets){for(var c=[],u=0;u<e.SheetNames.length;++u)2!=(e.Workbook.Sheets[u]||{}).Hidden&&c.push(e.SheetNames[u]);e.Props.SheetNames=c}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,Ke(o,a,Nr(e.Props)),i.extprops.push(a),Sr(t.rels,3,a,br.EXT_PROPS),e.Custprops!==e.Props&&Oe(e.Custprops||{}).length>0&&(Ke(o,a="docProps/custom.xml",xr(e.Custprops)),i.custprops.push(a),Sr(t.rels,4,a,br.CUST_PROPS));var l=["SheetJ5"];for(t.tcid=0,s=1;s<=e.SheetNames.length;++s){var f={"!id":{}},d=e.Sheets[e.SheetNames[s-1]];(d||{})["!type"];if(Ke(o,a="xl/worksheets/sheet"+s+"."+n,Xo(s-1,t,e,f)),i.sheets.push(a),Sr(t.wbrels,-1,"worksheets/sheet"+s+"."+n,br.WS[0]),d){var p=d["!comments"],h=!1,v="";if(p&&p.length>0){var m=!1;p.forEach((function(e){e[1].forEach((function(e){1==e.T&&(m=!0)}))})),m&&(Ke(o,v="xl/threadedComments/threadedComment"+s+"."+n,Qi(p,l,t)),i.threadedcomments.push(v),Sr(f,-1,"../threadedComments/threadedComment"+s+"."+n,br.TCMNT)),Ke(o,v="xl/comments"+s+"."+n,Xi(p)),i.comments.push(v),Sr(f,-1,"../comments"+s+"."+n,br.CMNT),h=!0}d["!legacy"]&&h&&Ke(o,"xl/drawings/vmlDrawing"+s+".vml",Ji(s,d["!comments"])),delete d["!comments"],delete d["!legacy"]}f["!id"].rId1&&Ke(o,yr(a),Tr(f))}return null!=t.Strings&&t.Strings.length>0&&(Ke(o,a="xl/sharedStrings."+n,gi(t.Strings,t)),i.strs.push(a),Sr(t.wbrels,-1,"sharedStrings."+n,br.SST)),Ke(o,a="xl/workbook."+n,ma(e)),i.workbooks.push(a),Sr(t.rels,1,a,br.WB),Ke(o,a="xl/theme/theme1.xml",Hi(e.Themes,t)),i.themes.push(a),Sr(t.wbrels,-1,"theme/theme1.xml",br.THEME),Ke(o,a="xl/styles."+n,Ni(e,t)),i.styles.push(a),Sr(t.wbrels,-1,"styles."+n,br.STY),e.vbaraw&&r&&(Ke(o,a="xl/vbaProject.bin",e.vbaraw),i.vba.push(a),Sr(t.wbrels,-1,"vbaProject.bin",br.VBA)),Ke(o,a="xl/metadata."+n,zi()),i.metadata.push(a),Sr(t.wbrels,-1,"metadata."+n,br.XLMETA),l.length>1&&(Ke(o,a="xl/persons/person.xml",function(e){var t=[Ye,ht("personList",null,{xmlns:yt,"xmlns:x":kt[0]}).replace(/[\/]>/,">")];return e.forEach((function(e,n){t.push(ht("person",null,{displayName:e,id:"{54EE7950-7262-4200-6969-"+("000000000000"+n).slice(-12)+"}",userId:e,providerId:"None"}))})),t.push("</personList>"),t.join("")}(l)),i.people.push(a),Sr(t.wbrels,-1,"persons/person.xml",br.PEOPLE)),Ke(o,"[Content_Types].xml",_r(i,t)),Ke(o,"_rels/.rels",Tr(t.rels)),Ke(o,"xl/_rels/workbook.xml.rels",Tr(t.wbrels)),delete t.revssf,delete t.ssf,o}function bs(e,t){var n="";switch((t||{}).type||"base64"){case"buffer":case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":n=g(e.slice(0,12));break;case"binary":n=e;break;default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3),n.charCodeAt(4),n.charCodeAt(5),n.charCodeAt(6),n.charCodeAt(7)]}function ys(e,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return Re(t.file,Te.write(e,{type:E?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return Te.write(e,t)}function Ts(e,t){var n={},r=E?"nodebuffer":"undefined"!==typeof Uint8Array?"array":"string";if(t.compression&&(n.compression="DEFLATE"),t.password)n.type=r;else switch(t.type){case"base64":n.type="base64";break;case"binary":n.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":n.type=r;break;default:throw new Error("Unrecognized type "+t.type)}var i=e.FullPaths?Te.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[n.type]||n.type,compression:!!t.compression}):e.generate(n);if("undefined"!==typeof Deno&&"string"==typeof i){if("binary"==t.type||"base64"==t.type)return i;i=new Uint8Array(S(i))}return t.password&&"undefined"!==typeof encrypt_agile?ys(encrypt_agile(i,t.password),t):"file"===t.type?Re(t.file,i):"string"==t.type?ct(i):i}function Ss(e,t,n){n||(n="");var r=n+e;switch(t.type){case"base64":return m(ut(r));case"binary":return ut(r);case"string":return e;case"file":return Re(t.file,r,"utf8");case"buffer":return E?_(r,"utf8"):"undefined"!==typeof TextEncoder?(new TextEncoder).encode(r):Ss(r,{type:"binary"}).split("").map((function(e){return e.charCodeAt(0)}))}throw new Error("Unrecognized type "+t.type)}function ws(e,t){switch(t.type){case"string":case"base64":case"binary":for(var n="",r=0;r<e.length;++r)n+=String.fromCharCode(e[r]);return"base64"==t.type?m(n):"string"==t.type?ct(n):n;case"file":return Re(t.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+t.type)}}function Rs(e,t){l(),va(e);var n=Ve(t||{});if(n.cellStyles&&(n.cellNF=!0,n.sheetStubs=!0),"array"==n.type){n.type="binary";var r=Rs(e,n);return n.type="array",S(r)}var i=0;if(n.sheet&&(i="number"==typeof n.sheet?n.sheet:e.SheetNames.indexOf(n.sheet),!e.SheetNames[i]))throw new Error("Sheet not found: "+n.sheet+" : "+typeof n.sheet);switch(n.bookType||"xlsb"){case"xml":case"xlml":return Ss(Oa(e,n),n);case"slk":case"sylk":return Ss(fi.from_sheet(e.Sheets[e.SheetNames[i]],n),n);case"htm":case"html":return Ss(Ka(e.Sheets[e.SheetNames[i]],n),n);case"txt":return function(e,t){switch(t.type){case"base64":return m(e);case"binary":case"string":return e;case"file":return Re(t.file,e,"binary");case"buffer":return E?_(e,"binary"):e.split("").map((function(e){return e.charCodeAt(0)}))}throw new Error("Unrecognized type "+t.type)}(Ns(e.Sheets[e.SheetNames[i]],n),n);case"csv":return Ss(Cs(e.Sheets[e.SheetNames[i]],n),n,"\ufeff");case"dif":return Ss(di.from_sheet(e.Sheets[e.SheetNames[i]],n),n);case"dbf":return ws(li.from_sheet(e.Sheets[e.SheetNames[i]],n),n);case"prn":return Ss(hi.from_sheet(e.Sheets[e.SheetNames[i]],n),n);case"rtf":return Ss(Ti.from_sheet(e.Sheets[e.SheetNames[i]],n),n);case"eth":return Ss(pi.from_sheet(e.Sheets[e.SheetNames[i]],n),n);case"fods":return Ss($a(e,n),n);case"wk1":return ws(vi.sheet_to_wk1(e.Sheets[e.SheetNames[i]],n),n);case"wk3":return ws(vi.book_to_wk3(e,n),n);case"biff2":n.biff||(n.biff=2);case"biff3":n.biff||(n.biff=3);case"biff4":return n.biff||(n.biff=4),ws(Va(e,n),n);case"biff5":n.biff||(n.biff=5);case"biff8":case"xla":case"xls":return n.biff||(n.biff=8),function(e,t){var n=t||{};return ys(Ca(e,n),n)}(e,n);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return function(e,t){var n=Ve(t||{});return Ts(Es(e,n),n)}(e,n);default:throw new Error("Unrecognized bookType |"+n.bookType+"|")}}function Os(e,t,n,r,i,o,a,s){var c=On(n),u=s.defval,l=s.raw||!Object.prototype.hasOwnProperty.call(s,"raw"),f=!0,d=1===i?[]:{};if(1!==i)if(Object.defineProperty)try{Object.defineProperty(d,"__rowNum__",{value:n,enumerable:!1})}catch(m){d.__rowNum__=n}else d.__rowNum__=n;if(!a||e[n])for(var p=t.s.c;p<=t.e.c;++p){var h=a?e[n][p]:e[r[p]+c];if(void 0!==h&&void 0!==h.t){var v=h.v;switch(h.t){case"z":if(null==v)break;continue;case"e":v=0==v?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+h.t)}if(null!=o[p]){if(null==v)if("e"==h.t&&null===v)d[o[p]]=null;else if(void 0!==u)d[o[p]]=u;else{if(!l||null!==v)continue;d[o[p]]=null}else d[o[p]]=l&&("n"!==h.t||"n"===h.t&&!1!==s.rawNumbers)?v:Ln(h,v,s);null!=v&&(f=!1)}}else{if(void 0===u)continue;null!=o[p]&&(d[o[p]]=u)}}return{row:d,isempty:f}}function Is(e,t){if(null==e||null==e["!ref"])return[];var n={t:"n",v:0},r=0,i=1,o=[],a=0,s="",c={s:{r:0,c:0},e:{r:0,c:0}},u=t||{},l=null!=u.range?u.range:e["!ref"];switch(1===u.header?r=1:"A"===u.header?r=2:Array.isArray(u.header)?r=3:null==u.header&&(r=0),typeof l){case"string":c=Dn(l);break;case"number":(c=Dn(e["!ref"])).s.r=l;break;default:c=l}r>0&&(i=0);var f=On(c.s.r),d=[],p=[],h=0,v=0,m=Array.isArray(e),g=c.s.r,E=0,_={};m&&!e[g]&&(e[g]=[]);var b=u.skipHidden&&e["!cols"]||[],y=u.skipHidden&&e["!rows"]||[];for(E=c.s.c;E<=c.e.c;++E)if(!(b[E]||{}).hidden)switch(d[E]=An(E),n=m?e[g][E]:e[d[E]+f],r){case 1:o[E]=E-c.s.c;break;case 2:o[E]=d[E];break;case 3:o[E]=u.header[E-c.s.c];break;default:if(null==n&&(n={w:"__EMPTY",t:"s"}),s=a=Ln(n,null,u),v=_[a]||0){do{s=a+"_"+v++}while(_[s]);_[a]=v,_[s]=1}else _[a]=1;o[E]=s}for(g=c.s.r+i;g<=c.e.r;++g)if(!(y[g]||{}).hidden){var T=Os(e,c,g,d,r,o,m,u);(!1===T.isempty||(1===r?!1!==u.blankrows:u.blankrows))&&(p[h++]=T.row)}return p.length=h,p}var As=/"/g;function ks(e,t,n,r,i,o,a,s){for(var c=!0,u=[],l="",f=On(n),d=t.s.c;d<=t.e.c;++d)if(r[d]){var p=s.dense?(e[n]||[])[d]:e[r[d]+f];if(null==p)l="";else if(null!=p.v){c=!1,l=""+(s.rawNumbers&&"n"==p.t?p.v:Ln(p,null,s));for(var h=0,v=0;h!==l.length;++h)if((v=l.charCodeAt(h))===i||v===o||34===v||s.forceQuotes){l='"'+l.replace(As,'""')+'"';break}"ID"==l&&(l='"ID"')}else null==p.f||p.F?l="":(c=!1,(l="="+p.f).indexOf(",")>=0&&(l='"'+l.replace(As,'""')+'"'));u.push(l)}return!1===s.blankrows&&c?null:u.join(a)}function Cs(e,t){var n=[],r=null==t?{}:t;if(null==e||null==e["!ref"])return"";var i=Dn(e["!ref"]),o=void 0!==r.FS?r.FS:",",a=o.charCodeAt(0),s=void 0!==r.RS?r.RS:"\n",c=s.charCodeAt(0),u=new RegExp(("|"==o?"\\|":o)+"+$"),l="",f=[];r.dense=Array.isArray(e);for(var d=r.skipHidden&&e["!cols"]||[],p=r.skipHidden&&e["!rows"]||[],h=i.s.c;h<=i.e.c;++h)(d[h]||{}).hidden||(f[h]=An(h));for(var v=0,m=i.s.r;m<=i.e.r;++m)(p[m]||{}).hidden||null!=(l=ks(e,i,m,f,a,c,o,r))&&(r.strip&&(l=l.replace(u,"")),(l||!1!==r.blankrows)&&n.push((v++?s:"")+l));return delete r.dense,n.join("")}function Ns(e,t){t||(t={}),t.FS="\t",t.RS="\n";var n=Cs(e,t);if("undefined"==typeof d||"string"==t.type)return n;var r=d.utils.encode(1200,n,"str");return String.fromCharCode(255)+String.fromCharCode(254)+r}function xs(e,t,n){var r,i=n||{},o=+!i.skipHeader,a=e||{},s=0,c=0;if(a&&null!=i.origin)if("number"==typeof i.origin)s=i.origin;else{var u="string"==typeof i.origin?kn(i.origin):i.origin;s=u.r,c=u.c}var l={s:{c:0,r:0},e:{c:c,r:s+t.length-1+o}};if(a["!ref"]){var f=Dn(a["!ref"]);l.e.c=Math.max(l.e.c,f.e.c),l.e.r=Math.max(l.e.r,f.e.r),-1==s&&(s=f.e.r+1,l.e.r=s+t.length-1+o)}else-1==s&&(s=0,l.e.r=t.length-1+o);var d=i.header||[],p=0;t.forEach((function(e,t){Oe(e).forEach((function(n){-1==(p=d.indexOf(n))&&(d[p=d.length]=n);var u=e[n],l="z",f="",h=Cn({c:c+p,r:s+t+o});r=Ds(a,h),!u||"object"!==typeof u||u instanceof Date?("number"==typeof u?l="n":"boolean"==typeof u?l="b":"string"==typeof u?l="s":u instanceof Date?(l="d",i.cellDates||(l="n",u=Ne(u)),f=i.dateNF||U[14]):null===u&&i.nullError&&(l="e",u=0),r?(r.t=l,r.v=u,delete r.w,delete r.R,f&&(r.z=f)):a[h]=r={t:l,v:u},f&&(r.z=f)):a[h]=u}))})),l.e.c=Math.max(l.e.c,c+d.length-1);var h=On(s);if(o)for(p=0;p<d.length;++p)a[An(p+c)+h]={t:"s",v:d[p]};return a["!ref"]=xn(l),a}function Ds(e,t,n){if("string"==typeof t){if(Array.isArray(e)){var r=kn(t);return e[r.r]||(e[r.r]=[]),e[r.r][r.c]||(e[r.r][r.c]={t:"z"})}return e[t]||(e[t]={t:"z"})}return Ds(e,Cn("number"!=typeof t?t:{r:t,c:n||0}))}function Ps(){return{SheetNames:[],Sheets:{}}}function Ls(e,t,n,r){var i=1;if(!n)for(;i<=65535&&-1!=e.SheetNames.indexOf(n="Sheet"+i);++i,n=void 0);if(!n||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(r&&e.SheetNames.indexOf(n)>=0){var o=n.match(/(^.*?)(\d+)$/);i=o&&+o[2]||0;var a=o&&o[1]||n;for(++i;i<=65535&&-1!=e.SheetNames.indexOf(n=a+i);++i);}if(ha(n),e.SheetNames.indexOf(n)>=0)throw new Error("Worksheet with name |"+n+"| already exists!");return e.SheetNames.push(n),e.Sheets[n]=t,n}function Ms(e,t,n){return t?(e.l={Target:t},n&&(e.l.Tooltip=n)):delete e.l,e}var Us={encode_col:An,encode_row:On,encode_cell:Cn,encode_range:xn,decode_col:In,decode_row:Rn,split_cell:function(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")},decode_cell:kn,decode_range:Nn,format_cell:Ln,sheet_add_aoa:Un,sheet_add_json:xs,sheet_add_dom:za,aoa_to_sheet:jn,json_to_sheet:function(e,t){return xs(null,e,t)},table_to_sheet:Ya,table_to_book:function(e,t){return Mn(Ya(e,t),t)},sheet_to_csv:Cs,sheet_to_txt:Ns,sheet_to_json:Is,sheet_to_html:Ka,sheet_to_formulae:function(e){var t,n="",r="";if(null==e||null==e["!ref"])return[];var i,o=Dn(e["!ref"]),a="",s=[],c=[],u=Array.isArray(e);for(i=o.s.c;i<=o.e.c;++i)s[i]=An(i);for(var l=o.s.r;l<=o.e.r;++l)for(a=On(l),i=o.s.c;i<=o.e.c;++i)if(n=s[i]+a,r="",void 0!==(t=u?(e[l]||[])[i]:e[n])){if(null!=t.F){if(n=t.F,!t.f)continue;r=t.f,-1==n.indexOf(":")&&(n=n+":"+n)}if(null!=t.f)r=t.f;else{if("z"==t.t)continue;if("n"==t.t&&null!=t.v)r=""+t.v;else if("b"==t.t)r=t.v?"TRUE":"FALSE";else if(void 0!==t.w)r="'"+t.w;else{if(void 0===t.v)continue;r="s"==t.t?"'"+t.v:""+t.v}}c[c.length]=n+"="+r}return c},sheet_to_row_object_array:Is,sheet_get_cell:Ds,book_new:Ps,book_append_sheet:Ls,book_set_sheet_visibility:function(e,t,n){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var r=function(e,t){if("number"==typeof t){if(t>=0&&e.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}if("string"==typeof t){var n=e.SheetNames.indexOf(t);if(n>-1)return n;throw new Error("Cannot find sheet name |"+t+"|")}throw new Error("Cannot find sheet |"+t+"|")}(e,t);switch(e.Workbook.Sheets[r]||(e.Workbook.Sheets[r]={}),n){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+n)}e.Workbook.Sheets[r].Hidden=n},cell_set_number_format:function(e,t){return e.z=t,e},cell_set_hyperlink:Ms,cell_set_internal_link:function(e,t,n){return Ms(e,"#"+t,n)},cell_add_comment:function(e,t,n){e.c||(e.c=[]),e.c.push({t:t,a:n||"SheetJS"})},sheet_set_array_formula:function(e,t,n,r){for(var i="string"!=typeof t?t:Dn(t),o="string"==typeof t?t:xn(t),a=i.s.r;a<=i.e.r;++a)for(var s=i.s.c;s<=i.e.c;++s){var c=Ds(e,a,s);c.t="n",c.F=o,delete c.v,a==i.s.r&&s==i.s.c&&(c.f=n,r&&(c.D=!0))}return e},consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};r.version}}]);
//# sourceMappingURL=582.9d359155.chunk.js.map