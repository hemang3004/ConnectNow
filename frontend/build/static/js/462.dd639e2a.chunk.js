"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[462],{462:function(e,t,n){n.r(t),n.d(t,{default:function(){return P}});var r=n(4165),s=n(5861),a=n(9439),i=n(2791),o=n(8652),c=n(4087),l=n(1295),u=n(3263),d=n(6971),f=n(3433),h=n(8348),p=n(1820),x=n(3380),v=n(2449),g=n(7693),m=n(1461),j=n(7521),b=n(2701),C=n(7886),w=n(4653),y=n(4224),Z=n(9884),S=n(7573),k=n(1024),_=n(184),N=function(e){var t=e.children,n=(0,h.q)(),o=n.isOpen,d=n.onOpen,N=n.onClose,M=(0,i.useState)(),A=(0,a.Z)(M,2),E=A[0],F=A[1],I=(0,i.useState)([]),z=(0,a.Z)(I,2),O=z[0],W=z[1],L=(0,i.useState)(""),G=(0,a.Z)(L,2),R=G[0],B=G[1],D=(0,i.useState)([]),q=(0,a.Z)(D,2),J=q[0],U=q[1],P=(0,i.useState)(!1),Q=(0,a.Z)(P,2),Y=Q[0],K=Q[1],T=(0,l.p)(),H=(0,k.g)(),V=H.user,X=H.chats,$=H.setChats,ee=(H.selectedChat,function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t){var n,s,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B(t),t){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,K(!0),n={headers:{Authorization:"Bearer ".concat(V.token)}},e.next=8,u.Z.get("/api/user?search=".concat(R),n);case 8:s=e.sent,a=s.data,K(!1),U(a),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),T({title:"Error Occured!",description:"Failed to Load the Search Results",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"});case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}()),te=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var t,n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E&&O){e.next=3;break}return T({title:"Please fill all the feilds",status:"warning",duration:2e3,isClosable:!0,position:"top"}),e.abrupt("return");case 3:return e.prev=3,t={headers:{Authorization:"Bearer ".concat(V.token)}},e.next=7,u.Z.post("/api/chat/group",{name:E,users:JSON.stringify(O.map((function(e){return e._id})))},t);case 7:n=e.sent,s=n.data,$([s].concat((0,f.Z)(X))),N(),T({title:"New Group Chat Created!",status:"success",duration:1e3,isClosable:!0,position:"bottom"}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),T({title:"Failed to Create the Chat!",description:e.t0.response.data,status:"error",duration:1e3,isClosable:!0,position:"bottom"});case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(){return e.apply(this,arguments)}}();return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("span",{onClick:d,children:t}),(0,_.jsxs)(p.u_,{onClose:N,isOpen:o,isCentered:!0,children:[(0,_.jsx)(x.Z,{}),(0,_.jsxs)(v.h,{children:[(0,_.jsx)(g.x,{fontSize:"35px",fontFamily:"Work sans",display:"flex",justifyContent:"center",children:"Create Group Chat"}),(0,_.jsx)(m.o,{}),(0,_.jsxs)(j.f,{display:"flex",flexDir:"column",alignItems:"center",children:[(0,_.jsx)(b.NI,{children:(0,_.jsx)(C.I,{placeholder:"Chat Name",mb:3,onChange:function(e){return F(e.target.value)}})}),(0,_.jsx)(b.NI,{children:(0,_.jsx)(C.I,{placeholder:"Add Users",mb:1,onChange:function(e){return ee(e.target.value)}})}),(0,_.jsx)(c.xu,{w:"100%",display:"flex",flexWrap:"wrap",children:O.map((function(e){return(0,_.jsx)(Z.Z,{user1:e,admin:V,handleFunction:function(){return t=e,void W(O.filter((function(e){return e._id!==t._id})));var t}},e._id)}))}),Y?(0,_.jsx)("div",{children:"Loading..."}):null===J||void 0===J?void 0:J.slice(0,3).map((function(e){return(0,_.jsx)(S.Z,{user:e,handleFunction:function(){return t=e,void(O.includes(t)?T({title:"User already added",status:"warning",duration:1e3,isClosable:!0,position:"top"}):W([].concat((0,f.Z)(O),[t])));var t}},e._id)}))]}),(0,_.jsx)(w.m,{children:(0,_.jsx)(y.z,{onClick:te,colorScheme:"blue",children:"Create Chat"})})]})]})]})},M=n(7377),A=n(7885),E=n(9120),F=n(7067),I=n(2790),z=n(447),O=n(1123),W=(n(8048),n(1622)),L=n(4930),G=n(7896),R=function(){var e=(0,k.g)(),t=e.setSelectedChat,n=e.user,r=e.notification,s=e.setNotification;e.chats,e.setChats;return(0,_.jsx)("div",{children:(0,_.jsxs)(E.v,{children:[(0,_.jsxs)(F.j,{p:"1",children:[(0,_.jsx)(G.default,{count:null===r||void 0===r?void 0:r.length,effect:L.Qm.SCALE}),(0,_.jsx)(O.D,{fontSize:"2xl",m:"1"})]}),(0,_.jsxs)(I.q,{pl:10,children:[!(null!==r&&void 0!==r&&r.length)&&"No New Messages",null===r||void 0===r?void 0:r.map((function(e){return(0,_.jsx)(z.s,{onClick:function(){t(e.chat),s(r.filter((function(t){return t!==e})))},children:e.chat.isGroupChat?"New Message in ".concat(e.chat.chatName):"New Message from ".concat((0,W.j2)(n,e.chat.users))},e._id)}))]})]})})},B=n(5232),D=n(9229),q=n(9704),J=n.n(q),U=function(e){var t=e.fetchAgain,n=(0,k.g)(),o=n.selectedChat,d=n.setSelectedChat,f=n.user,h=n.chats,p=n.setChats,x=(0,i.useState)(),v=(0,a.Z)(x,2),g=v[0],m=v[1],j=(0,l.p)(),b=(0,i.useRef)([]),C=function(e,t){return J().AES.decrypt(t,e).toString(J().enc.Utf8)},w=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var t,n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={headers:{Authorization:"Bearer ".concat(f.token)}},e.next=4,u.Z.get("/api/chat",t);case 4:n=e.sent,s=n.data,p(s),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),j({title:"Error Occured!",description:"Failed to Load the chats",status:"error",duration:2e3,isClosable:!0,position:"bottom-left"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),y=function(e){return o&&o._id===e._id},Z=function(e){return y(e)&&function(e){var t,n;return(null===(t=e.latestMessage)||void 0===t||null===(n=t.sender)||void 0===n?void 0:n.id)!==f._id}(e)?"#4c6ed5":"#E8E8E8"},S=function(e){return y(e)?"white":"black"};(0,i.useEffect)((function(){m(JSON.parse(localStorage.getItem("userInfo"))),w()}),[t]);return(0,_.jsx)(B.K,{overflowY:"scroll",children:h.map((function(e,t){var n,r,s,a,i="";return null===e||void 0===e||e.lastSeen.forEach((function(e){e.participant===String(f._id)&&(i=e.lastTime)})),(0,_.jsxs)(c.xu,{ref:function(e){return b.current[t]=e},onClick:function(){d(e),function(e){var t=b.current[e].querySelectorAll("p");t[2].style.fontWeight="normal",t[3].style.fontWeight="normal"}(t)},cursor:"pointer",bg:Z(e),color:S(e),px:3,py:2,borderRadius:"lg",children:[(0,_.jsx)(D.x,{children:e.isGroupChat?e.chatName:(0,W.j2)(g,e.users)}),e.latestMessage&&(0,_.jsxs)(D.x,{fontSize:"xs",children:[(0,_.jsxs)(D.x,{fontWeight:i<(null===e||void 0===e||null===(n=e.latestMessage)||void 0===n?void 0:n.time)?"bold":"normal",display:"inline",children:[null===e||void 0===e||null===(r=e.latestMessage)||void 0===r||null===(s=r.sender)||void 0===s?void 0:s.name," :"," "]}),(0,_.jsx)(D.x,{fontWeight:i<(null===e||void 0===e||null===(a=e.latestMessage)||void 0===a?void 0:a.time)?"bold":"normal",display:"inline",children:e.latestMessage.content.length>50?C(e._id,e.latestMessage.content).substring(0,51)+"...":C(e._id,e.latestMessage.content)})]})]},e._id)}))})},P=function(e){var t=e.fetchAgain,n=(0,k.g)(),f=n.selectedChat,h=(n.setSelectedChat,n.user),p=n.chats,x=n.setChats,v=n.newMsg,g=(0,i.useState)(),m=(0,a.Z)(g,2),j=(m[0],m[1]),b=(0,l.p)(),C=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var t,n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={headers:{Authorization:"Bearer ".concat(h.token)}},e.next=4,u.Z.get("/api/chat",t);case 4:n=e.sent,s=n.data,x(s),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),b({title:"Error Occured!",description:"Failed to Load the chats",status:"error",duration:2e3,isClosable:!0,position:"bottom-left"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();return(0,i.useEffect)((function(){C()}),[v]),(0,i.useEffect)((function(){j(JSON.parse(localStorage.getItem("userInfo"))),C()}),[t]),(0,_.jsxs)(c.xu,{display:{base:f?"none":"flex",md:"flex"},flexDir:"column",alignItems:"center",p:3,bg:"white",w:{base:"100%",md:"31%"},mr:1,borderWidth:"1px",height:"100%",children:[(0,_.jsxs)(c.xu,{display:"flex",justifyContent:"space-evenly",children:[(0,_.jsx)(c.xu,{pb:3,px:3,fontSize:{base:"28px",md:"30px"},fontFamily:"Work sans",w:"100%",justifyContent:"space-between",alignItems:"center",marginRight:16,children:"My Chats"}),(0,_.jsxs)(c.xu,{display:"flex",marginLeft:9,children:[(0,_.jsx)(N,{children:(0,_.jsx)(M.u,{label:"New Group Chat",hasArrow:!0,placement:"bottom-end",children:(0,_.jsx)(A.h,{display:"flex",fontSize:{base:"10px",md:"10px",lg:"17px"},icon:(0,_.jsx)(o.d,{})})})}),(0,_.jsx)(R,{})]})]}),(0,_.jsx)(c.xu,{display:"flex",flexDir:"column",p:3,bg:"#F8F8F8",w:"100%",h:"100%",borderRadius:"lg",overflowY:"hidden",children:p?(0,_.jsx)(U,{fetchAgain:t}):(0,_.jsx)(d.Z,{})})]})}},4930:function(e,t,n){Object.defineProperty(t,"Qm",{enumerable:!0,get:function(){return s.default}});var r=a(n(7896)),s=a(n(8912));function a(e){return e&&e.__esModule?e:{default:e}}r.default}}]);
//# sourceMappingURL=462.dd639e2a.chunk.js.map